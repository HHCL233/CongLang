/*! For license information please see blink.20f34231.js.LICENSE.txt */
"use strict";(self.webpackChunkneko=self.webpackChunkneko||[]).push([[4797],{60601:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.init_color_blocks=void 0;var o=i(98734),n=i(42798),r=i(82406),s=o.__importStar(i(37064)),_=i(98030),a=i(98929),c=i(65284);function l(t,e){var i,o,n,r,s;return(null===(i=t.get_input_target_block(e))||void 0===i?void 0:i.get_field_value("NUM"))||(null===(s=null===(r=null===(n=null===(o=t.get_input_target_block(e))||void 0===o?void 0:o.output_connection)||void 0===n?void 0:n.target_connection)||void 0===r?void 0:r.get_shadow_dom())||void 0===s?void 0:s.textContent)}e.init_color_blocks=function(t){function e(t){var e;switch(t.format_){case s.EColorFormat.ColorPalette:return(i=t.get_field("COLOR_PALETTE"))&&(t.color_=new n.Color(i.get_value())),t.color_;case s.EColorFormat.ColorString:var i;return(i=null===(e=t.get_input_target_block("COLOR_STRING"))||void 0===e?void 0:e.get_field("TEXT"))&&(t.color_=new n.Color(i.get_value())),t.color_;case s.EColorFormat.HSVA:var o=l(t,"H"),r=l(t,"S"),_=l(t,"V"),a=l(t,"A"),c=(0,n.hsv_to_rgb)({h:parseFloat(o||"0")%360,s:parseFloat(r||"0"),v:parseFloat(_||"0")});return t.color_.r=Math.round(c[0]),t.color_.g=Math.round(c[1]),t.color_.b=Math.round(c[2]),t.color_.a=parseFloat(a||"100")/100,t.color_;case s.EColorFormat.RGBA:var d=l(t,"R"),u=l(t,"G"),h=l(t,"B");a=l(t,"A");return t.color_.r=Math.round(parseFloat(d||"0")),t.color_.g=Math.round(parseFloat(u||"0")),t.color_.b=Math.round(parseFloat(h||"0")),t.color_.a=parseFloat(a||"100")/100,t.color_;default:return t.color_}}function i(t){var e=(0,n.rgb_to_hsv)(t.r,t.g,t.b);return[e.h.toFixed(0),e.s.toFixed(0),e.v.toFixed(0),(100*t.a).toFixed(0)]}function o(t){return[t.r.toFixed(0),t.g.toFixed(0),t.b.toFixed(0),(100*t.a).toFixed(0)]}t.define_block_with_object("color_picker",{init:function(){var a=t.di_container.get(_.BINDING.FieldColour)({colour:"#E8308C"});this.append_dummy_input("COLOR_PALETTE").append_field(a,"COLOR_PALETTE");var d=t.di_container.get(_.BINDING.FieldButton)({src:c.icon_setting,height:20,width:20,opt_callback:function(_){!function(_,a){var c=_.source_block;if(!c)return;e(c);var d=document.createElement("div");d.classList.add("color-menu"),_.source_block&&d.classList.add(_.source_block.type);var u=document.createElement("div");u.classList.add("color-menu-title");var h=document.createElement("div");h.innerText=a,u.appendChild(h),d.appendChild(u),Object.values(s.EColorFormat).filter((function(t){return!isNaN(Number(t))})).forEach((function(r){!function(r,_,a,c){var d=document.createElement("div");d.classList.add("color-menu-item"),r.format_===a&&d.classList.add("color-menu-item-selected");var u=e(r),h=function(t,e,r){switch(e){case s.EColorFormat.ColorString:return'  <div class="color-menu-item-content">\n        <div class="color-string">\n        \u201c'.concat((0,n.rgba_to_hex)(t).toUpperCase(),"\u201d\n        </div>\n      </div>");case s.EColorFormat.HSVA:var _=i(t),a=_[0],c=_[1],d=_[2],u=_[3];return'  <div class="color-menu-item-content">\n        <div class="color-hsva">\n          H\n          <div>'.concat(l(r,"H")||a,"</div>\n          S\n          <div>").concat(l(r,"S")||c,"</div>\n          V\n          <div>").concat(l(r,"V")||d,"</div>\n          A\n          <div>").concat(l(r,"A")||u,"</div>\n        </div>\n      </div>");case s.EColorFormat.RGBA:var h=o(t),p=h[0],g=h[1],f=h[2];u=h[3];return'  <div class="color-menu-item-content">\n        <div class="color-rgba">\n          R\n          <div>'.concat(l(r,"R")||p,"</div>\n          G\n          <div>").concat(l(r,"G")||g,"</div>\n          B\n          <div>").concat(l(r,"B")||f,"</div>\n          A\n          <div>").concat(l(r,"A")||u,"</div>\n        </div>\n      </div>");case s.EColorFormat.ColorPalette:default:return'<div class="color-menu-item-content">\n          <div class="color-palette">\n            <div style="background-color: '.concat(t,';"></div>\n          </div>\n        </div>')}}(u,a,r);d.innerHTML=h,d.addEventListener("mousedown",(function(e){var i;e.stopImmediatePropagation(),e.preventDefault(),t.widget_div.hide_if_owner(_),t.tooltip.hide();var o=String(r.format_);null===(i=r.addMutation)||void 0===i||i.call(r,a,o)})),c.appendChild(d)}(c,_,r,d)})),t.widget_div.show(_,(function(){_.focus(!1)}));var p=t.widget_div.DIV;null===p||void 0===p||p.appendChild(d),_.source_block.workspace.options.dropdown.menu.align="center";var g=(0,r.position_dropdown)(d,_);t.widget_div.position(g[0],g[1])}(_,t.Msg.SELECT_COLOR_PARAM_TYPE)},has_circle:!0});this.append_dummy_input("BUTTON").append_field(d,"BUTTON"),this.set_output(!0,["String","Color"]),this.set_inputs_inline(!0),this.set_colour(t.theme.block_color.PURPLE_1.fill),this.format_=s.EColorFormat.ColorPalette,this.color_=new n.Color("#E8308C"),t.extensions.apply("param_color_block",this)},addMutation:function(e,i){if(void 0!==e&&"string"!==typeof e){this.updateShape_(e);var o=t.di_container,n=o.get(_.BINDING.events);if(n.is_enabled()){var r=o.get(_.BINDING.ChangeEvent)("mutation",{block:this,old_value:void 0,new_value:e,name:i});n.fire(r)}}},removeMutation:function(e,i){if(void 0!==i){this.updateShape_(parseInt(i));var o=t.di_container,n=o.get(_.BINDING.events);if(n.is_enabled()){var r=o.get(_.BINDING.ChangeEvent)("mutation",{block:this,old_value:void 0,new_value:i,name:e});n.fire(r)}}},updateShape_:function(r,c){var l=this;if(this.format_!==r){switch(c||e(this),this.format_){case s.EColorFormat.ColorPalette:this.remove_input("COLOR_PALETTE");break;case s.EColorFormat.ColorString:this.remove_input("COLOR_STRING");break;case s.EColorFormat.HSVA:["H","S","V","A"].forEach((function(t){return l.remove_input(t)}));break;case s.EColorFormat.RGBA:["R","G","B","A"].forEach((function(t){return l.remove_input(t)}))}switch(r){case s.EColorFormat.ColorPalette:var f=t.di_container.get(_.BINDING.FieldColour);this.append_dummy_input("COLOR_PALETTE",0).append_field(f({colour:this.color_.toString()}),"COLOR_PALETTE"),this.format_=s.EColorFormat.ColorPalette;break;case s.EColorFormat.ColorString:this.append_shadow_input("COLOR_STRING",(0,a.text_shadow)((0,n.rgba_to_hex)(this.color_).toUpperCase()),0).set_check("String"),this.format_=s.EColorFormat.ColorString;break;case s.EColorFormat.HSVA:var v=i(this.color_),m=v[0],b=v[1],y=v[2],E=v[3];this.append_shadow_input("H",g(m,d,p),0).set_check("Number").append_field("H"),this.append_shadow_input("S",(0,a.number_shadow)(b,h),1).set_check("Number").append_field("S"),this.append_shadow_input("V",(0,a.number_shadow)(y,h),2).set_check("Number").append_field("V"),this.append_shadow_input("A",(0,a.number_shadow)(E,h),3).set_check("Number").append_field("A"),["H","S","V","A"].forEach((function(t){l.get_shadow_field(t).set_controller_option({type:s.ControllerType.COLOR_PICKER,color_format:s.EColorControllerFormat.HSVA,line:t})})),this.format_=s.EColorFormat.HSVA;break;case s.EColorFormat.RGBA:var k=o(this.color_),T=k[0],w=k[1],O=k[2];E=k[3];this.append_shadow_input("R",(0,a.number_shadow)(T,u),0).set_check("Number").append_field("R"),this.append_shadow_input("G",(0,a.number_shadow)(w,u),1).set_check("Number").append_field("G"),this.append_shadow_input("B",(0,a.number_shadow)(O,u),2).set_check("Number").append_field("B"),this.append_shadow_input("A",(0,a.number_shadow)(E,h),3).set_check("Number").append_field("A"),["R","G","B","A"].forEach((function(t){l.get_shadow_field(t).set_controller_option({type:s.ControllerType.COLOR_PICKER,color_format:s.EColorControllerFormat.RGBA,line:t})})),this.format_=s.EColorFormat.RGBA}this.render()}},domToMutation:function(t){if(t){var e=parseInt(t.getAttribute("format")||"1"),i=new n.Color(t.getAttribute("color")||"#E8308C");this.color_=i,this.updateShape_(e,i)}},mutationToDom:function(){var t=document.createElement("mutation");t.setAttribute("format",String(this.format_));var i=e(this);return i&&t.setAttribute("color",i.toString()),t}}),Object.assign(t.blocks_xml,{color_picker:'<block type="color_picker">\n      <mutation format="1" color="#E8308C"></mutation>\n      <field name="COLOR_PALETTE">#E8308C</field>\n    </block>'})};var d="0,360,1,false",u="0,255,1,",h="0,100,1,",p="360",g=function(t,e,i){return'<shadow type="math_number"><field name="NUM" constraints="'.concat(e,'" exceptions="').concat(i,'">').concat(t,"</field></shadow>")}},28799:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.init_tell_blocks=e.is_controls_if=e.init_control_blocks=void 0;var o=i(98030),n=i(56905),r=i(61972),s=i(98929),_=["Boolean"],a="EXTRA_ADD_ELSE",c="ADD_ELSE_IF",l="REMOVE_ELSE";e.init_control_blocks=function(t){var e=[{type:"repeat_forever",message0:(0,s.i18n)("repeat_forever"),args0:[{type:"input_dummy",align:"CENTRE"},{type:"input_statement",name:"DO"}],previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("BLUE_1"),inputsInline:!0},{type:"repeat_n_times",message0:(0,s.i18n)("repeat_n_times"),args0:[{type:"input_value",name:"times",check:"Number",align:"CENTRE"},{type:"input_dummy",align:"CENTRE"},{type:"input_statement",name:"DO"}],previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("BLUE_1"),inputsInline:!0},{type:"repeat_forever_until",message0:(0,s.i18n)("repeat_forever_until"),args0:[{type:"input_value",name:"condition",check:"Boolean",align:"CENTRE"},{type:"input_dummy",align:"CENTRE"},{type:"input_statement",name:"DO"}],previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("BLUE_1"),inputsInline:!0},{type:"break",message0:(0,s.i18n)("break"),previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("BLUE_1"),inputsInline:!0},{type:"warp",message0:(0,s.i18n)("warp"),args0:[{type:"input_dummy",align:"CENTRE"},{type:"input_statement",name:"DO"}],previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("GREEN_5"),inputsInline:!0},{type:"wait",message0:(0,s.i18n)("wait_secs"),args0:[{type:"input_value",name:"time",check:"Number",align:"CENTRE"}],previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("BLUE_1"),inputsInline:!0},{type:"wait_until",message0:(0,s.i18n)("wait_until"),args0:[{type:"input_value",name:"condition",check:"Boolean",align:"CENTRE"}],previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("BLUE_1"),inputsInline:!0},{type:"destruct",message0:(0,s.i18n)("destruct"),previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("BLUE_1"),inputsInline:!0},{type:"controls_if",message0:"".concat((0,s.i18n)("CONTROLS_IF_MSG_IF")," %1"),args0:[{type:"input_value",name:"IF0",check:_}],message1:"%1",args1:[{type:"input_statement",name:"DO0"}],message2:"%1 %2",args2:[{type:"mutation_add_button",name:c},{type:"input_dummy",name:a}],inputsInline:!0,previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("BLUE_1"),mutator:"controls_if_mutator_codemao",extensions:["controls_if_tooltip"]}];t.define_blocks_with_json_array(e),Object.assign(t.blocks_xml,{repeat_forever:'<block type="repeat_forever"/>',repeat_n_times:'<block type="repeat_n_times">\n      '.concat((0,s.number_value)("times","20","1,,1"),"\n    </block>"),repeat_forever_until:'<block type="repeat_forever_until">\n      '.concat((0,s.logic_value)("condition"),"\n    </block>"),break:'<block type="break"/>',warp:'<block type="warp"/>',wait:'<block type="wait">\n      '.concat((0,s.number_value)("time","1","0"),"\n    </block>"),wait_until:'<block type="wait_until">\n      '.concat((0,s.logic_value)("condition"),"\n    </block>"),destruct:'<block type="destruct"/>',controls_if_no_else:'<block type="controls_if">\n      '.concat((0,s.logic_value)("IF0"),"\n    </block>"),controls_if:'<block type="controls_if">\n\n      <mutation else="1"></mutation>\n      '.concat((0,s.logic_value)("IF0"),"\n    </block>")});var i={elseCount_:0,prevElseCount_:0,elseifCount_:0,prevElseifCount_:0,addMutation:function(e){this.elseCount_<1?this.elseCount_=1:this.elseifCount_++,this.updateShape_(e);var i=t.di_container,n=i.get(o.BINDING.events),r=i.get(o.BINDING.ChangeEvent);if(n.is_enabled()){var s=r("mutation",{block:this,old_value:void 0,new_value:e||this.prevElseifCount_});n.fire(s)}},removeMutation:function(e){this.elseifCount_>0?this.elseifCount_--:this.elseCount_=0,this.updateShape_(e);var i=t.di_container,n=i.get(o.BINDING.events);if(n.is_enabled()){var r=i.get(o.BINDING.ChangeEvent);n.fire(r("mutation",{block:this,old_value:e||this.prevElseifCount_,new_value:void 0}))}},updateShape_:function(e){var i,d;if(this.prevElseifCount_!==this.elseifCount_||this.prevElseCount_!==this.elseCount_){var u=t.di_container,h=u.get(o.BINDING.Msg),p=u.get(o.BINDING.MutationAddButton),g=u.get(o.BINDING.MutationRemoveButton);if(this.prevElseCount_!==this.elseCount_&&(this.prevElseCount_<this.elseCount_?(this.remove_input(a),this.append_dummy_input("ELSE_TEXT").append_field(h.CONTROLS_IF_MSG_ELSE).append_field(g(1),l).append_field(p(),c),this.append_statement_input("ELSE")):(this.remove_input("ELSE"),this.remove_input("ELSE_TEXT"),this.append_dummy_input(a).append_field(p(),c)),this.prevElseCount_=this.elseCount_),this.prevElseifCount_!==this.elseifCount_){var f=u.get(o.BINDING.events);if(this.elseifCount_>this.prevElseifCount_){if(this.elseifCount_>0)if((k=this.get_input("ELSE_TEXT"))&&k.get_field(l))k.remove_field(l),(E=k.get_field(c))&&(E.margin_left=26);var v=e||this.prevElseifCount_+1,m=this.elseifCount_-this.prevElseifCount_;this.inputList=this.inputList.map((function(t){var e=Number(t.name.match(/[0-9]+/));if(e>=v){t.name=t.name.replace(String(e),String(e+m));var i=t.fieldRow[0];(0,r.is_field_mutation)(i)&&!i.is_add&&i.set_index(e+m)}return t})),f.disable();for(var b=v+m-1;b>=v;b--){var y=b===this.elseifCount_?"ELSE_TEXT":"IF".concat(b+1);this.append_logic_shadow("IF".concat(b),y).set_check(_).append_field((0,s.i18n)("CONTROLS_IF_MSG_ELSEIF")),this.append_dummy_input("IF_TEXT".concat(b),y).append_field(g(b),"REMOVE_BUTTON".concat(b)),this.append_statement_input("DO".concat(b),y)}f.enable()}else{if(0===this.elseifCount_){var E,k=this.get_input("ELSE_TEXT");(0,n.assert)(k),k.insert_field_at(1,g(1),l),(E=k.get_field(c))&&(E.margin_left=t.theme.renderer.SEP_SPACE_X)}for(var T=e||this.prevElseifCount_,w=new RegExp("[^0-9]".concat(T,"$")),O=this.inputList.length-1;O>=0;O--){var N=this.inputList[O];w.test(N.name)&&((null===(d=null===(i=N.connection)||void 0===i?void 0:i.targetBlock())||void 0===d?void 0:d.is_shadow())?(f.disable(),this.remove_input(N.name),f.enable()):this.remove_input(N.name))}this.inputList=this.inputList.map((function(t){var e=Number(t.name.match(/[0-9]+/));if(e>T){t.name=t.name.replace(String(e),String(e-1));var i=t.fieldRow[0];(0,r.is_field_mutation)(i)&&!i.is_add&&i.set_index(e-1)}return t}))}this.prevElseifCount_=this.elseifCount_,this.render()}else this.render()}},domToMutation:function(t){this.elseifCount_=parseInt(t.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(t.getAttribute("else"),10)||0,this.updateShape_()},mutationToDom:function(){if(this.elseifCount_||this.elseCount_){var t=document.createElement("mutation");return this.elseifCount_&&t.setAttribute("elseif",String(this.elseifCount_)),this.elseCount_&&t.setAttribute("else",String(1)),t}}},d=Object.assign({},i,{updateShape_:function(){}});t.extensions.register("controls_if_tooltip",(function(){var e=this;this.set_tooltip((function(){var i=t.di_container.get(o.BINDING.utils),n=function(t){return i.replace_message_references((0,s.i18n)("CONTROLS_IF_TOOLTIP_".concat(t)))};return e.elseifCount_||e.elseCount_?!e.elseifCount_&&e.elseCount_?n(2):e.elseifCount_&&!e.elseCount_?n(3):n(4):n(1)}))})),t.extensions.register_mutator("controls_if_mutator_codemao",i),t.extensions.register_mutator("controls_if_one_else_mutator_codemao",d)};e.is_controls_if=function(t){return"controls_if"===t.type},e.init_tell_blocks=function(t,e){var i=[{type:"tell",message0:(0,s.i18n)("tell"),args0:[{type:"field_dropdown",name:"sprite",options:function(){var t=e();return t.length>1&&t.shift(),t}},{type:"input_dummy",align:"CENTRE"},{type:"input_statement",name:"DO"}],previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("BLUE_1"),inputsInline:!0,extensions:["disable_inside_warp_loop"]},{type:"sync_tell",message0:(0,s.i18n)("sync_tell"),args0:[{type:"field_dropdown",name:"sprite",options:function(){var t=e();return t.length>1&&t.shift(),t}},{type:"input_dummy",align:"CENTRE"},{type:"input_statement",name:"DO"}],previousStatement:!0,nextStatement:!0,colour:(0,s.i18n)("BLUE_1"),inputsInline:!0,extensions:["disable_inside_warp_loop"]}];t.define_blocks_with_json_array(i),Object.assign(t.blocks_xml,{tell:'<block type="tell"/>',sync_tell:'<block type="sync_tell"/>'})}},62848:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.init_data_blocks=void 0;var o=i(98929);e.init_data_blocks=function(t,e){var i=[{type:"variables_get",message0:(0,o.i18n)("variables_get"),args0:[{type:"field_dropdown",name:"VAR",options:function(){return e("any",!0)}}],output:!0,colour:(0,o.i18n)("ORANGE_2"),inputsInline:!0},{type:"variables_set",message0:(0,o.i18n)("variables_set"),args0:[{type:"field_dropdown",name:"VAR",options:function(){return e("any")}},{type:"input_value",name:"VALUE",align:"CENTRE",check:["Number","String","Boolean","Array"]}],inputsInline:!0,previousStatement:!0,nextStatement:!0,colour:(0,o.i18n)("ORANGE_2")},{type:"change_variable",message0:(0,o.i18n)("change_variable"),args0:[{type:"field_dropdown",name:"valname",options:function(){return e("any")}},{type:"field_dropdown",name:"method",options:[[(0,o.i18n)("increase"),"increase"],[(0,o.i18n)("decrease"),"decrease"]]},{type:"input_value",name:"n",check:"Number",align:"CENTRE"}],previousStatement:!0,nextStatement:!0,colour:(0,o.i18n)("ORANGE_2"),inputsInline:!0},{type:"lists_get",message0:(0,o.i18n)("lists_get"),args0:[{type:"field_dropdown",name:"VAR",options:function(){return e("list",!0)}}],output:"Array",colour:(0,o.i18n)("ORANGE_1"),inputsInline:!0},{type:"lists_append",message0:(0,o.i18n)("lists_append"),args0:[{type:"input_value",name:"VALUE",check:["String","Number","Boolean","Array"]},{type:"input_value",name:"VAR",check:["Array"]}],colour:(0,o.i18n)("ORANGE_1"),inputsInline:!0,previousStatement:!0,nextStatement:!0},{type:"lists_insert_value",message0:(0,o.i18n)("lists_insert_value"),args0:[{type:"input_value",name:"VAR",align:"CENTRE",check:"Array"},{type:"input_value",check:"Number",name:"INDEX",align:"CENTRE"},{type:"input_value",name:"VALUE",align:"CENTRE"}],colour:(0,o.i18n)("ORANGE_1"),inputsInline:!0,previousStatement:!0,nextStatement:!0},{type:"lists_copy",message0:(0,o.i18n)("lists_copy"),args0:[{type:"input_value",name:"TARGET",check:"Array"},{type:"input_value",name:"VALUE",check:"Array"}],colour:(0,o.i18n)("ORANGE_1"),inputsInline:!0,previousStatement:!0,nextStatement:!0},{type:"lists_length",message0:(0,o.i18n)("lists_length"),args0:[{type:"input_value",name:"VAR",check:"Array"}],output:"Number",colour:(0,o.i18n)("ORANGE_1"),inputsInline:!0},{type:"lists_is_exist",message0:(0,o.i18n)("lists_is_exist"),args0:[{type:"input_value",name:"VAR",check:"Array"},{type:"input_value",name:"VALUE",align:"CENTRE"}],colour:(0,o.i18n)("ORANGE_1"),output:"Boolean",inputsInline:!0},{type:"lists_index_of",message0:(0,o.i18n)("lists_index_of"),args0:[{type:"input_value",name:"VALUE",align:"CENTRE"},{type:"input_value",name:"VAR",check:"Array"}],colour:(0,o.i18n)("ORANGE_1"),output:"Number",inputsInline:!0}];t.define_blocks_with_json_array(i),Object.assign(t.blocks_xml,{variables_get:'<block type="variables_get" />',variables_set:'<block type="variables_set">\n      '.concat((0,o.number_value)("VALUE","0"),"\n    </block>"),change_variable:'<block type="change_variable">\n      '.concat((0,o.number_value)("n","1"),"\n    </block>"),lists_get:'<block type="lists_get" />',lists_append:'<block type="lists_append">\n      '.concat((0,o.number_value)("VALUE","0"),'\n      <value name="VAR">\n        <shadow type="lists_get">\n        </shadow>\n      </value>\n    </block>'),lists_insert_value:'<block type="lists_insert_value">\n      <value name="VAR">\n        <shadow type="lists_get">\n        </shadow>\n      </value>\n      '.concat((0,o.number_value)("INDEX","1","1,,1"),"\n      ").concat((0,o.number_value)("VALUE","0"),"\n    </block>"),lists_copy:'<block type="lists_copy">\n      <value name="TARGET">\n        <shadow type="lists_get">\n        </shadow>\n      </value>\n      <value name="VALUE">\n        <shadow type="lists_get">\n        </shadow>\n      </value>\n    </block>',lists_length:'<block type="lists_length">\n      <value name="VAR">\n        <shadow type="lists_get">\n        </shadow>\n      </value>\n    </block>',lists_is_exist:'<block type="lists_is_exist">\n      <value name="VAR">\n        <shadow type="lists_get">\n        </shadow>\n      </value>\n      '.concat((0,o.number_value)("VALUE"),"\n    </block>"),lists_index_of:'<block type="lists_index_of">\n      '.concat((0,o.number_value)("VALUE"),'\n      <value name="VAR">\n        <shadow type="lists_get">\n        </shadow>\n      </value>\n    </block>')})}},98929:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.logic_value=e.logic_shadow=e.number_value=e.number_shadow=e.text_value=e.text_shadow=e.create_head_icon=e.i18n=void 0;e.i18n=function(t){return"%{BKY_".concat(t,"}")},e.create_head_icon=function(t){return{type:"field_icon",is_head:!0,src:t,width:38,height:38,alt:"*"}};e.text_shadow=function(t,e){return void 0===t&&(t=""),void 0===e&&(e=""),'<shadow type="text" id="'.concat(e,'"><field name="TEXT">').concat(t,"</field></shadow>")};e.text_value=function(t,i){return void 0===i&&(i=""),'<value name="'.concat(t,'">').concat((0,e.text_shadow)(i),"</value>")};e.number_shadow=function(t,e){return void 0===t&&(t="0"),e?'<shadow type="math_number"><field name="NUM" constraints="'.concat(e,'">').concat(t,"</field></shadow>"):'<shadow type="math_number"><field name="NUM">'.concat(t,"</field></shadow>")};e.number_value=function(t,i,o){return void 0===i&&(i="0"),'<value name="'.concat(t,'">').concat((0,e.number_shadow)(i,o),"</value>")};e.logic_shadow=function(){return'<empty type="logic_empty"></empty>'};e.logic_value=function(t){return'<value name="'.concat(t,'">').concat((0,e.logic_shadow)(),"</value>")}},65849:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.init_events_blocks=void 0;var o=i(98929),n=i(65284);e.init_events_blocks=function(t){var e=[{type:"start_on_click",message0:(0,o.i18n)("start_on_click"),args0:[(0,o.create_head_icon)(n.icon_start)],nextStatement:!0,colour:(0,o.i18n)("BLUE_3"),inputsInline:!0},{type:"start_on_click_2",message0:(0,o.i18n)("start_on_click_2"),args0:[(0,o.create_head_icon)(n.icon_start),{type:"input_dummy",align:"CENTRE"},{type:"input_statement",name:"DO"}],colour:(0,o.i18n)("BLUE_3"),inputsInline:!0},{type:"on_running_group_activated",message0:(0,o.i18n)("on_running_group_activated"),args0:[(0,o.create_head_icon)(n.icon_start)],nextStatement:!0,colour:(0,o.i18n)("BLUE_3"),inputsInline:!0},{type:"self_listen",message0:(0,o.i18n)("self_listen"),args0:[(0,o.create_head_icon)(n.icon_broadcast),{type:"input_value",name:"message",check:"String"},{type:"input_dummy",align:"CENTRE"},{type:"input_statement",name:"DO"}],colour:(0,o.i18n)("BLUE_3"),inputsInline:!0},{type:"self_broadcast",message0:(0,o.i18n)("self_broadcast"),args0:[{type:"input_value",name:"message",check:"String"}],previousStatement:!0,nextStatement:!0,colour:(0,o.i18n)("BLUE_3"),inputsInline:!0},{type:"self_broadcast_and_wait",message0:(0,o.i18n)("self_broadcast_and_wait"),args0:[{type:"input_value",name:"message",check:"String"}],previousStatement:!0,nextStatement:!0,colour:(0,o.i18n)("BLUE_3"),inputsInline:!0},{type:"when",message0:(0,o.i18n)("when"),args0:[(0,o.create_head_icon)(n.icon_broadcast),{type:"input_value",name:"condition",check:"Boolean",align:"CENTRE"},{type:"input_statement",name:"DO"}],tooltip:(0,o.i18n)("WHEN_BLOCK_TOOLTIPS"),colour:(0,o.i18n)("BLUE_3"),inputsInline:!0},{type:"terminate",message0:(0,o.i18n)("terminate"),args0:[],inputsInline:!0,previousStatement:!0,colour:(0,o.i18n)("BLUE_3")}];t.define_blocks_with_json_array(e),Object.assign(t.blocks_xml,{start_on_click:'<block type="start_on_click"/>',start_on_click_2:'<block type="start_on_click_2"/>',on_running_group_activated:'<block type="on_running_group_activated"/>',self_listen:'<block type="self_listen">\n      '.concat((0,o.text_value)("message","Hi"),"\n    </block>"),self_broadcast:'<block type="self_broadcast">\n      '.concat((0,o.text_value)("message","Hi"),"\n    </block>"),self_broadcast_and_wait:'<block type="self_broadcast_and_wait">\n      '.concat((0,o.text_value)("message","Hi"),"\n    </block>"),when:'<block type="when">\n      '.concat((0,o.logic_value)("condition"),"\n    </block>"),terminate:'<block type="terminate"/>'})}},2198:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.init_extensions=void 0;var o=i(98734).__importStar(i(37064)),n=i(81558);e.init_extensions=function(t){t.extensions.register("parent_tooltip_when_inline",(function(){var t=this;this.tooltip_when_not_connected=this.tooltip,this.set_tooltip((function(){var e=t.get_parent();return e&&e.get_inputs_inline()&&e.tooltip||t.tooltip_when_not_connected}))}));var e={onchange:function(t){t.type&&t.type!=o.BlockEventType.MOVE||(0,n.update_disable_status)(this)}};t.extensions.register_mixin("disable_inside_wrap_loop",e),t.extensions.register_mixin("disable_inside_warp_loop",{onchange:function(t){if((!t.type||t.type==o.BlockEventType.MOVE)&&!this.is_in_flyout){for(var e=["repeat_forever","repeat_n_times","repeat_forever_until"],i=!1,n=!0,r=this.get_surround_parent();r;){if(i&&"warp"===r.type){n=!1;break}e.includes(r.type)&&(i=!0),r=r.get_surround_parent()}if(n){if(!this.disabled)return;this.disabled=!1,this.update_disabled()}else{if(this.disabled)return;this.disabled=!0,this.update_disabled()}}}}),t.extensions.register("param_block",(function(){this.element_type="param"})),t.extensions.register("param_color_block",(function(){this.element_type="param_color"}))}},65284:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.icon_setting=e.icon_broadcast=e.icon_start=void 0,e.icon_start="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNiAzNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0xOCAzNmM5Ljk0MSAwIDE4LTguMDU5IDE4LTE4UzI3Ljk0MSAwIDE4IDAgMCA4LjA1OSAwIDE4czguMDU5IDE4IDE4IDE4eiIgZmlsbD0iIzU2ODBENSIvPjxwYXRoIGQ9Ik0xOCAzNWM5LjM4OSAwIDE3LTcuNjExIDE3LTE3UzI3LjM4OSAxIDE4IDEgMSA4LjYxMSAxIDE4czcuNjExIDE3IDE3IDE3eiIgZmlsbD0iI0ZGRiIvPjxwYXRoIGQ9Ik0yNS41NiAxNi40NTdjMS45MTUgMS4xMyAxLjkyNSAyLjk1NCAwIDQuMDlsLTEwLjA5NCA1Ljk1N0MxMy41NTIgMjcuNjM0IDEyIDI2Ljc2NiAxMiAyNC41OFYxMi40MjRjMC0yLjE5MiAxLjU0MS0zLjA2IDMuNDY2LTEuOTI0bDEwLjA5NCA1Ljk1N3oiIGZpbGw9IiM2MDhGRUUiLz48L2c+PC9zdmc+Cg==",e.icon_broadcast="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNiAzNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNjIgLTExNikiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PGNpcmNsZSBmaWxsPSIjNTY4MEQ1IiBjeD0iODAiIGN5PSIxMzQiIHI9IjE4Ii8+PGNpcmNsZSBmaWxsPSIjRkZGIiBjeD0iODAiIGN5PSIxMzQiIHI9IjE3Ii8+PHBhdGggZD0iTTg1LjI1IDEyOS4zMDNjLjM4LjY0OS41OTcgMS40MDQuNTk3IDIuMjA5YTQuMzUgNC4zNSAwIDAgMS0xLjI3NCAzLjA5LjU3My41NzMgMCAwIDAgLjQwMi45NzQuNTY2LjU2NiAwIDAgMCAuNDAyLS4xNjcgNS40ODcgNS40ODcgMCAwIDAgMS42MDgtMy44OTcgNS40ODcgNS40ODcgMCAwIDAtMS42MDctMy44OThBNS40NDMgNS40NDMgMCAwIDAgODEuNDk2IDEyNmE1LjQ0MyA1LjQ0MyAwIDAgMC0zLjg4MiAxLjYxNC41NzMuNTczIDAgMCAwIDAgLjgwOC41NjcuNTY3IDAgMCAwIC44MDUgMCA0LjMxNCA0LjMxNCAwIDAgMSAzLjA3Ny0xLjI4Yy44MDQgMCAxLjU1Ny4yMiAyLjIwNC42MDRhMi4xNTcgMi4xNTcgMCAwIDAtMi4wOTYuNTcuMzk0LjM5NCAwIDAgMCAwIC41NTRjLjE1My4xNTMuNC4xNTMuNTUyIDAgLjI2NC0uMjY2LjYxNS0uNDEyLjk4OC0uNDEyLjc3IDAgMS4zOTcuNjMgMS4zOTggMS40MDZhMS40IDEuNCAwIDAgMS0uNDEuOTk0LjM5NC4zOTQgMCAwIDAgLjI3Ni42N2MuMSAwIC4yLS4wMzkuMjc2LS4xMTVhMi4xOTggMi4xOTggMCAwIDAgLjU2Ni0yLjExem0tMi4xMDIgMy44NTVsLjQ4LTMuMTg1YS41MjIuNTIyIDAgMCAwLS41OTItLjU5NmwtMy4xNjYuNDg0IDMuMjc4IDMuMjk3em0tNS40MTIgNy4zNTRhOC45NTMgOC45NTMgMCAwIDEtMy45MDYtMy4yMzd2NS40MDVjMCAuMjg4LjIzMy41MjMuNTIuNTIzaDYuNmEuMzQ5LjM0OSAwIDAgMCAuMjMxLS42MWwtMS43MjctMS41NDlhOC43NTMgOC43NTMgMCAwIDEtMS43MTgtLjUzMnptLTIuNjUtMTMuNTYyYTguMTMyIDguMTMyIDAgMCAwLTEuOTg5IDUuMzQ0IDguMTUgOC4xNSAwIDAgMCA0Ljk3IDcuNTA3IDguMDEgOC4wMSAwIDAgMCAzLjEyLjYyOSA4LjAzIDguMDMgMCAwIDAgNS4zMTItMi4wMDFjLjIyNy0uMi4yNC0uNTUuMDI2LS43NjVsLTMuNTIzLTMuNTQzLTQuMDktNC4xMTQtMy4wNjUtMy4wODNhLjUxNi41MTYgMCAwIDAtLjc2LjAyNnoiIGZpbGw9IiM1MDk4RkMiLz48L2c+PC9zdmc+Cg==",e.icon_setting="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8dGl0bGU+5YiH54mHPC90aXRsZT4KICAgIDxnIGlkPSJQeXRob24t56ev5pyoIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iQy3lj6Plh73mlbDlrprkuYnnp6/mnKgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yOTQuMDAwMDAwLCAtMTgzLjAwMDAwMCkiIGZpbGw9IiNGRkZGRkYiPgogICAgICAgICAgICA8ZyBpZD0iYmxvY2tfMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTMyLjAwMDAwMCwgMTY5LjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPGcgaWQ9ImJ0bl9vcHRpb24iIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1OC4wMDAwMDAsIDEwLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgICAgIDxnIGlkPSJpY25fYnRuX29wdGlvbiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMi4xOTIzNTksIDIuMDI4MTU1KSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03LjgwNzY0MTAxLDEuOTcxODQ1MjUgQzguMzU5OTI1NzYsMS45NzE4NDUyNSA4LjgwNzY0MTAxLDIuNDE5NTYwNSA4LjgwNzY0MTAxLDIuOTcxODQ1MjUgTDguODA4NTk1MzUsMy41ODM1NzAxMyBDOS4zMTA2MzE5LDMuNjk3NjAzODEgOS43ODA3NzMwMSwzLjg5NTU3ODc0IDEwLjIwMzQ4MDYsNC4xNjE5NTY4NSBMMTAuNjM2MDY4MSwzLjcyOTIwNDU3IEMxMS4wMjY1OTI0LDMuMzM4NjgwMjcgMTEuNjU5NzU3NCwzLjMzODY4MDI3IDEyLjA1MDI4MTcsMy43MjkyMDQ1NyBDMTIuNDQwODA2LDQuMTE5NzI4ODYgMTIuNDQwODA2LDQuNzUyODkzODQgMTIuMDUwMjgxNyw1LjE0MzQxODEzIEwxMS42MTc1Mjk0LDUuNTc2MDA1NjMgQzExLjg4NDA4MzgsNS45OTg5OTI5NiAxMi4wODIxNDQ0LDYuNDY5NDc2NTggMTIuMTk2MTQyNCw2Ljk3MTg4NzU2IEwxMi44MDc2NDEsNi45NzE4NDUyNSBDMTMuMzU5OTI1OCw2Ljk3MTg0NTI1IDEzLjgwNzY0MSw3LjQxOTU2MDUgMTMuODA3NjQxLDcuOTcxODQ1MjUgQzEzLjgwNzY0MSw4LjUyNDEzIDEzLjM1OTkyNTgsOC45NzE4NDUyNSAxMi44MDc2NDEsOC45NzE4NDUyNSBMMTIuMTk1OTE2MSw4Ljk3Mjc5OTU5IEMxMi4wODE4ODI0LDkuNDc0ODM2MTQgMTEuODgzOTA3NSw5Ljk0NDk3NzI2IDExLjYxNzUyOTQsMTAuMzY3Njg0OSBMMTIuMDUwMjgxNywxMC44MDAyNzI0IEMxMi40NDA4MDYsMTEuMTkwNzk2NyAxMi40NDA4MDYsMTEuODIzOTYxNiAxMi4wNTAyODE3LDEyLjIxNDQ4NTkgQzExLjY1OTc1NzQsMTIuNjA1MDEwMiAxMS4wMjY1OTI0LDEyLjYwNTAxMDIgMTAuNjM2MDY4MSwxMi4yMTQ0ODU5IEwxMC4yMDM0ODA2LDExLjc4MTczMzcgQzkuNzgwNzczMDEsMTIuMDQ4MTExOCA5LjMxMDYzMTksMTIuMjQ2MDg2NyA4LjgwODU5NTM1LDEyLjM2MDEyMDQgTDguODA3NjQxMDEsMTIuOTcxODQ1MyBDOC44MDc2NDEwMSwxMy41MjQxMyA4LjM1OTkyNTc2LDEzLjk3MTg0NTMgNy44MDc2NDEwMSwxMy45NzE4NDUzIEM3LjI1NTM1NjI2LDEzLjk3MTg0NTMgNi44MDc2NDEwMSwxMy41MjQxMyA2LjgwNzY0MTAxLDEyLjk3MTg0NTMgTDYuODA3NjgzMzIsMTIuMzYwMzQ2NiBDNi4zMDUyNzIzMywxMi4yNDYzNDg3IDUuODM0Nzg4NzIsMTIuMDQ4Mjg4IDUuNDExODAxMzksMTEuNzgxNzMzNyBMNC45NzkyMTM4OCwxMi4yMTQ0ODU5IEM0LjU4ODY4OTU5LDEyLjYwNTAxMDIgMy45NTU1MjQ2MSwxMi42MDUwMTAyIDMuNTY1MDAwMzIsMTIuMjE0NDg1OSBDMy4xNzQ0NzYwMywxMS44MjM5NjE2IDMuMTc0NDc2MDMsMTEuMTkwNzk2NyAzLjU2NTAwMDMyLDEwLjgwMDI3MjQgTDMuOTk3NzUyNjEsMTAuMzY3Njg0OSBDMy43MzEzNzQ1LDkuOTQ0OTc3MjYgMy41MzMzOTk1Nyw5LjQ3NDgzNjE0IDMuNDE5MzY1ODgsOC45NzI3OTk1OSBMMi44MDc2NDEwMSw4Ljk3MTg0NTI1IEMyLjI1NTM1NjI2LDguOTcxODQ1MjUgMS44MDc2NDEwMSw4LjUyNDEzIDEuODA3NjQxMDEsNy45NzE4NDUyNSBDMS44MDc2NDEwMSw3LjQxOTU2MDUgMi4yNTUzNTYyNiw2Ljk3MTg0NTI1IDIuODA3NjQxMDEsNi45NzE4NDUyNSBMMy40MTkxMzk2Miw2Ljk3MTg4NzU2IEMzLjUzMzEzNzYsNi40Njk0NzY1OCAzLjczMTE5ODIzLDUuOTk4OTkyOTYgMy45OTc3NTI2MSw1LjU3NjAwNTYzIEwzLjU2NTAwMDMyLDUuMTQzNDE4MTMgQzMuMTc0NDc2MDMsNC43NTI4OTM4NCAzLjE3NDQ3NjAzLDQuMTE5NzI4ODYgMy41NjUwMDAzMiwzLjcyOTIwNDU3IEMzLjk1NTUyNDYxLDMuMzM4NjgwMjcgNC41ODg2ODk1OSwzLjMzODY4MDI3IDQuOTc5MjEzODgsMy43MjkyMDQ1NyBMNS40MTE4MDEzOSw0LjE2MTk1Njg1IEM1LjgzNDc4ODcyLDMuODk1NDAyNDggNi4zMDUyNzIzMywzLjY5NzM0MTg0IDYuODA3NjgzMzIsMy41ODMzNDM4NyBMNi44MDc2NDEwMSwyLjk3MTg0NTI1IEM2LjgwNzY0MTAxLDIuNDE5NTYwNSA3LjI1NTM1NjI2LDEuOTcxODQ1MjUgNy44MDc2NDEwMSwxLjk3MTg0NTI1IFogTTcuODA3NjQxMDEsNS40NzE4NDUyNSBDNi40MjY5MjkxMyw1LjQ3MTg0NTI1IDUuMzA3NjQxMDEsNi41OTExMzMzOCA1LjMwNzY0MTAxLDcuOTcxODQ1MjUgQzUuMzA3NjQxMDEsOS4zNTI1NTcxMyA2LjQyNjkyOTEzLDEwLjQ3MTg0NTMgNy44MDc2NDEwMSwxMC40NzE4NDUzIEM5LjE4ODM1Mjg4LDEwLjQ3MTg0NTMgMTAuMzA3NjQxLDkuMzUyNTU3MTMgMTAuMzA3NjQxLDcuOTcxODQ1MjUgQzEwLjMwNzY0MSw2LjU5MTEzMzM4IDkuMTg4MzUyODgsNS40NzE4NDUyNSA3LjgwNzY0MTAxLDUuNDcxODQ1MjUgWiIgaWQ9IuW9oueKtue7k+WQiCI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+"},69971:function(t,e,i){e.uc=e.NT=void 0;var o=i(59654),n=i(65849),r=i(28799),s=i(96901),_=i(59493),a=i(21512),c=i(43883),l=i(60601),d=i(2198);Object.defineProperty(e,"NT",{enumerable:!0,get:function(){return d.init_extensions}}),e.uc=function(t){(0,o.init_shadows)(t),(0,n.init_events_blocks)(t),(0,r.init_control_blocks)(t),(0,s.init_sensing_blocks)(t),(0,_.init_math_blocks)(t),(0,a.init_logic_blocks)(t),(0,c.init_text_blocks)(t),(0,l.init_color_blocks)(t)};var u=i(28799);var h=i(62848)},21512:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.init_logic_blocks=void 0;var o=i(98929);e.init_logic_blocks=function(t){var e=[{type:"logic_negate",message0:(0,o.i18n)("LOGIC_NEGATE_TITLE"),args0:[{type:"input_value",name:"BOOL",check:["Boolean"]}],output:"Boolean",colour:(0,o.i18n)("ORANGE_3")},{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[[(0,o.i18n)("LOGIC_BOOLEAN_TRUE"),"TRUE"],[(0,o.i18n)("LOGIC_BOOLEAN_FALSE"),"FALSE"]]}],output:"Boolean",colour:(0,o.i18n)("ORANGE_3"),tooltip:(0,o.i18n)("LOGIC_BOOLEAN_TOOLTIP")},{type:"logic_compare",message0:(0,o.i18n)("logic_compare"),args0:[{type:"input_value",name:"A",check:["Number","String","Boolean","Array"]},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["\u2260","NEQ"],["<","LT"],["\u2264","LTE"],[">","GT"],["\u2265","GTE"]]},{type:"input_value",name:"B",check:["Number","String","Boolean","Array"]}],inputsInline:!0,output:"Boolean",colour:(0,o.i18n)("ORANGE_3"),extensions:["logic_op_tooltip"]},{type:"logic_operation",message0:(0,o.i18n)("logic_operation"),args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[[(0,o.i18n)("LOGIC_OPERATION_AND"),"AND"],[(0,o.i18n)("LOGIC_OPERATION_OR"),"OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",colour:(0,o.i18n)("ORANGE_3"),extensions:["logic_op_tooltip"]}];t.define_blocks_with_json_array(e);var i={EQ:(0,o.i18n)("LOGIC_COMPARE_TOOLTIP_EQ"),NEQ:(0,o.i18n)("LOGIC_COMPARE_TOOLTIP_NEQ"),LT:(0,o.i18n)("LOGIC_COMPARE_TOOLTIP_LT"),LTE:(0,o.i18n)("LOGIC_COMPARE_TOOLTIP_LTE"),GT:(0,o.i18n)("LOGIC_COMPARE_TOOLTIP_GT"),GTE:(0,o.i18n)("LOGIC_COMPARE_TOOLTIP_GTE"),AND:(0,o.i18n)("LOGIC_OPERATION_TOOLTIP_AND"),OR:(0,o.i18n)("LOGIC_OPERATION_TOOLTIP_OR")};t.extensions.register("logic_op_tooltip",t.extensions.build_tooltip_for_dropdown("OP",i)),Object.assign(t.blocks_xml,{logic_negate:'<block type="logic_negate">\n      '.concat((0,o.logic_value)("BOOL"),"\n    </block>\n    "),logic_boolean:'<block type="logic_boolean"/>',logic_compare:'<block type="logic_compare">\n      '.concat((0,o.number_value)("A","0"),"\n      ").concat((0,o.number_value)("B","0"),"\n    </block>\n    "),logic_operation:'<block type="logic_operation">\n      '.concat((0,o.logic_value)("A"),"\n      ").concat((0,o.logic_value)("B"),"\n    </block>\n    ")})}},59493:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.init_math_blocks=void 0;var o=i(98030),n=i(98929);e.init_math_blocks=function(t){var e=t.Blocks;t.define_blocks_with_json_array([{type:"random",message0:(0,n.i18n)("random_num"),args0:[{type:"input_value",name:"a",check:"Number",align:"CENTRE"},{type:"input_value",name:"b",check:"Number",align:"CENTRE"}],output:"Number",colour:(0,n.i18n)("ORANGE_3"),inputsInline:!0},{type:"divisible_by",message0:(0,n.i18n)("divisible_by"),args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],output:"Boolean",colour:(0,n.i18n)("ORANGE_3"),inputsInline:!0},{type:"calculate",message0:(0,n.i18n)("calculate"),args0:[{type:"input_value",name:"input",check:["String","Number"]}],output:"Number",colour:(0,n.i18n)("ORANGE_3"),inputsInline:!0,tooltip:(0,n.i18n)("CALCULATE_TOOLTIPS")},{type:"math_arithmetic",message0:(0,n.i18n)("math_arithmetic"),args0:[{type:"input_value",name:"A",check:["Number","String","Boolean","Array"]},{type:"field_dropdown",name:"OP",options:[[(0,n.i18n)("MATH_ADDITION_SYMBOL"),"ADD"],[(0,n.i18n)("MATH_SUBTRACTION_SYMBOL"),"MINUS"],[(0,n.i18n)("MATH_MULTIPLICATION_SYMBOL"),"MULTIPLY"],[(0,n.i18n)("MATH_DIVISION_SYMBOL"),"DIVIDE"],[(0,n.i18n)("MATH_POWER_SYMBOL"),"POWER"]]},{type:"input_value",name:"B",check:["Number","String","Boolean","Array"]}],inputsInline:!0,output:"Number",colour:(0,n.i18n)("ORANGE_3"),extensions:["math_op_tooltip"]},{type:"math_single",message0:(0,n.i18n)("math_single"),args0:[{type:"field_dropdown",name:"OP",options:[[(0,n.i18n)("MATH_SINGLE_OP_ROOT"),"ROOT"],[(0,n.i18n)("MATH_SINGLE_OP_ABSOLUTE"),"ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",colour:(0,n.i18n)("ORANGE_3"),extensions:["math_op_tooltip"]},{type:"math_round",message0:(0,n.i18n)("math_round"),args0:[{type:"field_dropdown",name:"OP",options:[[(0,n.i18n)("MATH_ROUND_OPERATOR_ROUND"),"ROUND"],[(0,n.i18n)("MATH_ROUND_OPERATOR_ROUNDUP"),"ROUNDUP"],[(0,n.i18n)("MATH_ROUND_OPERATOR_ROUNDDOWN"),"ROUNDDOWN"]]},{type:"input_shadow",name:"NUM",field_type:"math",default_text:"0"}],output:"Number",colour:(0,n.i18n)("ORANGE_3"),tooltip:(0,n.i18n)("MATH_ROUND_TOOLTIP")},{type:"math_modulo",message0:(0,n.i18n)("MATH_MODULO_TITLE"),args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",colour:(0,n.i18n)("ORANGE_3"),tooltip:(0,n.i18n)("MATH_MODULO_TOOLTIP")},{type:"math_number_property",message0:(0,n.i18n)("math_number_property"),args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[[(0,n.i18n)("MATH_IS_EVEN"),"EVEN"],[(0,n.i18n)("MATH_IS_ODD"),"ODD"],[(0,n.i18n)("MATH_IS_PRIME"),"PRIME"],[(0,n.i18n)("MATH_IS_WHOLE"),"WHOLE"],[(0,n.i18n)("MATH_IS_POSITIVE"),"POSITIVE"],[(0,n.i18n)("MATH_IS_NEGATIVE"),"NEGATIVE"]]}],inputsInline:!0,output:"Boolean",colour:(0,n.i18n)("ORANGE_3"),tooltip:(0,n.i18n)("MATH_IS_TOOLTIP")}]);var i={ADD:(0,n.i18n)("MATH_ARITHMETIC_TOOLTIP_ADD"),MINUS:(0,n.i18n)("MATH_ARITHMETIC_TOOLTIP_MINUS"),MULTIPLY:(0,n.i18n)("MATH_ARITHMETIC_TOOLTIP_MULTIPLY"),DIVIDE:(0,n.i18n)("MATH_ARITHMETIC_TOOLTIP_DIVIDE"),POWER:(0,n.i18n)("MATH_ARITHMETIC_TOOLTIP_POWER"),ROOT:(0,n.i18n)("MATH_SINGLE_TOOLTIP_ROOT"),ABS:(0,n.i18n)("MATH_SINGLE_TOOLTIP_ABS"),NEG:(0,n.i18n)("MATH_SINGLE_TOOLTIP_NEG"),LN:(0,n.i18n)("MATH_SINGLE_TOOLTIP_LN"),LOG10:(0,n.i18n)("MATH_SINGLE_TOOLTIP_LOG10"),EXP:(0,n.i18n)("MATH_SINGLE_TOOLTIP_EXP"),POW10:(0,n.i18n)("MATH_SINGLE_TOOLTIP_POW10")};t.extensions.register("math_op_tooltip",t.extensions.build_tooltip_for_dropdown("OP",i)),e.math_trig={init:function(){this.set_colour_by_key((0,n.i18n)("ORANGE_3"));var e=this,i=t.di_container.get(o.BINDING.FieldDropdown)({menu_generator:[[(0,n.i18n)("MATH_TRIG_SIN"),"SIN"],[(0,n.i18n)("MATH_TRIG_COS"),"COS"],[(0,n.i18n)("MATH_TRIG_TAN"),"TAN"],[(0,n.i18n)("MATH_TRIG_ASIN"),"ASIN"],[(0,n.i18n)("MATH_TRIG_ACOS"),"ACOS"],[(0,n.i18n)("MATH_TRIG_ATAN"),"ATAN"]],opt_onchange:function(i){var n,r,s="SIN"===i||"COS"===i||"TAN"===i,_=e.get_input("DEGREES"),a=t.di_container.get(o.BINDING.events);s?_||a.is_undoing()||null===(n=e.addMutation)||void 0===n||n.call(e):_&&!a.is_undoing()&&(null===(r=e.removeMutation)||void 0===r||r.call(e))}});this.append_dummy_input().append_field(i,"OP"),this.append_shadow_input("NUM",(0,n.number_shadow)("45")).set_check("Number"),this.append_dummy_input("DEGREES").append_field((0,n.i18n)("MATH_DEGREES")),this.set_inputs_inline(!0),this.set_output(!0)},addMutation:function(){this.append_dummy_input("DEGREES").append_field((0,n.i18n)("MATH_DEGREES"));var e=t.di_container.get(o.BINDING.events);if(e.is_enabled()){var i=t.di_container.get(o.BINDING.ChangeEvent);e.fire(i("mutation",{block:this,old_value:void 0,new_value:"add"}))}},removeMutation:function(){var e=t.di_container.get(o.BINDING.events);if(this.remove_input("DEGREES"),e.is_enabled()){var i=t.di_container.get(o.BINDING.ChangeEvent);e.fire(i("mutation",{block:this,old_value:"remove",new_value:void 0}))}}},Object.assign(t.blocks_xml,{random:'<block type="random">\n      '.concat((0,n.number_value)("a","0"),"\n      ").concat((0,n.number_value)("b","5"),"\n    </block>\n    "),divisible_by:'<block type="divisible_by">\n      '.concat((0,n.number_value)("NUMBER_TO_CHECK","9"),"\n      ").concat((0,n.number_value)("DIVISOR","3"),"\n    </block>\n    "),calculate:'<block type="calculate">\n      '.concat((0,n.text_value)("input","1+2"),"\n    </block>\n    "),math_arithmetic:'<block type="math_arithmetic">\n      '.concat((0,n.number_value)("A","0"),"\n      ").concat((0,n.number_value)("B","0"),"\n    </block>\n    "),math_single:'<block type="math_single">\n      '.concat((0,n.number_value)("NUM","0"),"\n    </block>\n    "),math_round:'<block type="math_round">\n      '.concat((0,n.number_value)("NUM","3.1"),"\n    </block>\n    "),math_modulo:'<block type="math_modulo">\n      '.concat((0,n.number_value)("DIVIDEND","64"),"\n      ").concat((0,n.number_value)("DIVISOR","10"),"\n    </block>\n    "),math_number_property:'<block type="math_number_property">\n      '.concat((0,n.number_value)("NUMBER_TO_CHECK","0"),"\n    </block>\n    "),math_trig:'<block type="math_trig">\n      '.concat((0,n.number_value)("NUM","45"),"\n    </block>\n    ")})}},96901:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.init_sensing_blocks=void 0;var o=i(98929);e.init_sensing_blocks=function(t){var e=[{type:"get_time",message0:(0,o.i18n)("get_time"),args0:[{type:"field_dropdown",name:"op",options:[[(0,o.i18n)("year"),"year"],[(0,o.i18n)("month"),"month"],[(0,o.i18n)("date"),"date"],[(0,o.i18n)("week"),"week"],[(0,o.i18n)("hour"),"hour"],[(0,o.i18n)("minute"),"minute"],[(0,o.i18n)("second"),"second"]]}],output:"Number",colour:(0,o.i18n)("GREEN_3"),inputsInline:!0},{type:"get_timer",message0:(0,o.i18n)("timer"),args0:[],output:"Number",colour:(0,o.i18n)("GREEN_3"),inputsInline:!0},{type:"reset_timer",message0:(0,o.i18n)("reset_timer"),previousStatement:!0,nextStatement:!0,colour:(0,o.i18n)("GREEN_3"),inputsInline:!0}];t.define_blocks_with_json_array(e),Object.assign(t.blocks_xml,{get_time:'<block type="get_time"/>',get_timer:'<block type="get_timer"/>',reset_timer:'<block type="reset_timer"/>'})}},59654:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.init_shadows=void 0;var o=i(98929);e.init_shadows=function(t){var e=[{type:"logic_empty",message0:"%1",args0:[{type:"field_label",name:"BOOL",text:""}],output:"Boolean",colour:(0,o.i18n)("ORANGE_3"),tooltip:(0,o.i18n)("LOGIC_BOOLEAN_TOOLTIP")},{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",colour:(0,o.i18n)("ORANGE_3"),tooltip:(0,o.i18n)("MATH_NUMBER_TOOLTIP"),extensions:["parent_tooltip_when_inline"]},{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",colour:(0,o.i18n)("ORANGE_3"),tooltip:(0,o.i18n)("TEXT_TEXT_TOOLTIP"),extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"multiline_text",message0:"%1",args0:[{type:"field_multiline_input",name:"TEXT",text:"",max_width:264}],output:"String",colour:(0,o.i18n)("ORANGE_3"),tooltip:(0,o.i18n)("TEXT_TEXT_TOOLTIP"),extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"default_value",message0:"%1",args0:[{type:"field_default_value",name:"TEXT",default_value:"0"}],output:"String",colour:(0,o.i18n)("TEXTS_HUE"),tooltip:(0,o.i18n)("TEXT_TEXT_TOOLTIP"),extensions:["parent_tooltip_when_inline"]}];t.define_blocks_with_json_array(e),t.Blocks.SHADOW=t.Blocks.SHADOW||{},Object.assign(t.Blocks.SHADOW,{logic:'<empty type="logic_empty"><field name="BOOL"></field></empty>',text:'<shadow type="text"><field name="TEXT"></field></shadow>',math:'<shadow type="math_number"><field name="NUM">0</field></shadow>',multiline_text:'<shadow type="multiline_text"><field name="TEXT"></field></shadow>',default_value:'<shadow type="default_value"><field name="TEXT"></field></shadow>'})}},43883:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.init_text_blocks=void 0;var o=i(98030),n=i(37767),r=i(11214),s=i(25461),_=i(98929);e.init_text_blocks=function(t){t.define_blocks_with_json_array([{type:"text_select",message0:(0,_.i18n)("text_select"),args0:[{type:"input_value",name:"string",check:["String","Number"]},{type:"input_value",name:"char_start_index",check:["Number"]},{type:"input_value",name:"char_end_index",check:["Number"]}],output:"String",colour:(0,_.i18n)("ORANGE_3"),inputsInline:!0},{type:"text_length",message0:(0,_.i18n)("text_length"),args0:[{type:"input_value",name:"VALUE",check:["String","Number"]}],output:"Number",colour:(0,_.i18n)("ORANGE_3"),inputsInline:!0},{type:"text_contain",message0:(0,_.i18n)("text_contain"),args0:[{type:"input_value",name:"TEXT1",check:["String","Number"]},{type:"input_value",name:"TEXT2",check:["String","Number"]}],output:"Boolean",colour:(0,_.i18n)("ORANGE_3"),inputsInline:!0},{type:"text_split",message0:(0,_.i18n)("text_split"),args0:[{type:"input_value",name:"TEXT_TO_SPLIT",check:["String","Number"]},{type:"input_value",name:"SPLIT_TEXT",check:["String","Number"]}],output:"Array",colour:(0,_.i18n)("ORANGE_3"),inputsInline:!0},{type:"text_join",message0:"",output:"String",inputsInline:!0,colour:(0,_.i18n)("ORANGE_3"),tooltip:(0,_.i18n)("TEXT_JOIN_TOOLTIP"),mutator:"text_join_mutator_codemao"}]);var e={QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:8,QUOTE_IMAGE_HEIGHT:8,quoteField_:function(t){for(var e=0;e<this.inputList.length;e++)for(var i=this.inputList[e],o=0;o<i.fieldRow.length;o++){if(t==i.fieldRow[o].name)return i.insert_field_at(o,this.newQuote_(!0)),void i.insert_field_at(o+2,this.newQuote_(!1))}},newQuote_:function(i){var r=(0,s.create_svg_element)("g",{});return(0,s.create_svg_element)("path",{d:i?n.ICON.LEFT_QUOTA:n.ICON.RIGHT_QUOTA,"fill-rule":"nonzero"},r),t.di_container.get(o.BINDING.FieldImage)({src:r,width:e.QUOTE_IMAGE_WIDTH,height:e.QUOTE_IMAGE_HEIGHT,opt_tag:i?"quote_left":"quote_right"})}},i={itemCount_:0,addMutation:function(e){var i,n=t.di_container.get(o.BINDING.events),s=n.get_group();s||n.set_group(!0);var a="ADD".concat(this.itemCount_),c=this.shadow_ids[this.itemCount_]||(0,r.gen_uid)();this.shadow_ids[this.itemCount_]=c;var l=e||"";if(null===(i=this.append_value_input(a,"TITLE_TAIL",void 0,(0,_.text_shadow)(l,c)).connection)||void 0===i||i.respawn_shadow(),this.itemCount_++,this.itemCount_>2){var d=this.get_input("MUTATE_BUTTON");if(d&&!d.get_field("REMOVE")){var u=t.di_container.get(o.BINDING.MutationRemoveButton);d.insert_field_at(0,u(void 0),"REMOVE")}}if(n.is_enabled()){var h=t.di_container.get(o.BINDING.ChangeEvent);n.fire(h("mutation",{block:this,old_value:void 0,new_value:l}))}s||n.set_group(!1)},removeMutation:function(){var e,i=this.itemCount_-1,n="ADD".concat(i),s=this.get_input(n);if(this.itemCount_--,this.itemCount_<=2){var _=this.get_input("MUTATE_BUTTON");_&&_.get_field("REMOVE")&&_.remove_field("REMOVE")}if(s){var a,c=t.di_container.get(o.BINDING.events),l=c.get_group();l||c.set_group(!0);var d=s.connection.targetBlock();if(d&&d.is_shadow())this.shadow_ids[i]=d.id,a=d.get_field_value("TEXT")||"";else{var u=s.connection.get_shadow_dom();this.shadow_ids[i]=(null===u||void 0===u?void 0:u.getAttribute("id"))||(0,r.gen_uid)(),a=(null===(e=null===u||void 0===u?void 0:u.firstChild)||void 0===e?void 0:e.textContent)||""}if(this.remove_input(n),c.is_enabled()){var h=t.di_container.get(o.BINDING.ChangeEvent);c.fire(h("mutation",{block:this,old_value:a,new_value:void 0}))}""===l&&c.set_group(!1)}},mutationToDom:function(){var t=document.createElement("mutation");return t.setAttribute("items",String(this.itemCount_)),t},domToMutation:function(e){this.itemCount_=Math.max(parseInt(e.getAttribute("items")||"0",10),2);var i=t.di_container.get(o.BINDING.events);i.disable(),this.append_dummy_input("TITLE_HEAD").append_field((0,_.i18n)("TEXT_JOIN_TITLE_HEAD")),this.shadow_ids=this.shadow_ids||[];for(var n=0;n<this.itemCount_;n++)if(!this.get_input("ADD".concat(n))){var s=(0,r.gen_uid)();if(this.shadow_ids[n]=s,0==n){this.append_shadow_input("ADD".concat(n),(0,_.text_shadow)("ab",s));continue}if(1==n){this.append_shadow_input("ADD".concat(n),(0,_.text_shadow)("c",s));continue}this.append_shadow_input("ADD".concat(n),(0,_.text_shadow)("",s))}this.append_dummy_input("TITLE_TAIL").append_field((0,_.i18n)("TEXT_JOIN_TITLE_TAIL"));var a=t.di_container.get(o.BINDING.MutationAddButton),c=this.append_dummy_input("MUTATE_BUTTON").append_field(a(),"ADD");if(this.itemCount_>2){var l=t.di_container.get(o.BINDING.MutationRemoveButton);c.insert_field_at(0,l(void 0),"REMOVE")}i.enable()}};t.extensions.register("text_quotes",(function(){this.mixin(e),this.quoteField_("TEXT")})),t.extensions.register_mutator("text_join_mutator_codemao",i),Object.assign(t.blocks_xml,{text_select:'<block type="text_select">\n      '.concat((0,_.text_value)("string","abc"),"\n      ").concat((0,_.number_value)("char_start_index","1"),"\n      ").concat((0,_.number_value)("char_end_index","2"),"\n    </block>"),text_length:'<block type="text_length">\n      '.concat((0,_.text_value)("VALUE","abc"),"\n    </block>"),text_contain:'<block type="text_contain">\n      '.concat((0,_.text_value)("TEXT1","abc"),"\n      ").concat((0,_.text_value)("TEXT2","abc"),"\n    </block>"),text_split:'<block type="text_split">\n      '.concat((0,_.text_value)("TEXT_TO_SPLIT","1,2,3,4"),"\n      ").concat((0,_.text_value)("SPLIT_TEXT",","),"\n    </block>"),text_join:'<block type="text_join">\n      <mutation items="2"></mutation>\n      '.concat((0,_.text_value)("ADD0","ab"),"\n      ").concat((0,_.text_value)("ADD1","c"),"\n    </block>")})}},37767:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ICON=e.VISIBILITY_CLASSNAME=e.NEED_COLLAPSE_CHILDREN_BLOCKS=e.SPECIAL_CONNECTION_INPUT_NAME=e.COLLAPSED_INPUT_NAME=e.HTML_NS=e.SVG_NS=void 0,e.SVG_NS="http://www.w3.org/2000/svg",e.HTML_NS="http://www.w3.org/1999/xhtml",e.COLLAPSED_INPUT_NAME="_TEMP_COLLAPSED_INPUT",e.SPECIAL_CONNECTION_INPUT_NAME=["DO","STACK"],e.NEED_COLLAPSE_CHILDREN_BLOCKS=["start_on_click","self_on_tap","on_running_group_activated","on_phone_shake","on_phone_tilt","on_swipe"],e.VISIBILITY_CLASSNAME={TRANSLUCENT:"blocklyBlockTranslucent",HIDDEN:"blocklyBlockHidden",UNOPERATABLE:"blocklyBlockUnOperable"},e.ICON={LEFT_QUOTA:"M8.192,0.624 L8.192,1.616 C7.744,1.76 7.392,2.016 7.104,2.384 C6.816,2.736 6.688,3.104 6.704,3.488 C6.784,3.44 6.912,3.424 7.088,3.424 C7.408,3.424 7.696,3.536 7.92,3.76 C8.144,3.984 8.256,4.272 8.256,4.624 C8.256,4.976 8.128,5.264 7.904,5.488 C7.664,5.712 7.36,5.824 6.992,5.824 C6.56,5.824 6.208,5.648 5.952,5.296 C5.68,4.96 5.552,4.528 5.552,4 C5.552,3.168 5.792,2.464 6.272,1.856 C6.736,1.248 7.376,0.832 8.192,0.624 Z M4.464,0.624 L4.464,1.616 C4.032,1.76 3.68,2.016 3.408,2.384 C3.12,2.736 2.976,3.104 2.992,3.488 C3.056,3.44 3.184,3.424 3.376,3.424 C3.696,3.424 3.968,3.536 4.192,3.76 C4.416,3.984 4.544,4.272 4.544,4.624 C4.544,4.976 4.416,5.264 4.192,5.488 C3.952,5.712 3.648,5.824 3.28,5.824 C2.848,5.824 2.512,5.648 2.256,5.296 C1.968,4.96 1.84,4.528 1.84,4 C1.84,3.168 2.064,2.464 2.544,1.856 C3.024,1.248 3.664,0.832 4.464,0.624 Z",RIGHT_QUOTA:"M6.224,0.608 C6.64,0.608 6.976,0.768 7.248,1.12 C7.504,1.456 7.648,1.904 7.648,2.448 C7.648,3.248 7.408,3.968 6.944,4.576 C6.464,5.184 5.824,5.584 5.024,5.808 L5.024,4.816 C5.44,4.672 5.808,4.416 6.096,4.064 C6.368,3.696 6.496,3.328 6.496,2.944 C6.416,2.976 6.288,3.008 6.112,3.008 C5.792,3.008 5.504,2.88 5.28,2.656 C5.056,2.432 4.944,2.16 4.944,1.808 C4.944,1.456 5.056,1.168 5.312,0.944 C5.536,0.72 5.84,0.608 6.224,0.608 Z M2.496,0.608 C2.912,0.608 3.264,0.768 3.52,1.12 C3.792,1.456 3.936,1.904 3.936,2.448 C3.936,3.248 3.696,3.968 3.216,4.576 C2.736,5.184 2.096,5.584 1.296,5.808 L1.296,4.816 C1.728,4.672 2.08,4.416 2.368,4.064 C2.656,3.696 2.784,3.328 2.784,2.944 C2.704,2.976 2.576,3.008 2.4,3.008 C2.08,3.008 1.808,2.88 1.584,2.656 C1.344,2.432 1.232,2.16 1.232,1.808 C1.232,1.456 1.344,1.168 1.568,0.944 C1.808,0.72 2.112,0.608 2.496,0.608 Z",DROPDOWN_ARRAY:"M5.99695526,7.90416306 L9.03751442,4.8636039 C9.38898628,4.51213203 9.95883476,4.51213203 10.3103066,4.8636039 C10.6617785,5.21507576 10.6617785,5.78492424 10.3103066,6.1363961 L6.63335137,9.81335137 C6.2818795,10.1648232 5.71203102,10.1648232 5.36055916,9.81335137 L1.6836039,6.1363961 C1.33213203,5.78492424 1.33213203,5.21507576 1.6836039,4.8636039 C2.03507576,4.51213203 2.60492424,4.51213203 2.9563961,4.8636039 L5.99695526,7.90416306 Z"}},27807:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.lazy_inject=e.bind_singleton=e.get_instance=void 0;var o=i(98734),n=i(61455),r=o.__importDefault(i(45696)),s=new n.Container;e.get_instance=function(){return s},e.bind_singleton=function(t,e){s.rebind(t).to(e).inSingletonScope()},e.lazy_inject=(0,r.default)(s).lazyInject},70267:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.bind_di_modules=void 0;var o=i(22149),n=i(25026),r=i(73892),s=i(50121),_=i(66976),a=i(21366),c=i(25629),l=i(56312),d=i(77920),u=i(9147),h=i(88292),p=i(15105),g=i(35656),f=i(11158),v=i(82922),m=i(46354),b=i(35693),y=i(27781),E=i(4418),k=i(61880),T=i(55376),w=i(60271),O=i(13024),N=i(95208),I=i(34491),A=i(61236),C=i(21848),S=i(63295),x=i(37239),R=i(1103),L=i(87482),D=i(19214),M=i(15924),P=i(52096),B=i(54693),U=i(78429),G=i(11734),j=i(36908),F=i(23257),z=i(48979),H=i(94492),W=i(5527),V=i(75662),Y=i(25939),K=i(55011),X=i(91822),Q=i(89502),q=i(22495),Z=i(94648),J=i(98961),$=i(72454),tt=i(88891),et=i(87546),it=i(13769),ot=i(16145),nt=i(12963),rt=i(91758),st=i(10777),_t=i(81563),at=i(96312),ct=i(68397),lt=i(11200),dt=i(1247),ut=i(21498),ht=i(61972),pt=i(9528);e.bind_di_modules=function(t){t.bind(pt.BINDING.ChangeEvent).toFunction((function(t,e){if(!function(t){return t.block instanceof F.WorkspaceElement}(e)||"string"!==typeof t)throw new Error("\n        Trying to create invalid change event with event ".concat(t.toString()," and param ").concat(e,".\n        It may caused by wrong custom change event subtype registry.\n        Note that options of any change event should include [block], [old_value] and [new_value].\n        Check https://codemao.yuque.com/milktea/blink/zy9tlg for more information.\n      "));return new o.ChangeEvent(t,e)})),t.bind(pt.BINDING.CreateEvent).toFunction((function(t){return new o.CreateEvent(t)})),t.bind(pt.BINDING.DeleteEvent).toFunction((function(t){return new o.DeleteEvent(t)})),t.bind(pt.BINDING.DragAreaChangeEvent).toFunction((function(t){return new o.DragAreaChangeEvent(t)})),t.bind(pt.BINDING.EndDragEvent).toFunction((function(t){return new o.EndDragEvent(t)})),t.bind(pt.BINDING.MoveEvent).toFunction((function(t){return new o.MoveEvent(t)})),t.bind(pt.BINDING.StartDragEvent).toFunction((function(t){return new o.StartDragEvent(t)})),t.bind(pt.BINDING.ContextMenuOptionEvent).toFunction((function(t){return new n.ContextMenuOptionEvent(t)})),t.bind(pt.BINDING.GroupEvent).toFunction((function(t){return new n.GroupEvent(t)})),t.bind(pt.BINDING.UIEvent).toFunction((function(t){return new n.UIEvent(t)})),t.bind(pt.BINDING.FlyoutButton).toFunction((function(t){return new r.FlyoutButton(t)})),t.bind(pt.BINDING.VerticalFlyout).toFunction((function(t){return new s.VerticalFlyout(t)})),t.bind(pt.BINDING.WorkspaceElementDragger).toFunction((function(t){if((0,ht.is_block_svg)(t.target))return new _.BlockDragger({target:t.target,workspace:t.workspace});if((0,ht.is_workspace_comment)(t.target))return new l.WorkspaceCommentDragger({target:t.target,workspace:t.workspace});throw Error("Trying to drag invalid element")})),t.bind(pt.BINDING.WorkspaceDragger).toFunction((function(t){return(0,ht.is_workspace)(t)?new d.WorkspaceDragger(t):new a.FlyoutDragger(t)})),t.bind(pt.BINDING.Gesture).toFunction((function(t){return new c.Gesture(t)})),t.bind(pt.BINDING.Blink).to(u.Blink).inSingletonScope(),t.bind(pt.BINDING.block_animations).to(h.BlockAnimations).inSingletonScope(),t.bind(pt.BINDING.context_menu).to(p.ContextMenu).inSingletonScope(),t.bind(pt.BINDING.css).to(g.Css).inSingletonScope(),t.bind(pt.BINDING.dragged_connection_manager).to(f.DraggedConnectionManager).inSingletonScope(),t.bind(pt.BINDING.insertion_marker_manager).to(v.InsertionMarkerManager).inSingletonScope(),t.bind(pt.BINDING.events).to(m.Events).inSingletonScope(),t.bind(pt.BINDING.extensions).to(b.Extensions).inSingletonScope(),t.bind(pt.BINDING.json).to(y.Json).inSingletonScope(),t.bind(pt.BINDING.registry).to(E.Registry).inSingletonScope(),t.bind(pt.BINDING.runtime_data).to(k.RuntimeData).inSingletonScope(),t.bind(pt.BINDING.theme).to(T.Theme).inSingletonScope(),t.bind(pt.BINDING.tooltip).to(w.Tooltip).inSingletonScope(),t.bind(pt.BINDING.touch_manager).to(O.TouchManager).inSingletonScope(),t.bind(pt.BINDING.utils).to(N.Utils).inSingletonScope(),t.bind(pt.BINDING.widget_div).to(I.WidgetDiv).inSingletonScope(),t.bind(pt.BINDING.workspace_db).to(A.WorkspaceDB).inSingletonScope(),t.bind(pt.BINDING.xml).to(C.Xml).inSingletonScope(),t.bind(pt.BINDING.slider_controller).to(S.SliderController).inSingletonScope(),t.bind(pt.BINDING.angle_controller).to(x.AngleController).inSingletonScope(),t.bind(pt.BINDING.color_controller).to(L.ColorController).inSingletonScope(),t.bind(pt.BINDING.Toolbox).toFunction((function(t){return new D.Toolbox(t)})),t.bind(pt.BINDING.BlockDragSurfaceSvg).toFunction((function(t){return new M.BlockDragSurfaceSvg(t)})),t.bind(pt.BINDING.ConnectionDB).toFunction((function(){return new P.ConnectionDB})),t.bind(pt.BINDING.Grid).toFunction((function(t){return new B.Grid(t)})),t.bind(pt.BINDING.WorkspaceAudio).toFunction((function(t){return new U.WorkspaceAudio(t)})),t.bind(pt.BINDING.WorkspaceDragSurfaceSvg).toFunction((function(t,e){return new G.WorkspaceDragSurfaceSvg(t,e)})),t.bind(pt.BINDING.WorkspaceSvg).toFunction((function(t,e,i,o){return new j.WorkspaceSvg(t,e,i,o)})),t.bind(pt.BINDING.FieldButton).toFunction((function(t){return new z.FieldButton(t)})),t.bind(pt.BINDING.FieldColour).toFunction((function(t){return new H.FieldColour(t)})),t.bind(pt.BINDING.FieldDropdown).toFunction((function(t){return new W.FieldDropdown(t)})),t.bind(pt.BINDING.FieldIcon).toFunction((function(t){return new V.FieldIcon(t)})),t.bind(pt.BINDING.FieldImage).toFunction((function(t){return new Y.FieldImage(t)})),t.bind(pt.BINDING.FieldLabel).toFunction((function(t){return new X.FieldLabel(t)})),t.bind(pt.BINDING.FieldLabelSerializable).toFunction((function(t){return new K.FieldLabelSerializable(t)})),t.bind(pt.BINDING.FieldMultilineInput).toFunction((function(t){return new Q.FieldMultilineInput(t)})),t.bind(pt.BINDING.FieldLimitLengthInput).toFunction((function(t){return new q.FieldLimitLengthInput(t)})),t.bind(pt.BINDING.MutationAddButton).toFunction((function(){return new Z.MutationAddButton})),t.bind(pt.BINDING.MutationRemoveButton).toFunction((function(t){return new Z.MutationRemoveButton(t)})),t.bind(pt.BINDING.FieldNumber).toFunction((function(t){return new J.FieldNumber(t)})),t.bind(pt.BINDING.FieldTextDropdown).toFunction((function(t){return new $.FieldTextDropdown(t)})),t.bind(pt.BINDING.FieldTextInput).toFunction((function(t){return new tt.FieldTextInput(t)})),t.bind(pt.BINDING.FieldDefaultValue).toFunction((function(t){return new et.FieldDefaultValue(t)})),t.bind(pt.BINDING.Input).toFunction((function(t){return new it.Input(t)})),t.bind(pt.BINDING.RenderedConnection).toFunction((function(t){return new st.RenderedConnection(t)})),t.bind(pt.BINDING.BlockSvg).toFunction((function(t){return new((0,ot.block_render_svg)(rt.BlockSvg))(t)})),t.bind(pt.BINDING.BlockGroup).toFunction((function(t){return new((0,ot.block_render_svg)(nt.BlockGroup))(t)})),t.bind(pt.BINDING.SimplifiedCommentBubble).to(R.SimplifiedCommentBubble).inSingletonScope(),t.bind(pt.BINDING.WorkspaceComment).toFunction((function(t){return"simplified"===t.type?new at.SimplifiedWorkspaceComment(t.workspace,t.parent_block,t.position,t.opt_id):new _t.WorkspaceComment(t.workspace,t.parent_block,t.position,t.opt_id,t.client_type,t.default_bubble_size)})),t.bind(pt.BINDING.Options).toFunction((function(t){return new ct.Options(t)})),t.bind(pt.BINDING.Scrollbar).toFunction((function(t,e,i,o,n){return new lt.Scrollbar(t,e,i,o,n)})),t.bind(pt.BINDING.ScrollbarPair).toFunction((function(t,e){return new lt.ScrollbarPair(t,e)})),t.bind(pt.BINDING.Msg).toConstantValue(ut.Msg),t.bind(pt.BINDING.css_content).toConstantValue(dt.BLINK_CSS_CONTENT)}},9528:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.BINDING=void 0,e.BINDING={Blink:Symbol("Blink"),block_animations:Symbol("block_animations"),touch_manager:Symbol("touch_manager"),dragged_connection_manager:Symbol("dragged_connection_manager"),insertion_marker_manager:Symbol("insertion_marker_manager"),utils:Symbol("utils"),xml:Symbol("xml"),registry:Symbol("registry"),json:Symbol("json"),css_content:Symbol("css_content"),css:Symbol("css"),widget_div:Symbol("widget_div"),runtime_data:Symbol("runtime_data"),context_menu:Symbol("context_menu"),events:Symbol("events"),extensions:Symbol("extensions"),slider_controller:Symbol("slider_controller"),angle_controller:Symbol("angle_controller"),color_controller:Symbol("color_controller"),WorkspaceElementDragger:Symbol("WorkspaceElementDragger"),FlyoutDragger:Symbol("FlyoutDragger"),WorkspaceDragger:Symbol("WorkspaceDragger"),Inject:Symbol("Inject"),Msg:Symbol("Msg"),WorkspaceDragSurfaceSvg:Symbol("WorkspaceDragSurfaceSvg"),BlockSvg:Symbol("BlockSvg"),BlockDragSurfaceSvg:Symbol("BlockDragSurfaceSvg"),ConnectionDB:Symbol("connection_db"),WorkspaceSvg:Symbol("WorkspaceSvg"),WorkspaceAudio:Symbol("WorkspaceAudio"),EndDragEvent:Symbol("EndDragEvent"),StartDragEvent:Symbol("StartDragEvent"),MoveEvent:Symbol("MoveEvent"),ChangeEvent:Symbol("ChangeEvent"),UIEvent:Symbol("UIEvent"),CreateEvent:Symbol("CreateEvent"),DeleteEvent:Symbol("DeleteEvent"),DragAreaChangeEvent:Symbol("DragAreaChangeEvent"),ContextMenuOptionEvent:Symbol("ContextMenuOptionEvent"),GroupEvent:Symbol("GroupEvent"),FlyoutButton:Symbol("FlyoutButton"),VerticalFlyout:Symbol("VerticalFlyout"),Field:Symbol("Field"),FieldImage:Symbol("Image"),FieldIcon:Symbol("Icon"),FieldLabel:Symbol("Label"),FieldLabelSerializable:Symbol("LabelSerializable"),FieldDropdown:Symbol("Dropdown"),FieldButton:Symbol("FieldButton"),FieldColour:Symbol("FieldColour"),FieldTextInput:Symbol("FieldTextInput"),FieldTextDropdown:Symbol("FieldTextDropdown"),FieldNumber:Symbol("FieldNumber"),FieldMultilineInput:Symbol("FieldMultilineInput"),FieldLimitLengthInput:Symbol("FieldLimitLengthInput"),FieldDefaultValue:Symbol("FieldDefaultValue"),Toolbox:Symbol("Toolbox"),MutationAddButton:Symbol("MutationAddButton"),MutationRemoveButton:Symbol("MutationRemoveButton"),Scrollbar:Symbol("Scrollbar"),ScrollbarPair:Symbol("ScrollbarPair"),Grid:Symbol("Grid"),Comment:Symbol("Comment"),Bubble:Symbol("Bubble"),Gesture:Symbol("Gesture"),RenderedConnection:Symbol("RenderedConnection"),Input:Symbol("Input"),Options:Symbol("Options"),Warning:Symbol("Warning"),tooltip:Symbol("tooltip"),theme:Symbol("theme"),WorkspaceComment:Symbol("WorkspaceComment"),BlockGroup:Symbol("BlockGroup"),SimplifiedCommentBubble:Symbol("SimplifiedCommentBubble"),workspace_db:Symbol("workspace_db")}},98030:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.lazy_inject=e.get_instance=e.BINDING=void 0;var o=i(9528);Object.defineProperty(e,"BINDING",{enumerable:!0,get:function(){return o.BINDING}});var n=i(27807);Object.defineProperty(e,"get_instance",{enumerable:!0,get:function(){return n.get_instance}}),Object.defineProperty(e,"lazy_inject",{enumerable:!0,get:function(){return n.lazy_inject}})},84682:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BaseEvent=void 0;var o=i(98734),n=i(98030),r=function(){function t(){this._workspace_id="",this._group=this.events.get_group(),this._record_undo=this.events.is_record_undo()}return t.prototype.is_null=function(){return!1},t.prototype._get_event_workspace=function(){var t=this.workspace_db.get(this._workspace_id);if(void 0==t)throw Error("Workspace is undefined. Event must have been generated from real Blockly events.");return t},t.prototype.is_record_undo=function(){return this._record_undo},t.prototype.set_record_undo=function(t){this._record_undo=t},t.prototype.get_workspace_id=function(){return this._workspace_id},t.prototype.set_workspace_id=function(t){this._workspace_id=t},t.prototype.get_block_id=function(){return this._block_id},t.prototype.serialize=function(){},o.__decorate([(0,n.lazy_inject)(n.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,n.lazy_inject)(n.BINDING.xml)],t.prototype,"xml",void 0),o.__decorate([(0,n.lazy_inject)(n.BINDING.json)],t.prototype,"json",void 0),o.__decorate([(0,n.lazy_inject)(n.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),t}();e.BaseEvent=r},76272:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockEvent=void 0;var o=i(98734),n=function(t){function e(e){var i=t.call(this)||this,o=e.get_workspace();return i._block_id=e.id,void 0==o?(console.error("Event block workspace not found."),i):(i._workspace_id=o.id,i)}return o.__extends(e,t),e.prototype.get_block_id=function(){return this._block_id},e}(i(84682).BaseEvent);e.BlockEvent=n},7851:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ChangeEvent=void 0;var o=i(98734),n=i(61455),r=i(75102),s=i(61972),_=function(t){function e(e,i){var o=t.call(this,i.block)||this;if(o.type=r.BlockEventType.CHANGE,o.element=e,o._data={block:i.block,name:i.name,old_value:i.old_value,new_value:i.new_value,new_text:i.new_text,old_text:i.old_text},(0,s.is_block_svg)(i.block)){if(o.is("mutation",o._data)||o.is("change_procedure_param",o._data))return o._new_json=o.json.block_to_json(i.block),o;if(o.is("comment",o._data)&&"string"===typeof o._data.new_value){var n=o._get_event_workspace().workspace_comment_db.get(o._data.new_value);n&&(o._comment_json=o.json.comment_to_json(n))}}return o}return o.__extends(e,t),e.prototype.is=function(t,e){return this.element===t&&!!e},e.prototype.is_null=function(){return this._data.old_value==this._data.new_value},e.prototype.run=function(t){var e,i,o,n,r,_,a=this._get_event_workspace(),c=a.get_element_from_db(this._block_id);if(c)if((0,s.is_workspace_comment)(c))if(this.is("comment_text",this._data))c.set_text(t?this._data.new_value:this._data.old_value);else if(this.is("comment_color",this._data))c.set_color_theme(t?this._data.new_value:this._data.old_value);else if(this.is("comment_expand",this._data))c.set_expanded(t?this._data.new_value:this._data.old_value);else if(this.is("comment_resize",this._data)){var l=t?this._data.new_value:this._data.old_value;c.set_bubble_size(l[0],l[1])}else console.warn("Unknown change type: ".concat(this.element));else if((0,s.is_block_svg)(c))if(this.is("field",this._data)){var d=this._data,u=d.name,h=d.new_value,p=d.old_value;l=t?h:p;void 0!=u&&(_=c.get_field(String(u)))&&(_.call_validator(l),_.set_value(l,!0))}else if(this.is("field_default_value",this._data)){var g=this._data,f=g.name;h=g.new_value,p=g.old_value,l=t?h:p;void 0!=f&&(_=c.get_field(String(f)))&&(0,s.is_field_default_value)(_)&&_.set_has_been_edited(l)}else if(this.is("comment",this._data)){var v=this._data;h=v.new_value,p=v.old_value;switch(typeof(l=t?h:p)){case"string":c.set_comment_text("",l),c.comment&&(c.comment.set_expanded(!0),c.comment.init_svg());break;case"undefined":c.set_comment_text(void 0);break;default:var m=void 0,b=parseFloat(l.getAttribute("relativeleft_")||""),y=parseFloat(l.getAttribute("relativetop_")||"");isNaN(b)||isNaN(y)||(m={x:b,y:y}),c.set_comment_text("",l.getAttribute("id")||void 0,m),this.xml.parse_comment_attributes(l,c.comment),c.comment&&c.comment.init_svg()}}else if(this.is("collapsed",this._data))c.set_collapsed(t?this._data.new_value:this._data.old_value,!0);else if(this.is("disabled",this._data))c.set_disabled(t?this._data.new_value:this._data.old_value);else if(this.is("inline",this._data))c.set_inputs_inline(t?this._data.new_value:this._data.old_value);else if(this.is("mutation",this._data)){p=t?this._data.old_value:this._data.new_value;"undefined"!==typeof(h=t?this._data.new_value:this._data.old_value)?null===(e=c.addMutation)||void 0===e||e.call(c,h,null===(i=this._data.name)||void 0===i?void 0:i.toString()):"undefined"!==typeof p&&(null===(o=c.removeMutation)||void 0===o||o.call(c,p,null===(n=this._data.name)||void 0===n?void 0:n.toString()))}else if(this.is("visibility",this._data))c.set_chunk_visibility(t?this._data.new_value:this._data.old_value),c.update_chunk_visibility();else if(this.is("group_block",this._data)){var E=this._data;h=E.new_value,p=E.old_value;if(l=t?h:p){var k=l[0],T=l[1],w=l[2];c.hide_into_group(T,{id:k,group_stop_at:w})}else null===(r=c.parent_group)||void 0===r||r.release()}else{var O=a.get_change_event(this.element);O?O.call(this,t):console.warn("Unknown change type: ".concat(this.element))}},e.prototype.get_name=function(){return this._data.name},e.prototype.get_new_value=function(){return this._data.new_value},e.prototype.get_old_value=function(){return this._data.old_value},e.prototype.get_new_text=function(){return this._data.new_text},e.prototype.get_old_text=function(){return this._data.old_text},e.prototype.update_new_value=function(t){this._data.new_value=t},e.prototype.serialize=function(){return{id:this._block_id,group:this._group,element:this.element,old_value:this._data.old_value,new_value:this._data.new_value,name:this._data.name}},e.prototype.get_new_comment=function(){return this._comment_json},e.prototype.get_new_json=function(){return this._new_json},e=o.__decorate([(0,n.injectable)()],e)}(i(76272).BlockEvent);e.ChangeEvent=_},24801:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.CreateEvent=void 0;var o=i(98734),n=i(61455),r=i(75102),s=o.__importStar(i(22804)),_=i(98030),a=function(t){function e(e){var i=t.call(this,e.block)||this;i.type=r.BlockEventType.CREATE,i.ids=[],i.is_shadow=!1,i.source=e.source||"other",i.original_block=e.original_block;var o=e.block,n=o.get_workspace();if(void 0!=n&&n.rendered?i._xml=i.xml.workspace_element_to_dom_with_xy(o):i._xml=i.xml.workspace_element_to_dom(o),s.base.is_block_svg(o))i.ids=o.get_descendant_ids(),i.is_shadow=o.is_shadow(),i._element_json=i.json.block_to_json(o);else{if(!s.base.is_workspace_comment(o))throw new Error("Trying to fire create event for unsupported workspace element.");i.ids=[o.id],i._element_json={blocks:{},comments:{},connections:{}},i._element_json.comments[o.id]=i.json.comment_to_json(o)}return i}return o.__extends(e,t),e.prototype.run=function(t){var e=this._get_event_workspace();if(t){var i=s.dom.create_dom("xml");return i.appendChild(this._xml),void this.xml.dom_to_workspace(i,e)}for(var o=0;o<this.ids.length;o++){var n=this.ids[o],r=e.get_element_from_db(n);r?r.dispose(!1,!1):n==this._block_id&&this.is_shadow}},e.prototype.get_element_json=function(){return this._element_json},e.prototype.serialize=function(){if(this._element_json)return{group:this._group,blocks:this._element_json.blocks,comments:this._element_json.comments,connections:this._element_json.connections}},o.__decorate([(0,_.lazy_inject)(_.BINDING.events)],e.prototype,"events",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.xml)],e.prototype,"xml",void 0),e=o.__decorate([(0,n.injectable)()],e)}(i(76272).BlockEvent);e.CreateEvent=a},69682:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.DeleteEvent=void 0;var o=i(98734),n=i(61455),r=i(75102),s=i(98030),_=o.__importStar(i(22804)),a=function(t){function e(e){var i=t.call(this,e.block)||this;i.type=r.BlockEventType.DELETE,i.ids=[],i.is_shadow=!1;var o=e.block;if(_.base.is_block_svg(o)&&o.get_parent())return console.error("Connected blocks cannot be deleted."),i;var n=o.get_workspace();return void 0!=n&&n.rendered?i.old_xml=i.xml.workspace_element_to_dom_with_xy(o):i.old_xml=i.xml.workspace_element_to_dom(o),i.ids=[o.id],_.base.is_block_svg(o)&&(i.ids=o.get_descendant_ids(),i.is_shadow=o.is_shadow()),i}return o.__extends(e,t),e.prototype.run=function(t){var e=this._get_event_workspace();if(t)for(var i=0;i<this.ids.length;i++){var o=this.ids[i];(r=e.get_element_from_db(o))?r.dispose(!1,!1):o!==this._block_id||this.is_shadow||console.warn("Can't delete non-existent block: ".concat(o))}else{var n=this.old_xml.getAttribute("id");if(n){var r;void 0!=(r=e.get_element_from_db(n))&&r.dispose(!1,!1);var s=_.dom.create_dom("xml");s.appendChild(this.old_xml),this.xml.dom_to_workspace(s,e)}}},e.prototype.serialize=function(){return{id:this._block_id,all_ids:this.ids,group:this._group}},o.__decorate([(0,s.lazy_inject)(s.BINDING.xml)],e.prototype,"xml",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.events)],e.prototype,"events",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.Blink)],e.prototype,"Blink",void 0),e=o.__decorate([(0,n.injectable)()],e)}(i(76272).BlockEvent);e.DeleteEvent=a},40486:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.DragAreaChangeEvent=void 0;var o=i(98734),n=i(61455),r=i(75102),s=function(t){function e(e){var i=t.call(this,e.block)||this;return i.type=r.BlockEventType.DRAG_AREA_CHANGE,i._record_undo=!1,i.block=e.block,i.area=e.area,i.is_in=e.is_in,i}return o.__extends(e,t),e=o.__decorate([(0,n.injectable)()],e)}(i(76272).BlockEvent);e.DragAreaChangeEvent=s},27197:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.EndDragEvent=void 0;var o=i(98734),n=i(61455),r=i(75102),s=function(t){function e(e){var i=t.call(this,e.block)||this;return i._record_undo=!1,i.type=r.BlockEventType.END_DRAG,i.block=e.block,i._is_outside=e.is_outside,i.mouse_position=e.mouse_position,i._is_from_flyout=e.is_from_flyout,i.redo_stack_before_drag=e.redo_stack_before_drag,i}return o.__extends(e,t),e.prototype.get_block_xml=function(){return this.xml.workspace_element_to_dom(this.block,!0)},e.prototype.delete_current=function(){this.block.dispose()},e.prototype.cancel_move=function(){var t=this._get_event_workspace();t.undo(),t.set_redo_stack(this.redo_stack_before_drag)},e=o.__decorate([(0,n.injectable)()],e)}(i(76272).BlockEvent);e.EndDragEvent=s},22149:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.StartDragEvent=e.MoveEvent=e.EndDragEvent=e.DragAreaChangeEvent=e.DeleteEvent=e.ChangeEvent=e.CreateEvent=e.BlockEvent=void 0;var o=i(76272);Object.defineProperty(e,"BlockEvent",{enumerable:!0,get:function(){return o.BlockEvent}});var n=i(24801);Object.defineProperty(e,"CreateEvent",{enumerable:!0,get:function(){return n.CreateEvent}});var r=i(7851);Object.defineProperty(e,"ChangeEvent",{enumerable:!0,get:function(){return r.ChangeEvent}});var s=i(69682);Object.defineProperty(e,"DeleteEvent",{enumerable:!0,get:function(){return s.DeleteEvent}});var _=i(40486);Object.defineProperty(e,"DragAreaChangeEvent",{enumerable:!0,get:function(){return _.DragAreaChangeEvent}});var a=i(27197);Object.defineProperty(e,"EndDragEvent",{enumerable:!0,get:function(){return a.EndDragEvent}});var c=i(36418);Object.defineProperty(e,"MoveEvent",{enumerable:!0,get:function(){return c.MoveEvent}});var l=i(88189);Object.defineProperty(e,"StartDragEvent",{enumerable:!0,get:function(){return l.StartDragEvent}})},36418:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.MoveEvent=void 0;var o=i(98734),n=i(1530),r=i(61455),s=i(75102),_=i(61972),a=function(t){function e(e){var i=t.call(this,e.block)||this;i.type=s.BlockEventType.MOVE;var o=i._current_location();return i.old_parent_id=o.parent_id,i.old_input_name=o.input_name,i.old_coordinate=o.coordinate,i}return o.__extends(e,t),e.prototype.get_new_loc=function(){return{parent_id:this.new_parent_id,input_name:this.new_input_name,coordinate:this.new_coordinate}},e.prototype._current_location=function(){var t=this.workspace_db.get(this._workspace_id);if(void 0==t)return console.error("Event has no workspace."),{};var e=t.get_element_from_db(this._block_id);if(void 0==e)return console.error("Event has no block."),{};var i={};if((0,_.is_block_svg)(e)){var o=e.get_parent();if(o){i.parent_id=o.id;var n=o.get_input_with_block(e);n&&(i.input_name=n.name)}else i.coordinate=e.get_relative_to_surface_xy()}else(0,_.is_workspace_comment)(e)&&(i.coordinate=(0,_.clone_deep)(e.get_relative_position()));return i},e.prototype.record_new=function(){var t=this._current_location();this.new_parent_id=t.parent_id,this.new_input_name=t.input_name,this.new_coordinate=t.coordinate},e.prototype.is_null=function(){return this.old_parent_id===this.new_parent_id&&this.old_input_name===this.new_input_name&&(void 0==this.old_coordinate&&void 0==this.new_coordinate||void 0!=this.old_coordinate&&void 0!=this.new_coordinate&&n.vec2.equals(this.old_coordinate,this.new_coordinate))},e.prototype.run=function(t){var e=this,i=this._get_event_workspace(),o=i.get_element_from_db(this._block_id);if(void 0!=o){!function(){if((0,_.is_block_svg)(o)){var n=t?e.new_parent_id:e.old_parent_id;if(n){var r,a=i.get_block_by_id(n);if(!a)throw Error("Trying to re-connect to non-existent block. Event: ".concat(e));var c=o.output_connection||o.previous_connection;if(!c)throw Error("\u6ca1\u6709\u5bf9\u5916\u8fde\u63a5\u8bb0\u5f55\u4e2a\ud83d\udd28\u7684\u8fde\u63a5\u4e8b\u4ef6");var l=t?e.new_input_name:e.old_input_name;if(l){var d=a.get_input(l);r=d&&d.connection}else c.type===s.CONNECTION_TYPE.PREVIOUS_STATEMENT&&(r=a.next_connection);if(void 0!=r)return o.unplug(),void c.connect(r,!0);console.warn("Can't connect to non-existent input: ".concat(l,", so dispose this blockConnection")),c&&(e.events.disable(),c.source_block.dispose(),e.events.enable())}else o.unplug()}}(),function(){var i,r=t?(0,_.clone_deep)(e.new_coordinate):(0,_.clone_deep)(e.old_coordinate);if(r){var s=o.get_relative_to_surface_xy();if((0,_.is_workspace_comment)(o)){var a=null===(i=o.get_parent_block())||void 0===i?void 0:i.get_relative_to_surface_xy();a&&n.vec2.add(r,a,r)}o.move_by(n.vec2.sub(s,r,s))}}()}else t||console.warn("Can't move non-existent block: ".concat(this._block_id))},e.prototype.set_old_coord=function(t){this.old_coordinate=t},e.prototype.get_old_loc=function(){return{parent_id:this.old_parent_id,input_name:this.old_input_name,coordinate:this.old_coordinate}},e.prototype.serialize=function(){var t=this.old_coordinate?[this.old_coordinate[0],this.old_coordinate[1]]:void 0,e=this.new_coordinate?[this.new_coordinate[0],this.new_coordinate[1]]:void 0;return{id:this._block_id,group:this._group,old_parent_id:this.old_parent_id,old_input_name:this.old_input_name,old_coordinate:t,new_parent_id:this.new_parent_id,new_input_name:this.new_input_name,new_coordinate:e}},e.prototype.deserialize=function(t){this._block_id=t.id,this.old_parent_id=t.old_parent_id,this.old_input_name=t.old_input_name,this.old_coordinate=t.old_coordinate&&n.vec2.fromValues(t.old_coordinate[0],t.old_coordinate[1]),this.new_parent_id=t.new_parent_id,this.new_input_name=t.new_input_name,this.new_coordinate=t.new_coordinate&&n.vec2.fromValues(t.new_coordinate[0],t.new_coordinate[1])},e.prototype.update_new_loc=function(t){this.new_parent_id=t.parent_id,this.new_input_name=t.input_name,this.new_coordinate=t.coordinate},e=o.__decorate([(0,r.injectable)()],e)}(i(76272).BlockEvent);e.MoveEvent=a},88189:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.StartDragEvent=void 0;var o=i(98734),n=i(61455),r=i(75102),s=function(t){function e(e){var i=t.call(this,e.block)||this;return i.type=r.BlockEventType.START_DRAG,i._record_undo=!1,i.block=e.block,i._is_from_flyout=e.is_from_flyout,i}return o.__extends(e,t),e=o.__decorate([(0,n.injectable)()],e)}(i(76272).BlockEvent);e.StartDragEvent=s},35054:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ContextMenuOptionEvent=void 0;var o=i(98734),n=i(61455),r=i(75102),s=function(t){function e(e){var i=t.call(this)||this;return i.type=r.BlockEventType.CONTEXT_MENU_OPTION,i._record_undo=!1,i._workspace_id=e.workspace_id,i._option_name=e.option_name,i._source=e.source,i}return o.__extends(e,t),e=o.__decorate([(0,n.injectable)()],e)}(i(84682).BaseEvent);e.ContextMenuOptionEvent=s},73829:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.GroupEvent=void 0;var o=i(98734),n=i(61455),r=i(14375),s=i(98030),_=i(75102),a=i(81558),c=function(t){function e(e){var i=t.call(this)||this;i._workspace_id=i.Blink.mainWorkspace.id||"",i._record_undo=!1;var o=e.type,n=e.group;if(i.type=o,i._group=n,o===_.GroupEventType.GroupEnd)for(var r=i._get_event_workspace().get_undo_stack().filter((function(t){return t._group===i._group})),s=r.length-1;s>=0;s--){var a=r[s];(a.type===_.BlockEventType.MOVE||a.type===_.BlockEventType.CREATE&&"other"===a.source||a.type===_.BlockEventType.CHANGE&&"change_procedure_param"===a.element)&&i.process_context_blocks(a)}return i}return o.__extends(e,t),e.prototype.process_context_blocks=function(t){var e=this,i=this._get_event_workspace().get_block_by_id(t.get_block_id());if(i){var o=new Set,n=new Set;i.get_descendants(!1,!0).forEach((function(t){if(t.type!==r.PROCEDURE_BLOCK_TYPES.CALL_NORETURN&&t.type!==r.PROCEDURE_BLOCK_TYPES.CALL_RETURN&&(0,a.has_context)(t)){var e=(0,a.is_valid_context)(t);e||t.disabled||o.add(t),e&&t.disabled&&n.add(t)}}));var s=function(t,i){var o=e.events.is_record_undo();e.events.set_record_undo(!0),e.events.disable();var n=e.events.get_group();e.events.set_group(e._group),e.events.enable(),t.set_disabled(i),e.events.disable(),e.events.set_group(n),e.events.enable(),e.events.set_record_undo(o)};o.forEach((function(t){s(t,!0)})),n.forEach((function(t){s(t,!1)}))}},o.__decorate([(0,s.lazy_inject)(s.BINDING.Blink)],e.prototype,"Blink",void 0),e=o.__decorate([(0,n.injectable)()],e)}(i(84682).BaseEvent);e.GroupEvent=c},25026:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.GroupEvent=e.ContextMenuOptionEvent=e.BaseEvent=e.UIEvent=void 0;var o=i(17220);Object.defineProperty(e,"UIEvent",{enumerable:!0,get:function(){return o.UIEvent}});var n=i(84682);Object.defineProperty(e,"BaseEvent",{enumerable:!0,get:function(){return n.BaseEvent}});var r=i(35054);Object.defineProperty(e,"ContextMenuOptionEvent",{enumerable:!0,get:function(){return r.ContextMenuOptionEvent}});var s=i(73829);Object.defineProperty(e,"GroupEvent",{enumerable:!0,get:function(){return s.GroupEvent}})},17220:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.UIEvent=void 0;var o=i(98734),n=i(61455),r=function(t){function e(e){var i=t.call(this)||this;return i._record_undo=!1,i.type=e.type,i._workspace_id=e.workspace_id,i._old_value=e.old_value,i._new_value=e.new_value,i._block_id=e.block_id,i}return o.__extends(e,t),e.prototype.get_new_value=function(){return this._new_value},e.prototype.get_old_value=function(){return this._old_value},e=o.__decorate([(0,n.injectable)()],e)}(i(84682).BaseEvent);e.UIEvent=r},14024:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Flyout=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=i(75102),a=i(25461),c=i(49325),l=i(76518),d=function(){function t(t){var e=this;this.listeners_=[],this.containerVisible_=!0,this.permanently_disabled_=[],this.reflow_wrapper=void 0,this.buttons_=[],this.cached_blocks=new Map,this.cached_buttons=new Map,this.default_button_gap=12,this.horizontalLayout_=!1,this.is_visible_=!1,this.width_=0,this.height_=0,this.event_wrappers_=[],this.drag_angle_range_=50,this.auto_close=!0,this.bind_transition_end_event=function(){e.svg_group&&e.targetWorkspace_&&(e.transition_end_wrapper=e.events.bind_event_with_checks(e.svg_group,"transitionend",e,(function(t){if(e.targetWorkspace_&&"transform"===t.propertyName&&e.events.is_enabled()){var i=e.ui_event_factory({type:_.UIEventType.FLYOUT_SHOW,workspace_id:e.targetWorkspace_.id,old_value:!e.is_visible_,new_value:e.is_visible_});e.events.fire(i)}})))},t.get_metrics=this.get_metrics.bind(this),t.set_metrics=this.set_metrics.bind(this),t.has_categories=!1,t.in_flyout=!0,this.workspace_=this.workspace_factory(t),this.workspace_.set_scale(t.zoomOptions.startScale),this.RTL=!!t.RTL,this.toolboxPosition_=t.toolboxPosition,this.flyout_corner_radius=t.flyout.corner_radius||this.theme.renderer.FLYOUT_CORNER_RADIUS,this.padding_top=t.flyout.padding.top,this.padding_bottom=t.flyout.padding.bottom,this.padding_left=t.flyout.padding.left,this.padding_right=t.flyout.padding.right}return t.prototype.get_workspace=function(){return this.workspace_},t.prototype.get_buttons_=function(){return this.buttons_},t.prototype.set_corner_radius=function(t){this.flyout_corner_radius=t},t.prototype.filter_for_capacity=function(){if(this.targetWorkspace_)for(var t=this.targetWorkspace_.remaining_capacity(),e=this.workspace_.get_top_blocks(!1),i=0;i<e.length;i++){var o=e[i];if(-1==this.permanently_disabled_.indexOf(o)){var n=o.get_descendants();o.set_disabled(n.length>t)}}},t.prototype.reflow=function(){this.reflow_wrapper&&this.workspace_.remove_change_listener(this.reflow_wrapper);var t=this.workspace_.get_top_blocks(!1);this.reflow_internal(t),this.reflow_wrapper&&this.workspace_.add_change_listener(this.reflow_wrapper)},t.prototype.set_visible=function(t){var e=t!=this.is_visible_;this.is_visible_=t,e&&this.update_display()},t.prototype.update_display=function(){var t=this.is_visible();return this.scrollbar_&&this.scrollbar_.set_container_visible(t),t},t.prototype.block_mouse_down=function(t){var e=this,i=this;return function(o){if(e.targetWorkspace_){var n=e.targetWorkspace_.get_gesture(o);n&&(n.set_start_block(t),n.handle_flyout_start(o,i))}}},t.prototype.get_svg_root=function(){return this.svg_group},t.prototype.get_background=function(){return this.svg_background_},t.prototype.get_scrollbar=function(){return this.scrollbar_},t.prototype.is_scrollable=function(){return!!this.scrollbar_&&this.scrollbar_.is_visible()},t.prototype.is_horizontal=function(){return this.horizontalLayout_},t.prototype.is_visible=function(){return this.is_visible_&&this.containerVisible_},t.prototype.get_width=function(){return this.width_},t.prototype.get_height=function(){return this.height_},t.prototype.set_auto_close=function(t){t!==this.auto_close&&(this.auto_close=t,this.targetWorkspace_&&this.utils.svg_resize(this.targetWorkspace_),this.svg_group&&(t?((0,a.add_class_if_necessary)(this.svg_group,"blocklyFlyoutAutoClose"),(0,a.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutPinned")):((0,a.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutAutoClose"),(0,a.add_class_if_necessary)(this.svg_group,"blocklyFlyoutPinned"))))},t.prototype.is_auto_close=function(){return this.auto_close},t.prototype.create_dom=function(t){return this.svg_group=(0,a.create_svg_element)(t,{class:this.auto_close?"blocklyFlyout blocklyFlyoutHidden blocklyFlyoutAutoClose":"blocklyFlyout blocklyFlyoutHidden blocklyFlyoutPinned",width:0,height:0}),this.svg_background_=(0,a.create_svg_element)("path",{class:"blocklyFlyoutBackground"},this.svg_group),this.svg_background_.style.fill=this.theme.flyout.BACKGROUND_COLOR.toString(),this.svg_group.appendChild(this.create_workspace_with_padding_top(this.padding_top)),this.svg_group},t.prototype.create_workspace_with_padding_top=function(t){var e=this.workspace_.create_dom();return this.set_padding_top(t),e},t.prototype.set_padding_top=function(t){this.workspace_&&this.workspace_.svg_group&&("number"===typeof t?(this.workspace_.svg_group.style.transform="",this.workspace_.svg_group.setAttribute("transform","translate(0, ".concat(t,")"))):(this.workspace_.svg_group.removeAttribute("transform"),this.workspace_.svg_group.style.transform="translate(0, ".concat(t,")")))},t.prototype.dispose=function(){this.hide(),this.unbind_scroll_events(),this.transition_end_wrapper&&(this.events.unbind_event(this.transition_end_wrapper),delete this.transition_end_wrapper),this.scrollbar_&&(this.scrollbar_.dispose(),delete this.scrollbar_),this.workspace_&&(this.workspace_.set_target_workspace(void 0),this.workspace_.dispose()),this.svg_group&&((0,a.remove_node)(this.svg_group),delete this.svg_group),delete this.svg_background_,delete this.targetWorkspace_,this.cached_blocks.forEach((function(t){return t.dispose()})),this.cached_blocks.clear(),this.cached_buttons.forEach((function(t){return t.dispose()})),this.cached_buttons.clear()},t.prototype.add_block_listeners=function(t,e){this.listeners_.push(this.events.bind_event_with_checks(t,"mousedown",void 0,this.block_mouse_down(e)))},t.prototype.xml_to_flyout_dom=function(t,e,i,o){if(void 0===o&&(o=this.workspace_),!this.targetWorkspace_)throw new Error("Trying to construct flyout dom before setting target workspace. ");var n=t.tagName.toUpperCase();if(n)switch(n){case"BLOCK":var r=this.xml.dom_to_text(t),s=this.cached_blocks.get(r);s?s.retach(o):(s=this.xml.dom_to_block(t,o),this.check_if_cache_block(t)&&this.cached_blocks.set(r,s)),s.disabled&&this.permanently_disabled_.push(s),e.push({type:"block",block:s,xml:t,inline:"true"===t.getAttribute("layout_inline")});var _=this.targetWorkspace_.options.flyout.blocks.default_gap;if(s.is_starting_block()&&i.length>0&&i[i.length-1]===_){var a=(0,l.is_short_block)(t)&&this.targetWorkspace_.options.flyout.blocks.head_short_block_offset?this.targetWorkspace_.options.flyout.blocks.head_short_block_offset[1]:this.targetWorkspace_.options.flyout.blocks.head_block_offset[1];i[i.length-1]+=a}var c=t.getAttribute("gap");return void i.push(c?parseInt(c)<=10?_:parseInt(c):_);case"SEP":var d=t.getAttribute("gap");return void(d&&i.length>0&&(i[i.length-1]=parseInt(d,10)));case"BUTTON":case"LABEL":var u=(new XMLSerializer).serializeToString(t),h=this.cached_buttons.get(u);return h?h.retach(o):(h=this.flyout_button_factory({workspace:o,target_workspace:this.targetWorkspace_,xml:t,is_label:"LABEL"===n,flyout_padding_left:this.padding_left,flyout_padding_right:this.padding_right}),this.cached_buttons.set(u,h)),e.push({type:"button",button:h}),void i.push(this.default_button_gap)}},t.prototype.show=function(t){var e=this;if(this.workspace_&&this.svg_group){var i;if(this.events.disable(),this.workspace_.set_resizes_enabled(!1),this.hide(),this.clear_old_blocks(),"string"==typeof t){var o=this.workspace_.get_target_workspace();if(!o)return void console.error("Workspace has no target workspace.");var n=o.get_toolbox_category_callback(t);i=n?n(this.workspace_.get_target_workspace()):[]}else i=t;this.set_visible(!0),this.permanently_disabled_.length=0;for(var r=[],s=[],_=0;_<i.length;_++){var c=i[_];this.xml_to_flyout_dom(c,r,s)}this.layout_(r,s);this.svg_background_?this.listeners_.push(this.events.bind_event_with_checks(this.svg_background_,"mouseover",this,(function(){for(var t=e.workspace_.get_top_blocks(!1),i=0;i<t.length;i++)t[i].remove_select()}))):console.warn("Flyout background svg not found."),this.reset_size(),this.workspace_.set_resizes_enabled(!0),this.reflow(),this.filter_for_capacity(),this.position(),this.reflow_wrapper=this.reflow.bind(this),this.reflow_wrapper&&this.workspace_.add_change_listener(this.reflow_wrapper),!this.auto_close&&this.targetWorkspace_&&this.utils.svg_resize(this.targetWorkspace_),this.events.enable(),(0,a.add_class_if_necessary)(this.svg_group,"blocklyFlyoutVisible"),(0,a.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutHidden")}else console.error("Workspace has not been init.")},t.prototype.check_if_cache_block=function(t){return"true"!==t.getAttribute("uncache")},t.prototype.hide=function(){var t=this;if(this.is_visible()&&this.targetWorkspace_&&this.svg_group){var e=this.get_workspace().svg_block_canvas_;e&&(e.style.transition="none"),this.set_visible(!1),this.listeners_.forEach((function(e){return t.events.unbind_event(e)})),this.listeners_.length=0,this.position(),this.reflow_wrapper&&(this.workspace_.remove_change_listener(this.reflow_wrapper),this.reflow_wrapper=void 0),this.auto_close||this.utils.svg_resize(this.targetWorkspace_),(0,a.add_class_if_necessary)(this.svg_group,"blocklyFlyoutHidden"),(0,a.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutVisible")}},t.prototype.clear_old_blocks=function(){if(this.workspace_){!function(t){for(var e=t.get_top_blocks(!1),i=0;i<e.length;i++){var o=e[i];o.get_workspace()==t&&o.detach()}}(this.workspace_);for(var t=0;t<this.buttons_.length;t++)this.buttons_[t].detach();this.buttons_.length=0}else console.error("Workspace has not been init.")},t.prototype.position_at=function(t,e,i,o){if(this.svg_group&&(this.svg_group.setAttribute("width",t.toString()),this.svg_group.setAttribute("height",e.toString()),this.utils.set_transform_style(this.svg_group,i,o)),this.scrollbar_){var n=r.vec2.fromValues(i,o);this.scrollbar_.set_origin(n),this.scrollbar_.resize()}},t.prototype.set_container_visible=function(t){if(this.svg_group){var e=t!=this.containerVisible_;if(this.containerVisible_=t,e){var i=this.update_display();this.svg_group.style.display=i?"block":"none"}}},t.prototype.scroll_to_start=function(){this.targetWorkspace_&&this.targetWorkspace_.options.flyout_scrollable&&(this.scrollbar_?this.scrollbar_.set(0):console.error("Cannot scroll flyout before scrollbar is initialized. ","Make sure Flyout.init() is called before trying to scroll. "))},t.prototype.create_block=function(t,e,i){if(!this.targetWorkspace_)throw new Error("Trying to create block from flyout before target workspace set. ");var o;this.events.disable(),this.targetWorkspace_.set_resizes_enabled(!1);try{t.remove_hover(),o=this.place_new_block(t,i)}finally{this.events.enable(),this.utils.hide_chaff()}return this.events.is_enabled()&&(this.events.get_group()||this.events.set_group(!0),void 0!=o&&this.events.is_enabled()&&this.events.fire(this.create_event_factory({block:o,source:e?"flyout:click":"flyout:drag",original_block:t}))),this.auto_close&&this.hide(),o},t.prototype.init=function(t){if(this.targetWorkspace_=t,!this.workspace_)throw new Error("this.workspace_ can not be undefined");this.workspace_.set_target_workspace(t),t.options.flyout_scrollable&&(this.scrollbar_=this.scrollbar_factory(this.workspace_,this.horizontalLayout_,!1,"blocklyFlyoutScrollbar",t.options.flyout_show_scrollbars),this.bind_scroll_events()),this.bind_transition_end_event(),this.hide(),this.auto_close||this.targetWorkspace_.add_change_listener(this.filter_for_capacity.bind(this)),this.workspace_.get_gesture=this.targetWorkspace_.get_gesture.bind(this.targetWorkspace_)},t.prototype.unbind_scroll_events=function(){var t=this;this.event_wrappers_.forEach((function(e){return t.events.unbind_event(e)})),this.event_wrappers_=[]},t.prototype.bind_scroll_events=function(){if(!this.svg_group||!this.svg_background_)throw new Error("Trying to bind scroll event for flyout before svg init. ");this.event_wrappers_.push(this.events.bind_event_with_checks(this.svg_group,"wheel",this,this.wheel_)),this.event_wrappers_.push(this.events.bind_event_with_checks(this.svg_background_,"mousedown",this,this.on_mouse_down))},t.prototype.init_flyout_button=function(t,e,i,o){var n=t.get_svg_group()||t.create_dom(o);return"number"===typeof e&&"number"===typeof i&&t.move_to(e,i),t.show("none"!==t.default_display),this.listeners_.push(this.events.bind_event_with_checks(n,"mousedown",this,"fixed"!==t.position?this.on_mouse_down:function(){})),this.buttons_.push(t),n},t.prototype.on_mouse_down=function(t){if(this.is_visible()&&this.targetWorkspace_){var e=this.targetWorkspace_.get_gesture(t);e&&e.handle_flyout_start(t,this)}},t.prototype.clear_cached_blocks=function(){this.cached_blocks.clear()},t.prototype.stop_scroll=function(){c.scrollSmothInstance.stopIosAnimate()},o.__decorate([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.xml)],t.prototype,"xml",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.FlyoutButton)],t.prototype,"flyout_button_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.WorkspaceSvg)],t.prototype,"workspace_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.Scrollbar)],t.prototype,"scrollbar_factory",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Flyout=d},73892:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FlyoutButton=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=i(25461),a=function(){function t(t){var e=this;this.position_=r.vec2.fromValues(0,0),this.svg_group=void 0,this.width=0,this.width_ratio=void 0,this.height=0,this.margin_right=0,this.on_mouse_up=function(t){var i,o=null===(i=e.target_workspace)||void 0===i?void 0:i.get_gesture(t);o&&o.cancel(),e.callback_&&e.callback_(e,t)},this.workspace_=t.workspace,this.target_workspace=t.target_workspace,this.text_=t.xml.getAttribute("text")||"",this.position_=r.vec2.fromValues(0,0),this.is_label=t.is_label,this.flyout_padding_left=t.flyout_padding_left,this.flyout_padding_right=t.flyout_padding_right,this.callback_=void 0;var i=t.xml,o=t.target_workspace,n=i.getAttribute("callbackkey");this.is_label&&n&&console.warn("Labels should not have callbacks. Label text: ".concat(this.text_)),this.is_label||(n&&o.get_button_callback(n)?this.callback_=o.get_button_callback(n):console.warn("Buttons should have callbacks. Button text: ".concat(this.text_))),this.relation=i.getAttribute("relation")||void 0,this.css_class=i.getAttribute("web-class")||void 0,this.default_display=i.getAttribute("display")||void 0,this.type=i.getAttribute("type")||void 0,this.height=parseInt(i.getAttribute("height")||"0")||this.height;var s=i.getAttribute("width");if(s){var _=s.match(/[0-9]+%/);_&&_[0]?this.width_ratio=parseInt(_[0])/100:this.width=parseInt(s)||0}"line"===this.type&&(this.width_ratio=this.width_ratio||1,this.height=this.height||11);var a=function(t){if("string"===typeof t){var e=parseFloat(t);return isNaN(e)?void 0:e}};this.position=i.getAttribute("position")||"relative",this.left=a(i.getAttribute("left")),this.top=a(i.getAttribute("top")),this.right=a(i.getAttribute("right")),this.bottom=a(i.getAttribute("bottom")),this.align=i.getAttribute("align")||void 0,this.inline=i.getAttribute("inline")||void 0,this.margin_right=a(i.getAttribute("margin_right"))||0,this.img_url=i.getAttribute("img_url")||void 0,this.img_width=a(i.getAttribute("img_width"))||0,this.img_height=a(i.getAttribute("img_height"))||0,this.img_margin_right=a(i.getAttribute("img_margin_right"))||0,this.vertical_padding=a(i.getAttribute("vertical_padding"))||0,this.option=i.getAttribute("option")||void 0,this.title=i.getAttribute("title")||void 0,this.key=i.getAttribute("key")||void 0}return t.prototype.get_svg_group=function(){return this.svg_group},t.prototype.get_target_workspace=function(){return this.target_workspace},t.prototype.show=function(t){void 0===t&&(t=!0),this.svg_group&&(this.svg_group.setAttribute("display",t?"block":"none"),t&&this.update_callback&&this.update_callback(this))},t.prototype.move_to=function(t,e){if(this.workspace_){var i="fixed"===this.position?this.workspace_.get_scale():1;this.position_=r.vec2.fromValues(t*i,e*i),this.update_transform()}},t.prototype.update_transform=function(){if(this.svg_group&&this.workspace_){var t="fixed"===this.position?", scale(".concat(this.workspace_.get_scale(),")"):"";this.svg_group.setAttribute("transform","translate(".concat(this.position_[0],", ").concat(this.position_[1],")").concat(t))}},t.prototype.detach=function(){this.svg_group&&(0,_.remove_node)(this.svg_group),this.workspace_=void 0},t.prototype.retach=function(t){this.workspace_=t,this.svg_group&&this.workspace_.svg_block_canvas_&&this.workspace_.svg_block_canvas_.appendChild(this.svg_group)},t.prototype.dispose=function(){this.on_mouse_up_wrapper&&this.event.unbind_event(this.on_mouse_up_wrapper),this.svg_group&&((0,_.remove_node)(this.svg_group),this.svg_group=void 0),delete this.workspace_,delete this.target_workspace},t.prototype.create_dom=function(t){var e,i,o,n,r,s,a,c=this,l=function(){c.svg_group&&(c.is_label||c.svg_group.classList.add("blocklyFlyoutClickable"),c.update_transform(),c.on_mouse_up_wrapper=c.event.bind_event_with_checks(c.svg_group,"mouseup",c,c.on_mouse_up),(c.width<=0&&!c.width_ratio||c.height<=0)&&console.warn("[FlyoutButton] A button without width or height declaration may cause layout error. ","Please indicate both width and height in the xml of button type: [".concat(c.type,"].")))},d=null===(e=this.target_workspace)||void 0===e?void 0:e.get_custom_flyout_button(this.type||"");if(d){var u=d(t);if(u instanceof Element)this.svg_group=u;else{var h=u.svg_group,p=u.update_callback;this.svg_group=h,this.update_callback=p}return null===(o=null===(i=this.workspace_)||void 0===i?void 0:i.svg_block_canvas_)||void 0===o||o.appendChild(this.svg_group),this.svg_group.cachedWidth_&&(this.width=this.svg_group.cachedWidth_),this.svg_group.cachedHeight_&&(this.height=this.svg_group.cachedHeight_),l(),this.svg_group}if("line"===this.type){if("number"!==typeof t)throw Error("Flyout line should be draw when reflow. ");this.svg_group=(0,_.create_svg_element)("g",{class:"blocklyLine"}),null===(r=null===(n=this.workspace_)||void 0===n?void 0:n.svg_block_canvas_)||void 0===r||r.appendChild(this.svg_group);var g=(0,_.create_svg_element)("rect",{rx:0,ry:0,height:0,width:0},this.svg_group);this.width=t-this.flyout_padding_left-this.flyout_padding_right,g.setAttribute("y","5"),g.setAttribute("width","".concat(this.width)),g.setAttribute("height","1")}else{"normal"!==this.type&&console.warn("Flyout button type [".concat(this.type,"] is not defined. "),"Rendering ".concat(this," as a normal button. "));var f=this.height||32,v=this.vertical_padding;this.svg_group=(0,_.create_svg_element)("g",{class:this.css_class}),null===(a=null===(s=this.workspace_)||void 0===s?void 0:s.svg_block_canvas_)||void 0===a||a.appendChild(this.svg_group);var m=(0,_.create_svg_element)("rect",{class:"flyoutButtonNormalRect",rx:4,ry:4},this.svg_group);if(this.img_url&&((0,_.create_svg_element)("image",{class:"flyoutButtonNormalIcon",height:this.img_height,width:this.img_width,x:v,y:(f-this.img_height)/2},this.svg_group).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.img_url),v+=this.img_width+this.img_margin_right),this.text_){var b;(b=(0,_.create_svg_element)("text",{class:"blocklyText","dominant-baseline":"middle",x:v,y:f/2+1},this.svg_group)).textContent=this.text_;var y=0;try{y=b.getComputedTextLength()}catch(E){y=8*this.text_.length}v+=y}v+=this.vertical_padding,m.setAttribute("width","".concat(v)),m.setAttribute("height","".concat(f)),this.width=v,this.height=f,this.option&&((b=(0,_.create_svg_element)("text",{class:"blocklyButtonTip","dominant-baseline":"middle",x:v+3,y:f/2+1},this.svg_group)).textContent="* ".concat(this.option)),this.title&&((0,_.create_svg_element)("title",{},this.svg_group).textContent=this.title)}return l(),this.svg_group},t.MARGIN=5,o.__decorate([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"event",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.FlyoutButton=a},50121:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.VerticalFlyout=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(76518),_=i(75102),a=i(25461),c=i(61972),l=i(11214),d=function(t){function e(e){var i=t.call(this,e)||this;return i.excute_after_next_reflow=[],i.content_height_=0,i.horizontalLayout_=!1,i.fixed_width=e.flyout.fixed_width,i.width_=i.fixed_width||0,i.set_auto_close(e.flyout.auto_close),i.init_events(),i}return o.__extends(e,t),e.prototype.create_dom=function(e){var i=t.prototype.create_dom.call(this,e);return"number"===typeof this.fixed_width&&(i.addEventListener("mouseenter",(function(){i.style.overflow="visible"})),i.addEventListener("mouseleave",(function(){i.style.overflow="hidden"}))),i},e.prototype.get_metrics=function(){if(this.is_visible()){var t,e=this.workspace_.get_canvas();if(!e)throw new Error("Flyout ws has not been inited.");try{t=e.getBBox()}catch(o){t={height:0,y:0,width:0,x:0}}var i=this.workspace_.get_scale();return{viewHeight:this.height_,viewWidth:this.width_,contentHeight:t.height*i+this.padding_top+this.padding_bottom,contentWidth:t.width*i,viewTop:-this.workspace_.scroll_xy[1],viewLeft:-this.workspace_.scroll_xy[0],contentTop:0,contentLeft:t.x,absoluteTop:2,absoluteLeft:0}}},e.prototype.layout_=function(t,e){for(var i,o,n,_,a,c,l=this,d=r.vec2.fromValues(this.padding_left,0),u=function(t){for(var e=t.get_descendants(),i=0;i<e.length;i++){var o=e[i];o.is_in_flyout=!0,o.render()}t.render();var n=t.get_svg_root();return l.add_block_listeners(n,t),t},h=0;h<t.length;h++){var p=t[h];if("block"==p.type&&p.block){var g=p.block,f=r.vec2.fromValues(d[0],d[1]);if(r.vec2.add(f,f,this.theme.renderer.BLOCK_LEFT_TOP),g.is_starting_block()){var v=(0,s.is_short_block)(p.xml)&&(null===(o=null===(i=this.targetWorkspace_)||void 0===i?void 0:i.options.flyout.blocks)||void 0===o?void 0:o.head_short_block_offset)?null===(a=null===(_=null===(n=this.targetWorkspace_)||void 0===n?void 0:n.options.flyout.blocks)||void 0===_?void 0:_.head_short_block_offset)||void 0===a?void 0:a[0]:null===(c=this.targetWorkspace_)||void 0===c?void 0:c.options.flyout.blocks.head_block_offset[0];r.vec2.add(f,f,[v||0,0])}var m=(0,s.get_short_block_define_from_xml)(p.xml);if(m){if(this.render_short_block(g,m),p.inline)(v=(0,s.compute_inline_offset)(t,e,h-1))?r.vec2.add(f,f,[v.dx,v.dy]):d[1]+=g.get_svg_root().getBoundingClientRect().height+e[h];else d[1]+=g.get_svg_root().getBoundingClientRect().height+e[h];g.move_by(f);continue}u(g),g.move_by(f);var b=g.get_height_width();if(p.inline){this.current_item_line={offset_left:d[0]+b.width,offset_right:this.padding_right,height:b.height};continue}d[1]+=b.height+e[h]}else"button"==p.type&&p.button&&this.button_layout(p.button,d,e[h])}this.content_height_=d[1]},e.prototype.button_layout=function(t,e,i){var o,n=this,r=e[0],s=e[1],_="absolute"!==t.position&&"fixed"!==t.position,a="center"===t.align||"right"===t.align,c=function(e){if(_&&!a)return{x:r,y:s};if("number"!==typeof e)return console.warn("Position of button ".concat(t," should be computed when reflow. ")),{x:r,y:s};var i=0,o=e/n.workspace_.get_scale();if(void 0!==t.left?i=t.left:void 0!==t.right?i=o-t.right-t.width:"center"===t.align?i=(o-t.width)/2:"right"===t.align&&(i=o-n.padding_right-t.margin_right-t.width),_)return{x:i,y:s};var c=0;if(void 0!==t.top)c=t.top;else if(void 0!==t.bottom){c=("fixed"===t.position?n.height_/n.workspace_.get_scale():n.content_height_)-t.bottom-t.height}return{x:i,y:c}};if(t.width_ratio)return this.excute_after_next_reflow.push((function(e){var i,o=e/n.workspace_.get_scale(),r=c(e),s=r.x,_=r.y,a=n.init_flyout_button(t,s,_,o*(t.width_ratio||1));"fixed"===t.position&&(null===(i=n.svg_group)||void 0===i||i.appendChild(a))})),void(_&&(e[1]+=t.height+i));if(!_){var l=this.init_flyout_button(t);return this.excute_after_next_reflow.push((function(e){var i=c(e),o=i.x,n=i.y;t.move_to(o,n)})),void("fixed"===t.position&&(null===(o=this.svg_group)||void 0===o||o.appendChild(l)))}t.inline||this.current_item_line?function(){if(n.current_item_line||(n.current_item_line={offset_left:r,offset_right:n.padding_right,height:t.height}),"center"===t.align)n.init_flyout_button(t),n.excute_after_next_reflow.push((function(e){var i=e/n.workspace_.get_scale();t.move_to((i-t.width)/2,s)}));else if("right"===t.align){n.init_flyout_button(t);var o=n.current_item_line.offset_right,_=t.width+t.margin_right;n.excute_after_next_reflow.push((function(e){var i=e/n.workspace_.get_scale();t.move_to(i-o-_,s)})),n.current_item_line.offset_right+=_}else n.init_flyout_button(t,n.current_item_line.offset_left,s),n.current_item_line.offset_left+=t.width+t.margin_right;n.current_item_line.height=Math.max(n.current_item_line.height,t.height),t.inline||(e[1]+=n.current_item_line.height+i,n.current_item_line=void 0)}():("center"===t.align||"right"===t.align?(this.init_flyout_button(t),this.excute_after_next_reflow.push((function(e){var i=c(e),o=i.x,n=i.y;t.move_to(o,n)}))):this.init_flyout_button(t,r,s),e[1]+=t.height+i)},e.prototype.reflow_internal=function(t){var e=this;if(this.workspace_&&this.targetWorkspace_){var i=this.targetWorkspace_.options.flyout,o=i.max_width,n=i.min_width||0;if("number"===typeof this.fixed_width)n=this.fixed_width;else{for(var r=0;r<t.length;r++){var s=t[r],_=s.width;s.is_starting_block()&&(_+=this.targetWorkspace_.options.flyout.blocks.head_block_offset[0]),n=Math.max(n,_)}for(r=0;r<this.buttons_.length;r++){var a=this.buttons_[r];if("fixed"===a.position)break;n=Math.max(n,a.width)}var c=this.workspace_.get_scale();n+=this.padding_left+this.padding_right,n*=c,o&&(n=Math.min(n,o))}this.width_=n,this.excute_after_next_reflow.forEach((function(t){return t(e.width_)})),this.excute_after_next_reflow=[]}else console.error("Workspace has not been init.")},e.prototype.is_drag_toward_workspace=function(t){var e=t[0],i=t[1],o=Math.atan2(i,e)/Math.PI*180,n=this.drag_angle_range_;return o<n&&o>-n||(o<-180+n||o>180-n)},e.prototype.place_new_block=function(t,e){if(!this.targetWorkspace_)throw new Error("Trying to place block before setting target workspace. ");var i=t.get_svg_root();if(!i)throw ReferenceError("Origin block should have root svg.");var o=this.utils.get_injection_div_xy(i),n=this.xml.block_to_dom(t),s=this.xml.dom_to_block(n,this.targetWorkspace_),_=s.get_svg_root();if(void 0==_)throw new ReferenceError("Block should have svg root.");var c=this.utils.get_injection_div_xy(_);r.vec2.sub(c,o,c);var l=this.targetWorkspace_.get_scale();if(this.workspace_.get_scale()!==l&&e){var d=r.vec2.sub(e,e,(0,a.get_page_offset)(t.get_svg_root()));r.vec2.scale(d,d,this.workspace_.get_scale()-l),r.vec2.add(c,c,d)}return r.vec2.scale(c,c,1/l),s.move_by(c),s},e.prototype.wheel_=function(t){if(this.is_visible()){var e=this.get_workspace().svg_block_canvas_;e&&(e.style.transition="none"),t.preventDefault(),t.stopPropagation();var i=t.deltaY;if(i&&this.scrollbar_){var o=this.get_metrics();if(o){var n=o.viewTop+i;this.scrollbar_.set(n)}else console.error("Cannot get metrics for wheel.")}}},e.prototype.set_metrics=function(t){if(void 0!=this.workspace_){var e=this.get_metrics();if(e){(0,c.is_number)(t.y)&&(this.workspace_.content_offset_by_view[1]=t.y,this.workspace_.scroll_xy[1]=-e.contentTop-t.y);var i=this.workspace_.scroll_xy[0],o=this.workspace_.scroll_xy[1];this.workspace_.translate(i,o)}}else console.error("Workspace not init.")},e.prototype.get_client_rect=function(){if(this.svg_group){var t=this.svg_group.getBoundingClientRect(),e=this.workspace_.get_options().delete_area_margin,i=t.left,o=t.top,n=t.width,r=t.height;return new l.Rect(i-e[3],o-e[0],n+e[1]+e[3],r+e[0]+e[2])}},e.prototype.reset_size=function(){this.width_=0},e.prototype.position=function(){if(void 0!=this.targetWorkspace_)if(this.svg_background_&&this.svg_group){var t=this.targetWorkspace_.get_metrics();if(t){if(this.height_=t.viewHeight,this.is_visible()){var e=this.compute_background_path(this.width_,this.height_);this.svg_background_.setAttribute("d",e)}else this.svg_group.style.overflow="hidden";var i=t.absoluteTop,o=t.absoluteLeft;this.toolboxPosition_===_.TOOLBOX_POSITION.RIGHT&&(o+=t.viewWidth,this.is_auto_close()&&this.is_visible()&&(o-=this.width_),o=Math.round(o+1)),this.toolboxPosition_===_.TOOLBOX_POSITION.LEFT&&(this.is_auto_close()&&this.is_visible()||(o-=this.width_),o=Math.round(o-1)),this.position_at(this.width_,this.height_,o,i)}}else console.error("Trying to position flyout before initialization. ");else console.error("Trying to position flyout before setting target workspace. ")},e.prototype.compute_background_path=function(t,e){var i=this.toolboxPosition_===_.TOOLBOX_POSITION.RIGHT,o=t-this.flyout_corner_radius,n=e-2*this.flyout_corner_radius,r=["M ".concat(i?t:0,",0")];return r.push("h","".concat(i?-o:o)),r.push("a","".concat(this.flyout_corner_radius),"".concat(this.flyout_corner_radius),"0","0",i?"0":"1","".concat(i?-this.flyout_corner_radius:this.flyout_corner_radius),"".concat(this.flyout_corner_radius)),r.push("v","".concat(Math.max(0,n))),r.push("a","".concat(this.flyout_corner_radius),"".concat(this.flyout_corner_radius),"0","0",i?"0":"1","".concat(i?this.flyout_corner_radius:-this.flyout_corner_radius),"".concat(this.flyout_corner_radius)),r.push("h","".concat(i?o:-o)),r.push("z"),r.join(" ")},e.prototype.render_short_block=function(t,e){var i=t.svg_group,o=e.args0,n=e.args1,r=e.shape,c=e.icon,l=e.nextStatement,d=void 0===l||l,u=e.min_width,h=e.max_width,p=e.colour,g=t.get_colour().toString(),f=t.get_border_colour().toString();(0,a.remove_children)(i);var v=(0,s.get_short_block_content_dx)(r),m=(0,s.get_short_block_content_dy)(r),b=u||(0,s.get_short_block_content_min_width)(r),y=(0,s.get_short_block_height)(r,[o,n].filter(Boolean).length);switch(r){case _.ShortBlockShape.EVENT:var E=(0,a.create_svg_element)("g",{transform:"translate(-8, 0)"},i),k=(0,s.render_short_block_content)(o,E,{dx:v,dy:m,min_width:b,max_width:h,colour:p}).width,T=s.SvgPath.create().moveTo(24,48).arcTo(0,-48,24).arcTo(18,8,24).hLineTo(9).hLineTo(k).arcTo(0,40,20).close().dom({class:"blocklyPath",stroke:f,"stroke-width":"1px","stroke-opacity":"1",fill:g});E.insertBefore(T,E.firstChild),(0,a.create_svg_element)("image",{"xlink:href":c,transform:"translate(4,4)",width:"40px",height:"40px"},E);break;case _.ShortBlockShape.BOOLEAN_VALUE:k=(0,s.render_short_block_content)(o,i,{dx:v,dy:m,min_width:b,max_width:h,center:!0,colour:p}).width,T=s.SvgPath.create().moveTo(18,36).hLineTo(-4).arcTo(-2,-1,3).lineTo(-11,-16).arcTo(0,-2,2).lineTo(11,-16).arcTo(2,-1,3).hLineTo(4).hLineTo(k).hLineTo(4).arcTo(2,1,3).lineTo(11,16).arcTo(0,2,2).lineTo(-11,16).arcTo(-2,1,3).close().dom({class:"blocklyPath",stroke:f,"stroke-width":"1px","stroke-opacity":"1",fill:g});i.insertBefore(T,i.firstChild);break;case _.ShortBlockShape.ANY_VALUE:k=(0,s.render_short_block_content)(o,i,{dx:v,dy:m,min_width:b,max_width:h,center:!0,colour:p}).width,T=s.SvgPath.create().moveTo(18,36).arcTo(0,-36,18).hLineTo(k).arcTo(0,36,18).close().dom({class:"blocklyPath",stroke:f,"stroke-width":"1px","stroke-opacity":"1",fill:g});i.insertBefore(T,i.firstChild);break;case _.ShortBlockShape.EXECUTE:k=(0,s.render_short_block_content)(o,i,{dx:v,dy:m,min_width:b,max_width:h,colour:p}).width;var w=d?2:12;T=s.SvgPath.create().moveTo(w,y).arcTo(-w,-w,w).vLineTo(-(y-w-2)).arcTo(2,-2,2).hLineTo(v-2).hLineTo(k).arcTo(0,40,20).close().dom({class:"blocklyPath",stroke:f,"stroke-width":"1px","stroke-opacity":"1",fill:g});i.insertBefore(T,i.firstChild);break;case _.ShortBlockShape.EXECUTE_WITH_SLOT:k=(0,s.render_short_block_content)(o,i,{dx:v,dy:m,min_width:b,max_width:h,colour:p}).width,w=d?2:12,T=s.SvgPath.create().moveTo(w,y).arcTo(-w,-w,w).vLineTo(-(y-w-2)).arcTo(2,-2,2).hLineTo(v-2).hLineTo(k).arcTo(0,40,20).hLineTo(-k).vLineTo(8);if(n){var O=(0,s.get_short_block_content_dy)(r,1),N=(0,s.render_short_block_content)(n,i,{dx:v,dy:O,min_width:44,max_width:h,colour:p}).width;T.hLineTo(N).arcTo(0,40,20).hLineTo(-N).vLineTo(8)}T.hLineTo(34).arcTo(0,12,6).close();var I=T.dom({class:"blocklyPath",stroke:f,"stroke-width":"1px","stroke-opacity":"1",fill:g});i.insertBefore(I,i.firstChild)}var A=t.get_svg_root();return this.add_block_listeners(A,t),t},e.prototype.get_block_color=function(t){var e=this.theme.get_color(t);return e?[e.fill.toString(),e.border.toString()]:[t,t]},e.prototype.init_events=function(){},e=o.__decorate([(0,n.injectable)()],e)}(i(14024).Flyout);e.VerticalFlyout=d},66976:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockDragger=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=function(t){function e(e){var i=t.call(this,e.target,e.workspace)||this;i.type="block_dragger",i.set_connection_manger_pre_block=function(t){if(i._dragged_connection_manager){var e=i._dragged_connection_manager.set_pre_connect_block;i.connection_pre_block_options=t,e&&e(t)}},i.enable_block_bump=!0,i.set_enable_block_bump=function(t){i.enable_block_bump=t};var o=e.target,n=e.workspace.get_options().connection_effect;return i._dragged_connection_manager=n&&"default"===n.type?i.dragged_connection_manager:i.insertion_marker_manager,i._dragged_connection_manager.init(o),i._drag_icon_data=i.generate_icon_data(o),i}return o.__extends(e,t),e.prototype.generate_icon_data=function(t){for(var e=[],i=t.get_descendants(),o=0;o<i.length;o++)for(var n=i[o].get_icons(),r=0;r<n.length;r++){var s={location:n[r].get_location(),icon:n[r]};e.push(s)}return e},e.prototype.update_cursor_during_block_drag=function(t){void 0!=this._workspace&&void 0!=this._dragging_block?this._dragging_block.is_deletable()&&(this._would_delete_block=this._dragged_connection_manager.would_delete_block(),this._dragging_block.set_delete_style(this._would_delete_block),this._dragging_block.set_mouse_through_style(t)):console.error("Block dragger has been disposed.")},e.prototype.start_block_drag=function(e){if(void 0==this._workspace||void 0==this._dragging_block)throw new Error("Block dragger has been disposed.");this.redo_stack_before_drag=this._workspace.get_redo_stack().slice(),this.undo_stack_before_drag=this._workspace.get_undo_stack().slice(),this.events.get_group()||this.events.set_group(!0),this.parent_before_drag=this._dragging_block.get_parent(),this.parent_before_drag&&(this._dragging_block.get_root_block().svg_group.removeAttribute("filter"),this._dragging_block.unplug(),this.block_animations.disconnect_ui_effect(this._dragging_block)),t.prototype.start_block_drag.call(this,e)},e.prototype.drag_block=function(e,i){var o=t.prototype.drag_block.call(this,e,i);return this._dragged_connection_manager.update(o,this._delete_area),o},e.prototype.end_block_drag=function(t,e){if(void 0==this._workspace||void 0==this._dragging_block)throw new Error("Block dragger has been disposed.");this.drag_block(t,e),this._drag_icon_data=[],this.block_animations.disconnect_ui_effect_stop(this._dragging_block),this._dragging_block.set_mouse_through_style(!1);var i=this._workspace.get_toolbox();void 0!=i&&i.remove_delete_style();var o=void 0;if(this.events.is_enabled()){var n=this._workspace.current_gesture_;o=this.end_drag_event_factory({block:this._dragging_block,is_outside:this._was_outside,mouse_position:r.vec2.fromValues(t.clientX,t.clientY),is_from_flyout:(null===n||void 0===n?void 0:n.is_start_from_flyout())||!1,redo_stack_before_drag:this.redo_stack_before_drag})}var s=this.pixels_to_workspace_units(e),_=r.vec2.add(r.vec2.create(),this._start_xy,s);if(this._dragging_block.move_off_drag_surface(_),this._dragging_block.bring_to_front(),!this.maybe_delete_block()){if(this._dragging_block.move_connections(s),this._dragging_block.set_dragging(!1),this.events.is_enabled()){var a=this.move_event_factory({block:this._dragging_block});a.set_old_coord(this._start_xy),a.record_new(),this.events.fire(a)}this._dragged_connection_manager.apply_connections(),this._dragging_block.render(),this.enable_block_bump&&this._dragging_block.schedule_snap_and_bump()}this.redo_stack_before_drag=[],this.undo_stack_before_drag=[],this.parent_before_drag=void 0;var c=this._workspace;this.dispose(),null===c||void 0===c||c.set_resizes_enabled(!0),this.events.fire(o),this.events.set_group(!1)},e.prototype.drag_related=function(){for(var t=0;t<this._drag_icon_data.length;t++){this._drag_icon_data[t].icon.reposition()}},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._drag_icon_data.length=0,this._dragged_connection_manager&&this._dragged_connection_manager.dispose()},o.__decorate([(0,s.lazy_inject)(s.BINDING.insertion_marker_manager)],e.prototype,"insertion_marker_manager",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.dragged_connection_manager)],e.prototype,"dragged_connection_manager",void 0),e=o.__decorate([(0,n.injectable)()],e)}(i(46043).ElementDragger);e.BlockDragger=_},21366:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FlyoutDragger=void 0;var o=i(98734),n=i(61455),r=function(t){function e(e){var i=t.call(this,e.get_workspace())||this;return i.horizontal_layout=!1,i.scrollbar_=e.get_scrollbar(),i.horizontal_layout=e.is_horizontal(),i}return o.__extends(e,t),e.prototype.update_scroll=function(t){this.horizontal_layout?this.scrollbar_.set(t[0]):this.scrollbar_.set(t[1])},e=o.__decorate([(0,n.injectable)()],e)}(i(77920).WorkspaceDragger);e.FlyoutDragger=r},49325:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.scrollSmothInstance=void 0;var o=i(22804),n=i(11214),r=function(){function t(){this.startTime=0,this.startY=0,this.pointY=0,this.offsetY=0,this.momentumStartY=0,this.scrollHeight=0,this.isIosStarted=!1,this.iosCanAnimate=!0}return t.prototype.stopIosAnimate=function(){this.iosCanAnimate=!1},t.prototype.onStart=function(t,e){var i,n=e.get_metrics();if(n){this.lastBlockId=null===(i=e.get_workspace().get_last_block())||void 0===i?void 0:i.id,o.is.ios()?this.isIosStarted=!0:this.androidStop(e),this.scrollHeight!==n.contentHeight?(this.scrollHeight=n.contentHeight,this.momentumStartY=this.startY=this.offsetY=0):this.momentumStartY=this.startY=this.offsetY;var r=t.changedTouches?t.changedTouches[0].pageY:t.clientY;this.pointY=r,this.startTime=(new Date).getTime()}},t.prototype.onMove=function(t,e){var i=e.get_metrics();if(i){var o=i.contentHeight,n=i.viewHeight-o,r=(t.changedTouches?t.changedTouches[0].pageY:t.clientY)-this.pointY,s=Math.round(this.startY+r);(s<n||s>0)&&(s=Math.round(this.startY+r/3)),this.offsetY=s;var _=(new Date).getTime();_-this.startTime>300&&(this.momentumStartY=this.offsetY,this.startTime=_)}},t.prototype.onEnd=function(t){var e=t.get_metrics();if(e){o.is.ios()&&(this.isIosStarted=!1);var i=e.contentHeight,r=e.viewHeight-i;if(!this.checkBoundary(r)){var s=Math.abs(this.offsetY-this.momentumStartY),_=(new Date).getTime()-this.startTime;if(_<300&&s>15){var a=this.momentum(this.offsetY,this.momentumStartY,_,e);this.offsetY=(0,n.clamp)(0,r,Math.round(a.destination));var c=a.duration;this.setTransition(this.offsetY,c,t)}}}},t.prototype.checkBoundary=function(t){return(0,n.clamp)(this.offsetY,t,0)!==this.offsetY},t.prototype.momentum=function(t,e,i,o){var n,r=o.contentHeight,s=o.viewHeight,_=s-r,a="noBounce",c=s/6,l=t-e,d=t+2*Math.abs(l)/i/.003*(l<0?-1:1);return d<_?(a=(n=_-d)>300?"strongBounce":"weekBounce",d=Math.max(_-c,_-n/10)):d>0&&(a=(n=d-0)>300?"strongBounce":"weekBounce",d=Math.min(0+c,0+n/10)),{destination:d,duration:{noBounce:2500,weekBounce:800,strongBounce:400}[a]}},t.prototype.androidStop=function(t){var e,i=t.get_workspace().svg_block_canvas_;if(i){i.style.transitionDuration="0ms";var o=window.getComputedStyle(i).getPropertyValue("transform"),n=Math.round(+o.split(")")[0].split(", ")[5]);isNaN(n)||null===(e=t.get_scrollbar())||void 0===e||e.set(Math.abs(n))}},t.prototype.setTransition=function(t,e,i){o.is.ios()?this.iosAnimation(t,e,i):this.androidAnimation(t,e,i)},t.prototype.iosAnimation=function(t,e,i){var o=this;if(i.get_workspace().svg_block_canvas_){var n=i.get_metrics();if(n){var r=n.viewTop,s=Math.abs(t),_=Date.now();!function t(){var n,a;if(o.iosCanAnimate&&!o.isIosStarted&&o.lastBlockId===(null===(n=i.get_workspace().get_last_block())||void 0===n?void 0:n.id)){var c=Date.now()-_,l=Math.min(1,c/e),d=function(t,e,i,o,n){var r=1-n,s=n*n,_=r*r,a=_*r*t;return a+=3*_*n*e,a+=3*r*s*i,a+=s*n*o}(.05,.7,.9,1,l),u=r+(s-r)*d;null===(a=i.get_scrollbar())||void 0===a||a.set(u),l<1&&requestAnimationFrame(t)}else o.iosCanAnimate=!0}()}}},t.prototype.androidAnimation=function(t,e,i){var o,n=i.get_workspace().svg_block_canvas_;n&&(n.style.transitionProperty="transform",n.style.transitionTimingFunction="cubic-bezier(.17, .89, .45, 1)",n.style.transitionDuration="".concat(e,"ms"),null===(o=i.get_scrollbar())||void 0===o||o.set(Math.abs(t)))},t}();e.scrollSmothInstance=new r},25629:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Gesture=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(75102),_=i(98030),a=i(61972),c=i(74370),l=i(53494),d=i(57754),u=i(49325),h=function(){function t(t){this.mouse_down_xy=r.vec2.create(),this.current_drag_delta_xy=r.vec2.create(),this.start_field=void 0,this.start_block=void 0,this.target_block=void 0,this.start_workspace=void 0,this.has_exceeded_drag_radius=!1,this.is_dragging_workspace=!1,this.is_dragging_block=!1,this.is_mutation_click=!1,this.on_move_wrapper=void 0,this.on_up_wrapper=void 0,this.bubble_dragger=void 0,this.block_dragger=void 0,this.workspace_dragger=void 0,this.flyout_=void 0,this.called_update_is_dragging=!1,this.has_started_=!1,this.is_ending=!1,this.should_duplicate_on_drag=!1,this.body_width=document.body.clientWidth,this.body_height=document.body.clientHeight,this.PADDING=20,this.selected_field=void 0,this.creator_workspace_=t.workspace,this.most_recent_event=t.event}return t.prototype.dispose=function(){this.touch_manager.clear_touch_identifier(),this.creator_workspace_.clear_gesture(),this.on_move_wrapper&&this.events.unbind_event(this.on_move_wrapper),this.on_up_wrapper&&this.events.unbind_event(this.on_up_wrapper),this.start_field=void 0,this.selected_field=void 0,this.start_block=void 0,this.target_block=void 0,this.start_workspace=void 0,this.flyout_=void 0,this.block_dragger=void 0,this.workspace_dragger=void 0},t.prototype.update_from_event=function(t){var e=r.vec2.fromValues(t.clientX,t.clientY);this.update_drag_delta(e)&&(this.update_is_dragging(),this.touch_manager.long_stop()),this.most_recent_event=t},t.prototype.update_drag_delta=function(t){if(r.vec2.sub(this.current_drag_delta_xy,t,this.mouse_down_xy),!this.has_exceeded_drag_radius){var e=r.vec2.sqrLen(this.current_drag_delta_xy),i=this.flyout_?this.theme.blink_params.FLYOUT_DRAG_RADIUS:this.theme.blink_params.DRAG_RADIUS;return this.has_exceeded_drag_radius=e>i,this.has_exceeded_drag_radius}return!1},t.prototype.update_is_dragging_from_flyout=function(){return!(!this.target_block||this.target_block.disabled||!(0,a.is_block_svg)(this.target_block))&&(!!(this.flyout_&&!this.flyout_.is_scrollable()||this.flyout_&&this.flyout_.is_drag_toward_workspace(this.current_drag_delta_xy))&&(this.start_workspace=this.flyout_.targetWorkspace_,void 0!=this.start_workspace&&this.start_workspace.update_screen_calculations_if_scrolled(),this.events.get_group()||this.events.set_group(!0),this.start_block=void 0,this.target_block=this.flyout_.create_block(this.target_block,!1,r.vec2.fromValues(this.mouse_down_xy[0],this.mouse_down_xy[1])),void 0!=this.target_block&&(this.target_block.select(),(0,a.is_block_svg)(this.target_block)&&this.target_block.set_connections_hidden(!1)),!0))},t.prototype.update_is_dragging_block=function(){return!!this.target_block&&(this.flyout_?this.is_dragging_block=this.update_is_dragging_from_flyout():(this.target_block.is_movable()||this.should_duplicate_on_drag)&&(this.is_dragging_block=!0),!!this.is_dragging_block&&(this.start_dragging_block(),!0))},t.prototype.update_is_dragging_workspace=function(){if(this.flyout_?this.flyout_.is_scrollable():this.start_workspace&&this.start_workspace.is_draggable()){if(this.flyout_)this.workspace_dragger=this.workspace_dragger_factory(this.flyout_);else{if(void 0==this.start_workspace)return;this.workspace_dragger=this.workspace_dragger_factory(this.start_workspace)}this.is_dragging_workspace=!0,this.workspace_dragger.start_drag()}},t.prototype.update_is_dragging=function(){this.called_update_is_dragging||(this.called_update_is_dragging=!0,this.update_is_dragging_block()||this.update_is_dragging_workspace())},t.prototype.update_is_mutation_click=function(t){this.is_mutation_click=t},t.prototype.start_dragging_block=function(){var t=this.events.get_group();this.events.set_group(t||!0),this.should_duplicate_on_drag&&this.duplicate_on_drag(),void 0!=this.target_block&&void 0!=this.start_workspace&&(this.block_dragger=this.element_dragger_factory({target:this.target_block,workspace:this.start_workspace}),this.block_dragger.start_block_drag(this.current_drag_delta_xy),this.block_dragger.drag_block(this.most_recent_event,this.current_drag_delta_xy))},t.prototype.do_start=function(t){(0,c.is_target_input)(t)?this.cancel():void 0!=this.start_workspace&&(this.start_workspace.is_gestures_enabled()||this.start_block?(this.has_started_=!0,this.start_workspace.update_screen_calculations_if_scrolled(),this.start_workspace.mark_focused(),this.most_recent_event=t,this.utils.hide_chaff(!!this.flyout_),this.target_block&&!this.is_mutation_click&&this.target_block.select(),(0,c.is_right_button)(t)?this.handle_right_click(t):((0,l.case_insensitive_equals)(t.type,"touchstart")&&this.touch_manager.long_start(t,this),this.mouse_down_xy=r.vec2.fromValues(t.clientX,t.clientY),this.bind_mouse_events(t))):this.touch_manager.clear_touch_identifier())},t.prototype.bind_mouse_events=function(t){this.on_move_wrapper=this.events.bind_event_with_checks(document,"mousemove",void 0,this.handle_move.bind(this)),this.on_up_wrapper=this.events.bind_event_with_checks(document,"mouseup",void 0,this.handle_up.bind(this)),t.preventDefault(),t.stopPropagation()},t.prototype.handle_move=function(t){if(d.is.mobile()){var e=t.clientX,i=t.clientY;if(e<=this.PADDING||e>=this.body_width-this.PADDING||i<=this.PADDING||i>=this.body_height-this.PADDING)return void this.handle_up(t)}if(this.update_from_event(t),this.is_dragging_workspace){if(void 0==this.workspace_dragger)return void console.error("Trying to drag workspace without dragger.");this.workspace_dragger.drag(this.current_drag_delta_xy),"changedTouches"in t&&this.flyout_&&u.scrollSmothInstance.onMove(t,this.flyout_)}else if(this.is_dragging_block){if(void 0==this.block_dragger)return void console.error("Trying to drag block without dragger.");this.block_dragger.drag_block(this.most_recent_event,this.current_drag_delta_xy)}t.preventDefault(),t.stopPropagation()},t.prototype.handle_up=function(t){if(!this.is_ending){this.is_ending=!0;try{if(this.update_from_event(t),this.touch_manager.long_stop(),this.is_dragging_block){if(void 0==this.block_dragger)return void console.error("Trying to drag block without dragger.");this.is_dragging_block=!1,this.block_dragger.end_block_drag(t,this.current_drag_delta_xy)}else if(this.is_dragging_workspace){if(void 0==this.workspace_dragger)return void console.error("Trying to drag workspace without dragger.");this.is_dragging_workspace=!1,this.workspace_dragger.end_drag(this.current_drag_delta_xy),"changedTouches"in t&&this.flyout_&&u.scrollSmothInstance.onEnd(this.flyout_)}else this.is_field_click()?this.do_field_click(t):this.is_block_click()&&!this.is_mutation_click?this.do_block_click():this.is_workspace_click()&&this.do_workspace_click()}catch(t){console.error("Occurs error when handle mouseup: ",t)}finally{t.preventDefault(),t.stopPropagation(),this.dispose()}}},t.prototype.cancel=function(){if(!this.is_ending){this.is_ending=!0;try{if(this.touch_manager.long_stop(),this.is_dragging_block){if(void 0==this.block_dragger)return void console.error("Trying to drag block without dragger.");this.block_dragger.end_block_drag(this.most_recent_event,this.current_drag_delta_xy)}else if(this.is_dragging_workspace){if(void 0==this.workspace_dragger)return void console.error("Trying to drag workspace without dragger.");this.workspace_dragger.end_drag(this.current_drag_delta_xy)}}catch(t){console.error("Occurs error when cancel gesture: ",t)}finally{this.dispose()}}},t.prototype.handle_right_click=function(t){this.target_block?(this.bring_block_to_front(),this.utils.hide_chaff(!!this.flyout_),this.target_block.show_context_menu(t,this.selected_field)):this.start_workspace&&!this.flyout_&&(this.utils.hide_chaff(),this.start_workspace.show_context_menu(t)),t.preventDefault(),t.stopPropagation(),this.dispose()},t.prototype.handle_ws_start=function(t,e){this.has_started_||(this.set_start_workspace(e),this.most_recent_event=t,this.do_start(t))},t.prototype.handle_flyout_start=function(t,e){if(!this.has_started_){var i=e.get_workspace();void 0!=i&&(this.set_start_flyout(e),this.handle_ws_start(t,i),"changedTouches"in t&&u.scrollSmothInstance.onStart(t,e))}},t.prototype.handle_block_start=function(t,e){this.has_started_||(this.set_start_block(e),this.most_recent_event=t)},t.prototype.do_field_click=function(t){this.creator_workspace_.is_disabled_field_click()||(void 0!=this.start_field?(this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.CLICK,workspace_id:this.start_field.source_block.workspace.id})),this.start_field.focus(!0),this.start_field.show_editor(t),this.bring_block_to_front()):console.error("Click event without start field."))},t.prototype.do_block_click=function(){if((0,a.is_block_svg)(this.start_block)&&(0,a.is_block_svg)(this.target_block)){var t=this.events.get_group();if(this.flyout_&&this.flyout_.is_auto_close()){if(void 0!=this.target_block&&!this.target_block.disabled){this.events.set_group(t||!0);var e=this.flyout_.create_block(this.target_block,!0,r.vec2.fromValues(this.mouse_down_xy[0],this.mouse_down_xy[1]));e.select(),e.schedule_snap_and_bump(),e.workspace.set_resizes_enabled(!0)}}else if(!this.widget_div.is_visible()&&this.events.is_enabled()){var i=this.start_block.id,o=this.start_block.workspace.id,n=this.start_block.get_root_block().id;this.events.fire(this.ui_event_factory({type:s.UIEventType.CLICK,workspace_id:o,block_id:i})),this.events.fire(this.ui_event_factory({type:s.UIEventType.STACK_CLICK,workspace_id:o,block_id:n}))}this.bring_block_to_front(),this.events.set_group(t)}},t.prototype.do_workspace_click=function(){this.start_workspace&&(this.runtime_data.selected&&this.runtime_data.selected.unselect(),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.STACK_CLICK,workspace_id:this.start_workspace.id})))},t.prototype.bring_block_to_front=function(){this.target_block&&this.target_block.workspace&&!this.flyout_&&this.target_block.bring_to_front()},t.prototype.set_start_field=function(t){this.start_field||(this.start_field=t)},t.prototype.set_start_block=function(t){var e;this.start_block||((0,a.is_block_svg)(t)&&"param_color"===(null===(e=t.parent_block)||void 0===e?void 0:e.element_type)&&t.is_shadow()&&(t=t.parent_block),this.start_block=t,(0,a.is_block_svg)(t)&&t.is_in_flyout&&t!=t.get_root_block()?(this.should_duplicate_on_drag=!1,this.set_target_block(t.get_root_block())):((0,a.is_block_svg)(t)&&t.is_shadow()&&("param"===t.element_type||"param_color"===t.element_type)&&(this.should_duplicate_on_drag=!0),this.set_target_block(t)))},t.prototype.set_target_block=function(t){(0,a.is_block_svg)(t)&&t.is_shadow()&&!this.should_duplicate_on_drag?this.set_target_block(t.get_parent()):this.target_block=t},t.prototype.set_start_workspace=function(t){this.start_workspace||(this.start_workspace=t)},t.prototype.set_start_flyout=function(t){this.flyout_||(this.flyout_=t)},t.prototype.is_start_from_flyout=function(){return!!this.flyout_},t.prototype.is_block_click=function(){return!!this.start_block&&!this.has_exceeded_drag_radius&&!this.is_field_click()},t.prototype.is_field_click=function(){return!!this.start_field&&this.start_field.is_currently_editable()&&!this.has_exceeded_drag_radius},t.prototype.is_workspace_click=function(){return!this.start_block&&!this.start_field&&!this.has_exceeded_drag_radius},t.prototype.is_dragging=function(){return this.is_dragging_workspace||this.is_dragging_block},t.prototype.has_started=function(){return this.has_started_},t.prototype.force_start_block_drag=function(t,e){this.handle_block_start(t,e),this.handle_ws_start(t,e.get_workspace()),this.is_dragging_block=!0,this.has_exceeded_drag_radius=!0,this.start_dragging_block()},t.prototype.duplicate_on_drag=function(){var t=void 0;if(void 0!=this.start_workspace)if((0,a.is_block_svg)(this.target_block)){this.events.disable();try{this.start_workspace.set_resizes_enabled(!1);var e=this.xml.block_to_dom(this.target_block);"color_picker"===e.getAttribute("type")?(t=this.xml.dom_to_block(e,this.start_workspace)).set_connections_hidden(!1):t=this.xml.dom_to_block_headless(e,this.start_workspace),t.init_svg(),t.render();var i=this.target_block.get_relative_to_surface_xy();t.move_by(i),t.set_shadow(!1)}finally{this.events.enable()}t?(this.events.is_enabled()&&this.events.fire(this.create_event_factory({block:t})),t.select(),this.target_block=t):console.error("Something went wrong while duplicating a block.")}else console.error("Try to drag without target block.");else console.error("Try to drag without start workspace.")},t.prototype.set_selected_field=function(t){this.selected_field||(this.selected_field=t)},o.__decorate([(0,_.lazy_inject)(_.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.touch_manager)],t.prototype,"touch_manager",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.widget_div)],t.prototype,"widget_div",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.xml)],t.prototype,"xml",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.theme)],t.prototype,"theme",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.WorkspaceElementDragger)],t.prototype,"element_dragger_factory",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.WorkspaceDragger)],t.prototype,"workspace_dragger_factory",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Gesture=h},56312:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceCommentDragger=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(61972),_=function(t){function e(e){var i=t.call(this,e.target,e.workspace)||this;return i.type="comment_dragger",i.start_relative_position=e.target.get_relative_position(),i}return o.__extends(e,t),e.prototype.drag_related=function(t){if((0,s.is_workspace_comment)(this._dragging_block)){var e=r.vec2.add(r.vec2.create(),this.start_relative_position,t);this._dragging_block.set_relative_position(e),this._dragging_block.draw_line()}},e.prototype.end_block_drag=function(t,e){if(void 0==this._workspace||void 0==this._dragging_block)throw new Error("Comment dragger has been disposed.");this.drag_block(t,e),this.block_animations.disconnect_ui_effect_stop(this._dragging_block);var i=void 0;if(this.events.is_enabled()){var o=this._workspace.current_gesture_;i=this.end_drag_event_factory({block:this._dragging_block,is_outside:this._was_outside,mouse_position:r.vec2.fromValues(t.clientX,t.clientY),is_from_flyout:(null===o||void 0===o?void 0:o.is_start_from_flyout())||!1,redo_stack_before_drag:this.redo_stack_before_drag})}this._dragging_block.set_mouse_through_style(!1);var n=this.pixels_to_workspace_units(e),s=r.vec2.add(r.vec2.create(),this._start_xy,n);if(this._dragging_block.move_off_drag_surface(s),this._dragging_block.bring_to_front(),!this.maybe_delete_block()&&(this._dragging_block.set_dragging(!1),this.events.is_enabled())){var _=this.move_event_factory({block:this._dragging_block});_.set_old_coord(this.start_relative_position),_.record_new(),this.events.fire(_)}if(this._workspace.set_resizes_enabled(!0),this._dragging_block.is_deletable()){var a=this._workspace.get_toolbox();void 0!=a&&a.remove_delete_style()}this.redo_stack_before_drag=[],this.undo_stack_before_drag=[],this.dispose(),i&&this.events.fire(i),this.events.set_group(!1)},e=o.__decorate([(0,n.injectable)()],e)}(i(46043).ElementDragger);e.WorkspaceCommentDragger=_},77920:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceDragger=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=function(){function t(t){this.start_scroll_xy_=r.vec2.create(),this.workspace_=t,this.start_drag_metrics_=t.get_metrics(),r.vec2.copy(this.start_scroll_xy_,t.scroll_xy)}return t.prototype.dispose=function(){this.workspace_=void 0},t.prototype.start_drag=function(){this.runtime_data&&this.runtime_data.selected&&this.runtime_data.selected.unselect(),void 0!=this.workspace_&&this.workspace_.setup_drag_surface()},t.prototype.end_drag=function(t){this.drag(t),void 0!=this.workspace_&&this.workspace_.reset_drag_surface(),this.dispose()},t.prototype.drag=function(t){var e=this.start_drag_metrics_,i=r.vec2.add(r.vec2.create(),this.start_scroll_xy_,t);r.vec2.min(i,i,[-e.contentLeft,-e.contentTop]),r.vec2.max(i,i,[e.viewWidth-e.contentLeft-e.contentWidth,e.viewHeight-e.contentTop-e.contentHeight]),r.vec2.scaleAndAdd(i,[-e.contentLeft,-e.contentTop],i,-1),this.update_scroll(i)},t.prototype.update_scroll=function(t){void 0!=this.workspace_&&this.workspace_.get_scrollbar().set(t[0],t[1])},o.__decorate([(0,s.lazy_inject)(s.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.WorkspaceDragger=_},46043:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ElementDragger=void 0;var o=i(98734),n=i(1530),r=i(98030),s=i(75102),_=function(){function t(t,e){this.parent_before_drag=void 0,this._delete_area=s.DeleteArea.DELETE_AREA_NONE,this._would_delete_block=!1,this._was_outside=!1,this._was_workspace=!0,this.redo_stack_before_drag=[],this.undo_stack_before_drag=[],this._dragging_block=t,this._workspace=e,this._start_xy=t.get_relative_to_surface_xy()}return t.prototype.update_cursor_during_block_drag=function(t){void 0!=this._workspace&&void 0!=this._dragging_block?this._dragging_block.is_deletable()&&(this._would_delete_block=this._delete_area===s.DeleteArea.DELETE_AREA_TOOLBOX,this._dragging_block.set_delete_style(this._would_delete_block),this._dragging_block.set_mouse_through_style(t)):console.error("Block dragger has been disposed.")},t.prototype.start_block_drag=function(t){if(void 0==this._workspace||void 0==this._dragging_block)throw new Error("Block dragger has been disposed.");this.redo_stack_before_drag||this.undo_stack_before_drag||(this.redo_stack_before_drag=this._workspace.get_redo_stack().slice(),this.undo_stack_before_drag=this._workspace.get_undo_stack().slice()),this.events.get_group()||this.events.set_group(!0),this._workspace.set_resizes_enabled(!1),this.tooltip.hide();var e=this.pixels_to_workspace_units(t),i=n.vec2.create();if(n.vec2.add(i,this._start_xy,e),this._dragging_block.translate(i),this._dragging_block.set_dragging(!0),this._dragging_block.bring_to_front(),this._dragging_block.move_to_drag_surface(),this._dragging_block.is_deletable()){var o=this._workspace.get_toolbox();void 0!=o&&o.add_delete_style()}if(this.events.is_enabled()){var r=this._workspace.current_gesture_;this.events.fire(this.start_drag_event_factory({block:this._dragging_block,is_from_flyout:(null===r||void 0===r?void 0:r.is_start_from_flyout())||!1}))}},t.prototype.drag_block=function(t,e){if(void 0==this._workspace||void 0==this._dragging_block)throw new Error("Block dragger has been disposed.");var i=this.pixels_to_workspace_units(e),o=n.vec2.create();return n.vec2.add(o,this._start_xy,i),this._dragging_block.move_during_drag(o),this.drag_related(i),this.handle_dragging_around_delete_area(t),this.handle_dragging_around_blocks_area(t),this.handle_dragging_around_workspace(t),i},t.prototype.handle_dragging_around_delete_area=function(t){if(void 0==this._workspace||void 0==this._dragging_block)throw new Error("Block dragger has been disposed.");var e,i=this._workspace.is_delete_area(t);!!i!==!!this._delete_area&&this.events.is_enabled()&&(e=this.drag_area_change_event_factory({block:this._dragging_block,area:s.DragArea.DELETE_AREA,is_in:!!i})),this._delete_area=i,this.events.fire(e)},t.prototype.handle_dragging_around_blocks_area=function(t){if(void 0==this._workspace||void 0==this._dragging_block)throw new Error("Block dragger has been disposed.");var e,i=!this._workspace.is_inside_blocks_area(t);i!==this._was_outside&&(this.events.is_enabled()&&(e=this.drag_area_change_event_factory({block:this._dragging_block,area:s.DragArea.INJECTION_DIV,is_in:!i})),this._was_outside=i),this.update_cursor_during_block_drag(i),this.events.fire(e)},t.prototype.handle_dragging_around_workspace=function(t){if(void 0==this._workspace||void 0==this._dragging_block)throw new Error("Block dragger has been disposed.");var e,i=this._workspace.is_inside_workspace_area(t);i!==this._was_workspace&&(this.events.is_enabled()&&(e=this.drag_area_change_event_factory({block:this._dragging_block,area:s.DragArea.WORKSPACE,is_in:i})),this._was_workspace=i),this.events.fire(e)},t.prototype.maybe_delete_block=function(){if(void 0==this._workspace||void 0==this._dragging_block)throw new Error("Block dragger has been disposed.");if(!this._dragging_block.is_deletable())return!1;if(this._would_delete_block){if(this.events.is_enabled()){var t=this.move_event_factory({block:this._dragging_block});t.set_old_coord(this._start_xy),t.record_new(),this.events.fire(t)}this._dragging_block.dispose(!1,!0)}return this._would_delete_block},t.prototype.pixels_to_workspace_units=function(t){var e=n.vec2.create();if(void 0==this._workspace)return console.error("Block dragger has been disposed."),n.vec2.create();var i=this._workspace.get_scale();return n.vec2.scale(e,t,1/i),e},t.prototype.dispose=function(){this._dragging_block=void 0,this._workspace=void 0},o.__decorate([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.block_animations)],t.prototype,"block_animations",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.tooltip)],t.prototype,"tooltip",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.DragAreaChangeEvent)],t.prototype,"drag_area_change_event_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.EndDragEvent)],t.prototype,"end_drag_event_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.MoveEvent)],t.prototype,"move_event_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.StartDragEvent)],t.prototype,"start_drag_event_factory",void 0),t}();e.ElementDragger=_},12605:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.onKeyDown_=e.Inject=void 0;var o=i(98734),n=i(1530),r=i(98030),s=i(75102),_=i(3909),a=i(43210),c=i(61972),l=o.__importStar(i(25461)),d=i(5250),u=i(22804),h=i(81558);e.Inject=function(t,e){if((0,c.is_string)(t)&&(t=document.getElementById(t)||document.querySelector(t)||void 0),(0,c.is_nil)(t)||!l.contains(document,t))throw new ReferenceError("Error: container is not in current document.");var i=(0,r.get_instance)(),o=i.get(r.BINDING.Options)(e||{}),_=l.create_dom("div","injectionDiv");_.classList.add(o.theme),t.appendChild(_);var a=g.call(this,_,o),u=function(t,e,i,o,_){e.parentWorkspace=void 0;var a=(0,r.get_instance)(),c=a.get(r.BINDING.WorkspaceSvg)(e,i,o,_);void 0!=e.zoomOptions.startScale&&c.set_scale(e.zoomOptions.startScale);if(t.appendChild(c.create_dom("blocklyMainBackground")),!e.has_categories&&e.toolbox_config){var u=c.add_flyout("svg");if(void 0==u)throw new Error("Add flyout failed.");l.insert_after(u,t)}var p=a.get(r.BINDING.Blink);if(c.translate(0,0),p.mainWorkspace=c,!e.readOnly&&!e.ws_scrollable){var g=function(t){var i=t.type===s.BlockEventType.MOVE||t.type===s.BlockEventType.CREATE&&"flyout:drag"!==t.source||t.type===s.UIEventType.FLYOUT_SHOW;if(!c.is_dragging()&&i){var o=c.get_metrics(),r=o.viewLeft+o.absoluteLeft-c.offset[0],_=o.viewTop+o.absoluteTop-c.offset[1],a=o.contentTop<_,l=o.contentLeft<(e.RTL?o.viewLeft:r),d=o.contentTop+o.contentHeight>o.viewHeight+_,u=o.contentLeft+o.contentWidth>(e.RTL?o.viewWidth:o.viewWidth+r);if(a||l||d||u)for(var h=25,p=c.get_top_elements(!1),g=0;g<p.length;g++){var f=p[g],v=f.get_relative_to_surface_xy(),m=f.get_height_width(),b=_-v[1];b>0&&f.move_by(n.vec2.fromValues(0,b+h));var y=_+o.viewHeight-v[1]-m.height;y<0&&f.move_by(n.vec2.fromValues(0,y));var E=r-v[0]-(e.RTL?m.width:0);E>0&&f.move_by(n.vec2.fromValues(E+h,0));var k=r+o.viewWidth-v[0]-(e.RTL?0:m.width);k<0&&f.move_by(n.vec2.fromValues(k,0))}}};c.add_change_listener(g)}if("simplified"===e.comment_type){var f=function(t){if(t.type===s.BlockEventType.MOVE){var e=c.get_block_by_id(t.get_block_id());if(!e)return;var i=t.get_old_loc(),o=t.get_new_loc();if(i.parent_id){var n=(0,h.get_nested_blocks_with_comment)(e)[0];n&&n.comment&&n.rendered&&n.comment.init_svg(!0);var r=c.get_block_by_id(i.parent_id);if(!r)return;var _=(0,h.get_outer_block)(r);(a=(0,h.get_nested_blocks_with_comment)(_)[0])&&a.comment&&a.rendered&&a.comment.init_svg(!0)}if(o.parent_id){var a;_=(0,h.get_outer_block)(e);(a=(0,h.get_nested_blocks_with_comment)(_)[0])&&a.comment&&a.rendered&&a.comment.init_svg(!0)}}};c.add_change_listener(f)}p.utils.svg_resize(c),p.widget_div.create_dom(),e.tooltip&&p.tooltip.create_dom();e.pinch?p.runtime_data.register_finger_events():p.runtime_data.cancel_gesture_when_multi_touch();e.degrade_translate&&(c.degrade_translate=e.degrade_translate);e.timer&&(p.timer=new d.TimerHandler);return c}(a,o,i.get(r.BINDING.BlockDragSurfaceSvg)(_),i.get(r.BINDING.WorkspaceDragSurfaceSvg)(_,a),_);f.call(this,u),this.mainWorkspace=u;var v=i.get(r.BINDING.utils);return v.svg_resize(u),o.auto_resize&&p((0,c.debounce)((function(){return v.svg_resize(u)}),o.auto_resize.delay),t),u};var p=function(t,e){return o.__awaiter(void 0,void 0,void 0,(function(){var n;return o.__generator(this,(function(r){switch(r.label){case 0:return[4,Promise.resolve().then((function(){return o.__importStar(i(90474))}))];case 1:return[4,r.sent().default];case 2:return n=r.sent(),new n(t).observe(e),[2]}}))}))};function g(t,e){var i=(0,r.get_instance)();t.setAttribute("dir","LTR"),i.get(r.BINDING.css).inject(e.hasCss,e.pathToMedia);var o=l.create_svg_element("svg",{class:"blocklySvg"},t),n=l.create_svg_element("defs",{},o),s=String(Math.random()).substring(2);e.readOnly||(0,_.inject_extra_filters)(n),(0,_.inject_comment_filters)(n),(0,a.inject_icon_symbols)(n);var d=l.create_svg_element("filter",{id:"blur-1px"},n);l.create_svg_element("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"1"},d);var u=l.create_svg_element("filter",{id:"hiblur","color-interpolation-filters":"sRGB"},n);l.create_svg_element("feColorMatrix",{type:"luminanceToAlpha",in:"SourceGraphic",result:"lumMap"},u);var h=l.create_svg_element("feComponentTransfer",{in:"lumMap",result:"highlightMask"},u);l.create_svg_element("feFuncA",{type:"discrete",tableValues:"0 0 0 0 0 0 0 1"},h),l.create_svg_element("feComposite",{operator:"in",in:"SourceGraphic",in2:"highlightMask",result:"highlights"},u),l.create_svg_element("feGaussianBlur",{in:"highlights",stdDeviation:"3",result:"highBlur"},u),l.create_svg_element("feComposite",{operator:"over",in:"highBlur",in2:"SourceGraphic",result:"final"},u);var p=l.create_svg_element("pattern",{id:"transparentPattern",x:0,y:0,width:12,height:12,patternUnits:"userSpaceOnUse"},n);l.create_svg_element("rect",{x:0,y:0,width:7,height:7,style:"fill:#FFFFFF"},p),l.create_svg_element("rect",{x:6,y:0,width:7,height:7,style:"fill:#EFEFEF"},p),l.create_svg_element("rect",{x:0,y:6,width:7,height:7,style:"fill:#EFEFEF"},p),l.create_svg_element("rect",{x:6,y:6,width:7,height:7,style:"fill:#FFFFFF"},p);var g=l.create_svg_element("filter",{id:"blocklyEmbossFilter".concat(s)},n);l.create_svg_element("feGaussianBlur",{in:"SourceAlpha",stdDeviation:1,result:"blur"},g);var f=l.create_svg_element("feSpecularLighting",{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},g);l.create_svg_element("fePointLight",{x:-5e3,y:-1e4,z:2e4},f),l.create_svg_element("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},g),l.create_svg_element("feComposite",{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},g),e.embossFilterId=g.id;var v=l.create_svg_element("pattern",{id:"blocklyDisabledPattern".concat(s),patternUnits:"userSpaceOnUse",width:12,height:12},n);return l.create_svg_element("rect",{width:12,height:12,fill:this.theme.disabled_color.fill},v),e.disabledPatternId=v.id,e.svg_defs=n,e.svg_rnd=s,e.custom_svg_defs&&e.custom_svg_defs.forEach((function(t){n.appendChild((0,c.is_string)(t)?l.parse_to_SVG(t):t)})),o}function f(t){var e=(0,r.get_instance)(),i=e.get(r.BINDING.events),o=e.get(r.BINDING.utils),n=t.get_parent_svg();void 0!=n&&n.parentNode&&i.bind_event_with_checks(n.parentNode,"contextmenu",void 0,(function(t){o.is_target_input(t)||t.preventDefault()}));var _=i.bind_event_with_checks(window,"resize",void 0,(function(){o.hide_chaff(!0),o.svg_resize(t)}));t.set_resize_handler_wrapper(_),v.call(this);var a=t.get_options();if(void 0!=a.toolbox_config){var l=t.get_toolbox(),d=t.get_flyout();(0,c.is_nil)(l)?a.toolbox_config instanceof Element&&!(0,c.is_nil)(d)&&(d.init(t),d.show(a.toolbox_config.children),d.scroll_to_start(),t.scroll_xy[0]=d.get_width(),a.toolboxPosition==s.TOOLBOX_POSITION.RIGHT&&(t.scroll_xy[0]*=-1),t.translate(t.scroll_xy[0],0)):l.init()}if(a.ws_scrollable){var u=e.get(r.BINDING.ScrollbarPair)(t,a.ws_show_scrollbars);t.set_scrollbar(u),u.resize()}a.hasSounds&&function(t,e){var i=["click","disconnect","delete"],o=(0,r.get_instance)(),n=o.get(r.BINDING.events),s=e.get_audio_manager();if(!s)throw new ReferenceError("audioMgr is undefined");i.forEach((function(e){s.load(["".concat(t).concat(e,".mp3"),"".concat(t).concat(e,".wav"),"".concat(t).concat(e,".ogg")],e)}));var _=[],a=function(){for(var t=_.pop();t;)n.unbind_event(t),t=_.pop();s.preload()};_.push(n.bind_event_with_checks(document,"mousemove",void 0,a,!0)),_.push(n.bind_event_with_checks(document,"touchstart",void 0,a,!0))}(a.pathToMedia,t)}function v(){var t=this;if(!this.runtime_data.document_events_bound){var e=(0,r.get_instance)(),i=e.get(r.BINDING.events),o=e.get(r.BINDING.touch_manager),n=i.bind_event_with_checks(document,"keydown",void 0,m.bind(this));this.runtime_data.document_events_handler.set("keydown",n);var s=i.bind_event_with_checks(document,"touchend",void 0,o.long_stop.bind(o));this.runtime_data.document_events_handler.set("touchend",s);var _=i.bind_event_with_checks(document,"touchcancel",void 0,o.long_stop.bind(o));if(this.runtime_data.document_events_handler.set("touchcancel",_),u.is.ipad()){var a=i.bind_event_with_checks(window,"orientationchange",document,(function(){t.utils.svg_resize(t.mainWorkspace)}));this.runtime_data.document_events_handler.set("orientationchange",a)}}this.runtime_data.document_events_bound=!0}function m(t){if(!this.mainWorkspace.get_options().readOnly&&!this.utils.is_target_input(t)&&this.mainWorkspace.get_hotkey_enable()){var e=!1;if(27==t.keyCode)this.utils.hide_chaff();else if(8==t.keyCode||46==t.keyCode){if(t.preventDefault(),this.mainWorkspace.is_dragging())return;this.runtime_data.selected&&this.runtime_data.selected.is_deletable()&&(e=!0)}else if(t.altKey||t.ctrlKey||t.metaKey){if(this.mainWorkspace.is_dragging())return;if(this.runtime_data.selected&&this.runtime_data.selected.is_deletable()&&this.runtime_data.selected.is_movable()&&(67==t.keyCode?(this.utils.hide_chaff(),this.runtime_data.clipboard.copy(this.runtime_data.selected)):88==t.keyCode&&(this.runtime_data.clipboard.copy(this.runtime_data.selected),e=!0)),86==t.keyCode){var i=this.runtime_data.clipboard.get_content();if(i){var o=this.events.get_group();this.events.set_group(o||!0),Array.isArray(i)?this.mainWorkspace.paste_extend(i,void 0,!0):this.mainWorkspace.paste(i,void 0,!0),this.events.set_group(o)}}else 90==t.keyCode&&(this.utils.hide_chaff(),this.mainWorkspace.undo(t.shiftKey))}if(e){o=this.events.get_group();this.events.set_group(o||!0),this.utils.hide_chaff(),this.runtime_data.selected&&this.runtime_data.selected.dispose(!1,!0),this.events.set_group(o)}}}e.onKeyDown_=m},92929:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.NodeType=void 0,function(t){t[t.ELEMENT=1]="ELEMENT",t[t.ATTRIBUTE=2]="ATTRIBUTE",t[t.TEXT=3]="TEXT",t[t.CDATA_SECTION=4]="CDATA_SECTION",t[t.ENTITY_REFERENCE=5]="ENTITY_REFERENCE",t[t.ENTITY=6]="ENTITY",t[t.PROCESSING_INSTRUCTION=7]="PROCESSING_INSTRUCTION",t[t.COMMENT=8]="COMMENT",t[t.DOCUMENT=9]="DOCUMENT",t[t.DOCUMENT_TYPE=10]="DOCUMENT_TYPE",t[t.DOCUMENT_FRAGMENT=11]="DOCUMENT_FRAGMENT",t[t.NOTATION=12]="NOTATION"}(e.NodeType||(e.NodeType={}))},52749:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},42019:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},62542:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},3063:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},48496:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},72065:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},28705:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},54908:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},85762:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},10278:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.DragArea=e.BlockEventType=void 0,function(t){t.CREATE="create",t.DELETE="delete",t.CHANGE="change",t.MOVE="move",t.DRAG_AREA_CHANGE="drag_area_change",t.END_DRAG="end_drag",t.START_DRAG="start_drag",t.UI="ui",t.CONTEXT_MENU_OPTION="context_menu_option"}(e.BlockEventType||(e.BlockEventType={})),function(t){t.DELETE_AREA="delete_area",t.INJECTION_DIV="injection_div",t.WORKSPACE="workspace"}(e.DragArea||(e.DragArea={}))},72621:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.GroupEventType=void 0,function(t){t.GroupStart="GROUP_START",t.GroupEnd="GROUP_END",t.GroupCancel="GROUP_CANCEL"}(e.GroupEventType||(e.GroupEventType={}))},76659:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);i(10278);o.__exportStar(i(42019),e),o.__exportStar(i(62542),e),o.__exportStar(i(3063),e),o.__exportStar(i(48496),e),o.__exportStar(i(72065),e),o.__exportStar(i(28705),e),o.__exportStar(i(54908),e),o.__exportStar(i(52749),e),o.__exportStar(i(85762),e),o.__exportStar(i(10278),e),o.__exportStar(i(72621),e),o.__exportStar(i(9616),e)},9616:function(t,e){var i;Object.defineProperty(e,"__esModule",{value:!0}),e.AllUIEvents=e.UIEventType=void 0,function(t){t.SELECTED="selected",t.COMMENT_OPEN="commentOpen",t.CLICK="click",t.STACK_CLICK="stackclick",t.H_SCROLLBAR_SET="horizontalScrollbarSet",t.V_SCROLLBAR_SET="verticalScrollbarSet",t.WARNING_OPEN="warningOpen",t.SCALE="scale",t.DISCONNECT="disconnect",t.CONNECT="connect",t.INSERTION_MARKER_SHOW="insertionMarkerShow",t.FLYOUT_SHOW="flyoutShow",t.CATEGORY_WILL_CHANGE="categoryWillChange",t.CATEGORY="category",t.SIMPLIFIED_COMMENT_EDIT="simplifiedCommentEdit",t.SIMPLIFIED_COMMENT_DELETE="simplifiedCommentDelete",t.SIMPLIFIED_COMMENT_SELECT="simplifiedCommentSelect",t.FIELD_FOCUS_CHANGE="FieldFocusChange",t.CONTEXT_MENU_OPEN="contextMenuOpen"}(i=e.UIEventType||(e.UIEventType={})),e.AllUIEvents=Object.keys(i).map((function(t){return i[t]}))},41232:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},48432:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},35555:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(48432),e),o.__exportStar(i(41232),e)},84412:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},12145:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(84412),e),o.__exportStar(i(90202),e),o.__exportStar(i(52361),e)},90202:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},52361:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},75102:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(76659),e),o.__exportStar(i(35555),e),o.__exportStar(i(12145),e),o.__exportStar(i(97408),e),o.__exportStar(i(7666),e),o.__exportStar(i(12157),e),o.__exportStar(i(90287),e),o.__exportStar(i(92929),e),o.__exportStar(i(37597),e),o.__exportStar(i(42619),e),o.__exportStar(i(58034),e)},37597:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},42619:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},91522:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},35834:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},63233:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockOptionType=e.WorkspaceOptionType=void 0,function(t){t[t.PASTE=0]="PASTE",t[t.CLEAN_UP=1]="CLEAN_UP",t[t.DELETE_ALL=2]="DELETE_ALL",t[t.COPY_ALL=3]="COPY_ALL",t[t.GLOBAL_COMMENT=4]="GLOBAL_COMMENT"}(e.WorkspaceOptionType||(e.WorkspaceOptionType={})),function(t){t[t.COPY_AND_PASTE=0]="COPY_AND_PASTE",t[t.COPY=1]="COPY",t[t.ADD_COMMENT=2]="ADD_COMMENT",t[t.COLLAPSE=3]="COLLAPSE",t[t.DELETE=4]="DELETE",t[t.SET_GROUP=5]="SET_GROUP",t[t.VISIBILITY_CHANGE=6]="VISIBILITY_CHANGE"}(e.BlockOptionType||(e.BlockOptionType={}))},99605:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},95625:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.EColorFormat=e.EColorControllerFormat=void 0,function(t){t.RGBA="RGBA",t.HSVA="HSVA"}(e.EColorControllerFormat||(e.EColorControllerFormat={})),function(t){t[t.ColorPalette=1]="ColorPalette",t[t.HSVA=2]="HSVA",t[t.RGBA=3]="RGBA",t[t.ColorString=4]="ColorString"}(e.EColorFormat||(e.EColorFormat={}))},38950:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ControllerType=void 0;var o=i(98734);!function(t){t.SLIDER="SLIDER",t.ANGLE_SCALE="ANGLE_SCALE",t.COLOR_PICKER="COLOR_PICKER"}(e.ControllerType||(e.ControllerType={})),o.__exportStar(i(99605),e),o.__exportStar(i(4496),e),o.__exportStar(i(95625),e)},4496:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},9491:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},13669:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},35170:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},59145:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},47202:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ShortBlockShape=void 0,function(t){t[t.EVENT=0]="EVENT",t[t.EXECUTE=1]="EXECUTE",t[t.EXECUTE_WITH_SLOT=2]="EXECUTE_WITH_SLOT",t[t.ANY_VALUE=3]="ANY_VALUE",t[t.BOOLEAN_VALUE=4]="BOOLEAN_VALUE"}(e.ShortBlockShape||(e.ShortBlockShape={}))},97408:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(91522),e),o.__exportStar(i(35834),e),o.__exportStar(i(63233),e),o.__exportStar(i(9491),e),o.__exportStar(i(13669),e),o.__exportStar(i(35170),e),o.__exportStar(i(59145),e),o.__exportStar(i(66970),e),o.__exportStar(i(37190),e),o.__exportStar(i(39058),e),o.__exportStar(i(13114),e),o.__exportStar(i(56846),e),o.__exportStar(i(65420),e),o.__exportStar(i(41889),e),o.__exportStar(i(57194),e),o.__exportStar(i(80854),e),o.__exportStar(i(87742),e),o.__exportStar(i(38950),e),o.__exportStar(i(56298),e),o.__exportStar(i(47202),e)},66970:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.is_connection_json=e.is_comment_json=e.is_block_json=void 0,e.is_block_json=function(t){return"input"!==t.type&&"next"!==t.type&&void 0!==t.type},e.is_comment_json=function(t){return void 0!==t.color_theme},e.is_connection_json=function(t){return"input"===t.type||"next"===t.type}},37190:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},39058:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},13114:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},56846:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},65420:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},41889:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TokenizationState=void 0,function(t){t[t.BaseCase=0]="BaseCase",t[t.PercentFound=1]="PercentFound",t[t.DigitFound=2]="DigitFound",t[t.MsgRefFound=3]="MsgRefFound"}(e.TokenizationState||(e.TokenizationState={}))},57194:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},56298:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},80854:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},87742:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},58034:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},51673:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},7666:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(51673),e),o.__exportStar(i(76439),e),o.__exportStar(i(3128),e)},76439:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},3128:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},78027:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},5393:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},11771:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},12157:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(78027),e),o.__exportStar(i(5393),e),o.__exportStar(i(11771),e),o.__exportStar(i(19648),e),o.__exportStar(i(58887),e),o.__exportStar(i(70042),e)},70042:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TOOLBOX_POSITION=e.DeleteArea=void 0,function(t){t[t.DELETE_AREA_NONE=0]="DELETE_AREA_NONE",t[t.DELETE_AREA_TOOLBOX=2]="DELETE_AREA_TOOLBOX"}(e.DeleteArea||(e.DeleteArea={})),function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"}(e.TOOLBOX_POSITION||(e.TOOLBOX_POSITION={}))},19648:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},58887:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},94297:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},33792:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockGroupType=e.LAST_NEXT_XML_TAG=e.BLOCK_GROUP_STOPPED_XML_TAG=e.BLOCK_GROUP_ID_XML_TAG=e.BLOCK_GROUP_NAME_XML_TAG=e.BLOCK_GROUP_NAME_FIELD_NAME=e.BLOCK_GROUP_TAG_FIELD_NAME=void 0,e.BLOCK_GROUP_TAG_FIELD_NAME="group_tag",e.BLOCK_GROUP_NAME_FIELD_NAME="group_name",e.BLOCK_GROUP_NAME_XML_TAG="block_group_name",e.BLOCK_GROUP_ID_XML_TAG="block_group_id",e.BLOCK_GROUP_STOPPED_XML_TAG="block_group_stopped",e.LAST_NEXT_XML_TAG="last_next_in_stack",function(t){t[t.START=0]="START",t[t.EXECUTION=1]="EXECUTION",t[t.OUTPUT=2]="OUTPUT"}(e.BlockGroupType||(e.BlockGroupType={}))},78121:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},21158:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(97572),e),o.__exportStar(i(33792),e),o.__exportStar(i(94297),e),o.__exportStar(i(78121),e),o.__exportStar(i(97390),e),o.__exportStar(i(93239),e)},58136:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},98059:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},65826:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},84326:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},73713:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.OptionTypes=void 0,function(t){t[t.TEXT=0]="TEXT",t[t.VALUE=1]="VALUE",t[t.ICON=2]="ICON",t[t.TRIGGER_EVENT=3]="TRIGGER_EVENT"}(e.OptionTypes||(e.OptionTypes={}))},42138:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},5877:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},27763:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},62861:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},57677:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},49742:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},64784:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},77487:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},84641:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},60829:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},70405:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(98059),e),o.__exportStar(i(65826),e),o.__exportStar(i(73713),e),o.__exportStar(i(42138),e),o.__exportStar(i(5877),e),o.__exportStar(i(62861),e),o.__exportStar(i(27763),e),o.__exportStar(i(49742),e),o.__exportStar(i(57677),e),o.__exportStar(i(64784),e),o.__exportStar(i(77487),e),o.__exportStar(i(84641),e),o.__exportStar(i(60829),e),o.__exportStar(i(84326),e),o.__exportStar(i(58136),e)},97572:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(70405),e),o.__exportStar(i(57987),e)},57987:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.InputType=void 0,function(t){t[t.VALUE=1]="VALUE",t[t.STATEMENT=3]="STATEMENT",t[t.DUMMY=5]="DUMMY"}(e.InputType||(e.InputType={}))},97390:function(t,e){var i;Object.defineProperty(e,"__esModule",{value:!0}),e.OPPOSITE_TYPE=e.CONNECTABLE_TYPE=e.CONNECTION_TYPE=e.OutputShape=void 0,function(t){t[t.ROUND=0]="ROUND",t[t.HEXAGONAL=1]="HEXAGONAL"}(e.OutputShape||(e.OutputShape={})),function(t){t[t.INPUT_VALUE=1]="INPUT_VALUE",t[t.OUTPUT_VALUE=2]="OUTPUT_VALUE",t[t.NEXT_STATEMENT=3]="NEXT_STATEMENT",t[t.PREVIOUS_STATEMENT=4]="PREVIOUS_STATEMENT"}(i=e.CONNECTION_TYPE||(e.CONNECTION_TYPE={})),function(t){t[t.CAN_CONNECT=0]="CAN_CONNECT",t[t.REASON_SELF_CONNECTION=1]="REASON_SELF_CONNECTION",t[t.REASON_WRONG_TYPE=2]="REASON_WRONG_TYPE",t[t.REASON_TARGET_NULL=3]="REASON_TARGET_NULL",t[t.REASON_CHECKS_FAILED=4]="REASON_CHECKS_FAILED",t[t.REASON_DIFFERENT_WORKSPACES=5]="REASON_DIFFERENT_WORKSPACES",t[t.REASON_SHADOW_PARENT=6]="REASON_SHADOW_PARENT"}(e.CONNECTABLE_TYPE||(e.CONNECTABLE_TYPE={})),e.OPPOSITE_TYPE=[],e.OPPOSITE_TYPE[i.INPUT_VALUE]=i.OUTPUT_VALUE,e.OPPOSITE_TYPE[i.OUTPUT_VALUE]=i.INPUT_VALUE,e.OPPOSITE_TYPE[i.NEXT_STATEMENT]=i.PREVIOUS_STATEMENT,e.OPPOSITE_TYPE[i.PREVIOUS_STATEMENT]=i.NEXT_STATEMENT},93239:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.InputRowType=void 0,function(t){t[t.INLINE=-1]="INLINE",t[t.STATEMENT=3]="STATEMENT"}(e.InputRowType||(e.InputRowType={}))},90287:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(21158),e),o.__exportStar(i(57915),e),o.__exportStar(i(31205),e)},57915:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.THEME_COLOR_MAP=void 0;var o=i(42798);e.THEME_COLOR_MAP={RED:new o.Color("#FF604B"),BLUE:new o.Color("#3882FF"),GREEN:new o.Color("#26E32D"),YELLOW:new o.Color("#FFD34E")}},31205:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockVisibility=void 0,function(t){t.VISIBLE="visible",t.HIDDEN="hidden",t.TRANSLUCENT="translucent"}(e.BlockVisibility||(e.BlockVisibility={}))},21498:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Msg=void 0;e.Msg={MATH_ADDITION_SYMBOL:"+",MATH_SUBTRACTION_SYMBOL:"-",MATH_DIVISION_SYMBOL:"\xf7",MATH_MULTIPLICATION_SYMBOL:"\xd7",MATH_POWER_SYMBOL:"^",MATH_TRIG_SIN:"sin",MATH_TRIG_COS:"cos",MATH_TRIG_TAN:"tan",MATH_TRIG_ASIN:"asin",MATH_TRIG_ACOS:"acos",MATH_TRIG_ATAN:"atan",START_GROUP_TAG:"\u4e8b\u4ef6",OUTPUT_GROUP_TAG:"\u8f93\u51fa",EXECUTION_GROUP_TAG:"\u6267\u884c",BLOCK_GROUP:"\u79ef\u6728\u5206\u7ec4",RELEASE_GROUP:"\u89e3\u9664\u5206\u7ec4",HIDE_BLOCK_STACK:"\u9690\u85cf\u79ef\u6728\u5757",SHOW_BLOCK_STACK:"\u53d6\u6d88\u9690\u85cf\u79ef\u6728\u5757"}},68397:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Options=void 0;var o=i(98734),n=i(61455),r=i(61972),s=i(57754),_=i(27807),a=i(9528),c=i(75102),l=function(){function t(t){this.disabledPatternId="",this.embossFilterId="",this.pinch=void 0,this.notch=void 0,this.degrade_translate=void 0,this.tooltip=void 0,this.timer=void 0,this.toolbox_background_class=void 0,this.in_flyout=!1;var e,i,o,n,r,s=!!t.readOnly,l=!1;if(s)l=!1,e=!1,i=!1,o=!1,n=!1;else{if(t.toolbox){if("string"==typeof t.toolbox)r=(0,_.get_instance)().get(a.BINDING.xml).text_to_dom(t.toolbox);else r=t.toolbox;l=r instanceof Element?!(!r||!r.getElementsByTagName("category").length):r.length>0}void 0==(e=t.collapse)&&(e=l),void 0==(i=t.comments)&&(i=l),void 0==(o=t.disable)&&(o=l),n=void 0==t.sounds||t.sounds}var d,u,h,p,g,f=!!t.rtl,v=t.horizontalLayout;if(void 0==v&&(v=!1),"number"===typeof t.toolboxPosition)d=t.toolboxPosition;else{var m="end"!==t.toolboxPosition;d=v?m?c.TOOLBOX_POSITION.TOP:c.TOOLBOX_POSITION.BOTTOM:m===f?c.TOOLBOX_POSITION.RIGHT:c.TOOLBOX_POSITION.LEFT}void 0!==t.scrollbars?(u=t.scrollbars,h=t.scrollbars,p=t.scrollbars,g=t.scrollbars):(void 0==(u=t.scrollable?t.scrollable.workspace:void 0)&&(u=l),void 0==(h=t.scrollable?t.scrollable.flyout:void 0)&&(h=l),void 0==(p=t.show_scrollbars?t.show_scrollbars.workspace:void 0)&&(p=l),void 0==(g=t.show_scrollbars?t.show_scrollbars.flyout:void 0)&&(g=l));var b=t.css;void 0==b&&(b=!0);var y,E,k="https://static.codemao.cn/blockly/media/";t.media&&(k=t.media),y=void 0==t.oneBasedIndex||!!t.oneBasedIndex,E=void 0!=t.blockly_type?t.blockly_type:"default",this.RTL=f,this.oneBasedIndex=y,this.collapse=e,this.comments=i,this.comment_type=t.comment_type||"normal",this.disable=o,this.readOnly=s,this.maxBlocks=t.maxBlocks||1/0,this.pathToMedia=k,this.has_categories=l,this.ws_scrollable=u,this.ws_show_scrollbars=p,this.flyout_scrollable=h,this.flyout_show_scrollbars=g,this.hasSounds=n,this.hasCss=b,this.horizontalLayout=v,this.toolbox_config=r,this.gridOptions=this.parse_grid_options(t),this.zoomOptions=this.parse_zoom_options(t),this.toolboxPosition=d,this.blockly_type=E,this.connection_effect=this.parse_connection_effect_options(t),this.field_max_length=t.field_max_length,this.pinch=t.pinch,this.notch=t.notch,this.degrade_translate=t.degrade_translate,this.tooltip=t.tooltip,this.timer=t.timer,this.toolbox_background_class=t.toolbox_background_class,this.id=t.id,this.flyout=this.parse_flyout_options(t.flyout),this.custom_svg_defs=t.custom_svg_defs,this.delete_area_margin=this.parse_delete_area_margin(t,d),this.workspace={content_margin:t.workspace&&t.workspace.content_margin||"50%"},this.theme="string"===typeof t.theme?t.theme:"light",this.dropdown=this.parse_dropdown_options(t),this.delete_area=t.delete_area||"default",this.block_group=this.parse_block_group_options(t),this.auto_resize=this.parse_auto_resize_options(t),this.context_menu=this.parse_context_menu_options(t)}return t.prototype.parse_zoom_options=function(t){var e=t.zoom||{};return{controls:void 0!=e.controls&&e.controls,wheel:void 0!=e.wheel&&e.wheel,startScale:void 0==e.startScale?1:e.startScale,maxScale:void 0==e.maxScale?3:e.maxScale,minScale:void 0==e.minScale?.3:e.minScale,scaleSpeed:void 0==e.scaleSpeed?1.2:e.scaleSpeed}},t.prototype.parse_grid_options=function(t){var e=t.grid||{};return{spacing:e.spacing||35,step:void 0===e.step?4:e.step,snap:!!e.spacing&&!!e.snap}},t.prototype.parse_connection_effect_options=function(t){if(t.connection_effect){var e=t.connection_effect||{};return{type:e.type,color:e.color}}},t.prototype.parse_dropdown_options=function(t){var e=t.dropdown&&t.dropdown.menu||{},i=t.dropdown||{};return{padding:"number"===typeof i.padding?i.padding:6,arrow_type:i.arrow_type||"line",menu:{align:e.align||(s.is.mobile()||s.is.ipad()?"center":"first"),scalable:"boolean"!=typeof e.scalable||e.scalable}}},t.prototype.parse_delete_area_margin=function(t,e){var i=t.delete_area_margin;return Array.isArray(i)?i:("undefined"===typeof i&&(i=1e7),e===c.TOOLBOX_POSITION.LEFT?[i,0,i,i]:e===c.TOOLBOX_POSITION.TOP?[i,i,0,i]:e===c.TOOLBOX_POSITION.RIGHT?[i,i,i,0]:[0,i,i,i])},t.prototype.parse_flyout_options=function(t){var e={auto_close:!0,fixed_width:void 0,min_width:void 0,max_width:void 0,corner_radius:0,padding:{top:15,bottom:20,left:30,right:30},blocks:{default_gap:16,head_block_offset:[0,0],head_short_block_offset:void 0}};return(0,r.parse_attr_deep)(e,t)},t.prototype.parse_block_group_options=function(t){if(t.block_group)return!0===t.block_group?{}:t.block_group},t.prototype.parse_auto_resize_options=function(t){if(t.auto_resize)return!0===t.auto_resize?{delay:0}:t.auto_resize},t.prototype.parse_context_menu_options=function(t){var e,i,o=[c.WorkspaceOptionType.PASTE,c.WorkspaceOptionType.CLEAN_UP,c.WorkspaceOptionType.DELETE_ALL,c.WorkspaceOptionType.COPY_ALL,c.WorkspaceOptionType.GLOBAL_COMMENT],n=[c.BlockOptionType.COPY_AND_PASTE,c.BlockOptionType.COPY,c.BlockOptionType.ADD_COMMENT,c.BlockOptionType.COLLAPSE,c.BlockOptionType.DELETE,c.BlockOptionType.SET_GROUP];return{workspace:(null===(e=t.context_menu)||void 0===e?void 0:e.workspace)||o,block:(null===(i=t.context_menu)||void 0===i?void 0:i.block)||n}},t=o.__decorate([(0,n.injectable)()],t)}();e.Options=l},37064:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var o=i(98734);o.__exportStar(i(75102),e),o.__exportStar(i(37767),e)},11200:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ScrollbarPair=e.Scrollbar=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=i(75102),a=i(25461),c=function(){function t(t,i,o,n,s){void 0===o&&(o=!1),void 0===n&&(n=""),void 0===s&&(s=!0),this.origin_=r.vec2.create(),this.size_ratio_=0,this.start_drag_handle=0,this.handle_position_=0,this.start_drag_mouse=0,this.handle_length_=0,this.scroll_view_size_=0,this.scroll_content_size_=0,this.container_visible_=!0,this.is_visible_=!0,this.is_scrollable=!0,this.workspace_=t,this.pair_=o||!1,this.horizontal_=i,this.old_host_metrics_=void 0;var _="blocklyScrollbar".concat(this.horizontal_?"Horizontal":"Vertical");n&&(_+=" ".concat(n)),this.outer_svg_=(0,a.create_svg_element)("svg",{class:_}),this.svg_group=(0,a.create_svg_element)("g",{},this.outer_svg_),this.svg_background_=(0,a.create_svg_element)("rect",{class:"blocklyScrollbarBackground"},this.svg_group);var c=Math.floor((e.scrollbar_thickness-5)/2);this.svg_handle_=(0,a.create_svg_element)("rect",{class:"blocklyScrollbarHandle",rx:c,ry:c},this.svg_group),i?(this.svg_background_.setAttribute("height",e.scrollbar_thickness.toString()),this.outer_svg_.setAttribute("height",e.scrollbar_thickness.toString()),this.svg_handle_.setAttribute("height",(e.scrollbar_thickness-9).toString()),this.svg_handle_.setAttribute("y","5"),this.length_attribute_="width",this.position_attribute_="x"):(this.svg_background_.setAttribute("width",e.scrollbar_thickness.toString()),this.outer_svg_.setAttribute("width",e.scrollbar_thickness.toString()),this.svg_handle_.setAttribute("width",(e.scrollbar_thickness-9).toString()),this.svg_handle_.setAttribute("x","5"),this.length_attribute_="height",this.position_attribute_="y"),(0,a.insert_after)(this.outer_svg_,this.workspace_.get_parent_svg()),this.on_mouse_down_bar_wrapper_=this.events.bind_event_with_checks(this.svg_background_,"mousedown",this,this.on_mouse_down_bar),this.on_mouse_down_handle_wrapper_=this.events.bind_event_with_checks(this.svg_handle_,"mousedown",this,this.on_mousedown_handle),this.position_=r.vec2.fromValues(0,0),this.opt_visible=s,s||this.update_display()}var e;return e=t,t.prototype.resize_view=function(t){var i=this.horizontal_?t.viewWidth-1:t.viewHeight-1;this.pair_&&(i-=e.scrollbar_thickness),this.set_scroll_view_size(Math.max(0,i));var o=t.absoluteLeft+.5,n=t.absoluteTop+.5;this.horizontal_?n+=t.viewHeight-e.scrollbar_thickness-1:o+=t.viewWidth-e.scrollbar_thickness-1,this.set_position(o,n),this.resize_content(t)},t.prototype.resize_content=function(t){var e;this.scroll_content_size_=this.horizontal_?t.contentWidth:t.contentHeight,this.pair_||this.set_visible(this.scroll_view_size_<this.scroll_content_size_),this.size_ratio_=this.scroll_view_size_/this.scroll_content_size_,(this.size_ratio_==-1/0||this.size_ratio_==1/0||isNaN(this.size_ratio_))&&(this.size_ratio_=0);var i=this.scroll_view_size_*this.size_ratio_;this.set_handle_length(Math.max(0,i));var o={};this.horizontal_?(o.x=this.constrain_target_pos(t.viewLeft-t.contentLeft),this.set_handle_position(o.x*this.size_ratio_)):(o.y=this.constrain_target_pos(t.viewTop-t.contentTop),this.set_handle_position(o.y*this.size_ratio_)),null===(e=this.workspace_)||void 0===e||e.set_metrics(o)},t.prototype.set_handle_length=function(t){var e;this.handle_length_=t,null===(e=this.svg_handle_)||void 0===e||e.setAttribute(this.length_attribute_,String(this.handle_length_))},t.prototype.set_visible=function(t){var e=t!=this.is_visible();if(this.pair_)throw new Error("Unable to toggle visibility of paired scrollbars.");this.is_visible_=t,e&&this.update_display()},t.prototype.set_position=function(t,e){if(this.outer_svg_){this.position_[0]=t,this.position_[1]=e;var i=this.position_[0]+this.origin_[0],o=this.position_[1]+this.origin_[1],n="translate(".concat(i,"px, ").concat(o,"px)");(0,a.set_css_transform)(this.outer_svg_,n)}},t.prototype.set_scroll_view_size=function(t){var e,i;this.scroll_view_size_=t,null===(e=this.outer_svg_)||void 0===e||e.setAttribute(this.length_attribute_,String(this.scroll_view_size_)),null===(i=this.svg_background_)||void 0===i||i.setAttribute(this.length_attribute_,String(this.scroll_view_size_))},t.prototype.dispose=function(){this.clean_up(),this.on_mouse_down_bar_wrapper_&&(this.events.unbind_event(this.on_mouse_down_bar_wrapper_),this.on_mouse_down_bar_wrapper_=void 0),this.on_mouse_down_handle_wrapper_&&(this.events.unbind_event(this.on_mouse_down_handle_wrapper_),this.on_mouse_down_handle_wrapper_=void 0),this.outer_svg_&&(0,a.remove_node)(this.outer_svg_),delete this.outer_svg_,delete this.svg_group,delete this.svg_background_,delete this.svg_handle_,delete this.workspace_},t.prototype.metrics_are_equivalent=function(t,e){return!(!t||!e)&&(t.viewWidth==e.viewWidth&&t.viewHeight==e.viewHeight&&t.viewLeft==e.viewLeft&&t.viewTop==e.viewTop&&t.absoluteTop==e.absoluteTop&&t.absoluteLeft==e.absoluteLeft&&t.contentWidth==e.contentWidth&&t.contentHeight==e.contentHeight&&t.contentLeft==e.contentLeft&&t.contentTop==e.contentTop)},t.prototype.set_origin=function(t){this.origin_=t},t.prototype.is_visible=function(){return this.is_visible_},t.prototype.set_container_visible=function(t){var e=t!=this.container_visible_;this.container_visible_=t,e&&this.update_display()},t.prototype.update_display=function(){if(void 0==this.outer_svg_)throw new Error("outerSvg_ is undefined");this.opt_visible&&this.is_visible()&&this.container_visible_?this.outer_svg_.setAttribute("display","block"):this.outer_svg_.setAttribute("display","none")},t.prototype.on_mouse_move_handle=function(t){var e=(this.horizontal_?t.clientX:t.clientY)-this.start_drag_mouse,i=(this.start_drag_handle+e)/this.size_ratio_;this.set(i)},t.prototype.on_mouse_up_handle=function(){var t;null===(t=this.workspace_)||void 0===t||t.reset_drag_surface(),this.touch_manager.clear_touch_identifier(),this.clean_up()},t.prototype.on_mousedown_handle=function(t){var i,o;null===(i=this.workspace_)||void 0===i||i.mark_focused(),this.clean_up(),this.utils.is_right_button(t)?t.stopPropagation():(this.start_drag_handle=this.handle_position_,null===(o=this.workspace_)||void 0===o||o.setup_drag_surface(),this.start_drag_mouse=this.horizontal_?t.clientX:t.clientY,e.on_mouse_up_wrapper_=this.events.bind_event_with_checks(document,"mouseup",this,this.on_mouse_up_handle),e.on_mouse_move_wrapper_=this.events.bind_event_with_checks(document,"mousemove",this,this.on_mouse_move_handle),t.stopPropagation(),t.preventDefault())},t.prototype.clean_up=function(){this.utils.hide_chaff(!0),e.on_mouse_up_wrapper_&&(this.events.unbind_event(e.on_mouse_up_wrapper_),e.on_mouse_up_wrapper_=void 0),e.on_mouse_move_wrapper_&&(this.events.unbind_event(e.on_mouse_move_wrapper_),e.on_mouse_move_wrapper_=void 0)},t.prototype.on_mouse_down_bar=function(t){if(!this.workspace_||!this.svg_handle_)throw new Error("this.workspace_ is undefined");if(this.workspace_.mark_focused(),this.touch_manager.clear_touch_identifier(),this.clean_up(),this.utils.is_right_button(t))t.stopPropagation();else{var e=this.utils.mouse_to_svg(t,this.workspace_.get_parent_svg(),this.workspace_.get_inverse_screen_ctm()),i=this.horizontal_?e.x:e.y,o=this.utils.get_injection_div_xy(this.svg_handle_),n=this.horizontal_?o[0]:o[1],r=this.handle_position_,s=.95*this.handle_length_;i<=n?r-=s:i>=n+this.handle_length_&&(r+=s);var _=r/this.size_ratio_;this.set(_),t.stopPropagation(),t.preventDefault()}},t.prototype.set_handle_position=function(t){this.svg_handle_&&(this.handle_position_=t,"y"==this.position_attribute_?(0,a.set_css_transform)(this.svg_handle_,"translate3d(0px, ".concat(this.handle_position_,"px, 0px)")):"x"==this.position_attribute_&&(0,a.set_css_transform)(this.svg_handle_,"translate3d(".concat(this.handle_position_,"px, 0px, 0px)")))},t.prototype.constrain_target_pos=function(t){return Math.max(0,Math.min(t,this.scroll_content_size_-this.scroll_view_size_))},t.prototype.set=function(t){if(this.workspace_&&this.is_scrollable){var e=this.workspace_.content_offset_by_view[this.horizontal_?0:1];if((t=this.constrain_target_pos(t))!==e){this.set_handle_position(t*this.size_ratio_);var i={};this.horizontal_?i.x=t:i.y=t,this.workspace_.set_metrics(i);var o=this.horizontal_?_.UIEventType.H_SCROLLBAR_SET:_.UIEventType.V_SCROLLBAR_SET;this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:o,workspace_id:this.workspace_.id,old_value:e,new_value:t}))}}},t.prototype.enable_scroll=function(t){this.is_scrollable=t},t.prototype.set_block_offset_by_view=function(t){if(this.workspace_){var e=this.workspace_.content_offset_by_view[this.horizontal_?0:1],i={},o=this.workspace_.get_metrics();if(this.horizontal_?(t=this.constrain_target_pos(-o.contentLeft-t),i.x=t):(t=this.constrain_target_pos(-o.contentTop-t),i.y=t),t!==e){this.workspace_.set_metrics(i);var n=this.workspace_.content_offset_by_view;this.horizontal_?this.set_handle_position(n[0]*this.size_ratio_):this.set_handle_position(n[1]*this.size_ratio_);var r=this.horizontal_?_.UIEventType.H_SCROLLBAR_SET:_.UIEventType.V_SCROLLBAR_SET;this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:r,workspace_id:this.workspace_.id,old_value:e,new_value:t}))}}},t.prototype.resize=function(t){if(this.workspace_){var e=t||this.workspace_.get_metrics();e&&e.viewWidth&&e.viewHeight&&(this.old_host_metrics_&&this.metrics_are_equivalent(e,this.old_host_metrics_)||(this.old_host_metrics_=e,this.resize_view(e)))}},t.scrollbar_thickness=15,o.__decorate([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.touch_manager)],t.prototype,"touch_manager",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),t=e=o.__decorate([(0,n.injectable)()],t)}();e.Scrollbar=c;var l=function(){function t(t,e){void 0===e&&(e=!0),this.old_host_metrics_=void 0,this.workspace_=t,this.h_scroll=new c(t,!0,!0,"blocklyMainWorkspaceScrollbar",e),this.v_scroll=new c(t,!1,!0,"blocklyMainWorkspaceScrollbar",e)}return t.prototype.set_container_visible=function(t){var e,i;null===(e=this.h_scroll)||void 0===e||e.set_container_visible(t),null===(i=this.v_scroll)||void 0===i||i.set_container_visible(t)},t.prototype.dispose=function(){var t,e;delete this.workspace_,this.old_host_metrics_=void 0,null===(t=this.h_scroll)||void 0===t||t.dispose(),delete this.h_scroll,null===(e=this.v_scroll)||void 0===e||e.dispose(),delete this.v_scroll},t.prototype.resize=function(){var t,e;if(this.workspace_){var i=this.workspace_.get_metrics();if(i){var o=!1,n=!1;this.old_host_metrics_&&this.old_host_metrics_.viewWidth==i.viewWidth&&this.old_host_metrics_.viewHeight==i.viewHeight&&this.old_host_metrics_.absoluteTop==i.absoluteTop&&this.old_host_metrics_.absoluteLeft==i.absoluteLeft?(this.old_host_metrics_&&this.old_host_metrics_.contentWidth==i.contentWidth&&this.old_host_metrics_.viewLeft==i.viewLeft&&this.old_host_metrics_.contentLeft==i.contentLeft||(o=!0),this.old_host_metrics_&&this.old_host_metrics_.contentHeight==i.contentHeight&&this.old_host_metrics_.viewTop==i.viewTop&&this.old_host_metrics_.contentTop==i.contentTop||(n=!0)):(o=!0,n=!0),o&&(null===(t=this.h_scroll)||void 0===t||t.resize(i)),n&&(null===(e=this.v_scroll)||void 0===e||e.resize(i)),this.old_host_metrics_=i}}},t.prototype.set=function(t,e,i){if(this.h_scroll&&this.v_scroll&&this.workspace_){var o=this.workspace_.content_offset_by_view,n={x:this.h_scroll.constrain_target_pos(t),y:this.v_scroll.constrain_target_pos(e)};n.x===o[0]&&n.y===o[1]||(this.workspace_.set_metrics(n,i),this.h_scroll.set_handle_position(n.x*this.h_scroll.size_ratio_),this.v_scroll.set_handle_position(n.y*this.v_scroll.size_ratio_),this.events.is_enabled()&&(this.events.fire(this.ui_event_factory({type:_.UIEventType.H_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:o[0],new_value:n.x})),this.events.fire(this.ui_event_factory({type:_.UIEventType.V_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:o[1],new_value:n.y}))))}},t.prototype.set_block_offset_by_view=function(t,e){if(this.h_scroll&&this.v_scroll&&this.workspace_){var i=this.workspace_.content_offset_by_view,o=this.workspace_.get_metrics(),n={x:this.h_scroll.constrain_target_pos(-o.contentLeft-t),y:this.v_scroll.constrain_target_pos(-o.contentTop-e)};n.x===i[0]&&n.y===i[1]||(this.workspace_.set_metrics(n),this.h_scroll.set_handle_position(n.x*this.h_scroll.size_ratio_),this.v_scroll.set_handle_position(n.y*this.v_scroll.size_ratio_),this.events.is_enabled()&&(this.events.fire(this.ui_event_factory({type:_.UIEventType.H_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:i[0],new_value:n.x})),this.events.fire(this.ui_event_factory({type:_.UIEventType.V_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:i[1],new_value:n.y}))))}},o.__decorate([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.ScrollbarPair=l},9147:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Blink=void 0;var o=i(98734),n=i(61455),r=i(59654),s=i(52734),_=i(12605),a=i(27807),c=i(98030),l=function(){function t(){this.Blocks=Object.create(null),this.blocks_xml={},this.version=i(47188).i8,this.inject=_.Inject.bind(this),Object.assign(this.Msg,s.zh_hans),(0,r.init_shadows)(this)}return Object.defineProperty(t.prototype,"mainWorkspace",{get:function(){return this.workspace_db.current},set:function(t){this.workspace_db.current=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"di_container",{get:function(){return(0,a.get_instance)()},enumerable:!1,configurable:!0}),t.prototype.define_blocks_with_json_array=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i){var o=i.type;o?(this.Blocks[o]&&console.warn("Block definition #".concat(e,' in JSON array overwrites prior definition of "').concat(o,'".')),this.Blocks[o]={init:function(t){return function(){this.jsonInit(t)}}(i)}):console.warn("Block definition #".concat(e," in JSON array is missing a type attribute. Skipping."))}else console.warn("Block definition #".concat(e," in JSON array not exist. Skipping."))}},t.prototype.define_block_with_object=function(t,e){this.Blocks[t]&&console.warn('Block definition overwrites prior definition of "'.concat(t,'".')),this.Blocks[t]=e},o.__decorate([(0,c.lazy_inject)(c.BINDING.context_menu)],t.prototype,"context_menu",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.extensions)],t.prototype,"extensions",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.Msg)],t.prototype,"Msg",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.registry)],t.prototype,"registry",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.theme)],t.prototype,"theme",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.tooltip)],t.prototype,"tooltip",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.widget_div)],t.prototype,"widget_div",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.xml)],t.prototype,"xml",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.json)],t.prototype,"json",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.utils)],t.prototype,"utils",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Blink=l},88292:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockAnimations=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=i(25461),a=i(42798),c=i(3909),l=function(){function t(){this.disconnectUiEffectTimeoutId=0}return t.prototype.dispose_ui_effect=function(t){var e=t.get_workspace(),i=t.get_svg_root(),o=e.get_injection_div();if(e.get_audio_manager().play("delete"),i&&o){var n=this.utils.get_injection_div_xy(i),r=e.get_scale(),s=(0,_.create_svg_element)("svg",{class:"blocklyBlockDisposeWrapper"});s.style.transformOrigin="left top",s.style.overflow="visible",this.utils.set_transform_style(s,n[0],n[1],r);var a=(0,_.clone_node)(i,!0);a.setAttribute("transform",""),s.appendChild(a),o.appendChild(s);var c=function t(){(0,_.remove_node)(s),a.removeEventListener("webkitAnimationEnd",t),a.removeEventListener("animationend",t),clearTimeout(l)};a.addEventListener("webkitAnimationEnd",c),a.addEventListener("animationend",c);var l=window.setTimeout(c,500),d=t.get_height_width();return a.setAttribute("transform-origin","".concat((d.width/2-this.theme.renderer.BLOCK_LEFT_TOP[0])*r,"px ").concat((d.height/2-this.theme.renderer.BLOCK_LEFT_TOP[1])*r,"px")),a.classList.add("blocklyBlockDispose"),a}console.warn("UI effects cannot be played without svg group or injection div.")},t.prototype.connection_ui_effect=function(t){var e=t.get_svg_root();if(void 0==e)throw new ReferenceError("Cannot connect ui effect to block without svg root.");var i=t.get_workspace();if(i.get_audio_manager().play("click"),!(i.get_scale()<1)){var o=i.get_svg_xy(e);t.output_connection?r.vec2.add(o,o,[-3*i.get_scale(),13*i.get_scale()]):t.previous_connection&&r.vec2.add(o,o,[0*i.get_scale(),3*i.get_scale()]);var n=t.workspace.options.notch?t.workspace.get_scale()*(this.theme.renderer.NOTCH_WIDTH/2+this.theme.renderer.NTOCH_START_PADDING):0,s=(0,_.create_svg_element)("circle",{cx:o[0]+n,cy:o[1],r:0,fill:"#fff"},i.get_parent_svg());this.connection_ui_step(s,Date.now(),i.get_scale())}},t.prototype.connection_ui_step=function(t,e,i){var o=this,n=(Date.now()-e)/150;n>1?(0,_.remove_node)(t):(t.setAttribute("r",String(15*n*i)),t.style.opacity=String(1-n),window.setTimeout((function(){o.connection_ui_step(t,e,i)}),10))},t.prototype.disconnect_ui_effect=function(t){t.workspace.get_audio_manager().play("disconnect"),t.workspace.get_scale()<1||t.svg_group&&t.use_drag_surface&&(t.svg_group.classList.add("dd"),this.disconnectUiEffectTimeoutId=window.setTimeout((function(){t.svg_group.classList.remove("dd");var e=t.svg_group.getAttribute("transform");t.svg_group.setAttribute("transform","".concat(void 0==e?"":e,"skewX(0)"))}),100))},t.prototype.disconnect_ui_effect_stop=function(t){clearTimeout(this.disconnectUiEffectTimeoutId),t.svg_group.classList.remove("dd");var e=t.svg_group.getAttribute("transform");t.svg_group.setAttribute("transform",void 0==e?"":e)},t.prototype.toolbox_click_effect=function(){},t.prototype.block_flash_effect=function(t,e){var i,o,n,r,s,l,d;if(e){var u=t.get_colour(),h=(0,a.rgb_to_hsv)(u.r,u.g,u.b),p=(0,a.hsv_to_rgb)({h:h.h,s:h.s+20,v:h.v-15}),g=new a.Color({r:p[0],g:p[1],b:p[2],a:u.a}),f=u.toString(),v=g.toString(),m=(0,_.create_svg_element)("animate",{id:"BlockFlashAnimation",attributeName:"fill",attributeType:"XML",values:"".concat(f," ; ").concat(v," ; ").concat(f),dur:"1s",repeatCount:"indefinite",keyTimes:"0 ; 0.5; 1",calcMode:"spline",keySplines:"0.25,0.1,0.25,1;0.25,0.1,0.25,1"});if(null===(i=t.svg_path)||void 0===i||i.removeAttribute("fill"),t.is_starting_block())(y=t.get_svg_root().querySelector(".".concat("blockly_head_icon_wrapper")))&&y.removeAttribute("fill");return t.is_output_block()&&t.parent_block?(null===(o=t.svg_path)||void 0===o||o.setAttribute("stroke","#FFFFFF"),null===(n=t.svg_path)||void 0===n||n.setAttribute("stroke-width","2px")):t.get_svg_root().setAttribute("filter","url(#".concat(c.FILTER.FOCUSED,")")),void t.get_svg_root().appendChild(m)}var b=t.svg_group.querySelector("#BlockFlashAnimation");b&&t.svg_group.removeChild(b),null===(r=t.svg_path)||void 0===r||r.removeAttribute("filter");var y,E=t.get_colour().toString();(null===(s=t.svg_path)||void 0===s||s.setAttribute("fill",E),t.is_starting_block())&&((y=t.get_svg_root().querySelector(".".concat("blockly_head_icon_wrapper")))&&(y.setAttribute("fill",E),y.removeAttribute("filter")));null===(l=t.svg_path)||void 0===l||l.setAttribute("stroke",t.get_border_colour().toString()),null===(d=t.svg_path)||void 0===d||d.setAttribute("stroke-width",t.get_stroke_width())},o.__decorate([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.BlockAnimations=l},15105:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ContextMenu=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(75102),_=i(25461),a=i(12988),c=i(74370),l=function(){function t(){this.current_block=void 0,this.disabled=!1}return t.prototype.set_disabled=function(t){this.disabled=t},t.prototype.show=function(t,e,i){var o,n,r;if(!this.disabled)if(this.widget_div.show(this,void 0),null===(o=this.tooltip)||void 0===o||o.hide(),Array.isArray(e)&&(e={source:"",options:e}),e.options.length){var _=this.populate_(e);this.position_(_,t,i),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.CONTEXT_MENU_OPEN,workspace_id:(null===(n=this.workspace_db.current)||void 0===n?void 0:n.id)||"",old_value:!1,new_value:!0,block_id:null===(r=this.current_block)||void 0===r?void 0:r.id})),window.setTimeout((function(){_.focus()}),0)}else this.hide()},t.prototype.populate_=function(t){var e=this,i=document.createElement("div");i.setAttribute("tabindex","-1"),i.classList.add("menu-wrapper");for(var o=t.options,n=function(n){var r=o[n],s=document.createElement("div");if(s.classList.add("menu-item"),s.setAttribute("name",r.name),!r.enabled&&s.classList.add("menu_item_disable"),r.enabled&&s.classList.add("menu_item_enable"),r.icon){var a=void 0;if("string"===typeof r.icon)(a=new Image).src=r.icon,a.alt=r.text,a.style.verticalAlign="middle",a.draggable=!1;else{a=(0,_.create_svg_element)("svg",{width:16,height:16});var c=(0,_.clone_node)(r.icon,!0);a.appendChild(c)}a.style.marginRight="8px",s.appendChild(a)}var l=document.createElement("span");l.innerText=r.text,s.appendChild(l),r.selected&&s.classList.add("menu_item_selected"),r.attr&&r.attr.forEach((function(t){var e=t[0],i=t[1];"class"!==e?s.setAttribute(e,i):s.classList.add(i)})),i.appendChild(s),s.addEventListener("click",(function(){var i;r.enabled&&(e.hide(),r.callback(),e.events.is_enabled()&&e.events.fire(e.contextmenu_option_event_factory({workspace_id:(null===(i=e.workspace_db.current)||void 0===i?void 0:i.id)||"",option_name:r.name,source:t.source})))}))},r=0;r<o.length;r++)n(r);return i},t.prototype.position_=function(t,e,i){var o=(0,_.get_viewport_bbox)(),n={top:e.clientY,bottom:e.clientY,left:e.clientX,right:e.clientX};this.create_widget(t);var r=(0,a.get_size)(t);r.height=t.scrollHeight,i&&(0,a.adjust_bboxes_for_rtl)(o,n,r),this.widget_div.position_with_anchor(o,n,r,i),t.focus()},t.prototype.create_widget=function(t){this.widget_div.DIV.appendChild(t),t.classList.add("blocklyContextMenu"),this.events.bind_event_with_checks(t,"contextmenu",void 0,c.no_event)},t.prototype.hide=function(){var t,e;this.widget_div.hide_if_owner(this),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.CONTEXT_MENU_OPEN,workspace_id:(null===(t=this.workspace_db.current)||void 0===t?void 0:t.id)||"",old_value:!0,new_value:!1,block_id:null===(e=this.current_block)||void 0===e?void 0:e.id})),this.current_block=void 0},o.__decorate([(0,r.lazy_inject)(r.BINDING.widget_div)],t.prototype,"widget_div",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.tooltip)],t.prototype,"tooltip",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.ContextMenuOptionEvent)],t.prototype,"contextmenu_option_event_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.ContextMenu=l},37239:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.AngleController=void 0;var o=i(98734),n=i(61455),r=i(43210),s=i(25461),_=i(42798),a=function(t){function e(){var e=t.call(this)||this;return e.pointer_elements=[],e.base_color=new _.Color("#000000"),e.mod=void 0,e.center_position=void 0,e.base_line_height=1,e.angle_interval=15,e.min_degree=-180,e.max_degree=180,e}return o.__extends(e,t),e.prototype.show=function(t,e){var i,o,n,r=(null===(i=t.source_block)||void 0===i?void 0:i.is_shadow())?t.source_block.parent_block:t.source_block;if(r&&(this.angle_scale||this.init(),this.owner=t,this.mod=t.mod_,this.base_color=r.get_colour(),this.update_angle_scale(),this.container.style.display="block",this.position(),this.base_line)){var s=(null===(n=null===(o=this.owner)||void 0===o?void 0:o.source_block)||void 0===n?void 0:n.get_workspace().get_scale())||1,_=this.base_line.getBoundingClientRect();this.center_position={left:_.left,top:_.top+this.base_line_height/2*s}}},e.prototype.init=function(){this.angle_scale=document.createElement("div"),this.angle_scale.classList.add("blockly-controller","angle-controller"),this.angle_scale.setAttribute("tabindex","-1");var t=(0,s.create_svg_element)("svg",{class:"blocklyIcon degree-mark-major"},this.angle_scale);this.degree_mark_major=(0,s.create_svg_element)("use",{},t),this.degree_mark_major.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#".concat(r.SYMBOL.DEGREE_MARK_MAJOR));var e=(0,s.create_svg_element)("svg",{class:"blocklyIcon degree-mark-minor"},this.angle_scale);this.degree_mark_minor=(0,s.create_svg_element)("use",{},e),this.degree_mark_minor.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#".concat(r.SYMBOL.DEGREE_MARK_MINOR));var i=document.createElement("div");i.classList.add("wrapper"),this.angle_scale.appendChild(i);var o=document.createElement("div");o.classList.add("grey-circle"),i.appendChild(o),this.mask=document.createElement("div"),this.mask.classList.add("mask-wrapper"),i.appendChild(this.mask),this.mask_top_clip=document.createElement("div"),this.mask_top_clip.classList.add("mask-clip"),this.mask.appendChild(this.mask_top_clip),this.mask_bottom_clip=document.createElement("div"),this.mask_bottom_clip.classList.add("mask-clip"),this.mask.appendChild(this.mask_bottom_clip);var n=document.createElement("div");n.classList.add("white-circle"),this.mask.appendChild(n),this.base_line=document.createElement("div"),this.base_line.classList.add("base-line"),i.appendChild(this.base_line),this.center=document.createElement("div"),this.center.classList.add("center"),i.appendChild(this.center),this.pointer=document.createElement("div"),this.pointer.classList.add("pointer"),i.appendChild(this.pointer);var _=document.createElement("div");_.classList.add("pointer-line"),this.pointer.appendChild(_),this.pointer_elements.push(_);var a=document.createElement("div");a.classList.add("pointer-arrow-wrapper"),this.pointer.appendChild(a);var c=document.createElement("div");c.classList.add("pointer-arrow-circle"),a.appendChild(c),this.pointer_elements.push(c);var l=(0,s.create_svg_element)("svg",{class:"blocklyIcon pointer-icon"},c),d=(0,s.create_svg_element)("use",{},l);d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#".concat(r.SYMBOL.DEGREE_POINTER)),d.setAttribute("fill","#ffffff"),this.angle_scale.addEventListener("mousedown",this.bind_angle_event.bind(this)),this.angle_scale.addEventListener("mouseup",this.set_pointer_position.bind(this)),this.container.appendChild(this.angle_scale),document.body.appendChild(this.container)},e.prototype.update_angle_scale=function(){var t=this;if(this.degree_mark_major&&this.degree_mark_minor&&this.base_line&&this.center&&this.pointer&&this.mask&&this.owner){this.degree_mark_major.style.fill=this.base_color.toString(),this.base_line.style.backgroundColor=this.base_color.toString(),this.center.style.backgroundColor=this.base_color.toString(),this.pointer_elements.forEach((function(e){return e.style.backgroundColor=t.base_color.toString()}));var e=new _.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.4});this.degree_mark_minor.style.fill=e.toString();var i=new _.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.2});this.mask.style.backgroundColor=i.toString();var o=this.field_to_angle_value(Number(this.owner.get_value()));this.set_angle_value(o)}},e.prototype.update_value=function(t){var e=this.field_to_angle_value(t);this.set_angle_value(e)},e.prototype.field_to_angle_value=function(t){var e=this.max_degree-this.min_degree,i=t%e;return!0===this.mod?i<=this.min_degree?i+=e:i>this.max_degree&&(i-=e):i<this.min_degree?i+=e:i>=this.max_degree&&(i-=e),Math.round(i)},e.prototype.bind_angle_event=function(){var t=this.move_pointer.bind(this);document.addEventListener("mousemove",t),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",e)}))},e.prototype.move_pointer=function(t){t.stopPropagation(),this.update_angle_and_field_value(t.clientX,t.clientY)},e.prototype.set_pointer_position=function(t){this.update_angle_and_field_value(t.clientX,t.clientY)},e.prototype.update_angle_and_field_value=function(t,e){if(this.center_position){var i=e,o=t-this.center_position.left,n=this.center_position.top-i,r=Math.atan2(n,o)/Math.PI*180;r=Math.round(r/this.angle_interval)*this.angle_interval,void 0!==this.mod&&(this.mod&&r===this.min_degree&&(r+=this.angle_interval),this.mod||r!==this.max_degree||(r-=this.angle_interval)),this.set_angle_value(r),this.owner&&(this.owner.set_html_input_value(r.toString()),this.owner.on_html_input_change())}},e.prototype.set_angle_value=function(t){this.pointer&&this.mask_top_clip&&this.mask_bottom_clip&&(this.pointer.style.transform="translateY(-50%) rotate(".concat(-t,"deg)"),t>0?(this.mask_top_clip.style.transform="rotate(-".concat(t,"deg)"),this.mask_bottom_clip.style.transform="rotate(180deg)"):(this.mask_top_clip.style.transform="rotate(0deg)",this.mask_bottom_clip.style.transform="rotate(".concat(180-t,"deg)")))},e=o.__decorate([(0,n.injectable)()],e)}(i(71839).Controller);e.AngleController=a},87482:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ColorController=void 0;var o=i(98734),n=i(61455),r=i(11214),s=i(42798),_=i(75102),a=i(98030),c=function(t){function e(){var e=t.call(this)||this;return e.color_handle_element=null,e.current_color_panel_element=null,e.color_review_element=null,e.color_strip_width=182,e.min=0,e.max=100,e}return o.__extends(e,t),e.prototype.show=function(t,e){var i,o=(null===(i=t.source_block)||void 0===i?void 0:i.is_shadow())?t.source_block.parent_block:t.source_block;o&&(this.owner=t,this.color_format=e.color_format,this.line=e.line,this.color=o.color_,this.color_format&&this.line&&this.color&&(this.init(),this.update_color(),this.container.style.display="block",this.position()))},e.prototype.hide=function(){var t;this.container.style.display="none",null===(t=this.color_element)||void 0===t||t.remove()},e.prototype.init=function(){var t=this;this.color_element=document.createElement("div"),this.color_element.classList.add("blockly-controller","color-controller"),this.color_element.setAttribute("tabindex","-1");var e=document.createElement("div"),i="",o=this.Blink.Msg;this.color_format===_.EColorControllerFormat.HSVA?i=this.create_color_panel([["h","H ".concat(o.HUE)],["s","S ".concat(o.SATURATION)],["v","V ".concat(o.BRIGHTNESS)],["a","A ".concat(o.OPACITY)]]):this.color_format===_.EColorControllerFormat.RGBA&&(i=this.create_color_panel([["r","R ".concat(o.RED)],["g","G ".concat(o.GREEN)],["b","B ".concat(o.BLUE)],["a","A ".concat(o.OPACITY)]])),e.innerHTML=i,e.classList.add("color-panel"),this.color_element.appendChild(e),e.childNodes.forEach((function(e){var i,o,n,r=e;t.set_color_panel_item_left(r),r.addEventListener("mousedown",t.bind_color_strip_event.bind(t,r)),null===(i=r.querySelector(".color-handle"))||void 0===i||i.addEventListener("mousedown",t.bind_color_event.bind(t)),null===(o=r.querySelector(".color-strip-panel"))||void 0===o||o.addEventListener("mousedown",t.bind_color_event.bind(t)),r.querySelector(".color-strip-panel").addEventListener("mouseup",t.set_color_handle_position.bind(t)),(null===(n=t.line)||void 0===n?void 0:n.toLowerCase())===r.getAttribute("data")&&(t.color_handle_element=r.querySelector(".color-handle"),t.current_color_panel_element=r.querySelector(".color-strip-panel"))}));var n="\n      <div>\n        ".concat(o.COLOR_PREVIEW,'\n      </div>\n      <div class="color-preview">\n      </div>\n    '),r=document.createElement("div");r.classList.add("preview-panel"),r.innerHTML=n,this.color_review_element=r.querySelector(".color-preview"),this.color_element.appendChild(r),this.container.appendChild(this.color_element),document.body.appendChild(this.container)},e.prototype.update_color=function(){if(this.color&&this.color_element&&this.color_format&&this.line&&this.owner&&"number"===typeof this.owner.min_&&"number"===typeof this.owner.max_){this.min=this.owner.min_,this.max=this.owner.max_;var t=this.field_to_color_value(Number(this.owner.get_value()),this.min,this.max);this.set_color_value(t),this.update_dropdown_color()}},e.prototype.set_color_panel_item_left=function(t){var e,i,o,n,r,s,_=null===(i=null===(e=this.owner)||void 0===e?void 0:e.source_block)||void 0===i?void 0:i.parent_block,a=t.getAttribute("data"),c=t.querySelector(".color-handle");if(_&&a&&c){var l=this.get_field_value(_,a.toUpperCase()),d=(null===(s=null===(r=null===(n=null===(o=_.get_input_target_block(a.toUpperCase()))||void 0===o?void 0:o.output_connection)||void 0===n?void 0:n.target_connection)||void 0===r?void 0:r.get_shadow_dom())||void 0===s?void 0:s.firstChild).getAttribute("constraints");if(d){var u=d.split(","),h=u[0],p=u[1],g=this.field_to_color_value(l,h,p);c.style.left="".concat(g,"px")}}},e.prototype.create_color_panel=function(t){return t.map((function(t){return'<div data="'.concat(t[0],'" id="').concat(t[0],'_panel" class="color-panel-item">\n    <div class="color-label">').concat(t[1],'</div>\n    <div class="color-strip-panel">\n      <div id="').concat(t[0],'_panel_strip" class="color-strip"></div>\n      <div class="color-handle"></div>\n    </div>\n  </div>')})).join("")},e.prototype.get_linear_gradient_rgba=function(t,e,i){var n=o.__assign({},t),r=o.__assign({},t);n[e]=0,r[e]=i;var _=(0,s.rgba_to_hex)(n),a=(0,s.rgba_to_hex)(r);return"linear-gradient(90deg, ".concat(_,", ").concat(a,")")},e.prototype.get_linear_gradient_hsva=function(t,e,i){var n,r,_=null===(r=null===(n=this.owner)||void 0===n?void 0:n.source_block)||void 0===r?void 0:r.parent_block;if(!_)return"";var a={h:this.get_field_value(_,"H"),s:this.get_field_value(_,"S"),v:this.get_field_value(_,"V")};if("h"===e)return"linear-gradient(90deg, \n        ".concat((0,s.rgba_to_hex)((0,s.hsva_to_rgba)(o.__assign(o.__assign({},a),{a:t.a,h:0}))),",\n        ").concat((0,s.rgba_to_hex)((0,s.hsva_to_rgba)(o.__assign(o.__assign({},a),{a:t.a,h:60}))),",\n        ").concat((0,s.rgba_to_hex)((0,s.hsva_to_rgba)(o.__assign(o.__assign({},a),{a:t.a,h:120}))),",\n        ").concat((0,s.rgba_to_hex)((0,s.hsva_to_rgba)(o.__assign(o.__assign({},a),{a:t.a,h:180}))),",\n        ").concat((0,s.rgba_to_hex)((0,s.hsva_to_rgba)(o.__assign(o.__assign({},a),{a:t.a,h:240}))),",\n        ").concat((0,s.rgba_to_hex)((0,s.hsva_to_rgba)(o.__assign(o.__assign({},a),{a:t.a,h:300}))),",\n        ").concat((0,s.rgba_to_hex)((0,s.hsva_to_rgba)(o.__assign(o.__assign({},a),{a:t.a,h:360}))),")");var c=o.__assign(o.__assign({},a),{a:t.a}),l=o.__assign(o.__assign({},a),{a:t.a});c[e]=0,l[e]=i;var d=(0,s.rgba_to_hex)((0,s.hsva_to_rgba)(c)),u=(0,s.rgba_to_hex)((0,s.hsva_to_rgba)(l));return"linear-gradient(90deg, ".concat(d,", ").concat(u,")")},e.prototype.update_dropdown_color=function(){var t=this,e=this.color;if(e){this.color_review_element&&(this.color_review_element.style.background=e.toString());var i="rgba",o=[["r",255],["g",255],["b",255],["a",1]];this.color_format===_.EColorControllerFormat.HSVA&&(i="hsva",o=[["h",360],["s",100],["v",100],["a",1]]),o.forEach((function(o){var n,r,s,_,a,c=document.getElementById("".concat(o[0],"_panel_strip"));if(c){if(!(null===(_=null===(s=null===(r=null===(n=t.owner)||void 0===n?void 0:n.source_block)||void 0===r?void 0:r.parent_block)||void 0===s?void 0:s.get_input_target_block(o[0].toString().toUpperCase()))||void 0===_?void 0:_.get_field_value("NUM"))){var l=document.getElementById("".concat(o[0],"_panel"));l.style.opacity="0.2",null===(a=null===l||void 0===l?void 0:l.querySelector(".color-handle"))||void 0===a||a.remove(),c.style.cursor="not-allowed"}c.style.background="rgba"===i?t.get_linear_gradient_rgba(e,o[0],o[1]):t.get_linear_gradient_hsva(e,o[0],o[1])}}))}},e.prototype.update_value=function(t){var e,i;if(this.color&&this.line){if("A"===this.line)this.color.a=t/100;else if(this.color_format===_.EColorControllerFormat.RGBA)this.color[this.line.toLowerCase()]=t;else if(this.color_format===_.EColorControllerFormat.HSVA){var o=null===(i=null===(e=this.owner)||void 0===e?void 0:e.source_block)||void 0===i?void 0:i.parent_block;if(!o)return;var n=this.get_field_value(o,"H"),r=this.get_field_value(o,"S"),a=this.get_field_value(o,"V");if(!n||!r||!a)return;var c={h:n,s:r,v:a};c[this.line.toLowerCase()]=t;var l=(0,s.hsv_to_rgb)(c),d=l[0],u=l[1],h=l[2];this.color.r=d,this.color.g=u,this.color.b=h}var p=this.field_to_color_value(t,this.min,this.max);this.set_color_value(p),this.update_dropdown_color()}},e.prototype.get_field_value=function(t,e){var i,o,n,r,s;return(null===(i=t.get_input_target_block(e))||void 0===i?void 0:i.get_field_value("NUM"))||(null===(s=null===(r=null===(n=null===(o=t.get_input_target_block(e))||void 0===o?void 0:o.output_connection)||void 0===n?void 0:n.target_connection)||void 0===r?void 0:r.get_shadow_dom())||void 0===s?void 0:s.textContent)},e.prototype.field_to_color_value=function(t,e,i){var o=(0,r.clamp)(t,e,i),n=e<0?o-e:o,s=i-e;return Math.round(n/s*this.color_strip_width)},e.prototype.bind_color_strip_event=function(t){var e,i,o,n,r=t.getAttribute("data");if(r){var s=null===(n=null===(o=null===(i=null===(e=this.owner)||void 0===e?void 0:e.source_block)||void 0===i?void 0:i.parent_block)||void 0===o?void 0:o.get_input_target_block(r.toUpperCase()))||void 0===n?void 0:n.get_field("NUM");s?(this.owner=s,this.line=r.toUpperCase(),this.color_handle_element=t.querySelector(".color-handle"),this.current_color_panel_element=t.querySelector(".color-strip-panel"),this.update_color()):this.color_handle_element=null}},e.prototype.bind_color_event=function(t){var e=this;if(t.preventDefault(),this.current_color_panel_element){this.current_color_panel_item_left=this.current_color_panel_element.getBoundingClientRect().left;var i=this.move_color_handle.bind(this);document.addEventListener("mousemove",i),document.addEventListener("mouseup",(function t(){e.current_color_panel_item_left=void 0,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",t)}))}},e.prototype.move_color_handle=function(t){t.stopPropagation(),this.update_color_and_field_value(t.clientX)},e.prototype.set_color_handle_position=function(t){this.current_color_panel_element&&(this.current_color_panel_item_left=this.current_color_panel_element.getBoundingClientRect().left,this.update_color_and_field_value(t.clientX))},e.prototype.update_color_and_field_value=function(t){var e,i;if(this.current_color_panel_item_left&&this.color_handle_element){var o=(null===(i=null===(e=this.owner)||void 0===e?void 0:e.source_block)||void 0===i?void 0:i.get_workspace().get_scale())||1,n=(t-this.current_color_panel_item_left)/o,s=(0,r.clamp)(n,0,this.color_strip_width),_=this.max-this.min,a=Math.round(s/this.color_strip_width*_),c=this.min<0?a+this.min:a;this.set_color_value(s),this.owner&&(this.owner.set_html_input_value(c.toString()),this.owner.on_html_input_change(),this.owner.get_value()!==c.toString()&&this.owner.set_value(c.toString()))}},e.prototype.set_color_value=function(t){this.color_handle_element&&(this.color_handle_element.style.left="".concat(t,"px"))},o.__decorate([(0,a.lazy_inject)(a.BINDING.Blink)],e.prototype,"Blink",void 0),e=o.__decorate([(0,n.injectable)()],e)}(i(71839).Controller);e.ColorController=c},71839:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(25461),_=function(){function t(){this.container=(0,s.create_dom)("div",{style:"position: fixed",class:"blocklyWidgetDiv"}),this.container.style.display="none"}return t.prototype.show=function(t,e){},t.prototype.hide=function(){this.container.style.display="none"},t.prototype.update_value=function(t){},t.prototype.position=function(){if(this.owner&&this.container){var t=this.owner.source_block;if(t){var e=t.get_workspace().get_scale()||1;this.container.style.transformOrigin="top left",this.container.style.transform="scale(".concat(e,")");var i=(this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_FIELD+1)*e,o=this.container.getBoundingClientRect().width;if(!t.is_shadow()){var n=this.owner.get_absolute_xy(),r=this.owner.get_size(),_=r.width*e,a=r.height*e,c=n[0]+_/2-o/2,l=n[1]+a+i;return this.container.style.left="".concat(c,"px"),void(this.container.style.top="".concat(l,"px"))}var d=t.svg_group,u=(0,s.get_page_offset)(d),h=t.width*e,p=t.height*e,g=u[0]+h/2-o/2,f=u[1]+p+i;this.container.style.left="".concat(g,"px"),this.container.style.top="".concat(f,"px")}}},o.__decorate([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Controller=_},63295:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.SliderController=void 0;var o=i(98734),n=i(61455),r=i(11214),s=i(42798),_=function(t){function e(){var e=t.call(this)||this;return e.base_color=new s.Color("#000000"),e.left_text="",e.right_text="",e.min=0,e.max=100,e.slider_width=140,e}return o.__extends(e,t),e.prototype.show=function(t,e){var i;if("number"===typeof t.min_&&"number"===typeof t.max_){var o=(null===(i=t.source_block)||void 0===i?void 0:i.is_shadow())?t.source_block.parent_block:t.source_block;o&&(this.slider||this.init(),this.owner=t,this.min=t.min_,this.max=t.max_,this.left_text=e.left_text,this.right_text=e.right_text,this.base_color=o.get_colour(),this.update_slider(),this.container.style.display="block",this.position())}},e.prototype.init=function(){this.slider=document.createElement("div"),this.slider.classList.add("blockly-controller","slider-controller"),this.slider.setAttribute("tabindex","-1"),this.left_text_ele=document.createElement("span"),this.left_text_ele.classList.add("slider-text"),this.left_text_ele.innerText=this.left_text,this.slider.appendChild(this.left_text_ele);var t=document.createElement("div");t.classList.add("slider-wrapper"),this.slider.appendChild(t),this.slider_rail=document.createElement("div"),this.slider_rail.classList.add("slider-rail"),this.slider_rail.style.backgroundColor=this.base_color.toString(),t.appendChild(this.slider_rail),this.slider_track=document.createElement("div"),this.slider_track.classList.add("slider-track"),this.slider_track.style.backgroundColor=this.base_color.toString(),t.appendChild(this.slider_track),this.slider_handle=document.createElement("div"),this.slider_handle.classList.add("slider-handle"),this.slider_handle.style.backgroundColor=this.base_color.toString(),t.appendChild(this.slider_handle),this.right_text_ele=document.createElement("span"),this.right_text_ele.classList.add("slider-text"),this.right_text_ele.innerText=this.right_text,this.slider.appendChild(this.right_text_ele),this.slider_handle.addEventListener("mousedown",this.bind_slider_event.bind(this)),t.addEventListener("mousedown",this.bind_slider_event.bind(this)),t.addEventListener("mouseup",this.set_slider_handle_position.bind(this)),this.container.appendChild(this.slider),document.body.appendChild(this.container)},e.prototype.update_slider=function(){if(this.slider_track&&this.slider_handle&&this.slider_rail&&this.left_text_ele&&this.right_text_ele&&this.owner){this.slider_handle.style.backgroundColor=this.base_color.toString();var t=new s.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.6});this.slider_track.style.backgroundColor=t.toString();var e=new s.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.2});this.slider_rail.style.backgroundColor=e.toString(),this.left_text_ele.innerText=this.left_text,this.right_text_ele.innerText=this.right_text;var i=this.field_to_slider_value(Number(this.owner.get_value()));this.set_slider_value(i)}},e.prototype.update_value=function(t){var e=this.field_to_slider_value(t);this.set_slider_value(e)},e.prototype.field_to_slider_value=function(t){var e=(0,r.clamp)(t,this.min,this.max),i=this.min<0?e-this.min:e,o=this.max-this.min;return Math.round(i/o*this.slider_width)},e.prototype.bind_slider_event=function(){var t=this;if(this.slider_rail){this.slider_rail_left=this.slider_rail.getBoundingClientRect().left;var e=this.move_slider_handle.bind(this);document.addEventListener("mousemove",e),document.addEventListener("mouseup",(function i(){t.slider_rail_left=void 0,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",i)}))}},e.prototype.move_slider_handle=function(t){t.stopPropagation(),this.update_slider_and_field_value(t.clientX)},e.prototype.set_slider_handle_position=function(t){this.slider_rail&&(this.slider_rail_left=this.slider_rail.getBoundingClientRect().left,this.update_slider_and_field_value(t.clientX))},e.prototype.update_slider_and_field_value=function(t){var e,i;if(this.slider_rail_left){var o=(null===(i=null===(e=this.owner)||void 0===e?void 0:e.source_block)||void 0===i?void 0:i.get_workspace().get_scale())||1,n=(t-this.slider_rail_left)/o,s=(0,r.clamp)(n,0,this.slider_width),_=this.max-this.min,a=this.min+Math.round(s/this.slider_width*_);this.set_slider_value(s),this.owner&&(this.owner.set_html_input_value(a.toString()),this.owner.on_html_input_change())}},e.prototype.set_slider_value=function(t){this.slider_handle&&this.slider_track&&(this.slider_handle.style.left="".concat(t,"px"),this.slider_track.style.width="".concat(t,"px"))},e=o.__decorate([(0,n.injectable)()],e)}(i(71839).Controller);e.SliderController=_},35656:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Css=void 0;var o=i(98734),n=i(61455),r=i(98030),s=function(){function t(){this.style_sheet=void 0,this.current_cursor="",this.media_path="",this.Cursor={OPEN:"handopen",CLOSED:"handclosed",DELETE:"handdelete"}}return t.prototype.inject=function(t,e){if(!this.style_sheet){var i=".blocklyDraggable {}\n";t&&(i+=this.CONTENT),this.media_path=e.replace(/[\\\/]$/,""),i=i.replace(/<<<PATH>>>/g,this.media_path);var o=document.createElement("style");if(document.head)document.head.insertBefore(o,document.head.firstChild);else{var n=document.createElement("head");n.insertBefore(o,n.firstChild),document.appendChild(n)}var r=document.createTextNode(i);o.appendChild(r),this.style_sheet=o.sheet}},t.prototype.set_cursor=function(t){if(this.current_cursor!=t){this.current_cursor=t;for(var e="url('".concat(this.media_path,"/").concat(t,".cur), auto"),i=document.getElementsByClassName("blocklyToolboxDiv"),o=0;o<i.length;o++){var n=i[o];t==this.Cursor.DELETE?n.style.cursor=e:n.style.cursor=""}}},o.__decorate([(0,r.lazy_inject)(r.BINDING.css_content)],t.prototype,"CONTENT",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Css=s},11158:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.DraggedConnectionManager=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(75102),_=function(){function t(){this.top_block=void 0,this._workspace=void 0,this.local_connection=void 0,this.would_delete_block_=!1,this._available_connections=[],this.closest_connection=void 0,this.radius_connection=0}return t.prototype.would_delete_block=function(){return this.would_delete_block_},t.prototype.init=function(t){this.runtime_data.selected=t,this.top_block=t,this._workspace=t.get_workspace(),this._available_connections=this._init_available_connections(t)},t.prototype.dispose=function(){this.top_block=void 0,this._workspace=void 0,this._available_connections.length=0,this.closest_connection=void 0,this.local_connection=void 0},t.prototype.apply_connections=function(){if(this.closest_connection&&this.local_connection){if(this.local_connection.connect(this.closest_connection),this.top_block&&this.top_block.rendered){var t=this.local_connection.is_superior()?this.closest_connection:this.local_connection;this.block_animations.connection_ui_effect(t.get_source_block()),this.connection_effect()}this.remove_highlighting()}},t.prototype.connection_effect=function(){},t.prototype.disconnection_effect=function(){},t.prototype.update=function(t,e){var i=this.closest_connection,o=this.update_closest(t);o&&i&&i.unhighlight();var n=!!this.closest_connection&&e!=s.DeleteArea.DELETE_AREA_TOOLBOX;if(this.top_block){var r=!!e&&!this.top_block.get_parent()&&this.top_block.is_deletable();this.would_delete_block_=r&&!n}!this.would_delete_block_&&o&&this.closest_connection&&this.add_highlighting()},t.prototype.remove_highlighting=function(){this.closest_connection&&this.closest_connection.unhighlight()},t.prototype.add_highlighting=function(){this.closest_connection&&this.closest_connection.highlight()},t.prototype._init_available_connections=function(t){var e=t.get_connections(!1),i=t.last_connection_in_stack();return i&&i!=t.next_connection&&e.push(i),e.filter((function(t){return t.in_db}))},t.prototype.update_closest=function(t){var e=this.closest_connection;this.closest_connection=void 0,this.local_connection=void 0,this.radius_connection=this.theme.blink_params.SNAP_RADIUS;for(var i=0;i<this._available_connections.length;i++){var o=this._available_connections[i],n=o.closest(this.radius_connection,t);n.connection&&(this.closest_connection=n.connection,this.local_connection=o,this.radius_connection=n.radius)}return e!=this.closest_connection},o.__decorate([(0,r.lazy_inject)(r.BINDING.block_animations)],t.prototype,"block_animations",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.DraggedConnectionManager=_},46354:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Events=void 0;var o=i(98734),n=i(61455),r=i(9528),s=i(27807),_=i(75102),a=i(11214),c=function(){function t(){this.FIRE_QUEUE_=[],this.disabled_=0,this.group_="",this._record_undo=!0,this._is_undoing=!1,this.enable_filter=!1,this.listener_disabled=0}return t.prototype.set_disabled=function(t){this.disabled_=t},t.prototype.is_record_undo=function(){return this._record_undo},t.prototype.set_record_undo=function(t){this._record_undo=t},t.prototype.is_undoing=function(){return this._is_undoing},t.prototype.set_undoing=function(t){this._is_undoing=t},t.prototype.fire=function(t){var e=this;if(t&&this.is_enabled())if(t.is_record_undo()&&this.enable_filter)this.FIRE_QUEUE_.length||window.setTimeout((function(){e.fire_now()}),0),this.FIRE_QUEUE_.push(t);else{var i=this.workspace_db.get(t.get_workspace_id());i&&i.fire_change_listener(t)}},t.prototype.fire_now=function(){var t=this.filter(this.FIRE_QUEUE_,!0);this.FIRE_QUEUE_.length=0;for(var e=0;e<t.length;e++){var i=t[e],o=this.workspace_db.get(i.get_workspace_id());o&&o.fire_change_listener(i)}},t.prototype.filter=function(t,e){var i=t.slice();e||i.reverse();for(var o=[],n=new Map,r=0;r<i.length;r++){var s=i[r];if(!s.is_null()){var a="",c="";s.type===_.BlockEventType.CHANGE&&(a=s.element||"",c=s.get_name()||"");var l="".concat(s.type,"&&").concat(s.get_block_id(),"&&").concat(s.get_workspace_id(),"&&").concat(a,"&&").concat(c),d=n.get(l);if(d)switch(s.type){case _.BlockEventType.MOVE:if(d.index===r-1){var u=s.get_new_loc();d.event.update_new_loc(u),d.index=r}else n.set(l,{index:r,event:s}),o.push(s);break;case _.BlockEventType.CHANGE:var h=s;d.event.update_new_value(h.get_new_value());break;default:n.set(l,{index:r,event:s}),o.push(s)}else n.set(l,{index:r,event:s}),o.push(s)}}return i=o.filter((function(t){return!t.is_null()})),e||i.reverse(),i},t.prototype.clear_pending_undo=function(){for(var t=0;t<this.FIRE_QUEUE_.length;t++){this.FIRE_QUEUE_[t].set_record_undo(!1)}},t.prototype.disable=function(){this.disabled_++},t.prototype.enable=function(){this.disabled_--},t.prototype.is_enabled=function(){return 0==this.disabled_},t.prototype.get_group=function(){return this.group_},t.prototype.set_group=function(t){var e=this.group_;if(this.group_="boolean"==typeof t?t?(0,a.gen_uid)():"":t,e&&e!==this.group_&&this.is_enabled()){var i=this.group_event_factory({type:_.GroupEventType.GroupEnd,group:e});this.fire(i)}if(this.group_&&e!==this.group_&&this.is_enabled()){var o=this.group_event_factory({type:_.GroupEventType.GroupStart,group:this.group_});this.fire(o)}},t.prototype.disable_orphans=function(t){if(t.type==_.BlockEventType.MOVE||t.type==_.BlockEventType.CREATE){this.disable();var e=this.workspace_db.get(t.get_workspace_id());if(void 0==e)return console.error("Trying to enable/disable a block when the workspace disposed."),void this.enable();var i=e.get_block_by_id(t.get_block_id());if(void 0!=i){var o=i.get_parent();if(o&&!o.disabled)for(var n=i.get_descendants(),r=0;r<n.length;r++){n[r].set_disabled(!1)}else if((i.output_connection||i.previous_connection)&&!e.is_dragging())do{i.set_disabled(!0),i=i.get_next_block()}while(i)}this.enable()}},t.prototype.bind_event=function(t,e,i,o){var n=this,r=function(t){i?o.call(i,t):o(t)};t.addEventListener(e,r,!1);var s={original:{target:t,name:e,listener:r},additional:[]};if(e in this.touch_manager.TOUCH_MAP)for(var _=function(t){if("touchstart"===t.type&&t.touches.length>=2||"touchend"===t.type&&t.touches.length>=1)return t.preventDefault(),void t.stopPropagation();if(1==t.changedTouches.length){var e=t.changedTouches[0];t.clientX=e.clientX,t.clientY=e.clientY}r(t),s.original&&n.unbind_original(s)},a=0;a<this.touch_manager.TOUCH_MAP[e].length;a++){var c=this.touch_manager.TOUCH_MAP[e][a];t.addEventListener(c,_,!1),s.additional.push({target:t,name:c,listener:_})}return s},t.prototype.unbind_event_by_data=function(t){var e=t.target,i=t.name,o=t.listener;return e.removeEventListener(i,o,!1),o},t.prototype.unbind_original=function(t){var e;return t.original&&(e=this.unbind_event_by_data(t.original),t.original=void 0),e},t.prototype.unbind_event=function(t){for(var e=this.unbind_original(t);t.additional.length>0;){var i=t.additional.pop();e=this.unbind_event_by_data(i)}return e},t.prototype.bind_event_with_checks=function(t,e,i,o,n,r){var s=this,_=function(t){if(t.target instanceof Element)for(var e=!n,r=s.touch_manager.split_event_by_touches(t),_=0;_<r.length;_++){var a=r[_];if(2===r.length)return;e&&!s.touch_manager.should_handle_event(a)||(s.touch_manager.set_client_from_touch(a),i?o.call(i,a):o(a))}};t.addEventListener(e,_,!1);var a={original:{target:t,name:e,listener:_},additional:[]};if(e in this.touch_manager.TOUCH_MAP)for(var c=function(o){if(_(o),a.original&&s.unbind_original(a),!r){if(0==o.cancelable)return;if(!e&&!i)return;if("mouseup"===e&&!i&&t===document)return;o.preventDefault()}},l=0;l<this.touch_manager.TOUCH_MAP[e].length;l++){var d=this.touch_manager.TOUCH_MAP[e][l];t.addEventListener(d,c,!1),a.additional.push({target:t,name:d,listener:c})}return a},t.prototype.enable_listener=function(){this.listener_disabled++},t.prototype.disable_listener=function(){this.listener_disabled--},t.prototype.is_listener_enabled=function(){return 0===this.listener_disabled},o.__decorate([(0,s.lazy_inject)(r.BINDING.touch_manager)],t.prototype,"touch_manager",void 0),o.__decorate([(0,s.lazy_inject)(r.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),o.__decorate([(0,s.lazy_inject)(r.BINDING.GroupEvent)],t.prototype,"group_event_factory",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Events=c},35693:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Extensions=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(75102),_=i(53494),a=i(61972),c=function(){function t(){this.extensions={},this.mutators={},this.MUTATOR_PROPERTIES_=["domToMutation","mutationToDom"]}return t.prototype.register=function(t,e){if((0,_.string_is_empty_or_whitespace)(t))throw new Error('Error when registering extension "'.concat(t,'": invalid extension name. '));this.extensions[t]?console.error('Error when registering extension "'.concat(t,'": extension existed.')):this.extensions[t]=e},t.prototype.register_mixin=function(t,e){var i=this.check_existed_mutator_property(e);if(i)throw Error('Error when registering extension "'.concat(t,'": Trying to register mixin with mutator property: ').concat(i,". "));this.register(t,(function(){this.mixin(e)}))},t.prototype.unregister=function(t){t in this.extensions&&delete this.extensions[t]},t.prototype.register_mutator=function(t,e,i){for(var o=0;o<this.MUTATOR_PROPERTIES_.length;o++){var n=this.MUTATOR_PROPERTIES_[o];if(!e.hasOwnProperty(n))throw new Error('Error when registering mutator "'.concat(t,'": missing required property "').concat(n,'". '));if(!(0,a.is_func)(e[n]))throw new Error('Error when registering mutator "'.concat(t,'": required property "').concat(n,'" must be a function. '))}this.mutators[t]=function(){this.mixin(e),i&&i.apply(this)}},t.prototype.unregister_mutator=function(t){t in this.mutators&&delete this.mutators[t]},t.prototype.apply=function(t,e){var i='Error when applying extension "'.concat(t,'": '),o=this.extensions[t];if(!(0,a.is_func)(o))throw new Error("".concat(i,"extension not found."));var n=this.get_mutator_properties(e);if(o.apply(e),!this.mutator_properties_match(n,e))throw new Error("".concat(i,"mutation properties changed when applying a non-mutator extension."))},t.prototype.apply_mutator=function(t,e){var i='Error when applying mutator "'.concat(t,'": '),o=this.mutators[t];if(!(0,a.is_func)(o))throw new Error("".concat(i,"mutator not found."));var n=this.check_existed_mutator_property(e);if(n)throw Error("".concat(i,"mutation property ").concat(n," already existed on block ").concat(e));o.apply(e);var r=this.check_absent_mutator_property(e);if(r)throw new Error("".concat(i,"applied a mutator didn't add \"").concat(r,'"'))},t.prototype.check_existed_mutator_property=function(t){for(var e=0;e<this.MUTATOR_PROPERTIES_.length;e++){var i=this.MUTATOR_PROPERTIES_[e];if(t.hasOwnProperty(i))return i}},t.prototype.check_absent_mutator_property=function(t){for(var e=0;e<this.MUTATOR_PROPERTIES_.length;e++){var i=this.MUTATOR_PROPERTIES_[e];if(!t.hasOwnProperty(i))return i}},t.prototype.get_mutator_properties=function(t){for(var e=[],i=0;i<this.MUTATOR_PROPERTIES_.length;i++)e.push(t[this.MUTATOR_PROPERTIES_[i]]);return e},t.prototype.mutator_properties_match=function(t,e){var i=this.get_mutator_properties(e);if(i.length!=t.length)return!1;for(var o=0;o<i.length;o++)if(t[o]!=i[o])return!1;return!0},t.prototype.build_tooltip_for_dropdown=function(t,e){var i=this,o=[];document&&this.utils.run_after_page_load((function(){for(var t in e)i.utils.check_message_references(e[t])}));var n=this;return function(){var i=this;this.type&&-1===o.indexOf(this.type)&&(n.check_dropdown_options_in_table(this,t,e),o.push(this.type)),this.set_tooltip((function(){var r=i.get_field_value(t),s=r?e[r]:void 0;if(void 0==s){if(-1===o.indexOf(i.type)){var _="No tooltip mapping for value ".concat(r," of field ").concat(t);void 0!=i.type&&(_+=" of block type ".concat(i.type)),console.warn("".concat(_,"."))}}else s=n.utils.replace_message_references(s);return s||""}))}},t.prototype.check_dropdown_options_in_table=function(t,e,i){var o=t.get_field(e);if(o&&(0,a.is_func)(o.is_dynamic)&&!o.is_dynamic())for(var n=o.get_options(),r=0;r<n.length;++r){var _=n[r][s.OptionTypes.VALUE];void 0!=_&&void 0!=i[_]||console.warn("No tooltip mapping for value ".concat(_," of field ").concat(e," of block type ").concat(t.type))}},o.__decorate([(0,r.lazy_inject)(r.BINDING.utils)],t.prototype,"utils",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Extensions=c},82922:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.InsertionMarkerManager=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(75102),_=function(){function t(){var t=this;this.top_block=void 0,this._workspace=void 0,this.last_on_stack=void 0,this.last_marker=void 0,this.closest_connection=void 0,this.first_marker=void 0,this.local_connection=void 0,this.would_delete_block_=!1,this.marker_connection=void 0,this.highlighting_block=!1,this.highlighted_block=void 0,this._available_connections=[],this.pre_connect_block=void 0,this.type=void 0,this.is_surrounding_c=void 0,this.set_pre_connect_block=function(e){t.pre_connect_block=null===e||void 0===e?void 0:e.pre_connect_block,t.type=null===e||void 0===e?void 0:e.type,t.is_surrounding_c=null===e||void 0===e?void 0:e.is_surrounding_c}}return t.prototype.init=function(t){this.runtime_data.selected=t,this.top_block=t,this._workspace=t.get_workspace(),this.top_block.output_connection||(this.first_marker=this.create_marker_block(this.top_block)),this._available_connections=this._init_available_connections(t)},t.prototype.create_marker_block=function(t){var e,i=t.type;this.events.disable();try{if(void 0==this._workspace)throw new ReferenceError("Trying to create marker before init the insertion marker manager.");(e=this.block_factory({prototype_name:i,workspace:this._workspace,is_insertion_marker:!0})).set_insertion_marker(!0),0===e.inputList.length&&e.appendDummyInput(),e.init_svg()}finally{this.events.enable()}return e},t.prototype.would_delete_block=function(){return this.would_delete_block_},t.prototype._init_available_connections=function(t){var e=t.get_connections(!1),i=t.last_connection_in_stack();return i&&(e.push(i),this.last_on_stack=i,this.last_marker=this.create_marker_block(i.get_source_block())),e.filter((function(t){return t.in_db}))},t.prototype.get_start_radius=function(){return this.closest_connection&&this.local_connection?this.theme.blink_params.CONNECTING_SNAP_RADIUS:this.theme.blink_params.SNAP_RADIUS},t.prototype._get_candidate=function(t){for(var e=this.get_start_radius(),i=void 0,o=void 0,n=0;n<this._available_connections.length;n++){var r=this._available_connections[n],s=r.closest(e,t);this.pre_connect_block?s.connection&&s.connection.source_block.id===this.pre_connect_block.id&&(i=s.connection,o=r,e=s.radius):s.connection&&(i=s.connection,o=r,e=s.radius)}return{closest:i,local:o,radius:e}},t.prototype.should_delete=function(t,e){if(void 0==this.top_block)throw new ReferenceError("Deleting block not found.");var i=t&&!!t.closest&&e!==s.DeleteArea.DELETE_AREA_TOOLBOX;return!!e&&!this.top_block.get_parent()&&this.top_block.is_deletable()&&!i},t.prototype.should_update_previews=function(t,e){var i=t.local,o=t.closest,n=t.radius;if(!i||!o)return!(!this.local_connection||!this.closest_connection);if(i.type===s.CONNECTION_TYPE.OUTPUT_VALUE)return!0;if(this.local_connection&&this.closest_connection){if(this.closest_connection==o)return!1;var r=this.local_connection.get_xy()[0]+e[0]-this.closest_connection.get_xy()[0],_=this.local_connection.get_xy()[1]+e[1]-this.closest_connection.get_xy()[1],a=Math.sqrt(r*r+_*_);return!(o&&n>a-this.theme.blink_params.CURRENT_CONNECTION_PREFERENCE)}return!this.local_connection&&!this.closest_connection||(console.error("Only one of localConnection_ and closestConnection_ was set."),console.error("Returning true from shouldUpdatePreviews, but it's not clear why."),!0)},t.prototype.unhighlight_block=function(){var t=this.closest_connection,e=this.highlighted_block;if(void 0==t||void 0==e)throw new ReferenceError("Connection not found for unhighlight.");e.highlight_for_replacement(!1),this.highlighted_block=void 0,this.highlighting_block=!1},t.prototype.disconnect_marker=function(){var t,e;if(this.marker_connection){var i=this.marker_connection,o=i.get_source_block(),n=o.next_connection,r=o.previous_connection;if(i!=n||r&&r.get_targe_connection())if(i.type==s.CONNECTION_TYPE.NEXT_STATEMENT&&i!=n){var _=i.get_targe_connection();if(void 0==_)throw new ReferenceError("Connection not found when disconnect marker.");_.get_source_block().unplug(!1);var a=r?r.get_targe_connection():void 0;o.unplug(!0),a&&a.connect(_)}else o.unplug(!0);else{var c=i.targetBlock();if(void 0==c)throw new ReferenceError("Target block not found when disconnect marger.");c.unplug(!1)}if(i.get_targe_connection())throw new Error("markerConnection_ still connected at the end of disconnectInsertionMarker");this.marker_connection=void 0;var l=o.get_svg_root();if(void 0!=l){var d=void 0,u=null===(t=this._workspace)||void 0===t?void 0:t.get_options().connection_effect;u&&u.enable_fire_events&&(this.events.enable(),d=this.ui_event_factory({type:s.UIEventType.INSERTION_MARKER_SHOW,workspace_id:(null===(e=this._workspace)||void 0===e?void 0:e.id)||"",old_value:!0,new_value:!1}),this.events.fire(d),this.events.disable()),l.setAttribute("visibility","hidden")}}},t.prototype.hide_preview=function(){this.highlighting_block?this.unhighlight_block():this.marker_connection&&this.disconnect_marker()},t.prototype.maybe_hide_preview=function(t){t.closest||this.hide_preview();var e=this.closest_connection&&this.local_connection,i=this.closest_connection!=t.closest,o=this.local_connection!=t.local;e&&(i||o||this.would_delete_block_)&&this.hide_preview(),this.marker_connection=void 0,this.closest_connection=void 0,this.local_connection=void 0},t.prototype.should_replace=function(){var t=this.closest_connection,e=this.local_connection;if(void 0==e)throw new ReferenceError("Local connection not found when trying replace/insert block.");if(void 0==this.top_block)throw new ReferenceError("Block not found when trying replace/insert block.");return e.type==s.CONNECTION_TYPE.OUTPUT_VALUE||e!=e.get_source_block().get_first_statement_connection()&&!(this.top_block.next_connection||e.type!=s.CONNECTION_TYPE.PREVIOUS_STATEMENT||void 0==t||!t.is_connected())},t.prototype.highlight_block=function(){var t=this.closest_connection,e=this.local_connection;if(void 0!=t&&void 0!=e){var i=t.targetBlock();i&&(this.highlighted_block=i,i.highlight_for_replacement(!0)),this.highlighting_block=!0}},t.prototype.connect_marker=function(){var t,e,i,o,n=this.local_connection,r=this.closest_connection;if(void 0!=r){var _=this.last_on_stack&&n==this.last_on_stack?this.last_marker:this.first_marker;if(void 0!=_&&void 0!=n){var a=_.get_matching_connection(n.get_source_block(),n);if(void 0!=a){if(a==this.marker_connection)throw new Error("Made it to connect_marker even though the marker isn't changing");if(!(this.pre_connect_block&&r.source_block.id!==this.pre_connect_block.id||this.type&&this.type!==a.type&&[s.CONNECTION_TYPE.NEXT_STATEMENT,s.CONNECTION_TYPE.PREVIOUS_STATEMENT].includes(this.type)||this.is_surrounding_c&&r!==(null===(t=this.pre_connect_block)||void 0===t?void 0:t.get_first_statement_connection())||r===(null===(e=this.pre_connect_block)||void 0===e?void 0:e.get_first_statement_connection())&&!this.is_surrounding_c)){_.render();var c=_.get_svg_root();if(void 0!=c){var l=void 0,d=null===(i=this._workspace)||void 0===i?void 0:i.get_options().connection_effect;d&&d.enable_fire_events&&(this.events.enable(),l=this.ui_event_factory({type:s.UIEventType.INSERTION_MARKER_SHOW,workspace_id:(null===(o=this._workspace)||void 0===o?void 0:o.id)||"",old_value:!1,new_value:!0}),this.events.fire(l),this.events.disable()),c.setAttribute("visibility","visible")}_.position_new_block(_,a,r),a.connect(r),this.marker_connection=a}}}}},t.prototype.show_preview=function(){this.should_replace()?this.highlight_block():this.connect_marker()},t.prototype.maybe_show_preview=function(t){if(!this.would_delete_block_){var e=t.closest,i=t.local;e&&(e==this.closest_connection||e.source_block.is_insertion_marker()||(this.closest_connection=e,this.local_connection=i,this.show_preview()))}},t.prototype.update=function(t,e){var i=this._get_candidate(t);this.would_delete_block_=this.should_delete(i,e),(this.would_delete_block_||this.should_update_previews(i,t))&&(this.events.disable(),this.maybe_hide_preview(i),this.maybe_show_preview(i),this.events.enable())},t.prototype.apply_connections=function(){var t,e;if(void 0==this.top_block)throw new ReferenceError("Top block not found when applying connections.");if(this.highlighting_block&&this.highlighted_block?this.closest_connection=(null===(t=this.highlighted_block.output_connection)||void 0===t?void 0:t.target_connection)||(null===(e=this.highlighted_block.previous_connection)||void 0===e?void 0:e.target_connection):this.marker_connection&&(this.closest_connection=this.marker_connection.target_connection),this.closest_connection){if(this.events.disable(),this.hide_preview(),this.events.enable(),this.local_connection&&this.local_connection.connect(this.closest_connection),this.top_block.is_rendered()){if(this.local_connection){var i=this.local_connection.is_superior()?this.closest_connection:this.local_connection;this.block_animations.connection_ui_effect(i.get_source_block())}this.top_block.get_root_block().bring_to_front()}return!0}return!1},t.prototype.dispose=function(){this.top_block=void 0,this._workspace=void 0,this._available_connections.length=0,this.closest_connection=void 0,this.local_connection=void 0,this.pre_connect_block=void 0,this.type=void 0,this.is_surrounding_c=void 0,this.events.disable();try{this.first_marker&&(this.first_marker.dispose(),this.first_marker=void 0),this.last_marker&&(this.last_marker.dispose(),this.last_marker=void 0)}finally{this.events.enable()}this.highlighted_block=void 0},o.__decorate([(0,r.lazy_inject)(r.BINDING.block_animations)],t.prototype,"block_animations",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.BlockSvg)],t.prototype,"block_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.InsertionMarkerManager=_},27781:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Json=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=i(75102),a=i(56905),c=i(11214),l=i(61972),d=i(25461),u=i(34160),h=function(){function t(){}return t.prototype.comment_to_json=function(t){var e=t.get_parent_block(),i=t.get_bubble_size(),o=t.get_relative_position();return{id:t.id,parent_id:void 0===e?null:e.id,text:t.get_text(),pinned:t.is_expanded(),size:[i.width,i.height],location:[o[0],o[1]],auto_layout:t.is_auto_layout(),color_theme:t.get_color_theme()}},t.prototype.comment_dom_to_json=function(t,e,i){if("comment"!==t.tagName.toLowerCase())throw Error("Trying to convert a non-comment dom into comment json.");var o={id:e||(t.getAttribute("id")||(0,c.gen_uid)()),parent_id:i||null,text:t.textContent||"",pinned:"true"===t.getAttribute("pinned"),auto_layout:"true"===t.getAttribute("auto_layout"),size:null,location:null,color_theme:null},n=parseInt(t.getAttribute("w")||"",10),r=parseInt(t.getAttribute("h")||"",10);isNaN(n)||isNaN(r)||(o.size=[n,r]);var s=parseFloat(t.getAttribute("relativeleft_")||""),_=parseFloat(t.getAttribute("relativetop_")||"");isNaN(s)||isNaN(_)||(o.location=[s,_]);var a=t.getAttribute("color_theme");return(0,l.is_comment_theme)(a)&&(o.color_theme=a),o},t.prototype.merge_workspace_data=function(t,e){function i(t,e){Object.keys(e).forEach((function(i){t[i]=e[i]}))}i(t.blocks,e.blocks),i(t.connections,e.connections),i(t.comments,e.comments)},t.prototype.block_to_json=function(t){var e=this,i={blocks:{},connections:{},comments:{}};i.connections[t.id]={};var o={},n={},r={},s={};t.inputList.map((function(a){var d,u;if(a.fieldRow.forEach((function(t){var e=void 0;if(t.editable&&"string"===typeof t.name)if((0,l.is_field_number)(t)){e=t.allow_text&&!(0,c.is_valid_number)(t.get_value())?"TEXT":t.name,o[e]=t.get_value(),n[e]={min:t.min_,max:t.max_,precision:t.precision_,mod:t.mod_||null};var i=t.get_controller_option();i&&(void 0===r[t.name]&&(r[t.name]={}),r[e].controller_type=i.type,i.type===_.ControllerType.SLIDER?(r[e].left_text=i.left_text,r[e].right_text=i.right_text):i.type===_.ControllerType.COLOR_PICKER&&(r[e].color_format=i.color_format,r[e].line=i.line))}else(0,l.is_field_default_value)(t)?(o[t.name]=t.get_value(),void 0===r[t.name]&&(r[t.name]={}),r[t.name].has_been_edited=t.get_has_been_edited()):o[t.name]=t.get_value();var s=t.is_uneditable(),a=t.is_highlight();"string"===typeof t.name&&(s||a)&&(e=e||t.name,void 0===r[e]&&(r[e]={}),s&&(r[e].uneditable=s),a&&(r[e].highlight=a))})),a.name){var h=null===(d=a.connection)||void 0===d?void 0:d.get_shadow_string();s[a.name]=h||""}var p=null===(u=a.connection)||void 0===u?void 0:u.targetBlock();if(p){var g=e.block_to_json(p);e.merge_workspace_data(i,g),i.connections[t.id][p.id]={type:"input",input_type:a.type===_.InputType.VALUE?"value":"statement",input_name:a.name}}})),t.comment&&(i.comments[t.comment.id]=this.comment_to_json(t.comment));var a=t.get_location(),d=t.mutation_to_string();i.blocks[t.id]={type:t.type,id:t.id,comment:void 0===t.comment?null:t.comment.id,is_shadow:t.is_shadow(),collapsed:t.is_collapsed(),disabled:t.disabled,deletable:t.deletable_,movable:t.movable_,editable:t.editable_,visible:t.visibility_,location:[a[0],a[1]],shadows:s,fields:o,field_constraints:n,field_extra_attr:r,mutation:d,is_output:!!t.output_connection,parent_id:void 0===t.parent_block?null:t.parent_block.id};var u=t.get_next_block();if(u){var h=this.block_to_json(u);this.merge_workspace_data(i,h),i.connections[t.id][u.id]={type:"next"}}return i},t.prototype.workspace_to_json=function(t){var e=this,i={blocks:{},connections:{},comments:{}};return t.get_top_blocks(!1).forEach((function(t){var o=e.block_to_json(t);e.merge_workspace_data(i,o)})),t.get_top_comments(!1).forEach((function(t){i.comments[t.id]=e.comment_to_json(t)})),i},t.prototype.json_to_block_headless=function(t,e,i){void 0===i&&(i=!0);var o=e.new_block(t.type,t.id);return this.parse_block_data(t,o,i)},t.prototype.parse_block_data=function(t,e,i){void 0===i&&(i=!0),null!==t.is_shadow&&e.set_shadow(t.is_shadow),null!==t.collapsed&&e.set_collapsed(t.collapsed),null!==t.disabled&&e.set_disabled(t.disabled),e.set_deletable(t.deletable),e.set_movable(t.movable),e.set_editable(t.editable);var o=(0,u.parse_visibility)(t.visible);return o&&e.set_visibility(o),t.type!==e.type&&console.warn("Trying to set invalid block data to block: ",e),e.string_to_mutation(t.mutation),e.inputList.forEach((function(e){var i;e.fieldRow.forEach((function(e){if(void 0!==e.name){var i=e.name;if(e.editable&&(0,l.is_field_number)(e)){void 0===t.fields.NUM&&void 0!==t.fields.TEXT&&(i="TEXT",e.set_allow_text(!0));var o,n=t.field_constraints[i];void 0!==n&&(e.set_constraints(n.min,n.max,n.precision),null!==n.mod&&(e.mod_=n.mod)),void 0!==(o=t.field_extra_attr&&t.field_extra_attr[i])&&void 0!==o.controller_type&&("SLIDER"===o.controller_type?e.set_controller_option({type:_.ControllerType.SLIDER,left_text:o.left_text||"",right_text:o.right_text||""}):o.controller_type===_.ControllerType.COLOR_PICKER?e.set_controller_option({type:_.ControllerType.COLOR_PICKER,color_format:o.color_format,line:o.line}):e.set_controller_option({type:_.ControllerType.ANGLE_SCALE}))}if(e.editable&&(0,l.is_field_default_value)(e))if(void 0!==(o=t.field_extra_attr&&t.field_extra_attr[i])&&void 0!==o.has_been_edited){var r=o.has_been_edited;e.set_has_been_edited(r)}var s=t.fields[i];if(e.editable&&void 0!==s)void 0!==e.call_validator(s)&&"FieldImage"!==e.field_type&&e.set_value(s);var a=t.field_extra_attr&&t.field_extra_attr[i];void 0!==a&&(void 0!==a.uneditable&&e.set_uneditable(a.uneditable),void 0!==a.highlight&&e.set_highlight(a.highlight))}})),e.connection&&t.shadows[e.name]&&((null===(i=e.connection.targetBlock())||void 0===i?void 0:i.is_shadow())&&e.connection.remove_shadow(),e.connection.set_shadow_from_string(t.shadows[e.name]))})),t.location&&i&&e.move_by(r.vec2.fromValues(t.location[0],t.location[1])),e},t.prototype.comment_json_to_dom=function(t){var e=(0,d.create_dom)("comment",void 0,t.text);return null!==t.color_theme&&e.setAttribute("pinned","".concat(t.pinned||!1)),t.size&&(e.setAttribute("h","".concat(t.size[1])),e.setAttribute("w","".concat(t.size[0]))),t.location&&(e.setAttribute("relativeleft_","".concat(t.location[0])),e.setAttribute("relativetop_","".concat(t.location[1]))),null!==t.auto_layout&&e.setAttribute("auto_layout","".concat(t.auto_layout)),t.color_theme&&e.setAttribute("color_theme","".concat(t.color_theme)),e.setAttribute("id",t.id),e},t.prototype.json_to_comment_headless=function(t,e){var i;if(t.parent_id){var o=e.get_block_by_id(t.parent_id);if(!o)throw Error("Comment parent block not found");o.set_comment_text("",t.id),(0,a.assert)(o.comment,"Create block comment failed."),i=o.comment}else i=e.new_workspace_comment(void 0,t.id);null!==t.text&&i.set_text(t.text),null!==t.pinned&&i.set_expanded(t.pinned),t.size&&i.set_bubble_size(t.size[0],t.size[1]),t.location&&(i.set_relative_position(r.vec2.fromValues(t.location[0],t.location[1])),i.get_parent_block()||i.move_by(r.vec2.fromValues(t.location[0],t.location[1]))),null!==t.auto_layout&&i.set_auto_layout(t.auto_layout);var n=t.color_theme;return(0,l.is_comment_theme)(n)&&i.set_color_theme(n,!0),i},t.prototype.json_to_workspace_headless=function(t,e){var i=this,o=t.blocks,n=t.connections,r=t.comments,s=[];if(o&&Object.keys(o).forEach((function(t){i.json_to_block_headless(o[t],e,!1),s.push(t)})),n){var _=[];Object.keys(n).forEach((function(t){Object.keys(n[t]).forEach((function(r){var s=n[t][r],a=e.get_block_by_id(t),c=e.get_block_by_id(r);if(a&&c){var l,d;if("next"===s.type)l=a.next_connection,d=c.previous_connection;else{var u=a.get_input(s.input_name);l=u&&u.connection,d=c.output_connection||c.previous_connection}if(!l||!d)return c.is_shadow()?(c.dispose(),void console.error("Connected connection not found. Shadow block disposed.")):void console.error("Connected connection not found.");d.context?_.push({inferior:d,superior:l}):i.try_connect(d,l,o)}else console.error("Connected block not found. ")}))})),_.forEach((function(t){i.try_connect(t.inferior,t.superior,o)})),s.forEach((function(t){var i;null===(i=e.get_block_by_id(t))||void 0===i||i.respawn_all_shadows()}))}return r&&Object.keys(r).forEach((function(t){i.json_to_comment_headless(r[t],e),s.push(t)})),s},t.prototype.try_connect=function(t,e,i){if(e.connect(t,!0))i&&t.source_block.is_shadow()&&this.parse_block_data(i[t.source_block.id],t.source_block,!1);else{if(this.runtime_data.is_pasting())t.source_block.dispose(!1,!1);else for(var o=t.source_block.get_descendants(!1),n=o.length-1;n>=0;n--)o[n].init_svg(),o[n].update_collapsed(),o[n].render(!1);e.respawn_shadow()}},t.prototype.json_to_workspace=function(t,e){var i=this.events.get_group();i||this.events.set_group(!0);var o=e.is_resizes_enabled();o&&e.set_resizes_enabled(!1),this.utils.start_text_cache();var n=[];try{this.events.disable(),n=this.json_to_workspace_headless(t,e),e.rendered&&this.render_blocks_and_comments(e,n,t.blocks||{})}catch(r){throw new Error("Something wrong with json data. Unable to convert it to workspace.")}finally{this.events.enable(),i||this.events.set_group(!1),o&&e.set_resizes_enabled(!0),this.utils.stop_text_cache()}return n},t.prototype.render_blocks_and_comments=function(t,e,i){var o=this;t.get_top_blocks(!1).forEach((function(t){if(!(e.indexOf(t.id)<0)){o.events.disable();try{t.set_connections_hidden(!0);for(var n=t.get_descendants(!1),s=n.length-1;s>=0;s--)n[s].init_svg();for(s=n.length-1;s>=0;s--)n[s].update_collapsed(),n[s].render(!1);for(s=n.length-1;s>=0;s--){var _=n[s];_.comment&&_.comment.init_svg()}var a=i[t.id];a.location&&t.move_by(r.vec2.fromValues(a.location[0],a.location[1])),window.setTimeout((function(){void 0!=t&&void 0!=t.get_workspace()&&t.set_connections_hidden(!1)}),1)}finally{t.update_disabled(),o.events.enable()}o.events.is_enabled()&&o.events.fire(o.create_event_factory({block:t}))}})),t.get_top_comments(!1).forEach((function(t){e.indexOf(t.id)<0||t.init_svg()}))},t.prototype.reset_element_ids=function(t){var e=JSON.stringify(t);function i(t,e,i){return t.replace(new RegExp(function(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}(e),"g"),i)}return Object.keys(t.blocks).forEach((function(t){e=i(e,t,(0,c.gen_uid)())})),Object.keys(t.comments).forEach((function(t){e=i(e,t,(0,c.gen_uid)())})),JSON.parse(e)},t.prototype.get_block_data_by_id=function(t,e){var i=function(t,e){o.blocks[e]=t.blocks[e],o.connections[e]=t.connections[e];var i=t.blocks[e].comment;i&&(o.comments[i]=t.comments[i])},o={blocks:{},connections:{},comments:{}},n=[];if(function t(e,i){var o=i[e];if(void 0!==o&&(n.push(e),Object.keys(o).length))for(var r in o)t(r,i)}(e,t.connections),n.length){for(var r=0,s=n;r<s.length;r++){i(t,s[r])}return o}},t.prototype.workspace_dom_to_json=function(t){var e,i={blocks:{},connections:{},comments:{}},o=new Set;Array.from(t.querySelectorAll("block")).forEach((function(t){var e=t.getAttribute("id");e&&o.add(e)}));for(var n=t.childNodes.length,r=0;r<n;r++)if(t.childNodes[r].nodeType!==_.NodeType.TEXT){var s=t.childNodes[r],a=s.tagName.toLowerCase();if("block"===a){var l=this.block_dom_to_json(s,void 0,o);this.merge_workspace_data(i,l)}else if("comment"===a){var d=s.getAttribute("id")||(0,c.gen_uid)(),u=this.comment_dom_to_json(s,d);l={blocks:{},connections:{},comments:(e={},e[d]=u,e)};this.merge_workspace_data(i,l)}else console.error("".concat(a," cannot be a top-level element."))}return i},t.prototype.block_dom_to_json=function(t,e,i){void 0===i&&(i=new Set);var n={blocks:{},connections:{},comments:{}},r=t.nodeName.toLowerCase(),s=t.getAttribute("id")||"";n.connections[s]={};for(var a=t.getAttribute("x")||"0",l=t.getAttribute("y")||"0",d=null,h="",p={},g={},f={},v={},m=t.childNodes.length,b=0;b<m;b++)if(t.childNodes[b].nodeType!==_.NodeType.TEXT){var y=t.childNodes[b],E=y.tagName.toLowerCase();if("field"!==E)if("comment"!==E)if("mutation"!==E)if("value"!==E)if("statement"!==E)if("next"!==E);else{if("true"===y.getAttribute("last_next_in_stack"))continue;for(k=0;k<y.childNodes.length;k++){if(y.childNodes[k].nodeType!==_.NodeType.TEXT)if("block"===(A=(I=y.childNodes[k]).tagName.toLowerCase())){T=I.getAttribute("id")||"";n.connections[s][T]={type:"next"};x=this.block_dom_to_json(I,s,i);this.merge_workspace_data(n,x)}}}else for(var k=0;k<y.childNodes.length;k++){if(y.childNodes[k].nodeType!==_.NodeType.TEXT)if(p[w=y.getAttribute("name")||""]="","block"===(A=(I=y.childNodes[k]).tagName.toLowerCase())){var T=I.getAttribute("id")||"";n.connections[s][T]={type:"input",input_type:"statement",input_name:w};x=this.block_dom_to_json(I,s,i);this.merge_workspace_data(n,x)}}else{for(var w=y.getAttribute("name")||"",O=void 0,N=void 0,k=0;k<y.childNodes.length;k++)if(y.childNodes[k].nodeType!==_.NodeType.TEXT){var I,A;if("shadow"===(A=(I=y.childNodes[k]).tagName.toLowerCase())||"empty"===A){var C=I.getAttribute("id");C&&i.has(C)&&I.setAttribute("id",this.utils.gen_uid()),p[w]=this.utils.dom_to_string(I),O=I}"block"===A&&(N=I)}if(N){var S=N.getAttribute("id")||"";n.connections[s][S]={type:"input",input_type:"value",input_name:w};var x=this.block_dom_to_json(N,s,i);this.merge_workspace_data(n,x)}else if(O){S=O.getAttribute("id")||"";n.connections[s][S]={type:"input",input_type:"value",input_name:w};var x=this.block_dom_to_json(O,s,i);this.merge_workspace_data(n,x)}}else h=this.utils.dom_to_string(y);else{d=y.getAttribute("id")||(0,c.gen_uid)();var R=this.comment_dom_to_json(y,d,s);n.comments[d]=R}else{var L=y.getAttribute("name")||"";g[L]=y.textContent||"";var D=y.getAttribute("constraints");null!==D&&(f[L]=(0,u.parse_constraints)(D));var M=y.getAttribute("has_been_edited"),P=y.getAttribute("uneditable"),B=y.getAttribute("highlight");null===M&&null===P&&null===B||(v[L]=o.__assign(o.__assign({has_been_edited:"true"===M},"true"===P?{uneditable:!0}:{}),"true"===B?{highlight:!0}:{}))}}return n.blocks[s]={type:t.getAttribute("type")||"",id:s,is_shadow:"block"!==r,collapsed:"true"===t.getAttribute("collapsed"),disabled:"true"===t.getAttribute("disabled"),deletable:"false"!==t.getAttribute("deletable"),movable:"false"!==t.getAttribute("movable"),editable:"false"!==t.getAttribute("editable")&&"empty"!==r,visible:t.getAttribute("visible")||"",location:[parseInt(a),parseInt(l)],shadows:p,fields:g,field_constraints:f,field_extra_attr:v,comment:d,mutation:h,parent_id:e||null,is_output:null},n},o.__decorate([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Json=h},4418:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Registry=void 0;var o=i(98734),n=i(61455),r=function(){function t(){this.field_map={}}return t.prototype.register=function(t,e){if(!t)throw new Error('Invalid field type "'.concat(t,'"'));this.field_map[t]=e},t.prototype.from_json=function(t){var e=t.type;if(!e||!this.field_map[e])throw new Error('Custom field type "'.concat(e,'" not found'));return new this.field_map[e](t)},t}(),s=function(){function t(){this.field=new r}return t=o.__decorate([(0,n.injectable)()],t)}();e.Registry=s},61880:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.RuntimeData=void 0;var o=i(98734),n=i(61455),r=o.__importStar(i(4097)),s=i(98030),_=i(25461),a=function(){function t(){var t=this;this.selected=void 0,this.editing=void 0,this.pasting_count=0,this.dragging_connections=[],this.hide_chaff_effects=[],this.document_events_bound=!1,this.document_events_handler=new Map,this.before_scale=1,this.lastpointerId=-1/0,this.pinch_listener=function(e){var i=!0;if(e.pointers.forEach((function(o,n){return document.body.contains(o.target)?o.pointerId<t.lastpointerId?(i=!1,e.pointers.splice(n,1),void(t.lastpointerId=e.changedPointers[0].pointerId)):void 0:(e.pointers.splice(n,1),void(i=!1))})),i||!(e.pointers.length>=2)){var o=t.workspace_db.current;o.current_gesture_&&o.current_gesture_.cancel();var n=e.scale;n-t.before_scale>.08?(o.mark_focused(),o.zoom_center(.5),t.before_scale=n):n-t.before_scale<-.08&&(o.mark_focused(),o.zoom_center(-.5),t.before_scale=n)}},this.pinchend_listener=function(e){t.before_scale=1,e.pointers.forEach((function(e){e.pointerId>t.lastpointerId&&(t.lastpointerId=e.pointerId)}))},this.clipboard=new c}return t.prototype.set_pasting=function(t){t?this.pasting_count++:this.pasting_count--},t.prototype.is_pasting=function(){return this.pasting_count},t.prototype.register_finger_events=function(){if(!this.hammer_manager){var t=document.querySelector(".blocklySvg");this.hammer_manager=new r.Manager(t)}this.pinch_recognizer||(this.pinch_recognizer=new r.Pinch),this.hammer_manager.add(this.pinch_recognizer),this.hammer_manager.on("pinch",this.pinch_listener),this.hammer_manager.on("pinchend",this.pinchend_listener)},t.prototype.unregister_finger_events=function(){var t,e,i;this.pinch_recognizer&&(null===(t=this.hammer_manager)||void 0===t||t.remove(this.pinch_recognizer)),null===(e=this.hammer_manager)||void 0===e||e.off("pinch",this.pinch_listener),null===(i=this.hammer_manager)||void 0===i||i.off("pinchend",this.pinchend_listener)},t.prototype.cancel_gesture_when_multi_touch=function(){var t,e=this;null===(t=this.workspace_db.current)||void 0===t||t.get_parent_svg().addEventListener("touchmove",(function(t){var i=e.workspace_db.current;t.touches.length>1&&i.current_gesture_&&i.current_gesture_.cancel()}))},o.__decorate([(0,s.lazy_inject)(s.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.RuntimeData=a;var c=function(){function t(){}return t.prototype.get_content=function(){if(this.content)return Array.isArray(this.content)?this.content.map((function(t){return(0,_.clone_node)(t,!0)})):(0,_.clone_node)(this.content,!0)},t.prototype.copy=function(t){var e=this.xml.workspace_element_to_dom_with_xy(t);return this.content=e,e},t.prototype.copy_all=function(t){var e=this,i=t.map((function(t){return e.xml.workspace_element_to_dom_with_xy(t)}));return this.content=i,i},t.prototype.duplicate=function(t){var e=this.copy(t);return t.get_workspace().paste((0,_.clone_node)(e,!0)),e},o.__decorate([(0,s.lazy_inject)(s.BINDING.xml)],t.prototype,"xml",void 0),t}()},55376:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.DARK_THEME_CONFIG=e.DEFAULT_THEME_CONFIG=e.RendererParams=e.Theme=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(61972),_=i(42798),a=function(){function t(){this.current_theme="",this.theme_list={},this.register(u,h),this.register(p,g),this._apply(u)}return t.prototype.get_color=function(t){var e=t.match(/^%\{(BKY_)?([^}]+)\}$/);return t=(null===e||void 0===e?void 0:e[2])||t,this.block_color[t]},t.prototype.register=function(t,e){var i=(0,s.merge_deep)(h,e);this.normalize_config(i),this.theme_list[t]&&console.warn("Theme ".concat(t," already exists and would be replaced.")),this.theme_list[t]=i},t.prototype.apply=function(t){if(this._apply(t),this.Blink.mainWorkspace){this.Blink.events.disable();var e=this.Blink.xml.workspace_to_dom(this.Blink.mainWorkspace);this.Blink.mainWorkspace.clear(),this.Blink.xml.dom_to_workspace(e,this.Blink.mainWorkspace),this.Blink.events.enable();var i=this.Blink.mainWorkspace.get_toolbox();i&&(i.flyout.hide(),i.flyout.clear_cached_blocks())}},t.prototype._apply=function(t){if(this.current_theme!==t){var e=this.theme_list[t];e?(this.current_theme=t,Object.assign(this,e)):console.error("Theme ".concat(t," not found."))}},t.prototype.normalize_config=function(t){for(var e in t.font.SIZE.match(/^\d*\.?\d+\s*[Pp][Tt]$/)||(console.warn("Font size ".concat(t.font.SIZE," replaced by default")),t.font.SIZE=h.font.SIZE),t.flyout.BACKGROUND_COLOR=new _.Color(t.flyout.BACKGROUND_COLOR,h.flyout.BACKGROUND_COLOR,"Flyout background color ".concat(t.flyout.BACKGROUND_COLOR," replaced by default")),t.insertion_marker.COLOR=new _.Color(t.insertion_marker.COLOR,h.insertion_marker.COLOR,"Insertion marker color ".concat(t.insertion_marker.COLOR," replaced by default")),(t.insertion_marker.OPACITY<0||t.insertion_marker.OPACITY>1)&&(console.warn("Insertion marker opacity ".concat(t.insertion_marker.OPACITY," replaced by default")),t.insertion_marker.OPACITY=h.insertion_marker.OPACITY),t.shadow_style.SHADOW_COLOR=new _.Color(t.shadow_style.SHADOW_COLOR,h.shadow_style.SHADOW_COLOR,"Shadow color ".concat(t.shadow_style.SHADOW_COLOR," replaced by default")),t.shadow_style.EMPTY_COLOR=new _.Color(t.shadow_style.EMPTY_COLOR,h.shadow_style.EMPTY_COLOR,"Invalid empty shadow color ".concat(t.shadow_style.EMPTY_COLOR," replaced by default")),t.shadow_style.BORDER.match(/^\d*\.?\d+\s*[Pp][Xx]$/)||(console.warn("Invalid shadow border ".concat(t.shadow_style.BORDER," replaced by default")),t.shadow_style.BORDER=h.shadow_style.BORDER),"0"!==t.shadow_style.NO_BORDER&&(console.warn("Invalid shadow no_border ".concat(t.shadow_style.NO_BORDER," replaced by default")),t.shadow_style.NO_BORDER=h.shadow_style.NO_BORDER),t.block_group_color){var i=e;t.block_group_color[i]=new _.Color(t.block_group_color[i],h.block_group_color[i],"Block group ".concat(e," replaced by default"))}for(var o in t.block_color){var n=new _.Color,r=new _.Color;if(n.set(t.block_color[o].fill)&&r.set(t.block_color[o].border)){if(t.block_color[o].fill=n,t.block_color[o].border=r,t.block_color[o].layer)(new _.Color).set(t.block_color[o].layer)||(console.warn("Illegal layer color ".concat(t.block_color[o].layer," of ").concat(o," deleted.")),delete t.block_color[o].layer)}else console.warn("Block color ".concat(o," and all its related colors deleted.")),delete t.block_color[o]}t.disabled_color.fill=new _.Color(t.disabled_color.fill,h.disabled_color.fill,"Block disabled fill color ".concat(t.disabled_color.fill," replaced by default")),t.disabled_color.border=new _.Color(t.disabled_color.border,h.disabled_color.border,"Block disabled border color ".concat(t.disabled_color.border," replaced by default"))},o.__decorate([(0,r.lazy_inject)(r.BINDING.Blink)],t.prototype,"Blink",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Theme=a;var c=function(){this.BLOCK_LEFT_TOP=[0,0],this.MIN_WIDTH=110,this.MIN_WIDTH_OUTPUT=40,this.MIN_WIDTH_SHADOW=this.MIN_WIDTH_OUTPUT,this.MIN_WIDTH_SHADOW_HEXAGONAL=54,this.BLOCK_EDGE_WIDTH=20,this.BLOCK_EDGE_WIDTH_OUTPUT=18,this.BLOCK_EDGE_WIDTH_OUTPUT_HEXAGONAL=12,this.BLOCK_EDGE_WIDTH_SHADOW=15,this.BLOCK_EDGE_WIDTH_SHADOW_ROUND=15,this.BLOCK_EDGE_WIDTH_SHADOW_HEXAGONAL=9,this.MIN_HEIGHT=40,this.MIN_HEIGHT_OUTPUT=36,this.MIN_HEIGHT_SHADOW=30,this.HEAD_ICON_WRAP_WIDTH=48,this.HEAD_ICON_WIDTH=38,this.SEP_SPACE_X=8,this.CORNER_RADIUS=2,this.C_BLOCK_INNER_CORNOR_RADIUS=2,this.CORNER_RADIUS_END_BLOCK_WITHOUD_NOTCH=12,this.HEX_TOP_BOTTOM_CORNER_RADIUS=3,this.HEX_CENTER_CORNER_RADIUS=2,this.CORNER_OFFSET_X=2,this.CORNER_OFFSET_Y=1,this.CENTER_CORNER_OFFSET=2,this.C_BLOCK_INNER_CORNOR_LEFT_TOP="a ".concat(this.C_BLOCK_INNER_CORNOR_RADIUS," ").concat(this.C_BLOCK_INNER_CORNOR_RADIUS," 0 0 0 -").concat(this.C_BLOCK_INNER_CORNOR_RADIUS," ").concat(this.C_BLOCK_INNER_CORNOR_RADIUS),this.C_BLOCK_INNER_CORNOR_LEFT_BOTTOM="a ".concat(this.C_BLOCK_INNER_CORNOR_RADIUS," ").concat(this.C_BLOCK_INNER_CORNOR_RADIUS," 0 0 0 ").concat(this.C_BLOCK_INNER_CORNOR_RADIUS," ").concat(this.C_BLOCK_INNER_CORNOR_RADIUS),this.COMMENT_PADDING_RIGHT=8,this.NTOCH_START_PADDING=13,this.NOTCH_HEIGHT=4,this.NOTCH_WIDTH=20,this.NOTCH_WIDTH_SHORT=6,this.NOTCH_CORNOR_RADIUS=3,this.NOTCH_WIDTH_SIDE=(this.NOTCH_WIDTH-this.NOTCH_WIDTH_SHORT-2*this.NOTCH_CORNOR_RADIUS)/2,this.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER=2,this.offset=this.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER,this.NOTCH_CORNOR_LEFT_TOP_1="a ".concat(this.NOTCH_CORNOR_RADIUS,",").concat(this.NOTCH_CORNOR_RADIUS," 0 0 1 ").concat(this.offset,",1"),this.NOTCH_CORNOR_LEFT_BOTTOM_1="a ".concat(this.NOTCH_CORNOR_RADIUS,",").concat(this.NOTCH_CORNOR_RADIUS," 0 0 0 ").concat(this.offset,",1"),this.NOTCH_CORNOR_RIGHT_TOP_1="a ".concat(this.NOTCH_CORNOR_RADIUS,",").concat(this.NOTCH_CORNOR_RADIUS," 0 0 1 ").concat(this.offset,",-1"),this.NOTCH_CORNOR_RIGHT_BOTTOM_1="a ".concat(this.NOTCH_CORNOR_RADIUS,",").concat(this.NOTCH_CORNOR_RADIUS," 0 0 0 ").concat(this.offset,",-1"),this.NOTCH_PATH_LEFT="".concat(this.NOTCH_CORNOR_LEFT_TOP_1," l ").concat(this.NOTCH_WIDTH_SIDE,",").concat(this.NOTCH_HEIGHT," ").concat(this.NOTCH_CORNOR_LEFT_BOTTOM_1," h ").concat(this.NOTCH_WIDTH_SHORT," ").concat(this.NOTCH_CORNOR_RIGHT_BOTTOM_1," l ").concat(this.NOTCH_WIDTH_SIDE,",-").concat(this.NOTCH_HEIGHT," ").concat(this.NOTCH_CORNOR_RIGHT_TOP_1),this.NOTCH_CORNOR_LEFT_TOP_2="a ".concat(this.NOTCH_CORNOR_RADIUS,",").concat(this.NOTCH_CORNOR_RADIUS," 0 0 0 -").concat(this.offset,",-1"),this.NOTCH_CORNOR_LEFT_BOTTOM_2="a ".concat(this.NOTCH_CORNOR_RADIUS,",").concat(this.NOTCH_CORNOR_RADIUS," 0 0 1 -").concat(this.offset,",-1"),this.NOTCH_CORNOR_RIGHT_TOP_2="a ".concat(this.NOTCH_CORNOR_RADIUS,",").concat(this.NOTCH_CORNOR_RADIUS," 0 0 0 -").concat(this.offset,",1"),this.NOTCH_CORNOR_RIGHT_BOTTOM_2="a ".concat(this.NOTCH_CORNOR_RADIUS,",").concat(this.NOTCH_CORNOR_RADIUS," 0 0 1 -").concat(this.offset,",1"),this.NOTCH_PATH_RIGHT="".concat(this.NOTCH_CORNOR_RIGHT_TOP_2," l -").concat(this.NOTCH_WIDTH_SIDE,",").concat(this.NOTCH_HEIGHT," ").concat(this.NOTCH_CORNOR_RIGHT_BOTTOM_2," h -").concat(this.NOTCH_WIDTH_SHORT," ").concat(this.NOTCH_CORNOR_LEFT_BOTTOM_2," l -").concat(this.NOTCH_WIDTH_SIDE,",-").concat(this.NOTCH_HEIGHT," ").concat(this.NOTCH_CORNOR_LEFT_TOP_2),this.ROW_PADDING=16,this.ROW_PADDING_OUTPUT=this.BLOCK_EDGE_WIDTH_OUTPUT,this.ROW_PADDING_OUTPUT_WITH_INPUT=16,this.ROW_PADDING_OUTPUT_WITH_TEXT=16,this.ROW_PADDING_OUTPUT_NON_TEXT=0,this.ROW_PADDING_SHADOW=this.BLOCK_EDGE_WIDTH_SHADOW,this.ROW_PADDING_HEAD=this.HEAD_ICON_WIDTH/2,this.STATEMENT_ROW_PADDING_Y_TO_FIELD=5,this.STATEMENT_ROW_PADDING_Y_TO_VALUE_BLOCK=4,this.STATEMENT_ROW_PADDING_Y_TO_STATEMENT_BLOCK=0,this.OUTPUT_ROW_PADDING_Y_TO_FIELD=3,this.OUTPUT_ROW_PADDING_Y_TO_VALUE_BLOCK=2,this.SHADOW_ROW_PADDING_Y_TO_FIELD=0,this.FIELD_HEIGHT=30,this.SHADOW_FIELD_HEIGHT=17.5,this.INPUT_MIN_HEIGHT_STATEMENT=20,this.INPUT_EXTRA_ROW_WIDTH=86,this.INPUT_EXTRA_ROW_HEIGHT=20,this.VALUE_SHAPE_WIDTH=54,this.VALUE_SHAPE_EDGE_WIDTH=this.BLOCK_EDGE_WIDTH_SHADOW,this.VALUE_SHAPE_HEIGHT=30,this.INPUT_SHAPE_ROUND_WIDTH=36,this.INPUT_SHAPE_HEXAGONAL_WIDTH=54,this.INPUT_SHAPE_HEIGHT=28,this.INLINE_PADDING_Y=2,this.VALUE_SHAPE_HEXAGONAL="M ".concat(this.VALUE_SHAPE_EDGE_WIDTH,",0 ")+" H ".concat(this.VALUE_SHAPE_WIDTH-this.VALUE_SHAPE_EDGE_WIDTH," L ").concat(this.VALUE_SHAPE_WIDTH,",").concat(4*this.VALUE_SHAPE_HEIGHT/2," l ").concat(-this.VALUE_SHAPE_EDGE_WIDTH,",").concat(4*this.VALUE_SHAPE_HEIGHT/2," H ").concat(this.VALUE_SHAPE_EDGE_WIDTH," L ").concat(NaN).concat(this.VALUE_SHAPE_HEIGHT/2," L ").concat(this.VALUE_SHAPE_EDGE_WIDTH,",").concat(0," z"),this.VALUE_SHAPE_ROUND="M ".concat(this.VALUE_SHAPE_EDGE_WIDTH,",0")+" H ".concat(this.VALUE_SHAPE_WIDTH-this.VALUE_SHAPE_EDGE_WIDTH," a ").concat(this.VALUE_SHAPE_EDGE_WIDTH," ").concat(this.VALUE_SHAPE_HEIGHT/2," 0 0 1 0 ").concat(this.VALUE_SHAPE_HEIGHT," H ").concat(this.VALUE_SHAPE_EDGE_WIDTH," a ").concat(this.VALUE_SHAPE_EDGE_WIDTH," ").concat(this.VALUE_SHAPE_HEIGHT/2," 0 0 1 0 -").concat(this.VALUE_SHAPE_HEIGHT," z"),this.STATEMENT_FIRST_ROW_MIN_WIDTH=110,this.STATEMENT_OTHER_ROW_MIN_WIDTH=86,this.STATEMENT_MIN_WIDTH=16,this.FLYOUT_CORNER_RADIUS=0,this.COLLAPSED_PATH="l 8,0 0,4 8,4 -16,8 8,4",this.COLLAPSED_HEIGHT=20,this.GROUP_RIGHT_EXTENDED_WIDTH=16,this.GROUP_RIGHT_EDGE_WIDTH=this.GROUP_RIGHT_EXTENDED_WIDTH+8,this.OUTPUT_GROUP_DECORATION_PADDING=14,this.OUTPUT_GROUP_DECORATION_OFFSET=6,this.EXECUTION_GROUP_DECORATION_WIDTH=124,this.EXECUTION_GROUP_DECORATION_RIGHT_MARGIN=8,this.GROUP_TOP_RIGHT_PATH="a 4 4 0 0 1 3.7 5.5",this.GROUP_BOTTOM_RIGHT_PATH="a 4 4 0 0 1 -3.7 3.5",this.GROUP_EXTRA_ROW_RIGHT="\n    h ".concat(96-this.STATEMENT_MIN_WIDTH-12-7,"\n    a 4 4 0 0 1 3.5 1.7\n    l 7 12\n    a 4 4 0 0 1 -3.5 6.3\n  "),this.TEXT_PADDING_IN_FIELD=8,this.TEXT_MIN_WIDTH_IN_FIELD=20};e.RendererParams=c;var l=function(){this.DRAG_RADIUS=5,this.FLYOUT_DRAG_RADIUS=10,this.SNAP_RADIUS=48,this.CONNECTING_SNAP_RADIUS=68,this.CURRENT_CONNECTION_PREFERENCE=20,this.BUMP_DELAY=250,this.COLLAPSE_CHARS=30,this.LONGPRESS=750,this.SOUND_LIMIT=100},d={INCOMPATIBLE_HUE:{fill:"#c7c7c7",border:"#c7c7c7"},EVENTS_HUE:{fill:"#608FEE",border:"#496EB8"},CONTROL_HUE:{fill:"#68CDFF",border:"#53A2C9"},ACTIONS_HUE:{fill:"#F46767",border:"#BF5050"},APPEARANCE_HUE:{fill:"#E76CEA",border:"#B353B5"},SOUND_HUE:{fill:"#A073FF",border:"#7E5BC9"},PEN_HUE:{fill:"#2BC9A7",border:"#1F947B"},SENSING_HUE:{fill:"#77D657",border:"#5AA142",layer:"#61BA41"},LOGIC_HUE:{fill:"#FEAE8A",border:"#C98A6D",layer:"#EDA380"},MATH_HUE:{fill:"#FEAE8A",border:"#C98A6D"},TEXTS_HUE:{fill:"#FEAE8A",border:"#C98A6D"},VARIABLES_HUE:{fill:"#FFBB55",border:"#C99342"},LISTS_HUE:{fill:"#F9CC37",border:"#C4A12B",layer:"#DEB738"},PROCEDURES_HUE:{fill:"#F88767",border:"#C26A51"},PROCEDURES_PARAM_HUE:{fill:"#FF7E2E",border:"#C26A51"},PHYSICS_HUE:{fill:"#E04852",border:"#AB373E"},CAMERA_HUE:{fill:"#C769FF",border:"#9E53C9"},CAMERA_QRCODE_HUE:{fill:"#C769FF",border:"#9E53C9"},VIDEO_HUE:{fill:"#A073FF",border:"#7E5BC9"},CLOUD_HUE:{fill:"#FFBB55",border:"#C99342"},CLOUD_LIST_HUE:{fill:"#F9CC37",border:"#C4A12B"},AI_HUE:{fill:"#5574F8",border:"#4259C2"},AI_GAME_HUE:{fill:"#8647F3",border:"#6837BD"},AI_COGNITIVE_HUE:{fill:"#C769FF",border:"#9E53C9"},ADVANCED_HUE:{fill:"#14B390",border:"#0E7D65"},HARDWARE_HUE:{fill:"#007E8C",border:"#007E8C"}},u="default",h={font:{SIZE:"12pt"},flyout:{BACKGROUND_COLOR:"rgba(255, 255, 255, 1)"},insertion_marker:{COLOR:"#c7c7c7",OPACITY:.2},shadow_style:{SHADOW_COLOR:"#FFF",EMPTY_COLOR:"rgba(0, 0, 0, 0.1)",BORDER:"1px",NO_BORDER:"0"},block_group_color:{OUTPUT_GROUP_FILL_COLOUR:"#5C559A",OUTPUT_GROUP_STROKE_COLOUR:"#423B82",EXECUTION_GROUP_FILL_COLOUR:"#5C559A",EXECUTION_GROUP_STROKE_COLOUR:"#423B82"},block_color:o.__assign(o.__assign({DEFAULT:{fill:"#CCCCCC",border:"rgba(0, 0, 0, 0.15)"}},d),{BLUE_1:{fill:"#68CDFF",layer:"#60BEED",border:"#53A2C9"},BLUE_2:{fill:"#64B5F6",border:"#4E8CBF"},BLUE_3:{fill:"#608FEE",border:"#496EB8"},BLUE_4:{fill:"#5574F8",border:"#4259C2"},BLUE_5:{fill:"#3FA1EF",border:"#307CBA"},BLUE_6:{fill:"#00AFC3",border:"#007E8C"},PURPLE_1:{fill:"#E76CEA",layer:"#D858D8",border:"#B353B5"},PURPLE_2:{fill:"#C769FF",border:"#9E53C9"},PURPLE_3:{fill:"#A073FF",border:"#7E5BC9"},PURPLE_4:{fill:"#7D68F1",border:"#6151BD"},PURPLE_5:{fill:"#8647F3",border:"#6837BD"},PURPLE_6:{fill:"#9D47E0",border:"#7937AB"},RED_1:{fill:"#FF895F",border:"#C96C4B"},RED_2:{fill:"#F46767",border:"#BF5050"},RED_3:{fill:"#E65D2D",border:"#B04923"},RED_4:{fill:"#E04852",border:"#AB373E"},RED_5:{fill:"#E94585",border:"#B33665"},RED_6:{fill:"#FF6795",border:"#C95175"},ORANGE_1:{fill:"#F9CC37",layer:"#EDBE24",border:"#E2B51F"},ORANGE_2:{fill:"#FFBB55",border:"#C99342"},ORANGE_3:{fill:"#FEAE8A",layer:"#EC9972",border:"#E58B63"},ORANGE_4:{fill:"#F88767",layer:"#FF7E2E",border:"#C26A51"},ORANGE_5:{fill:"#FC942C",border:"#C77422"},ORANGE_6:{fill:"#EE8F13",border:"#B86E0F"},ORANGE_7:{fill:"#FF7E2E",border:"#C26A51"},GREEN_1:{fill:"#C9D926",border:"#98A31D"},GREEN_2:{fill:"#A3DE2B",border:"#7BA820"},GREEN_3:{fill:"#77D657",layer:"#54BE2F",border:"#51AD2F"},GREEN_4:{fill:"#57B937",border:"#3F8528"},GREEN_5:{fill:"#14B390",border:"#0E7D65"},GREEN_6:{fill:"#2BC9A7",border:"#1F947B"},BLACK_1:{fill:"#999999",border:"#636363"},BLACK_2:{fill:"#4A4A4A",border:"#141414"}}),disabled_color:{fill:"#ABAFB6",border:"#9399A4"},renderer:new c,blink_params:new l},p="dark",g={font:{SIZE:"12pt"},flyout:{BACKGROUND_COLOR:"rgba(255, 255, 255, 1)"},insertion_marker:{COLOR:"#c7c7c7",OPACITY:.2},shadow_style:{SHADOW_COLOR:"#FFF",EMPTY_COLOR:"rgba(0, 0, 0, 0.1)",BORDER:"1px",NO_BORDER:"0"},block_group_color:{OUTPUT_GROUP_FILL_COLOUR:"#5C559A",OUTPUT_GROUP_STROKE_COLOUR:"#423B82",EXECUTION_GROUP_FILL_COLOUR:"#5C559A",EXECUTION_GROUP_STROKE_COLOUR:"#423B82"},block_color:o.__assign(o.__assign({DEFAULT:{fill:"#CCCCCC",border:"rgba(0, 0, 0, 0.15)"}},d),{BLUE_1:{fill:"#2DB3E3",layer:"#29A6D4",border:"#348DAD"},BLUE_2:{fill:"#3290E6",border:"#3876B0"},BLUE_3:{fill:"#3567E6",border:"#284FB0"},BLUE_4:{fill:"#384CE8",border:"#2B3BB3"},BLUE_5:{fill:"#1E97D1",border:"#16719C"},BLUE_6:{fill:"#00A9BD",border:"#007A87"},PURPLE_1:{fill:"#D158D0",layer:"#BD43BC",border:"#9C419C"},PURPLE_2:{fill:"#BB62F0",border:"#924CBA"},PURPLE_3:{fill:"#893BE3",border:"#692DAD"},PURPLE_4:{fill:"#624AE8",border:"#4B39B3"},PURPLE_5:{fill:"#6924E3",border:"#511CAD"},PURPLE_6:{fill:"#872AD1",border:"#661F9C"},RED_1:{fill:"#FA865D",border:"#C46A49"},RED_2:{fill:"#E64545",border:"#B04646"},RED_3:{fill:"#E6521E",border:"#B04017"},RED_4:{fill:"#C23D3A",border:"#8C2C2A"},RED_5:{fill:"#E34382",border:"#AD3463"},RED_6:{fill:"#FA6592",border:"#C44F72"},ORANGE_1:{fill:"#E8C552",layer:"#D9B337",border:"#B3973E"},ORANGE_2:{fill:"#EDB157",border:"#B88944"},ORANGE_3:{fill:"#F09972",layer:"#E6875D",border:"#BA7859"},ORANGE_4:{fill:"#F28465",layer:"#FF7824",border:"#BD674F"},ORANGE_5:{fill:"#F7912B",border:"#C27121"},ORANGE_6:{fill:"#E08103",border:"#AB6202"},ORANGE_7:{fill:"#FF7824",border:"#BD674F"},GREEN_1:{fill:"#B0C200",border:"#8D990C"},GREEN_2:{fill:"#8CC714",border:"#739E1E"},GREEN_3:{fill:"#63C243",border:"#488C31"},GREEN_4:{fill:"#53B034",border:"#3A7A25"},GREEN_5:{fill:"#13AD8B",border:"#0C6E59"},GREEN_6:{fill:"#28BA9B",border:"#1C856E"},BLACK_1:{fill:"#9A9A9A",border:"#636363"},BLACK_2:{fill:"#4A4A4A",border:"#141414"}}),disabled_color:{fill:"#ACADAE",border:"#818388"},renderer:new c,blink_params:new l};e.DEFAULT_THEME_CONFIG=(0,s.clone_deep)(h),e.DARK_THEME_CONFIG=(0,s.clone_deep)(g)},60271:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Tooltip=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(25461),_=i(61972),a=i(53494),c=function(){function t(){this.visible=!1,this.blocked_=!1,this.LIMIT=50,this.mouse_out_pid_=0,this.show_pid_=0,this.last_x_=0,this.last_y_=0,this.poisoned_element_=void 0,this.OFFSET_X=0,this.OFFSET_Y=10,this.RADIUS_OK=20,this.HOVER_MS=750,this.MARGINS=5,this.DIV=void 0}return t.prototype.create_dom=function(){return this.DIV||(this.DIV=(0,s.create_dom)("div","blocklyTooltipDiv"),document.body.appendChild(this.DIV)),this.DIV},t.prototype.bind_mouse_event=function(t){this.events.bind_event(t,"mouseover",void 0,this.on_mouse_over.bind(this)),this.events.bind_event(t,"mouseout",void 0,this.on_mouse_out.bind(this)),t.addEventListener("mousemove",this.on_mouse_move.bind(this),!1)},t.prototype.on_mouse_over=function(t){if(!this.blocked_){var e=t.target;e&&e.tooltip&&(this.element_!==t.target&&(this.hide(),this.poisoned_element_=void 0,this.element_=e),clearTimeout(this.mouse_out_pid_))}},t.prototype.on_mouse_out=function(t){var e=this;this.blocked_||(0,s.is_in_same_shadow)(t.target,t.relatedTarget)||(this.mouse_out_pid_=window.setTimeout((function(){e.element_=void 0,e.poisoned_element_=void 0,e.hide()}),1),clearTimeout(this.show_pid_))},t.prototype.on_mouse_move=function(t){if(this.element_&&!this.blocked_)if(this.visible){var e=this.last_x_-t.pageX,i=this.last_y_-t.pageY;Math.sqrt(e*e+i*i)>this.RADIUS_OK&&this.hide()}else this.poisoned_element_!=this.element_&&(clearTimeout(this.show_pid_),this.last_x_=t.pageX,this.last_y_=t.pageY,this.show_pid_=window.setTimeout(this.show_.bind(this),this.HOVER_MS))},t.prototype.hide=function(){this.visible&&(this.visible=!1,this.DIV&&(this.DIV.style.display="none")),this.show_pid_&&clearTimeout(this.show_pid_)},t.prototype.block=function(){this.hide(),this.blocked_=!0},t.prototype.unblock=function(){this.blocked_=!1},t.prototype.show_=function(){var t;if(!this.blocked_){this.poisoned_element_=this.element_;var e=this.DIV||this.create_dom();(0,s.remove_children)(e);for(var i=null===(t=this.element_)||void 0===t?void 0:t.tooltip;(0,_.is_func)(i);)i=i();if(i){for(var o=(i=(0,a.wrap)(i,this.LIMIT)).split("\n"),n=0;n<o.length;n++){var r=document.createElement("div");r.appendChild(document.createTextNode(o[n])),e.appendChild(r)}var c=(0,s.get_viewport_size)();e.style.display="block",this.visible=!0;var l=this.last_x_;l+=this.OFFSET_X;var d=this.last_y_+this.OFFSET_Y;d+e.offsetHeight>c.height+window.scrollY&&(d-=e.offsetHeight+2*this.OFFSET_Y),l+e.offsetWidth>c.width+window.scrollX-2*this.MARGINS&&(l=c.width-e.offsetWidth-2*this.MARGINS),e.style.top="".concat(d,"px"),e.style.left="".concat(l,"px")}}},t.prototype.get_element=function(){return this.element_},o.__decorate([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.widget_div)],t.prototype,"widget_div",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Tooltip=c},13024:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.TouchManager=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(61972),_=function(){function t(){this._touch_identifier=void 0,this.TOUCH_MAP=s.BrowserFeature.TOUCH_ENABLED?{mousedown:["touchstart"],mousemove:["touchmove"],mouseup:["touchend","touchcancel"]}:{},this._long_pid=0,this.is_touch_event=function(t){return t.type.startsWith("touch")}}return t.prototype.long_start=function(t,e){this.long_stop(),1==t.changedTouches.length&&(this._long_pid=window.setTimeout((function(){var i=t;i.button=2,i.clientX=t.changedTouches[0].clientX,i.clientY=t.changedTouches[0].clientY,e&&e.handle_right_click(i)}),this.theme.blink_params.LONGPRESS))},t.prototype.long_stop=function(){this._long_pid&&(clearTimeout(this._long_pid),this._long_pid=0)},t.prototype.clear_touch_identifier=function(){this._touch_identifier=void 0},t.prototype.should_handle_event=function(t){return!this.is_mouse_or_touch_event(t)||this.check_touch_identifier(t)},t.prototype.get_touch_identifier_from_event=function(t){var e=this.is_touch_event(t)&&t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0].identifier;return e||"mouse"},t.prototype.check_touch_identifier=function(t){var e=this.get_touch_identifier_from_event(t);if(void 0!=this._touch_identifier){var i=this._touch_identifier===e;return i||(this._touch_identifier=void 0),i}return("mousedown"==t.type||"touchstart"==t.type)&&(this._touch_identifier=e,!0)},t.prototype.set_client_from_touch=function(t){if(this.is_touch_event(t)){var e=t.changedTouches[0];t.clientX=e.clientX,t.clientY=e.clientY}},t.prototype.is_mouse_or_touch_event=function(t){return t.type.startsWith("touch")||t.type.startsWith("mouse")},t.prototype.split_event_by_touches=function(t){var e=[];if(this.is_touch_event(t))for(var i=0;i<t.changedTouches.length;i++){var o=Object.assign({},t,{type:t.type,changedTouches:[t.changedTouches[i]],target:t.target,stopPropagation:function(){t.stopPropagation()},preventDefault:function(){0!=t.cancelable&&t.preventDefault()}});e[i]=o}else e.push(t);return e},o.__decorate([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.TouchManager=_},95208:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(87409),_=i(52734),a=i(57341),c=i(98030),l=i(75102),d=i(48462),u=i(11214),h=i(61972),p=i(22804),g=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*\))?/,f=/transform:\s*translate\(\s*([-+\d.e]+)px(([ ,]\s*([-+\d.e]+)\s*)px)*\)?/,v=/transform:\s*translate3d\(\s*([-+\d.e]+)px([ ,]\s*([-+\d.e]+)\s*)px([ ,]\s*([-+\d.e]+)\s*)px\)?/,m=/scale\(\s*([-+\d.e]+)\s*\)/,b=function(){function t(){var t=this;this.is_3d_supported_cached_=void 0,this.string_to_dom=function(t){if(window.ActiveXObject){var e=new window.ActiveXObject("Microsoft.XMLDOM");return e.async="false",e.loadXML(t),e}var i=(new DOMParser).parseFromString(t,"text/xml");return i&&i.firstChild&&i.firstChild===i.lastChild||console.error("string_to_dom did not obtain a valid XML tree."),i.firstChild},this.cached_shadow_dom=new Map,this.shadow_type_map={text:'<shadow type="text"><field name="TEXT"></field></shadow>',math_number:'<shadow type="math_number"><field name="NUM"></field></shadow>',logic_empty:'<empty type="logic_empty"><field name="BOOL"></field></empty>',lists_get:'<shadow type="lists_get"><field name="VAR"></field></shadow>'},this.get_shadow_dom=function(e,i,o,n){var r,s=null===(r=t.cached_shadow_dom.get(t.shadow_type_map[e]))||void 0===r?void 0:r.cloneNode(!0);return s||(s=t.string_to_dom(t.shadow_type_map[e]),t.cached_shadow_dom.set(t.shadow_type_map[e],s)),o&&Object.keys(o).forEach((function(t){s.setAttribute(t,o[t])})),s.firstElementChild&&(void 0!=i&&(s.firstElementChild.textContent=i),n&&Object.keys(n).forEach((function(t){s.firstElementChild.setAttribute(t,n[t])}))),s},this.try_parse_shadow=function(e){var i=e.match(/^<shadow[^<]+type="([^"]+)"[^>]*>[^<]*<field[^>]*>(.*)<\/field>[^<]*<\/shadow>$/)||e.match(/^<empty[^<]+type="([^"]+)"/)||[],o=i[1],n=i[2];if(o&&t.shadow_type_map[o])return t.get_shadow_dom(o,n,t.parse_attrs((e.match(/^<shadow ([^>]*)>/)||e.match(/^<empty ([^>]*)>/)||[])[1]),t.parse_attrs((e.match(/<field ([^>]*)>/)||[])[1]))},this.string_to_dom_with_shadow_cache=function(e){var i=t.try_parse_shadow(e);if(i)return i;if(!(i=t.string_to_dom(e)))throw Error("Cannot convert string to xml. ".concat(e));return i},this.cache_reference=0,this.cached_widths=new Map,this.cached_style=""}return t.prototype.hide_chaff=function(t,e){for(var i=0,o=this.runtime_data.hide_chaff_effects;i<o.length;i++){(0,o[i])()}if(this.widget_div.hide(e),!t){var n=this.workspace_db.current,r=n&&n.get_toolbox();r&&r.flyout&&r.flyout.is_auto_close()&&r.clear_selection()}},t.prototype.gen_uid=function(){return(0,u.gen_uid)()},t.prototype.is_3d_supported=function(){if(void 0!=this.is_3d_supported_cached_)return this.is_3d_supported_cached_;if(!window.getComputedStyle)return!1;var t=document.createElement("p"),e="none",i={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(var o in document.body.insertBefore(t,null),i)if(void 0!=t.style.getPropertyValue(i[o])){t.style.setProperty(i[o],"translate3d(1px,1px,1px)");var n=window.getComputedStyle(t);if(!n)return document.body.removeChild(t),!1;e=n.getPropertyValue(i[o])}return document.body.removeChild(t),this.is_3d_supported_cached_="none"!==e,this.is_3d_supported_cached_},t.prototype.run_after_page_load=function(t){if(!document)throw new Error("Blockly.utils.run_after_page_load() requires browser document.");if("complete"===document.readyState)t();else var e=setInterval((function(){"complete"===document.readyState&&(clearInterval(e),t())}),10)},t.prototype.svg_resize=function(t){for(var e=t,i=e.get_options().parentWorkspace;i;)i=(e=i).get_options().parentWorkspace;var o=e.get_parent_svg(),n=e.get_injection_div();if(n){var r=e.get_toolbox(),s=(null===r||void 0===r?void 0:r.get_width())||0,_=(null===r||void 0===r?void 0:r.get_height())||0,a=e.get_flyout();a&&a.is_visible()&&!a.is_auto_close()&&(s+=a.get_width());var c=n.offsetWidth,d=n.offsetHeight;if(!(c<s||d<_)){var u=c;e.options.toolboxPosition===l.TOOLBOX_POSITION.LEFT&&(u-=s,e.offset[0]=s),e.options.toolboxPosition===l.TOOLBOX_POSITION.RIGHT&&(u-=s);var h=d;e.options.toolboxPosition===l.TOOLBOX_POSITION.TOP&&(h-=_,e.offset[1]=_),e.options.toolboxPosition===l.TOOLBOX_POSITION.BOTTOM&&(h-=_),o.cachedWidth_!=u&&(o.setAttribute("width","".concat(u,"px")),o.cachedWidth_=u),o.cachedHeight_!=h&&(o.setAttribute("height","".concat(h,"px")),o.cachedHeight_=h),e.resize(),this.set_transform_style(o,t.offset[0],t.offset[1])}}},t.prototype.set_language=function(t){switch(void 0===t&&(t="zh"),t){case"en":Object.assign(this.Msg,s.en);break;case"zh":Object.assign(this.Msg,_.zh_hans);break;case"tw":Object.assign(this.Msg,a.zh_hant)}},t.prototype.get_scale=function(t){var e=1,i=t.getAttribute("transform");if(void 0!=i){var o=i.match(m);o&&o[1]&&(e=parseFloat(o[1]))}return e},t.prototype.get_relative_xy=function(t){var e=r.vec2.create(),i=t.getAttribute("x"),o=t.getAttribute("y");i&&(e[0]=parseInt(i,10)),o&&(e[1]=parseInt(o,10));var n=t.getAttribute("transform"),s=void 0!=n&&n.match(g);s&&(e[0]+=parseFloat(s[1]),s[3]&&(e[1]+=parseFloat(s[3])));var _=t.getAttribute("style");if(_&&_.indexOf("translate")>-1){var a=_.match(f);a?(e[0]+=parseFloat(a[1]),a[4]&&(e[1]+=parseFloat(a[4]))):(a=_.match(v))&&(e[0]+=parseFloat(a[1]),a[3]&&(e[1]+=parseFloat(a[3])))}return e},t.prototype.get_injection_div_xy=function(t){for(var e=r.vec2.create(),i=t;i instanceof Element;){var o=this.get_relative_xy(i),n=this.get_scale(i);r.vec2.scaleAndAdd(e,o,e,n);var s=i.getAttribute("class")||"";if(-1!=" ".concat(s," ").indexOf(" ".concat("injectionDiv"," ")))break;i=i.parentNode}return e},t.prototype.common_word_suffix=function(t){if(!t.length)return 0;if(1==t.length)return t[0].length;for(var e=0,i=0,o=(0,d.shortest_string_length)(t);i<o;i++){for(var n=t[0].substr(-i-1,1),r=1;r<t.length;r++)if(n!=t[r].substr(-i-1,1))return e;" "==n&&(e=i+1)}for(r=1;r<t.length;r++){if((n=t[r].charAt(t[r].length-i-1))&&" "!=n)return e}return o},t.prototype.common_word_prefix=function(t){if(!t.length)return 0;if(1==t.length)return t[0].length;for(var e=0,i=0,o=(0,d.shortest_string_length)(t);i<o;i++){for(var n=t[0][i],r=1;r<t.length;r++)if(n!=t[r][i])return e;" "==n&&(e=i+1)}for(r=1;r<t.length;r++){if((n=t[r][i])&&" "!=n)return e}return o},t.prototype.is_target_input=function(t){var e=t.target;return"textarea"==e.type||"text"==e.type||"number"==e.type||"email"==e.type||"password"==e.type||"search"==e.type||"tel"==e.type||"url"==e.type||e.isContentEditable},t.prototype.check_message_references=function(t){for(var e=!0,i=/%{BKY_([a-zA-Z][a-zA-Z0-9_]*)}/g,o=i.exec(t);o;){var n=o[1];void 0==this.Msg[n]&&(console.warn("WARNING: No message string for %{BKY_".concat(n,"}.")),e=!1),t=t.substring(o.index+n.length+1),o=i.exec(t)}return e},t.prototype.mouse_to_svg=function(t,e,i){var o=e.createSVGPoint();(o.x=t.clientX,o.y=t.clientY,i)||(i=e.getScreenCTM().inverse());return o.matrixTransform(i)},t.prototype.is_right_button=function(t){return!(!t.ctrlKey||!p.is.mac())||2==t.button},t.prototype.confirm=function(t,e){e(window.confirm(t))},t.prototype.replace_message_references=function(t){return this.tokenize_interpolation(t).reduce((function(t,e){return"number"===typeof e?"".concat(t,"%").concat(e):"".concat(t).concat(e)}),"")},t.prototype.tokenize_interpolation=function(t){var e=[],i=t.split("");i.push("");for(var o=l.TokenizationState.BaseCase,n=[],r="",s="",_=0;_<i.length;_++){var a=i[_];switch(o){case l.TokenizationState.BaseCase:if("%"===a){(s=n.join(""))&&e.push(s),n.length=0,o=l.TokenizationState.PercentFound;break}n.push(a);break;case l.TokenizationState.PercentFound:if("%"===a){n.push(a),o=l.TokenizationState.BaseCase;break}if("0"<=a&&a<="9"){o=l.TokenizationState.DigitFound,r=a,(s=n.join(""))&&e.push(s),n.length=0;break}if("{"==a){o=l.TokenizationState.MsgRefFound;break}n.push("%",a),o=l.TokenizationState.BaseCase;break;case l.TokenizationState.DigitFound:if("0"<=a&&a<="9"){r+=a;break}e.push(parseInt(r,10)),_--,o=l.TokenizationState.BaseCase;break;case l.TokenizationState.MsgRefFound:if(""===a){n.splice(0,0,"%{"),_--,o=l.TokenizationState.BaseCase;break}if("}"!==a){n.push(a);break}var c=n.join("");if(/[A-Z]\w*/i.test(c)){var d=c.toUpperCase(),u=d.startsWith("BKY_")?d.substring(4):void 0,p=u&&u in this.Msg?this.Msg[u]:void 0;void 0!==p?(0,h.is_string)(p)?Array.prototype.push.apply(e,this.tokenize_interpolation(p)):e.push(String(p)):e.push("%{".concat(c,"}")),n.length=0,o=l.TokenizationState.BaseCase}else e.push("%{".concat(c,"}")),n.length=0,o=l.TokenizationState.BaseCase}}(s=n.join(""))&&e.push(s);var g=[];n.length=0;for(var f=0;f<e.length;++f)"string"===typeof e[f]?n.push(e[f]):((s=n.join(""))&&g.push(s),n.length=0,g.push(e[f]));return(s=n.join(""))&&g.push(s),n.length=0,g},t.prototype.get_svg_size=function(t){return{width:t.cachedWidth_,height:t.cachedHeight_}},t.prototype.set_transform_style=function(t,e,i,o){if("number"===typeof e||"number"===typeof i||"number"===typeof o){var n=t.style.transform||t.style.webkitTransform||"translate(0px, 0px) scale(1)",s=n;if("number"===typeof e||"number"===typeof i){var _=r.vec2.fromValues(0,0),a=void 0!=s&&s.match(g);a&&(_[0]=parseFloat(a[1]),_[1]=parseFloat(a[3]));var c="number"===typeof e?e:_[0],l="number"===typeof i?i:_[1];if(c!==_[0]||l!==_[1]){var d="translate(".concat(c,"px, ").concat(l,"px)");s=s.replace(/translate\([^)]+\)/,d)}}"number"===typeof o&&(s=s.replace(/scale\([^)]+\)/,"scale(".concat(o,")"))),s!==n&&(t.style.transform=s,t.style.webkitTransform=s)}},t.prototype.parse_attrs=function(t){var e={};if(!t)return e;try{t.split(/\s/).forEach((function(t){if(!(t.length<2)){var i=t.split("="),o=i[0],n=i[1];e[o]=n.slice(1,n.length-1)}}))}catch(i){console.error("Parsing shadow attribute error: ".concat(i))}return e},t.prototype.dom_to_string=function(t){return(new XMLSerializer).serializeToString(t)},t.prototype.start_text_cache=function(){this.cache_reference++},t.prototype.stop_text_cache=function(){this.cache_reference--,this.cache_reference||(this.cached_widths.clear(),this.cached_style="")},t.prototype.measure_text=function(t,e){if(!this.canvas_context){var i=document.createElement("canvas");i.style.display="none",document.body.appendChild(i),this.canvas_context=i.getContext("2d")}return this.canvas_context.font=e,this.canvas_context.measureText(t).width},t.prototype.get_cached_width=function(t){var e=this,i="".concat(t.textContent,"\n").concat(t.className.baseVal),o=this.cached_widths.get(i)||0;if(o)return o;try{if(!this.cached_style){var n=function(t){var i=window.getComputedStyle(t);e.cached_style="".concat(i.fontWeight," ").concat(i.fontSize," ").concat(i.fontFamily)};if(document.body.contains(t))n(t);else{for(var r=t;r.parentNode&&"text"!==r.tagName.toLowerCase();)r=r.parentNode;var s=r.cloneNode(!0);document.body.appendChild(s),n(s),document.body.removeChild(s)}}o=this.measure_text(t.textContent||"",this.cached_style)}catch(a){console.warn(a);var _=t.textContent;return void 0==_?0:8*_.length}return this.cached_widths.set(i,o),o},o.__decorate([(0,c.lazy_inject)(c.BINDING.Msg)],t.prototype,"Msg",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.widget_div)],t.prototype,"widget_div",void 0),o.__decorate([(0,c.lazy_inject)(c.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Utils=b},34491:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.WidgetDiv=void 0;var o=i(98734),n=i(61455),r=i(25461),s=i(12988),_=function(){function t(){this.dispose_=void 0}return t.prototype.create_dom=function(){void 0==this.DIV&&(this.DIV=(0,r.create_dom)("div","blocklyWidgetDiv"),document.body.appendChild(this.DIV))},t.prototype.show=function(t,e){if(this.hide(),this.owner_=t,this.dispose_=e,void 0!=this.DIV){var i=(0,s.get_viewport_page_offset)(document);this.DIV.style.top="".concat(i[1],"px"),this.DIV.style.direction="ltr",this.DIV.style.display="block"}},t.prototype.hide=function(){this.is_visible()&&(this.owner_=void 0,this.dispose_&&this.dispose_(),this.dispose_=void 0,this.hide_and_clear_dom())},t.prototype.hide_and_clear_dom=function(){void 0!=this.DIV&&(this.DIV.setAttribute("style","display: none;"),(0,r.remove_children)(this.DIV))},t.prototype.is_visible=function(){return!!this.owner_},t.prototype.hide_if_owner=function(t){this.owner_==t&&this.hide()},t.prototype.position=function(t,e,i,o,n){e<(o=o||(0,s.get_viewport_page_offset)(document))[1]&&(e=o[1]),n?t>(i=i||(0,r.get_viewport_size)()).width+o[0]&&(t=i.width+o[0]):t<o[0]&&(t=o[0]),void 0!=this.DIV&&(this.DIV.style.left="".concat(t,"px"),this.DIV.style.top="".concat(e,"px"),this.DIV.style.height="0px",this.DIV.setAttribute("tabindex","-1"),this.DIV.style.outline="none",this.DIV.focus())},t.prototype.position_with_anchor=function(t,e,i,o){var n=this.calculate_y(t,e,i),r=this.calculate_x(t,e,i,o);this.position_internal(r,n,i.height)},t.prototype.calculate_y=function(t,e,i){return e.bottom+i.height>=t.bottom?e.top-i.height:e.bottom},t.prototype.calculate_x=function(t,e,i,o){if(o){var n=e.right-i.width,r=Math.max(n,t.left);return Math.min(r,t.right-i.width)}r=Math.min(e.left,t.right-i.width);return Math.max(r,t.left)},t.prototype.position_internal=function(t,e,i){void 0!=this.DIV&&(this.DIV.style.left="".concat(t,"px"),this.DIV.style.top="".concat(e,"px"),this.DIV.style.height="".concat(i,"px"))},t=o.__decorate([(0,n.injectable)()],t)}();e.WidgetDiv=_},1103:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.SimplifiedCommentBubble=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(81558),_=i(61972),a=i(75102),c=i(25461),l=function(){function t(){this.is_showing=!1,this.selected_comment="",this.comments=new Map}return t.prototype.popup=function(t){var e,i=this;if(!this.is_showing){this.is_showing=!0,this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:a.UIEventType.COMMENT_OPEN,workspace_id:t.workspace.id,old_value:!1,new_value:!0,block_id:t.id}));var o=null===(e=t.get_icon())||void 0===e?void 0:e.children;if(o)for(var n=0;n<o.length;n++)o[n].setAttribute("data-showing","true");this.update_bubble("reset",t),this.bubble_&&(document.body.appendChild(this.bubble_),this.animate_once(this.bubble_,"showBubbleAnimation"));var r=function e(n){if(n.type!==a.UIEventType.H_SCROLLBAR_SET&&n.type!==a.UIEventType.V_SCROLLBAR_SET&&(n.type!==a.BlockEventType.CHANGE||"comment"!==n.element||n.get_new_value()||0===i.comments.size)){if(n.type===a.BlockEventType.CHANGE&&"comment_text"===n.element){var r=n.get_block_id();if(r&&i.comments.get(r))return}if(n.type!==a.UIEventType.SIMPLIFIED_COMMENT_EDIT&&n.type!==a.UIEventType.SIMPLIFIED_COMMENT_DELETE&&n.type!==a.UIEventType.SIMPLIFIED_COMMENT_SELECT){if(o)for(var s=0;s<o.length;s++)o[s].removeAttribute("data-showing");i.bubble_&&(i.animate_once(i.bubble_,"hideBubbleAnimation",(function(){i.bubble_&&(0,c.remove_node)(i.bubble_)})),t.workspace.remove_change_listener(e),i.is_showing=!1,i.comments.clear(),i.selected_comment="",i.events.is_enabled()&&i.events.fire(i.ui_event_factory({type:a.UIEventType.COMMENT_OPEN,workspace_id:t.workspace.id,old_value:!0,new_value:!1,block_id:t.id})))}}};window.setTimeout((function(){return t.workspace.add_change_listener(r)}))}},t.prototype.update_bubble=function(t,e){var i,o=this,n=e.get_parent_block();if(n&&(this.bubble_||(this.bubble_=document.createElement("div"),this.bubble_.classList.add("blocklySimplifiedCommentBubble","blocklySimplifiedCommentBubbleCover"),this.bubble_content_=document.createElement("div"),this.bubble_content_.classList.add("blocklySimplifiedCommentBubbleContent")),this.bubble_content_))if("reset"!==t){if("remove"===t){var r=null===(i=null===(a=this.comments.get(e.id))||void 0===a?void 0:a.parentElement)||void 0===i?void 0:i.parentElement;return r&&this.bubble_content_.removeChild(r),this.comments.delete(e.id),void(this.selected_comment="")}var a;if("edit"!==t);else(a=this.comments.get(e.id))&&(a.innerText=e.get_text())}else{for(;this.bubble_content_.firstChild;)this.bubble_content_.removeChild(this.bubble_content_.firstChild);for(var c=(0,s.get_outer_block)(n),l=(0,s.get_nested_blocks_with_comment)(c),d=0;d<l.length;d++){var u=l[d];if((0,_.is_block_group)(u))u.nested_blocks_with_comment.forEach((function(t){o.create_comment_bubble_text(t)}));else this.create_comment_bubble_text(l[d])}}},t.prototype.create_comment_bubble_text=function(t){var e=this,i=t.comment;if(i){var o=document.createElement("div");o.classList.add("blocklySimplifiedCommentTextWrapper");var n=document.createElement("div");n.classList.add("blocklySimplifiedCommentTextDecorator"),n.style.backgroundColor=t.get_colour().toString();var r=document.createElement("div");r.classList.add("blocklySimplifiedCommentTextBg");var s=document.createElement("div");s.classList.add("blocklySimplifiedCommentText");var _=function(){return 1!==e.comments.size||t.is_output_block()};this.events.bind_event_with_checks(r,"click",i,(function(){var t,o,n;if(_()){var r=e.selected_comment;if(r){e.selected_comment="";var s=e.comments.get(r);if(null===(t=null===s||void 0===s?void 0:s.parentElement)||void 0===t||t.classList.remove("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:i.workspace.id,old_value:!0,new_value:!1,block_id:r})),r!==i.id){e.selected_comment=i.id;var c=e.comments.get(i.id);null===(o=null===c||void 0===c?void 0:c.parentElement)||void 0===o||o.classList.add("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:i.workspace.id,old_value:!1,new_value:!0,block_id:i.id}))}}else{e.selected_comment=i.id;var l=e.comments.get(i.id);null===(n=null===l||void 0===l?void 0:l.parentElement)||void 0===n||n.classList.add("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:i.workspace.id,old_value:!1,new_value:!0,block_id:i.id}))}}}));var c=document.createElement("div");c.classList.add("blocklySimplifiedCommentTextSeparator");var l=new Image;l.src=this.Msg.ICON_COMMENT_EDIT,l.alt="Edit",l.classList.add("blocklySimplifiedCommentEditButton"),this.events.bind_event_with_checks(l,"click",i,(function(){e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_EDIT,workspace_id:i.workspace.id,old_value:void 0,new_value:void 0,block_id:i.id})),i.focus()}));var d=new Image;d.src=this.Msg.ICON_COMMENT_REMOVE,d.classList.add("blocklySimplifiedCommentRemoveButton"),this.events.bind_event_with_checks(d,"click",i,(function(){e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_DELETE,workspace_id:i.workspace.id,old_value:void 0,new_value:void 0,block_id:i.id})),t.set_comment_text(void 0)}));var u=new Image;u.src=this.Msg.ICON_COMMENT_MORE,u.classList.add("blocklySimplifiedCommentMoreButton"),u.setAttribute("tabindex","-1");var h=!1,p=!1;this.events.bind_event_with_checks(u,"focus",i,(function(){var t,o;if(!p){var c,g;if(p=!0,_()&&(c=e.selected_comment,e.selected_comment=i.id),c&&c!==i.id)if(e.events.is_enabled())null===(t=null===(g=e.comments.get(c))||void 0===g?void 0:g.parentElement)||void 0===t||t.classList.remove("blocklySimplifiedCommentTextActive"),e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:i.workspace.id,old_value:!0,new_value:!1,block_id:c}));if(e.selected_comment&&c!==i.id)null===(o=null===(g=e.comments.get(i.id))||void 0===g?void 0:g.parentElement)||void 0===o||o.classList.add("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:i.workspace.id,old_value:!1,new_value:!0,block_id:i.id}));l.style.display="block",e.animate_once(l,"showEditButtonAnimation"),d.style.display="block",e.animate_once(d,"showRemoveButtonAnimation"),e.animate_once(u,"expandMoreButtonAnimation",(function(){u.style.transform="rotate(90deg)",h=!0,p=!1})),n.style.opacity="0.4",n.style.left="26px",s.style.opacity="0.4",r.style.marginLeft="26px"}})),this.events.bind_event_with_checks(u,"blur",i,(function(){p||(p=!0,e.animate_once(l,"hideEditButtonAnimation",(function(){return l.style.display=""})),e.animate_once(d,"hideRemoveButtonAnimation",(function(){return d.style.display=""})),e.animate_once(u,"collapseMoreButtonAnimation",(function(){u.style.transform="",h=!1,p=!1})),s.style.opacity="",r.style.marginLeft="",n.style.opacity="",n.style.left="")})),this.events.bind_event_with_checks(u,"click",i,(function(){h?u.blur():u.focus()})),s.innerText=i.get_text(),this.comments.set(i.id,s),this.bubble_&&this.bubble_content_&&(o.appendChild(n),o.appendChild(r),r.appendChild(s),c&&o.appendChild(c),o.appendChild(l),o.appendChild(d),o.appendChild(u),this.bubble_content_.appendChild(o),this.bubble_.appendChild(this.bubble_content_))}},t.prototype.animate_once=function(t,e,i){var o=function o(){t&&(t.removeEventListener("webkitAnimationEnd",o),t.removeEventListener("animationend",o),t.classList.remove(e),i&&i())};t.addEventListener("webkitAnimationEnd",o),t.addEventListener("animationend",o),t.classList.add(e)},o.__decorate([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.Msg)],t.prototype,"Msg",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.SimplifiedCommentBubble=l},61236:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceDB=void 0;var o=i(98734),n=i(61455),r=function(){function t(){this.db=new Map}return t.prototype.add=function(t){this.db.set(t.id,t)},t.prototype.remove=function(t){return this.db.delete(t.id)},t.prototype.get=function(t){return this.db.get(t)},t=o.__decorate([(0,n.injectable)()],t)}();e.WorkspaceDB=r},21848:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Xml=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(75102),_=i(98030),a=i(61972),c=i(56905),l=i(11214),d=o.__importStar(i(25461)),u=function(){function t(){this.grouped_blocks=[],this.scoped_connections=[]}return t.prototype.workspace_to_dom=function(t,e){for(var i=d.create_dom("xml"),o=t.get_top_blocks(!0),n=0;n<o.length;n++){var r=o[n];r.is_insertion_marker()||r.parent_group||i.appendChild(this.block_to_dom_with_xy(r,e))}var s=t.get_top_comments(!0);for(n=0;n<s.length;n++){var _=s[n];i.appendChild(this.comment_to_dom_with_xy(_,e))}return i},t.prototype.dom_to_workspace=function(t,e){var i=[];this.utils.start_text_cache();var o=t.childNodes.length,n=this.events.get_group();n||this.events.set_group(!0);var s=e.is_resizes_enabled();s&&e.set_resizes_enabled(!1);try{for(var _=0;_<o;_++){var c=t.childNodes[_],l=c.nodeName.toLowerCase(),d=void 0;if("block"==l||"shadow"==l&&!this.events.is_record_undo()||"empty"==l&&!this.events.is_record_undo()?d=this.dom_to_block(c,e):"shadow"===l||"empty"===l?console.error("Shadow block cannot be a top-level block."):"comment"===l&&(d=this.dom_to_workspace_comment(c,e)),d){i.push(d.id);var u=parseInt(c.getAttribute("x")||"0",10),h=parseInt(c.getAttribute("y")||"0",10);isNaN(u)||isNaN(h)||(u=e.RTL?0-u:u,(0,a.is_block_svg)(d)&&d.parent_group?d.parent_group.move_by(r.vec2.fromValues(u,h)):d.move_by(r.vec2.fromValues(u,h)))}}}finally{n||this.events.set_group(!1),this.utils.stop_text_cache()}return s&&e.set_resizes_enabled(!0),i},t.prototype.block_to_dom=function(t,e){var i,o,n,r;if((0,a.is_block_group)(t)){n=this.block_to_dom(t.origin_block,e);var _=t.get_field_value(s.BLOCK_GROUP_NAME_FIELD_NAME);if((0,c.assert)("string"===typeof _),n.setAttribute(s.BLOCK_GROUP_NAME_XML_TAG,_),n.setAttribute(s.BLOCK_GROUP_ID_XML_TAG,t.id),t.group_type!==s.BlockGroupType.EXECUTION)return n;var l=null===(i=t.next_connection)||void 0===i?void 0:i.targetBlock(),u=l&&this.block_to_dom(l,e);if(u){u.setAttribute(s.BLOCK_GROUP_STOPPED_XML_TAG,"true");var h=n.querySelector("next[".concat(s.LAST_NEXT_XML_TAG,'="true"]'));null===h||void 0===h||h.removeAttribute(s.LAST_NEXT_XML_TAG),null===h||void 0===h||h.appendChild(u)}return n}if((n=t.is_shadow()?t.is_editable()?d.create_dom("shadow"):d.create_dom("empty"):d.create_dom("block")).setAttribute("type",t.type),e||n.setAttribute("id",t.id),t.mutationToDom){var p=t.mutationToDom();p&&(p.hasChildNodes()||p.hasAttributes())&&n.appendChild(p)}for(var g=0;g<t.inputList.length;g++)for(var f=t.inputList[g],v=0;v<f.fieldRow.length;v++){var m=f.fieldRow[v];this.field_to_dom(m,n)}if(t.parent_group?(t.parent_group.comment&&n.appendChild(this.comment_to_dom(t.parent_group.comment)),n.setAttribute("visible",t.parent_group.visibility_)):(t.comment&&n.appendChild(this.comment_to_dom(t.comment)),n.setAttribute("visible",t.visibility_)),t.data){var b=d.create_dom("data",void 0,t.data);n.appendChild(b)}for(g=0;g<t.inputList.length;g++){var y=!0;if((f=t.inputList[g]).type!=s.InputType.DUMMY&&f.connection){var E=f.connection.targetBlock();f.type==s.InputType.VALUE?r=d.create_dom("value"):f.type==s.InputType.STATEMENT&&(r=d.create_dom("statement"));var k=f.connection.get_shadow_dom();!k||E&&E.is_shadow()||r&&r.appendChild(this.clone_shadow(k)),E&&(r&&r.appendChild(this.block_to_dom(E,e)),y=!1),r&&r.setAttribute("name",f.name),y||n.appendChild(r)}}t.inputs_inline_default!=t.inputs_inline&&n.setAttribute("inline",String(t.inputs_inline)),t.is_collapsed()&&n.setAttribute("collapsed",String(!0)),t.disabled&&n.setAttribute("disabled",String(!0)),t.deletable_||n.setAttribute("deletable",String(!1)),t.movable_||n.setAttribute("movable",String(!1)),t.editable_||n.setAttribute("editable",String(!1));var T=null===(o=t.next_connection)||void 0===o?void 0:o.targetBlock();if(T){var w=d.create_dom("next",void 0,this.block_to_dom(T,e));n.appendChild(w)}else if(t.next_connection){var O=t.get_root_block();if(t.next_connection===O.last_connection_in_stack())(w=d.create_dom("next")).setAttribute("".concat(s.LAST_NEXT_XML_TAG),"true"),n.appendChild(w)}var N=t.next_connection&&t.next_connection.get_shadow_dom();return!N||T&&T.is_shadow()||r&&r.appendChild(this.clone_shadow(N)),n},t.prototype.field_to_dom=function(t,e){if(t.name&&t.editable){var i=d.create_dom("field",void 0,String(t.get_value())),o=t.name;(0,a.is_field_number)(t)&&(o=this.field_number_to_dom(t,i)),(0,a.is_field_default_value)(t)&&this.field_default_value_to_dom(t,i),t.is_highlight()&&i.setAttribute("highlight","true"),t.is_uneditable()&&i.setAttribute("uneditable","true"),i.setAttribute("name",o),e.appendChild(i)}},t.prototype.field_number_to_dom=function(t,e){var i=[t.min_,t.max_,t.precision_,t.mod_].join(",");if(e.setAttribute("constraints",i),void 0!=t.exceptions){var o=t.exceptions.join(",");e.setAttribute("exceptions",o)}var n=t.get_controller_option();if(n){var r=void 0;r=n.type===s.ControllerType.SLIDER?[n.type,n.left_text,n.right_text].join(","):n.type===s.ControllerType.COLOR_PICKER?[n.type,n.color_format,n.line].join(","):n.type,e.setAttribute("controller",r)}var _=t.name;return t.allow_text&&(e.setAttribute("allow_text","true"),(0,l.is_valid_number)(t.get_value())||(_="TEXT")),_},t.prototype.field_default_value_to_dom=function(t,e){var i=t.get_has_been_edited();e.setAttribute("has_been_edited",String(i))},t.prototype.clone_shadow=function(t){for(var e,i=t=d.clone_node(t,!0);i;)if(i.firstChild)i=i.firstChild;else{for(;i&&!i.nextSibling;)e=i,i=i.parentNode,e.nodeType==s.NodeType.TEXT&&""==e.data.trim()&&i.firstChild!=e&&d.remove_node(e);i&&(e=i,i=i.nextSibling,e.nodeType==s.NodeType.TEXT&&""==e.data.trim()&&d.remove_node(e))}return t},t.prototype.dom_to_block=function(t,e){var i;this.events.disable();try{i=this.dom_to_block_headless(t,e);var o=this.scoped_connections.slice();this.scoped_connections.length=0;for(var n=0;n<o.length;n++){var r=o[n],s=r[0],_=r[1];_.connect(s,!0)||this.handle_unconnectable_child_block(s.source_block,_)}if(e.rendered){i.set_connections_hidden(!0);var a=i.get_descendants(!1);for(n=a.length-1;n>=0;n--)a[n].respawn_all_shadows();for(n=(a=i.get_descendants(!1)).length-1;n>=0;n--)a[n].init_svg();for(n=a.length-1;n>=0;n--)a[n].update_collapsed(),a[n].render(!1);for(n=a.length-1;n>=0;n--){(d=a[n]).comment&&d.comment.init_svg()}var c=this.grouped_blocks.slice();this.grouped_blocks.length=0;for(n=c.length-1;n>=0;n--){var l=c[n],d=l.block,u=l.id,h=l.name,p=l.group_stop_at;d.hide_into_group(h,{id:u,group_stop_at:p})}window.setTimeout((function(){if(void 0!=i&&void 0!=i.get_workspace()){i.set_connections_hidden(!1);for(var t=0,e=c;t<e.length;t++){e[t].block.set_connections_hidden(!1)}}}),1),i.update_disabled()}}finally{this.events.enable()}return this.events.is_enabled()&&this.events.fire(this.create_event_factory({block:i})),i},t.prototype.dom_to_block_headless=function(t,e,i){var o=t.getAttribute("type");if(void 0==o)throw new ReferenceError("Block type unspecified.");var n=t.getAttribute("id")||i||void 0,r=t.nodeName.toLowerCase(),_=e.new_block(o,n),a=t.getAttribute(s.BLOCK_GROUP_ID_XML_TAG);a&&e.get_block_by_id(a)&&(a=(0,l.gen_uid)());var c=t.getAttribute(s.BLOCK_GROUP_NAME_XML_TAG);if("true"===t.getAttribute(s.BLOCK_GROUP_STOPPED_XML_TAG))for(var d=this.grouped_blocks.length-1;d>=0;d--){var u=this.grouped_blocks[d];u.block.is_starting_block()||u.block.is_output_block()||void 0!==u.group_stop_at||(u.group_stop_at=a||_.id)}a&&c&&this.grouped_blocks.push({block:_,id:a,name:c});for(d=0;d<t.childNodes.length;d++){var h=t.childNodes[d];if(h.nodeType!=s.NodeType.TEXT){for(var p=void 0,g=void 0,f=0;f<h.childNodes.length;f++){var v=h.childNodes[f];if(v.nodeType==s.NodeType.ELEMENT){var m=v.nodeName.toLowerCase();"block"==m?g=v:"shadow"!=m&&"empty"!==m||(p=v)}}switch(h.nodeName.toLowerCase()){case"mutation":_.domToMutation&&(_.domToMutation(h),void 0!=_.init_svg&&_.init_svg());break;case"comment":_.set_comment_text("",h.getAttribute("id")||void 0),this.parse_comment_attributes(h,_.comment);break;case"data":_.data=h.textContent;break;case"title":case"field":this.parse_child_field(h,_);break;case"value":case"statement":var b=h.getAttribute("name"),y=_.get_input(b);if(!y||!y.connection){console.warn("Ignoring non-existent input ".concat(b," in block ").concat(o));break}this.parse_connection(e,y.connection,p,g);break;case"next":if(!_.next_connection){console.error("Trying to connect to invalid next connect: ".concat(_));break}this.parse_connection(e,_.next_connection,p,g);break;case"short":break;default:console.warn("Ignoring unknown tag: ".concat(h.nodeName))}}}var E=t.getAttribute("inline");E&&_.set_inputs_inline("true"==E);var k=t.getAttribute("disabled");k&&_.set_disabled("true"==k);var T=t.getAttribute("deletable");T&&_.set_deletable("true"==T);var w=t.getAttribute("movable");w&&_.set_movable("true"==w);var O=t.getAttribute("editable");O&&_.set_editable("true"==O);var N=t.getAttribute("visible");if(N){var I=void 0;I="false"===N||N===s.BlockVisibility.TRANSLUCENT?s.BlockVisibility.TRANSLUCENT:"hidden"===N?s.BlockVisibility.HIDDEN:s.BlockVisibility.VISIBLE,_.set_chunk_visibility(I)}if("shadow"===r||"empty"===r){var A=_.get_children();for(d=0;d<A.length;d++){A[d].is_shadow()||console.error("Shadow block not allowed non-shadow child.")}_.set_shadow(!0),"empty"===r&&_.set_editable(!1)}var C=t.getAttribute("collapsed");return C&&_.set_collapsed("true"==C),_},t.prototype.parse_fields=function(t,e){for(var i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];o.nodeType!==s.NodeType.TEXT&&("field"===o.nodeName.toLowerCase()&&this.parse_child_field(o,e))}},t.prototype.parse_connection=function(t,e,i,o){var n;if(i&&((null===(n=e.targetBlock())||void 0===n?void 0:n.is_shadow())&&e.remove_shadow(),e.set_shadow_dom(i)),o){var r=this.dom_to_block_headless(o,t,void 0),s=r.output_connection||r.previous_connection;s?s.context?this.scoped_connections.push([s,e]):e.connect(s,!0)||this.handle_unconnectable_child_block(r,e):console.error("Child block does not have output or previous statement.")}},t.prototype.handle_unconnectable_child_block=function(t,e){if(this.runtime_data.is_pasting())t.dispose(!1,!1);else for(var i=t.get_descendants(!1),o=i.length-1;o>=0;o--)i[o].init_svg(),i[o].update_collapsed(),i[o].render(!1);e.respawn_shadow()},t.prototype.parse_child_field=function(t,e){var i=t.getAttribute("name");if(void 0!=i){"true"===t.getAttribute("allow_text")&&"NUM"!==i&&(i="NUM");var o=e.get_field(i);if(o){var n=t.textContent;if((0,a.is_field_number)(o)){var r=t.getAttribute("constraints");if(r){var _=r.split(",");o.set_constraints(_[0],_[1],_[2]),_[3]&&o.set_mod(_[3])}var c=t.getAttribute("exceptions");if(c){var l=[];l=c.split(",").map((function(t){return+t})),o.set_exceptions(l)}var d=t.getAttribute("allow_text"),u=void 0;d&&(u="true"===d),o.set_allow_text&&o.set_allow_text(u);var h=t.getAttribute("controller");if(h){var p=void 0;p="SLIDER"===(l=h.split(","))[0]?{type:s.ControllerType.SLIDER,left_text:l[1],right_text:l[2]}:"COLOR_PICKER"===l[0]?{type:s.ControllerType.COLOR_PICKER,color_format:l[1],line:l[2]}:{type:s.ControllerType.ANGLE_SCALE},o.set_controller_option(p)}}if((0,a.is_field_default_value)(o)){var g=t.getAttribute("has_been_edited");g&&o.set_has_been_edited("true"===g)}var f=t.getAttribute("uneditable");f&&o.set_uneditable("true"===f);var v=t.getAttribute("highlight");v&&o.set_highlight("true"===v);var m=o.call_validator(n);void 0!=m&&"FieldImage"!==o.field_type&&o.set_value(m)}}},t.prototype.dom_to_text=function(t){return this.utils.dom_to_string(t)},t.prototype.text_to_dom=function(t){return this.utils.string_to_dom(t)},t.prototype.block_to_dom_with_xy=function(t,e){var i,o=this.block_to_dom(t,e),n=(null===(i=t.parent_group)||void 0===i?void 0:i.get_relative_to_surface_xy())||t.get_relative_to_surface_xy();return o.setAttribute("x",String(Math.round(n[0]))),o.setAttribute("y",String(Math.round(n[1]))),o},t.prototype.filter_undefined_blocks=function(t,e){void 0===e&&(e=!1);for(var i=!1,o=t.querySelectorAll("block"),n=0;n<o.length;n++){var r=o[n],s=r.getAttribute("type");if(!this.Blink.Blocks[s]){i||(i=!0);var _=r.parentElement;if("NEXT"===_.nodeName)_.parentElement.removeChild(_);else _.removeChild(r)}}return e?{xml:t,deleted:i}:t},t.prototype.comment_to_dom_with_xy=function(t,e){var i=this.comment_to_dom(t,e),o=t.get_relative_to_surface_xy();return i.setAttribute("x",String(Math.round(o[0]))),i.setAttribute("y",String(Math.round(o[1]))),i},t.prototype.dom_to_workspace_comment=function(t,e){var i=t.getAttribute("id")||void 0,o=e.new_workspace_comment(void 0,i);return this.parse_comment_attributes(t,o),o.init_svg(),o},t.prototype.comment_to_dom=function(t,e){var i=t.get_text(),o=d.create_dom("comment",void 0,i);o.setAttribute("pinned",String(t.is_expanded()));var n=t.get_bubble_size();o.setAttribute("h",String(n.height)),o.setAttribute("w",String(n.width));var r=t.get_relative_position();return o.setAttribute("relativeleft_","".concat(r[0])),o.setAttribute("relativetop_","".concat(r[1])),o.setAttribute("auto_layout",String(t.is_auto_layout())),o.setAttribute("color_theme",String(t.get_color_theme())),e||o.setAttribute("id",t.id),o},t.prototype.parse_comment_attributes=function(t,e){if(e){e.set_text(t.textContent||"");var i=t.getAttribute("pinned");i&&e.set_expanded("true"==i);var o=parseInt(t.getAttribute("w")||"",10),n=parseInt(t.getAttribute("h")||"",10);isNaN(o)||isNaN(n)||e.set_bubble_size(o,n);var s=parseFloat(t.getAttribute("relativeleft_")||""),_=parseFloat(t.getAttribute("relativetop_")||"");isNaN(s)||isNaN(_)||e.set_relative_position(r.vec2.fromValues(s,_));var c=t.getAttribute("auto_layout");c&&e.set_auto_layout("true"===c);var l=t.getAttribute("color_theme");(0,a.is_comment_theme)(l)&&e.set_color_theme(l,!0)}},t.prototype.dom_to_workspace_element=function(t,e){var i=t.tagName.toLowerCase();return"block"===i?this.dom_to_block(t,e):"comment"===i?this.dom_to_workspace_comment(t,e):void console.error("Undefined workspace element: ".concat(t))},t.prototype.workspace_element_to_dom=function(t,e){return(0,a.is_block_svg)(t)?this.block_to_dom(t,e):(0,a.is_workspace_comment)(t)?this.comment_to_dom(t,e):(console.error("Undefined workspace element: ".concat(t)),d.create_dom("element"))},t.prototype.workspace_element_to_dom_with_xy=function(t,e){return(0,a.is_block_svg)(t)?this.block_to_dom_with_xy(t,e):(0,a.is_workspace_comment)(t)?this.comment_to_dom_with_xy(t,e):(console.error("Undefined workspace element: ".concat(t)),d.create_dom("element"))},o.__decorate([(0,_.lazy_inject)(_.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.Blink)],t.prototype,"Blink",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Xml=u},1247:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.BLINK_CSS_CONTENT=void 0,e.BLINK_CSS_CONTENT='.blocklyText{cursor:default;fill:#fff;pointer-events:none}.blocklyEditable .blocklyText{fill:#333}.blocklyEditable .blocklyTextDefault{fill:rgba(51,51,51,.4)}.dark .blocklyEditable .blocklyText{fill:#fff}.blockly_head_icon_wrapper{stroke-dasharray:97;stroke-dashoffset:158;stroke-linecap:round;stroke-width:1px}.blocklyDisabled .blocklyFieldDropdownNonShadow>g,.blocklyDisabled>.blocklyEditableTextBlack>g:not(.b-text-group){fill:#abafb6!important}.blocklyDisabled>.blocklyEditableTextBlack>rect,.blocklyDisabled>.blocklyFieldDropdownNonShadow>rect,.blocklyDisabled>path{stroke:#9399a4}.blocklyDisabled .blocklyDropdownArrow,.blocklyDisabled>.blocklyEditableTextBlack>.dropdown_element>path{fill:#686d76!important}.blocklyDisabled .blockly_head_icon_wrapper{fill:#abafb6!important;stroke:#9399a4!important}.InsertionMarker>.blocklyPath{stroke:none}.blocklyDraggable .output-block-hover:hover>path{stroke:#fff;stroke-width:2px}.blocklySurroundShadow{fill:transparent;stroke:#fff;stroke-width:2px;pointer-events:none}.blocklyBlockDisposeWrapper{position:absolute}.blocklyBlockDisposeWrapper .blocklyBlockDispose{-webkit-animation:dispose 150ms linear forwards;animation:dispose 150ms linear forwards}@-webkit-keyframes dispose{from{transform:scale(1)}to{transform:scale(0)}}@keyframes dispose{from{transform:scale(1)}to{transform:scale(0)}}.blocklyBlockTranslucent{opacity:.5}.blocklyBlockHidden{opacity:0;pointer-events:none}.blocklyBlockUnOperable{pointer-events:none}.blocklyStackGlow{-webkit-filter:url(#blocklySelectedFilter);filter:url(#blocklySelectedFilter)}.procedures_2_defnoreturn>.blocklyEditable text,.procedures_2_parameter>.blocklyEditable .blocklyText,.procedures_2_stable_parameter>.blocklyEditable .blocklyText{fill:#fff}.procedures_2_stable_parameter>.blocklyText:nth-child(3){fill:rgba(255,255,255,.5)}.procedures_2_defnoreturn>.blocklyEditable>rect{stroke:rgba(194,106,81,.5)}.procedures_2_parameter>.blocklyEditable>rect,.procedures_2_stable_parameter>.blocklyEditable>rect{display:none}.decoration_for_collapsed_blocks{pointer-events:none}.blocklyDraggable>.blocklyFieldTextInput>rect{fill:rgba(0,0,0,.1);cursor:default}.blocklyDraggable>.blocklyFieldTextInput .blocklyText{fill:#fff}.blocklyDraggable>.blocklyFieldTextInput .blocklyTextDefault{fill:rgba(255,255,255,.4)}.color_selector{width:112px}.color_selector_item{float:left;width:16px;height:16px;box-shadow:inset 0 0 0 1px #666}.color_selector_item:hover{box-shadow:inset 0 0 0 1px #fff}.blocklyFieldDropdown>rect,.blocklyShadowDropdown>path{cursor:pointer;fill:#fff;fill-opacity:.6}.blocklyFieldDropdown>rect:hover,.blocklyShadowDropdown>path:hover{fill-opacity:.8}.blocklyFieldDropdown[data-showing=true]>rect,.blocklyShadowDropdown[data-showing=true]>path{cursor:pointer;fill:#000;fill-opacity:.1}.blocklyShadow .blocklyFieldDropdown>rect{opacity:0;pointer-events:none}.dark .blocklyFieldDropdown>rect,.dark .blocklyShadowDropdown>path{cursor:pointer;fill:#fff;fill-opacity:.15;stroke:rgba(0,0,0,.15)}.dark .blocklyFieldDropdown>rect:hover,.dark .blocklyShadowDropdown>path:hover{fill-opacity:.3}.dark .blocklyShadowDropdown>path{fill:#000;fill-opacity:.1}.dark .blocklyFieldDropdown[data-showing=true]>rect,.dark .blocklyShadowDropdown[data-showing=true]>path{cursor:pointer;fill:#fff;fill-opacity:1;-webkit-filter:url(#blur-1px);filter:url(#blur-1px)}.dark :not(.blocklyShadowDropdown)>.blocklyFieldDropdown>.blocklyDropdownArrow{fill:#000!important;fill-opacity:.15}.dark .blocklyFieldDropdown[data-showing=true] .blocklyDropdownArrow,.dark .blocklyShadowDropdown[data-showing=true] .blocklyDropdownArrow{opacity:0}.dark .blocklyFieldDropdown[data-showing=true] .blocklyText,.dark .blocklyShadowDropdown[data-showing=true] .blocklyText{fill:#333}.blocklyQuote{fill:#333;opacity:.5}.dark .blocklyShadow>path{fill:#000;fill-opacity:.1;stroke:none}.dark .blocklyQuote{fill:#fff;opacity:1}.fieldButton{cursor:pointer}.fieldButton:hover>rect{fill:rgba(255,255,255,.4)}.dropdown_element{cursor:pointer}.blocklyPlusSign{background:center/contain no-repeat url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDU1LjEgKDc4MTM2KSAtIGh0dHBzOi8vc2tldGNoYXBwLmNvbSAtLT4KICAgIDx0aXRsZT5pY24vYWRkX2JsYWNrPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Imljbi9hZGRfYmxhY2siIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJpY25fYWRkX2JsYWNrIj4KICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgeD0iMCIgeT0iMCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIj48L3JlY3Q+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik01LDUgTDUsMiBDNSwxLjQ0NzcxNTI1IDUuNDQ3NzE1MjUsMSA2LDEgQzYuNTUyMjg0NzUsMSA3LDEuNDQ3NzE1MjUgNywyIEw3LDUgTDEwLDUgQzEwLjU1MjI4NDcsNSAxMSw1LjQ0NzcxNTI1IDExLDYgQzExLDYuNTUyMjg0NzUgMTAuNTUyMjg0Nyw3IDEwLDcgTDcsNyBMNywxMCBDNywxMC41NTIyODQ3IDYuNTUyMjg0NzUsMTEgNiwxMSBDNS40NDc3MTUyNSwxMSA1LDEwLjU1MjI4NDcgNSwxMCBMNSw3IEwyLDcgQzEuNDQ3NzE1MjUsNyAxLDYuNTUyMjg0NzUgMSw2IEMxLDUuNDQ3NzE1MjUgMS40NDc3MTUyNSw1IDIsNSBMNSw1IFoiIGlkPSJDb21iaW5lZC1TaGFwZSIgZmlsbD0iIzAwMDAwMCI+PC9wYXRoPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+);opacity:.15}.blocklyCommentGroup .blocklyCommentShape{stroke:#fff;stroke-width:2px}.blocklyCommentSymbol{fill:#fff}.blocklyCommentLine{stroke-width:2px;stroke-linecap:round;stroke-dasharray:4 6}.blocklyCommentBubble{border-radius:2px;position:relative;box-sizing:border-box}.blocklyCommentBubble .blocklyCommentTopContainer{width:100%;height:calc(100% - 8px);display:flex}.blocklyCommentBubble .blocklyCommentTopContainer .blocklyCommentMainContainer{width:calc(100% - 4px);height:100%}.blocklyCommentBubble .blocklyCommentBottomContainer{width:100%;height:4px;display:flex}@-webkit-keyframes borderEaseOut{from{margin-left:0}to{margin-left:100%}}@keyframes borderEaseOut{from{margin-left:0}to{margin-left:100%}}.blocklyCommentBorder{-webkit-animation:borderEaseOut .2s forwards ease-out;animation:borderEaseOut .2s forwards ease-out}.blockCommentEmptyBorder{height:4px;width:100%;background-color:transparent}.blocklyCommentBubbleLabel{height:32px;width:100%;display:flex;align-items:center;justify-content:space-between;padding:0 7px 0 12px}.blocklyCommentBubbleLabel .blocklyCommentBubbleIcon{margin-right:8px}.blocklyCommentBubbleLabel div{display:flex;align-items:center;font-size:12px;font-weight:400;color:#8c8c8c;line-height:12px}.blocklyCommentBubbleLabel .blocklyCommentBubbleClose{justify-self:end;fill:rgba(0,0,0,.2);cursor:pointer}.blocklyCommentTextarea{background-color:transparent;border:0;padding:0;resize:none;outline:0;font-size:14px;font-weight:400;color:#333;cursor:text;overflow:hidden;margin:8px 16px 0 12px;height:calc(100% - 44px);width:calc(100% - 28px)}.blocklyCommentTextarea::-webkit-input-placeholder{color:rgba(0,0,0,.3)}.blocklyCommentTextarea::-moz-placeholder{color:rgba(0,0,0,.3)}.blocklyCommentTextarea:-ms-input-placeholder{color:rgba(0,0,0,.3)}.blocklyCommentTextarea::placeholder{color:rgba(0,0,0,.3)}.blocklyCommentEWResize{cursor:ew-resize;width:4px;height:100%}.blocklyCommentNSResize{cursor:ns-resize;height:100%;width:calc(100% - 4px)}.blocklyCommentNWSEResize{cursor:nwse-resize;width:4px;height:4px}.createCommentAnimation{-webkit-animation:createComment .3s cubic-bezier(.34,1.56,.64,1);animation:createComment .3s cubic-bezier(.34,1.56,.64,1)}@-webkit-keyframes createComment{from{opacity:0;transform:scale(.4) rotate(-60deg) translate(-16px,-16px)}to{opacity:.4;transform:scale(1) rotate(0) translate(-16px,-16px)}}@keyframes createComment{from{opacity:0;transform:scale(.4) rotate(-60deg) translate(-16px,-16px)}to{opacity:.4;transform:scale(1) rotate(0) translate(-16px,-16px)}}.blocklySimplifiedCommentIcon[data-showing=true]>path{stroke:#fff;stroke-width:2px}.blocklySimplifiedCommentBubble{position:fixed;bottom:16px;left:0;right:0;margin:0 78px 0 24px;min-height:64px;max-height:148px;background-color:rgba(15,11,48,.95);border-radius:32px;display:flex;flex-direction:column;justify-content:center}.blocklySimplifiedCommentBubbleCover{overflow:hidden}.blocklySimplifiedCommentBubbleCover::before{content:"";position:absolute;z-index:1;width:100%;height:8px;left:0;top:0;background-image:linear-gradient(rgba(11,8,42,.8),rgba(11,8,42,.52),rgba(11,8,42,0))}.blocklySimplifiedCommentBubbleCover::after{content:"";position:absolute;width:100%;height:8px;left:0;bottom:0;background-image:linear-gradient(rgba(11,8,42,0),rgba(11,8,42,.52),rgba(11,8,42,.8))}.blocklySimplifiedCommentBubbleContent{width:100%;background:0 0;display:flex;flex-direction:column;padding:8px 0;overflow:scroll}.blocklySimplifiedCommentBubbleContent ::-webkit-scrollbar{width:0}.blocklySimplifiedCommentBubbleContent ::-webkit-scrollbar-thumb{background:0 0}.blocklySimplifiedCommentBubbleContent :last-child .blocklySimplifiedCommentTextSeparator{display:none}.showBubbleAnimation{-webkit-animation:showBubble .2s ease-out;animation:showBubble .2s ease-out}.hideBubbleAnimation{animation:showBubble .2s ease-out reverse}@-webkit-keyframes showBubble{from{bottom:-100%}to{bottom:16px}}@keyframes showBubble{from{bottom:-100%}to{bottom:16px}}.disposeBubbleContentAnimation{-webkit-animation:disposeBubbleContent 120ms ease-out;animation:disposeBubbleContent 120ms ease-out}@-webkit-keyframes disposeBubbleContent{to{opacity:0;scale:0}}@keyframes disposeBubbleContent{to{opacity:0;scale:0}}.disposeBubbleAnimation{-webkit-animation:disposeBubble .2s ease-out;animation:disposeBubble .2s ease-out}@-webkit-keyframes disposeBubble{to{bottom:48px;height:0;margin:0 128px 0 74px}}@keyframes disposeBubble{to{bottom:48px;height:0;margin:0 128px 0 74px}}.blocklySimplifiedCommentTextWrapper{position:relative}.blocklySimplifiedCommentTextDecorator{width:2px;height:14px;border-radius:2px;position:absolute;top:11px;left:42px;opacity:1;transition:opacity 120ms ease-out,left 120ms ease-out}.blocklySimplifiedCommentTextSeparator{position:absolute;bottom:0;left:42px;right:48px;height:1px;background:#c7b7ff;opacity:.2}.blocklySimplifiedCommentTextBg{margin-left:42px;margin-right:48px;opacity:1;transition:margin-left 120ms ease-out}.blocklySimplifiedCommentTextActive{background:rgba(199,183,255,.2)}.blocklySimplifiedCommentText{color:#c7b7ff;line-height:21px;min-height:37px;padding:8px 0 8px 6px;font-size:14px;word-break:break-all;width:308px;box-sizing:border-box;opacity:1;transition:opacity 120ms ease-out}.blocklySimplifiedCommentEditButton{position:absolute;top:0;right:116px;margin:auto;width:32px;height:32px;display:none}.showEditButtonAnimation{-webkit-animation:showEditButton 120ms ease-out;animation:showEditButton 120ms ease-out}.hideEditButtonAnimation{animation:showEditButton 120ms ease-out reverse}@-webkit-keyframes showEditButton{from{right:96px;opacity:0}to{right:116px;opacity:1}}@keyframes showEditButton{from{right:96px;opacity:0}to{right:116px;opacity:1}}.blocklySimplifiedCommentRemoveButton{position:absolute;top:0;right:64px;margin:auto;width:32px;height:32px;display:none}.showRemoveButtonAnimation{-webkit-animation:showRemoveButton 120ms ease-out;animation:showRemoveButton 120ms ease-out}.hideRemoveButtonAnimation{animation:showRemoveButton 120ms ease-out reverse}@-webkit-keyframes showRemoveButton{from{right:44px;opacity:0}to{right:64px;opacity:1}}@keyframes showRemoveButton{from{right:44px;opacity:0}to{right:64px;opacity:1}}.blocklySimplifiedCommentMoreButton{position:absolute;top:0;right:12px;margin:auto;width:32px;height:32px;outline:0}.expandMoreButtonAnimation{-webkit-animation:expandMoreButton 120ms ease-out;animation:expandMoreButton 120ms ease-out}.collapseMoreButtonAnimation{animation:expandMoreButton 120ms ease-out reverse}@-webkit-keyframes expandMoreButton{from{transform:rotate(0)}to{transform:rotate(90deg)}}@keyframes expandMoreButton{from{transform:rotate(0)}to{transform:rotate(90deg)}}.injectionDiv{height:100%;width:100%;position:relative;background:#fff}.injectionDiv>*{position:absolute;left:0;top:0}.injectionDiv *{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.injectionDiv ::-webkit-scrollbar{width:0;display:none}.injectionDiv ::-webkit-scrollbar-thumb{background:0 0}.blocklySvg{overflow:hidden;position:absolute}.blocklyScrollbarHorizontal,.blocklyScrollbarVertical{position:absolute;outline:0;opacity:.3}.blocklyScrollbarHorizontal .blocklyScrollbarBackground,.blocklyScrollbarVertical .blocklyScrollbarBackground{opacity:0;position:absolute}.blocklyScrollbarHorizontal .blocklyScrollbarHandle,.blocklyScrollbarVertical .blocklyScrollbarHandle{stroke:#bbb;fill:#bbb}.blocklyScrollbarHorizontal .blocklyScrollbarBackground:active+.blocklyScrollbarHandle,.blocklyScrollbarHorizontal .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,.blocklyScrollbarHorizontal .blocklyScrollbarHandle:active,.blocklyScrollbarHorizontal .blocklyScrollbarHandle:hover,.blocklyScrollbarVertical .blocklyScrollbarBackground:active+.blocklyScrollbarHandle,.blocklyScrollbarVertical .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,.blocklyScrollbarVertical .blocklyScrollbarHandle:active,.blocklyScrollbarVertical .blocklyScrollbarHandle:hover{stroke-width:4}.blocklyWsDragSurface{display:none;position:absolute;overflow:visible}.blocklyFlyout{box-shadow:rgba(191,173,163,.3) 2px 0 4px 0;background:#fbfbfb;position:absolute}.blocklyFlyout .blocklyDraggable *{cursor:-webkit-grab!important;cursor:grab!important}.blocklyFlyout .blocklyDraggable .blocklyEditable *,.blocklyFlyout .blocklyDraggable .blocklyEditableTextBlack *,.blocklyFlyout .blocklyDraggable .blocklyShadow,.blocklyFlyout .blocklyDraggable .fieldButton,.blocklyFlyout .blocklyFlyoutHidden{pointer-events:none}.blocklyFlyout .blocklyFlyoutClickable,.blocklyFlyout .blocklyFlyoutClickable *{cursor:pointer}.blocklyFlyout .blocklyLine{fill:#cacaca;cursor:default}.blocklyFlyout .blocklyButtonTip{stroke:none;font-size:12px;cursor:default}.blocklyToolboxDiv{display:flex;flex-direction:column;align-items:center;overflow-x:hidden;overflow-y:auto;position:absolute;min-width:54px;background:#fbfbfb;transform:translateZ(0);height:100%;border-right:1px solid #f0f0f0}.blocklyToolboxDiv .blocklyTreeRoot{padding:0}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow{border-radius:6px;min-width:64px;min-height:50px;white-space:nowrap;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow.blocklyTreeSelected{color:#fff;background-color:#ffb388}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow *{pointer-events:none}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow .blocklyTreeIcon{max-width:36px;max-height:28px}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow .blocklyTreeLabel{line-height:14px}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeChildren{display:block;flex-direction:column;align-items:center}.blocklyBlockDragSurface{display:none;position:absolute;top:0;left:0;right:0;bottom:0;overflow:visible;-webkit-backface-visibility:hidden;backface-visibility:hidden}.blinkGridPatternOuter{stroke-opacity:.8;stroke-width:2px}.blinkGridPatternInner{stroke-opacity:.4;stroke-width:1px}.blocklyWidgetDiv{display:none;position:fixed;z-index:99999;outline:0;box-sizing:border-box}.blocklyWidgetDiv *{box-sizing:border-box}.menu-wrapper{background:#fff;box-shadow:0 1px 6px 0 rgba(0,0,0,.15);border-radius:4px;padding:4px 0;overflow-y:auto;overflow-x:hidden;margin:0;outline:0}.menu-wrapper .menu-item{position:relative;height:32px;line-height:32px;padding:0 16px;font-size:14px;font-weight:400;color:#333;cursor:pointer;white-space:nowrap;display:flex;align-items:center;justify-content:start}.menu-wrapper .menu-item.menu-item-hover:not(.menu_item_disable):not(.menu_button),.menu-wrapper .menu-item:hover:not(.menu_item_disable):not(.menu_button){background-color:#fff7cf}.menu-wrapper .menu-item *{pointer-events:none}.menu-wrapper .menu_item_enable{cursor:default}.menu-wrapper .menu_item_disable{color:#000;opacity:.3;cursor:default}.menu-wrapper .dropdown_divider{border-top:1px solid #bbb;margin:4px 0}.menu-wrapper .menu_button{padding-right:20px;color:#fb5}.menu-wrapper .menu_button:hover{color:#c99342}.menu-wrapper .menu_group{position:relative;min-width:120px;padding-right:48px}.menu-wrapper .menu_group *{pointer-events:none}.menu-wrapper .menu_group.menu_group_expanded{background-color:#fff7cf}.menu-wrapper .menu_group::after{content:"";position:absolute;border:solid;border-width:4px 6px;border-color:transparent transparent transparent #979797;top:12px;right:4px}.menu-wrapper .menu_item_image_plus{height:56px;min-width:200px;padding-left:36px;padding-right:56px}.menu-wrapper .menu_item_image_plus>:first-child:not(.image_plus){fill:#fb5;position:absolute;left:12px}.menu-wrapper .menu_item_image_plus .image_plus{width:40px;height:40px;background:#fafafa;border:1px solid #f0f0f0;border-radius:4px;margin-right:8px;display:flex;align-items:center;justify-content:center}.menu-wrapper.scroll-smooth{scroll-behavior:smooth}.blocklyDropdownMenu{min-width:172px;max-height:314px}.menu_group_children{position:fixed;z-index:999999;outline:0;box-sizing:border-box}.menu_group_children *{box-sizing:border-box}.dropdown-triangle{position:absolute;left:50%;transform:translateX(-50%);width:0;height:0}.lower-menu .dropdown-triangle{top:0}.blocklyContextMenu{border-radius:4px;color:#fff;cursor:pointer;position:absolute}.blocklyContextMenu .italic{font-style:italic}.color-menu{width:300px;height:306px;background:#fff;box-shadow:0 1px 6px 0 rgba(76,81,89,.2);border-radius:4px;display:flex;flex-direction:column;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.color-menu .color-menu-title{width:300px;height:46px;font-size:14px;font-weight:500;color:#333;padding:16px}.color-menu .color-menu-item{width:268px;height:54px;background:#f5f9ff;border-radius:6px;margin-bottom:8px;display:flex;justify-content:center;align-items:center;cursor:pointer}.color-menu .color-menu-item:hover{background:#e8f1ff}.color-menu .color-menu-item .color-menu-item-content{padding:0 13px;height:31px;background:#e76cea;border-radius:16px;border:1px solid #b353b5;display:flex;justify-content:center;align-items:center;font-size:13px}.color-menu .color-menu-item .color-menu-item-content .color-palette{width:32px;height:24px;border-radius:12px;position:relative}.color-menu .color-menu-item .color-menu-item-content .color-palette div{width:100%;height:100%;border-radius:12px;border:1px solid #fff;position:absolute;z-index:3}.color-menu .color-menu-item .color-menu-item-content .color-palette::after,.color-menu .color-menu-item .color-menu-item-content .color-palette::before{content:"";position:absolute;width:100%;height:100%;border-radius:inherit;top:0;left:0}.color-menu .color-menu-item .color-menu-item-content .color-palette::after{display:block;background-color:inherit;z-index:2;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAClJREFUKFNj/P///38GLODDhw/YhBkYR6SG9+/fYw0lAQEB7KE0EjUAAPijQL2LySF6AAAAAElFTkSuQmCC) left center}.color-menu .color-menu-item .color-menu-item-content .color-palette::before{display:block;z-index:1;background-color:#fff}.color-menu .color-menu-item .color-menu-item-content .color-string{height:23px;line-height:23px;background:#fff;border-radius:13px;border:1px solid #b353b5;font-weight:500;color:#333;padding:0 2px}.color-menu .color-menu-item .color-menu-item-content .color-hsva,.color-menu .color-menu-item .color-menu-item-content .color-rgba{height:23px;line-height:23px;font-weight:500;color:#fff;display:flex;align-items:center}.color-menu .color-menu-item .color-menu-item-content .color-hsva div,.color-menu .color-menu-item .color-menu-item-content .color-rgba div{max-width:42px;min-width:36px;background:#fff;border-radius:13px;border:1px solid #b353b5;color:#333;margin:0 6px;text-align:center}.color-menu .color-menu-item .color-menu-item-content .color-hsva div:last-child,.color-menu .color-menu-item .color-menu-item-content .color-rgba div:last-child{margin-right:0}.color-menu .color-menu-item-selected{border:2px solid #297eff}.color-menu .injectionDiv{background:0 0}.color-menu .injectionDiv .blocklyMainBackground{display:none}.blocklyHtmlInput{border:none;position:absolute;top:0;left:0;height:100%;margin:0;outline:0;width:100%;text-align:center;border-radius:12px}.blocklyInvalidInput{background:#faa}.blocklyHtmlTextarea{line-break:anywhere;white-space:break-spaces;border:none;position:absolute;top:0;left:0;height:100%;width:100%;text-align:left;box-sizing:border-box;cursor:text;overflow:hidden;outline:0;resize:none}.blocklyDragging,.blocklyDragging *{cursor:-webkit-grabbing!important;cursor:grabbing!important}.blocklyTooltipDiv{background-color:#ffffc7;border:1px solid #ddc;box-shadow:4px 4px 20px 1px rgba(0,0,0,.15);color:#000;display:none;font-size:9pt;opacity:.9;padding:2px;position:absolute;z-index:100000;pointer-events:none}::-moz-selection{background-color:rgba(77,151,255,.25)}::selection{background-color:rgba(77,151,255,.25)}.slider-controller{height:44px;display:flex;background:#fff;box-shadow:0 0 6px 0 rgba(76,81,89,.2);border-radius:4px;padding:0 8px}.slider-controller .slider-text{font-size:12px;line-height:12px;color:#77808c;margin:auto 4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.slider-controller .slider-wrapper{position:relative;display:flex;align-items:center;justify-content:space-around;height:14px;width:156px;margin:auto}.slider-controller .slider-wrapper .slider-rail{height:6px;width:140px;border-radius:4px;margin:auto}.slider-controller .slider-wrapper .slider-rail:hover{cursor:pointer}.slider-controller .slider-wrapper .slider-handle{height:14px;width:14px;border-radius:50%;position:absolute;left:0}.slider-controller .slider-wrapper .slider-handle:hover{cursor:pointer}.slider-controller .slider-wrapper .slider-track{height:6px;width:0;border-radius:4px;position:absolute;left:8px;top:4px}.slider-controller .slider-wrapper .slider-track:hover{cursor:pointer}.angle-controller{width:204px;height:204px;background-color:#fff;box-shadow:0 0 6px 0 rgba(76,81,89,.2);border-radius:4px;position:relative;display:flex;align-items:center;justify-content:space-around}.angle-controller .degree-mark-major{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:196px}.angle-controller .degree-mark-minor{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:132px}.angle-controller .wrapper{position:relative;width:120px;height:120px;cursor:pointer}.angle-controller .wrapper .grey-circle{width:120px;height:120px;border-radius:50%;background-color:#f2f2f2}.angle-controller .wrapper .mask-wrapper{position:absolute;top:0;left:0;width:120px;height:120px;border-radius:50%;background-color:rgba(255,179,184,.4)}.angle-controller .wrapper .mask-wrapper .mask-clip{position:absolute;left:0;top:0;width:120px;height:120px;border-radius:50%;clip:rect(0,120px,60px,0);background-color:#f2f2f2}.angle-controller .wrapper .mask-wrapper .white-circle{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:64px;height:64px;border-radius:50%;background-color:#fff}.angle-controller .wrapper .base-line{position:absolute;top:50%;left:50%;transform:translateY(-50%);height:1px;width:60px;background-color:#f46767}.angle-controller .wrapper .center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:8px;height:8px;border-radius:50%;background-color:#f46767;z-index:1}.angle-controller .wrapper .pointer{position:absolute;top:50%;left:50%;height:28px;width:60px;transform-origin:left center;transform:translateY(-50%) rotate(-90deg)}.angle-controller .wrapper .pointer .pointer-line{position:absolute;top:50%;left:0;transform:translateY(-50%);height:1px;width:60px;background-color:#f46767}.angle-controller .wrapper .pointer .pointer-arrow-wrapper{position:absolute;top:0;right:0;transform:rotate(90deg)}.angle-controller .wrapper .pointer .pointer-arrow-wrapper .pointer-arrow-circle{width:28px;height:28px;border-radius:50%;background-color:#f46767;display:flex;align-items:center;justify-content:space-around}.angle-controller .wrapper .pointer .pointer-arrow-wrapper .pointer-arrow-circle .pointer-icon{font-size:16px}.color-controller{width:222px;height:277px;background:#fff;box-shadow:0 1px 6px 0 rgba(76,81,89,.4);border-radius:4px}.color-controller .color-panel{padding:16px;height:228px}.color-controller .color-panel .color-panel-item{font-size:14px;font-weight:500;color:#1a1a1a;margin-bottom:14px}.color-controller .color-panel .color-panel-item .color-label{line-height:16px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.color-controller .color-panel .color-panel-item .color-strip-panel{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAClJREFUKFNj/P///38GLODDhw/YhBkYR6SG9+/fYw0lAQEB7KE0EjUAAPijQL2LySF6AAAAAElFTkSuQmCC) left center}.color-controller .color-panel .color-panel-item .color-strip-panel{position:relative;margin-top:8px;cursor:pointer}.color-controller .color-panel .color-panel-item .color-strip-panel .color-handle{position:absolute;top:-1px;width:8px;height:14px;background:#fff;box-shadow:0 0 2px 0 rgba(0,0,0,.1);border-radius:2px;border:2px solid rgba(0,0,0,.1)}.color-controller .color-panel .color-panel-item .color-strip-panel-selected{cursor:pointer}.color-controller .color-panel .color-panel-item .color-strip{width:100%;height:12px;border-radius:4px;border:1px solid #e6e6e6}.color-controller .preview-panel{display:flex;justify-content:space-between;align-items:center;width:222px;height:49px;border-top:1px solid rgba(11,24,38,.1);padding:0 16px;font-size:14px;font-weight:500;color:#1a1a1a;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.color-controller .preview-panel .color-preview{width:24px;height:24px;border-radius:4px;border:1px solid rgba(0,0,0,.08)}.blocklyIcon{width:1em;height:1em}'},3909:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.inject_comment_filters=e.inject_extra_filters=e.FILTER=void 0;var o=i(98734).__importStar(i(22804));e.FILTER={REPLACEMENT_GLOW:"blocklyReplacementGlowFilter",DRAG_SHADOW:"blocklyDragFilter",SURROUND_SHADOW:"blocklySurroundShadowFilter",SELECTED:"blocklySelectedFilter",BOXSHADOW:"blocklyBoxShadowFilter",SURROUND_SHADOW_DARK:"blocklySurroundShadowDarkFilter",DISABLED_HEAD_ICON:"blocklyDisabledHeadIconFilter",FOCUSED:"blocklyFocusedFilter"},e.inject_extra_filters=function(t){var i,n=((i={})[e.FILTER.REPLACEMENT_GLOW]='\n      <filter id="'.concat(e.FILTER.REPLACEMENT_GLOW,'" height="160%" width="180%" y="-30%" x="-40%">\n        <feGaussianBlur in="SourceGraphic" stdDeviation="1.5"></feGaussianBlur>\n        <feComponentTransfer result="outBlur">\n          <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n        </feComponentTransfer>\n        <feFlood flood-color="#FFFFFF" flood-opacity="1" result="outColor"></feFlood>\n        <feComposite in="outColor" in2="outBlur" operator="in" result="outGlow"></feComposite>\n        <feComposite in="SourceGraphic" in2="outGlow" operator="over"></feComposite>\n      </filter>\n    '),i[e.FILTER.DRAG_SHADOW]='\n      <filter id="'.concat(e.FILTER.DRAG_SHADOW,'" height="180%" width="160%" y="-40%" x="-30%">\n\n        <feGaussianBlur stdDeviation="1"></feGaussianBlur>\n        <feComponentTransfer result="outBlur">\n          <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n        </feComponentTransfer>\n        <feFlood flood-color="#FFFFFF" flood-opacity="1" result="outColor"></feFlood>\n        <feComposite in="outColor" in2="outBlur" operator="in" result="outGlow"></feComposite>\n\n        <feGaussianBlur in="SourceAlpha" stdDeviation="6"></feGaussianBlur>\n        <feOffset dx="0" dy="2" />\n        <feComponentTransfer result="outShadow" >\n          <feFuncA type="linear" slope="0.4" />\n        </feComponentTransfer>\n\n        <feMerge>\n          <feMergeNode in="outShadow" />\n          <feMergeNode in="outGlow" />\n          <feMergeNode in="SourceGraphic" />\n        </feMerge>\n\n      </filter>\n    '),i[e.FILTER.SURROUND_SHADOW]='\n      <filter id="'.concat(e.FILTER.SURROUND_SHADOW,'" height="180%" width="160%" y="-40%" x="-30%">\n        <feFlood flood-color="#000" flood-opacity="0.2" result="shadowColor"></feFlood>\n        <feComposite in="shadowColor" in2="SourceAlpha" operator="in" result="floodShape"/>\n        <feGaussianBlur in="floodShape" stdDeviation="6" result="outShadow"></feGaussianBlur>\n        <feOffset dx="0" dy="0" />\n\n        <feMerge>\n          <feMergeNode in="outShadow" />\n          <feMergeNode in="SourceGraphic" />\n        </feMerge>\n      </filter>\n    '),i[e.FILTER.SELECTED]='\n      <filter id="'.concat(e.FILTER.SELECTED,'" height="160%" width="180%" y="-30%" x="-40%">\n        <feGaussianBlur stdDeviation="1" />\n        <feComponentTransfer result="outColor">\n          <feFuncR type="table" tableValues="1 1"></feFuncR>\n          <feFuncG type="table" tableValues="0.67 0.67"></feFuncG>\n          <feFuncB type="table" tableValues="0.21 0.21"></feFuncB>\n          <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n        </feComponentTransfer>\n        <feGaussianBlur result="outShadow" in="outColor" stdDeviation="4" />\n        <feComposite in="SourceGraphic" in2="outShadow" operator="over" />\n      </filter>\n      '),i[e.FILTER.BOXSHADOW]='\n      <filter x="-47.9%" y="-43.8%" width="195.8%" height="195.8%" filterUnits="objectBoundingBox" id="'.concat(e.FILTER.BOXSHADOW,'">\n        <feOffset dx="0" dy="1" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>\n        <feGaussianBlur stdDeviation="3" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n        <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.25 0" type="matrix" in="shadowBlurOuter1" result="outGlow"></feColorMatrix>\n        <feComposite in="SourceGraphic" in2="outGlow" operator="over"></feComposite>\n      </filter>\n      '),i[e.FILTER.SURROUND_SHADOW_DARK]='\n    <filter x="-21.1%" y="-23.1%" width="140.1%" height="142.5%" filterUnits="objectBoundingBox" id="'.concat(e.FILTER.SURROUND_SHADOW_DARK,'">\n      <feOffset dx="0" dy="0" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>\n      <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n      <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.4 0" type="matrix" in="shadowBlurOuter1" result="outShadow"></feColorMatrix>\n      <feComposite in="SourceGraphic" in2="outShadow" operator="over"></feComposite>\n    </filter>\n    '),i[e.FILTER.DISABLED_HEAD_ICON]='\n      <filter id="'.concat(e.FILTER.DISABLED_HEAD_ICON,'">\n        <feColorMatrix in="SourceGraphic" type="saturate" values="0" />\n      </filter>\n    '),i[e.FILTER.FOCUSED]="\n    <filter id=".concat(e.FILTER.FOCUSED,' height="180%" width="160%" y="-40%" x="-30%">\n      <feGaussianBlur stdDeviation="1"></feGaussianBlur>\n      <feComponentTransfer result="outColor">\n        <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n      </feComponentTransfer>\n      <feGaussianBlur result="outShadow" in="outColor" stdDeviation="4"></feGaussianBlur>\n      <feComposite in="SourceGraphic" in2="outShadow" operator="over"></feComposite>\n    </filter>\n    '),i),r=Array.prototype.map.call(t.children,(function(t){return t.id}));Object.keys(n).filter((function(t){return r.indexOf(t)<0})).map((function(t){return o.dom.parse_to_SVG(n[t])})).forEach((function(e){t.appendChild(e)}))},e.inject_comment_filters=function(t){var e={RED:["#FF838D","#F04E39"],BLUE:["#70C3FF","#3882FF"],GREEN:["#A1FF5C","#26E32D"],YELLOW:["#FFE06B","#FFB93A"]};Object.keys(e).forEach((function(i){if(o.base.is_comment_theme(i)){var n=o.dom.create_svg_element("linearGradient",{id:"CommentLinearGradient-".concat(i),x1:"50%",y1:"0%",x2:"50%",y2:"85.4676513%"},t);o.dom.create_svg_element("stop",{offset:"0%","stop-color":e[i][0]},n),o.dom.create_svg_element("stop",{offset:"100%","stop-color":e[i][1]},n)}}))}},43210:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.inject_icon_symbols=e.SYMBOL=void 0;var o=i(98734).__importStar(i(22804));e.SYMBOL={DEGREE_MARK_MAJOR:"blocklyDegreeMarkMajor",DEGREE_MARK_MINOR:"blocklyDegreeMarkMinor",DEGREE_POINTER:"blocklyDegreePointer"},e.inject_icon_symbols=function(t){var i,n=((i={})[e.SYMBOL.DEGREE_MARK_MAJOR]='\n      <symbol id="'.concat(e.SYMBOL.DEGREE_MARK_MAJOR,'" viewBox="0 0 1024 1024">\n        <path d="M512 156.734694a5.22449 5.22449 0 0 1 5.22449 5.22449v20.897959a5.22449 5.22449 0 0 1-10.44898 0v-20.897959a5.22449 5.22449 0 0 1 5.22449-5.22449z m355.265306 355.265306a5.22449 5.22449 0 0 1-5.22449 5.22449h-20.897959a5.22449 5.22449 0 1 1 0-10.44898h20.897959a5.22449 5.22449 0 0 1 5.22449 5.22449z m-355.265306 355.265306a5.22449 5.22449 0 0 1-5.22449-5.22449v-20.897959a5.22449 5.22449 0 1 1 10.44898 0v20.897959a5.22449 5.22449 0 0 1-5.22449 5.22449zM156.734694 512a5.22449 5.22449 0 0 1 5.22449-5.22449h20.897959a5.22449 5.22449 0 0 1 0 10.44898h-20.897959a5.22449 5.22449 0 0 1-5.22449-5.22449z m333.76653-397.270204c-5.632 0-8.704-3.949714-8.704-10.825143 0-7.021714 3.657143-11.190857 8.270368-11.190857 5.851429 0 9.874286 4.827429 10.673632 15.433143-3.213061 4.681143-6.948571 6.582857-10.24 6.582857z m-15.652571 21.577143c3.150367 3.218286 7.538939 5.705143 13.756082 5.705143 10.381061 0 20.035918-8.484571 20.035918-29.696 0-17.773714-8.338286-26.112-18.651429-26.112-8.704 0-16.018286 7.021714-16.018285 17.700571 0 11.264 6.070857 16.896 15.072653 16.896 4.096 0 8.704-2.413714 11.849143-6.290286-0.517224 15.36-6.144 20.626286-12.653715 20.626286a12.000653 12.000653 0 0 1-8.85551-4.022857l-4.534857 5.193143z m55.771429 5.705143c10.537796 0 17.413224-9.362286 17.413224-28.086858 0-18.578286-6.880653-27.721143-17.413224-27.721142-10.605714 0-17.402776 9.069714-17.402776 27.721142 0 18.724571 6.797061 28.086857 17.402776 28.086858z m0-6.656c-5.485714 0-9.357061-5.851429-9.357062-21.430858 0-15.433143 3.876571-21.065143 9.357062-21.065142 5.485714 0 9.36751 5.632 9.36751 21.065142 0 15.579429-3.876571 21.430857-9.36751 21.430858z m32.15151-28.818286c5.919347 0 10.825143-4.388571 10.825143-10.898286s-4.905796-10.898286-10.830368-10.898286c-5.773061 0-10.752 4.388571-10.752 10.898286s4.978939 10.898286 10.752 10.898286z m0-4.388572c-3.510857 0-5.929796-2.706286-5.929796-6.509714 0-3.876571 2.418939-6.582857 5.929796-6.582857 3.578776 0 5.99249 2.706286 5.99249 6.582857 0 3.803429-2.413714 6.509714-5.99249 6.509714zM462.576327 928.078367h19.309714v-6.217143h-19.309714v6.217143z m39.606857-8.777143c-5.632 0-8.704-3.949714-8.704-10.825142 0-7.021714 3.657143-11.190857 8.265143-11.190858 5.851429 0 9.874286 4.827429 10.678857 15.433143-3.218286 4.681143-6.948571 6.582857-10.24 6.582857z m-15.652572 21.577143c3.145143 3.218286 7.533714 5.705143 13.750857 5.705143 10.386286 0 20.041143-8.484571 20.041143-29.696 0-17.773714-8.338286-26.112-18.651428-26.112-8.704 0-16.018286 7.021714-16.018286 17.700572 0 11.264 6.070857 16.896 15.067429 16.896 4.096 0 8.704-2.413714 11.849142-6.290286-0.512 15.36-6.144 20.626286-12.653714 20.626286a12.000653 12.000653 0 0 1-8.850286-4.022858l-4.534857 5.193143z m55.771429 5.705143c10.532571 0 17.408-9.362286 17.408-28.086857 0-18.578286-6.875429-27.721143-17.408-27.721143-10.605714 0-17.408 9.069714-17.408 27.721143 0 18.724571 6.802286 28.086857 17.408 28.086857z m0-6.656c-5.485714 0-9.362286-5.851429-9.362286-21.430857 0-15.433143 3.876571-21.065143 9.362286-21.065143s9.362286 5.632 9.362286 21.065143c0 15.579429-3.876571 21.430857-9.362286 21.430857z m32.146286-28.818286c5.924571 0 10.825143-4.388571 10.825142-10.898285s-4.900571-10.898286-10.825142-10.898286c-5.778286 0-10.752 4.388571-10.752 10.898286s4.973714 10.898286 10.752 10.898285z m0-4.388571c-3.510857 0-5.924571-2.706286-5.924572-6.509714 0-3.876571 2.413714-6.582857 5.924572-6.582857 3.584 0 5.997714 2.706286 5.997714 6.582857 0 3.803429-2.413714 6.509714-5.997714 6.509714zM23.750531 532.897959h30.72v-6.948571H43.937959v-46.884572H37.574531c-3.072 1.901714-6.656 3.145143-11.702858 4.096v5.339429H35.526531v37.449143H23.750531V532.897959z m51.09551 0.950857c10.386286 0 17.408-6.144 17.408-14.116571 0-7.314286-4.242286-11.483429-9.069714-14.262857v-0.365715c3.364571-2.486857 7.094857-7.168 7.094857-12.653714 0-8.411429-5.851429-14.262857-15.213715-14.262857-8.850286 0-15.36 5.485714-15.36 13.897143 0 5.705143 3.218286 9.728 7.241143 12.580571v0.365715c-4.973714 2.633143-9.654857 7.387429-9.654857 14.482285 0 8.338286 7.460571 14.336 17.554286 14.336z m3.510857-30.866285c-5.997714-2.340571-11.117714-5.046857-11.117714-10.898286 0-4.827429 3.291429-7.826286 7.68-7.826286 5.266286 0 8.265143 3.730286 8.265143 8.704 0 3.584-1.609143 7.021714-4.827429 10.020572z m-3.364571 24.795428c-5.778286 0-10.24-3.730286-10.24-9.069714 0-4.681143 2.56-8.704 6.290285-11.264 7.314286 2.998857 13.238857 5.485714 13.238857 12.068571 0 5.046857-3.803429 8.265143-9.289142 8.265143z m36.24751 6.070857c10.532571 0 17.408-9.362286 17.408-28.086857 0-18.578286-6.875429-27.721143-17.408-27.721143-10.605714 0-17.408 9.069714-17.408 27.721143 0 18.724571 6.802286 28.086857 17.408 28.086857z m0-6.656c-5.485714 0-9.362286-5.851429-9.362286-21.430857 0-15.433143 3.876571-21.065143 9.362286-21.065143s9.362286 5.632 9.362285 21.065143c0 15.579429-3.876571 21.430857-9.362285 21.430857z m29.664653-28.818285c5.924571 0 10.825143-4.388571 10.825143-10.898286s-4.900571-10.898286-10.825143-10.898286c-5.778286 0-10.752 4.388571-10.752 10.898286s4.973714 10.898286 10.752 10.898286z m0-4.388572c-3.510857 0-5.924571-2.706286-5.924572-6.509714 0-3.876571 2.413714-6.582857 5.924572-6.582857 3.584 0 5.997714 2.706286 5.997714 6.582857 0 3.803429-2.413714 6.509714-5.997714 6.509714z m785.460245 39.862857c10.532571 0 17.408-9.362286 17.408-28.086857 0-18.578286-6.875429-27.721143-17.408-27.721143-10.605714 0-17.408 9.069714-17.408 27.721143 0 18.724571 6.802286 28.086857 17.408 28.086857z m0-6.656c-5.485714 0-9.362286-5.851429-9.362286-21.430857 0-15.433143 3.876571-21.065143 9.362286-21.065143s9.362286 5.632 9.362285 21.065143c0 15.579429-3.876571 21.430857-9.362285 21.430857z m29.664653-28.818285c5.924571 0 10.825143-4.388571 10.825143-10.898286s-4.900571-10.898286-10.825143-10.898286c-5.778286 0-10.752 4.388571-10.752 10.898286s4.973714 10.898286 10.752 10.898286z m0-4.388572c-3.510857 0-5.924571-2.706286-5.924572-6.509714 0-3.876571 2.413714-6.582857 5.924572-6.582857 3.584 0 5.997714 2.706286 5.997714 6.582857 0 3.803429-2.413714 6.509714-5.997714 6.509714z" p-id="16942"></path>\n      </symbol>\n    '),i[e.SYMBOL.DEGREE_MARK_MINOR]='\n      <symbol id="'.concat(e.SYMBOL.DEGREE_MARK_MINOR,'" viewBox="0 0 1024 1024">\n       <path d="M644.514909 17.446788a7.757576 7.757576 0 0 1 5.484606 9.50303l-4.010667 14.979879a7.757576 7.757576 0 0 1-14.987636-4.010667l4.010667-14.987636a7.757576 7.757576 0 0 1 9.50303-5.484606zM768 68.592485a7.757576 7.757576 0 0 1 2.839273 10.596848l-7.757576 13.436122a7.757576 7.757576 0 0 1-13.436121-7.757576l7.757576-13.436121A7.757576 7.757576 0 0 1 768 68.592485z m106.038303 81.369212a7.757576 7.757576 0 0 1 0 10.969212l-10.969212 10.969212a7.757576 7.757576 0 0 1-10.969212-10.969212l10.969212-10.969212a7.757576 7.757576 0 0 1 10.969212 0zM955.407515 256a7.757576 7.757576 0 0 1-2.839273 10.596848l-13.436121 7.757576a7.757576 7.757576 0 1 1-7.757576-13.436121l13.436122-7.757576a7.757576 7.757576 0 0 1 10.596848 2.839273z m51.145697 123.485091a7.757576 7.757576 0 0 1-5.484606 9.50303l-14.987636 4.010667a7.757576 7.757576 0 0 1-4.010667-14.987636l14.979879-4.010667a7.757576 7.757576 0 0 1 9.50303 5.484606z m0 265.029818a7.757576 7.757576 0 0 1-9.50303 5.484606l-14.979879-4.010667a7.757576 7.757576 0 1 1 4.010667-14.987636l14.987636 4.010667a7.757576 7.757576 0 0 1 5.484606 9.50303zM955.407515 768a7.757576 7.757576 0 0 1-10.596848 2.839273l-13.436122-7.757576a7.757576 7.757576 0 0 1 7.757576-13.436121l13.436121 7.757576a7.757576 7.757576 0 0 1 2.839273 10.596848z m-81.369212 106.038303a7.757576 7.757576 0 0 1-10.969212 0l-10.969212-10.969212a7.757576 7.757576 0 0 1 10.969212-10.969212l10.969212 10.969212a7.757576 7.757576 0 0 1 0 10.969212zM768 955.407515a7.757576 7.757576 0 0 1-10.596848-2.839273l-7.757576-13.436121a7.757576 7.757576 0 1 1 13.436121-7.757576l7.757576 13.436122a7.757576 7.757576 0 0 1-2.839273 10.596848z m-123.485091 51.145697a7.757576 7.757576 0 0 1-9.50303-5.484606l-4.010667-14.987636a7.757576 7.757576 0 0 1 14.987636-4.010667l4.010667 14.979879a7.757576 7.757576 0 0 1-5.484606 9.50303z m-265.029818 0a7.757576 7.757576 0 0 1-5.484606-9.50303l4.010667-14.979879a7.757576 7.757576 0 1 1 14.987636 4.010667l-4.010667 14.987636a7.757576 7.757576 0 0 1-9.50303 5.484606zM256 955.407515a7.757576 7.757576 0 0 1-2.839273-10.596848l7.757576-13.436122a7.757576 7.757576 0 0 1 13.436121 7.757576l-7.757576 13.436121a7.757576 7.757576 0 0 1-10.596848 2.839273z m-106.038303-81.369212a7.757576 7.757576 0 0 1 0-10.969212l10.969212-10.969212a7.757576 7.757576 0 0 1 10.969212 10.969212l-10.969212 10.969212a7.757576 7.757576 0 0 1-10.969212 0zM68.592485 768a7.757576 7.757576 0 0 1 2.839273-10.596848l13.436121-7.757576a7.757576 7.757576 0 0 1 7.757576 13.436121l-13.436122 7.757576A7.757576 7.757576 0 0 1 68.592485 768zM17.454545 644.514909a7.757576 7.757576 0 0 1 5.484607-9.50303l14.987636-4.010667a7.757576 7.757576 0 0 1 4.010667 14.987636l-14.979879 4.010667a7.757576 7.757576 0 0 1-9.503031-5.484606z m0-265.029818a7.757576 7.757576 0 0 1 9.503031-5.484606l14.979879 4.010667a7.757576 7.757576 0 0 1-4.010667 14.987636l-14.987636-4.010667a7.757576 7.757576 0 0 1-5.484607-9.50303zM68.592485 256a7.757576 7.757576 0 0 1 10.596848-2.839273l13.436122 7.757576a7.757576 7.757576 0 0 1-7.757576 13.436121l-13.436121-7.757576A7.757576 7.757576 0 0 1 68.592485 256z m81.369212-106.038303a7.757576 7.757576 0 0 1 10.969212 0l10.969212 10.969212a7.757576 7.757576 0 0 1-10.969212 10.969212l-10.969212-10.969212a7.757576 7.757576 0 0 1 0-10.969212zM256 68.592485a7.757576 7.757576 0 0 1 10.596848 2.839273l7.757576 13.436121a7.757576 7.757576 0 0 1-13.436121 7.757576l-7.757576-13.436122A7.757576 7.757576 0 0 1 256 68.592485zM379.485091 17.454545a7.757576 7.757576 0 0 1 9.50303 5.484607l4.010667 14.987636a7.757576 7.757576 0 0 1-14.987636 4.010667l-4.010667-14.979879a7.757576 7.757576 0 0 1 5.484606-9.503031z" p-id="8468"></path>\n      </symbol>\n    '),i[e.SYMBOL.DEGREE_POINTER]='\n      <symbol id="'.concat(e.SYMBOL.DEGREE_POINTER,'" viewBox="0 0 1024 1024">\n        <path d="M544.64 71.424c14.08 6.784 25.6 17.792 32.64 31.36l247.04 474.88c11.264 21.76 10.048 47.552-3.2 68.224-13.312 20.672-36.8 33.28-62.08 33.28H621.44l0.128 210.624C621.568 928.64 588.8 960 548.48 960H475.456c-40.32 0-72.96-31.424-72.96-70.208l-0.128-210.56H265.024c-25.344 0-48.832-12.672-62.08-33.28a67.84 67.84 0 0 1-3.2-68.352L446.72 102.784c18.048-34.624 61.888-48.64 97.92-31.36z" p-id="16814"></path> \n      </symbol>\n    '),i);Object.keys(n).map((function(t){return o.dom.parse_to_SVG(n[t])})).forEach((function(e){t.appendChild(e)}))}},5250:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TimerHandler=void 0;var i=function(){function t(){this.timers=[],this.override_timer()}return t.prototype.push=function(t){this.timers.push(t)},t.prototype.pop=function(t){var e=this.timers.findIndex((function(e){return e===t}));e>=0&&this.timers.splice(e,1)},t.prototype.is_empty=function(){return 0===this.timers.length},t.prototype.override_timer=function(){var t=this,e=window.setTimeout.bind(window);window.setTimeout=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var n=e.apply(window,i),r=i[1];return i[2]||t.push(n),e((function(){t.pop(n)}),r,!0),n};var i=window.clearTimeout.bind(window);window.clearTimeout=function(e){i(e),"number"===typeof e&&t.pop(e)}},t.prototype.show=function(){console.log(this.timers)},t}();e.TimerHandler=i},87811:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BaseNode=void 0;var o=i(25461),n=function(){function t(t){this.children_=[],this.selectable_=!0,this.selected_=!1,this.disabled_=!1,this.expanded_=!0,this.name_=t||""}return t.prototype.get_name=function(){return this.name_},t.prototype.set_tree=function(t){this.parent_=t},t.prototype.get_tree=function(){return this.parent_},t.prototype.get_element=function(){return this.element_},t.prototype.get_children_container=function(){return this.children_container_},t.prototype.dispose=function(){this.children_=[]},t.prototype.has_children=function(){return this.children_.length>0},t.prototype.get_children=function(){return this.children_},t.prototype.remove_child_at=function(t){return this.remove_child(this.children_[t])},t.prototype.remove_child=function(t){if(!t||t.get_tree()!==this)throw new Error("Not our child.");return t.dispose(),t},t.prototype.remove_children=function(){for(var t=[];this.has_children();)t.push(this.remove_child_at(0));return t},t.prototype.add_child_at=function(t,e){var i=t.get_tree();if(i!==this){void 0!=i&&i.remove_child(t);var n=this.children_[e];return this.children_.splice(e,0,t),n?(0,o.insert_before)(t.html_div,n.html_div):this.children_container_.appendChild(t.html_div),t.set_tree(this),t}},t.prototype.add=function(t){return this.add_child_at(t,this.children_.length)},t.prototype.is_selectable=function(){return this.selectable_},t.prototype.is_selected=function(){return this.selected_},t.prototype.select=function(){this.selected_=!0},t.prototype.unselect=function(){this.selected_=!1},t.prototype.set_disabled=function(t){t!==this.disabled_&&(this.disabled_=t)},t.prototype.is_disabled=function(){return this.disabled_},t.prototype.set_expanded=function(t){if(t!==this.expanded_){this.expanded_=t;var e="blocklyTreeExpanded";!this.expanded_&&this.html_div.classList.contains(e)?this.html_div.classList.remove(e):this.expanded_&&!this.html_div.classList.contains(e)&&this.html_div.classList.add(e),this.children_container_.style.display=this.expanded_?"":"none"}},t.prototype.is_expanded=function(){return this.expanded_},t}();e.BaseNode=n},19214:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Toolbox=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(75102),_=i(56905),a=i(25461),c=i(61972),l=i(11214),d=i(87811),u=i(522),h=function(t){function e(e){var i=t.call(this)||this;i.get_node_from_event_=function(t){for(var e=t.target;void 0!=e;){var o=i.find_node_by_name(e.id);if(void 0!=o)return o;if(e==i.children_container_)break;e=e.parentNode}};var o=e.options;i.workspace_=e,i.toolbox_position=e.get_options().toolboxPosition;var n=Object.assign({},i.workspace_.options,{disabledPatternId:o.disabledPatternId,parentWorkspace:e,RTL:e.RTL,toolboxPosition:o.toolboxPosition,blockly_type:o.blockly_type,id:void 0});return i.flyout=i.vertical_flyout_factory(n),i}return o.__extends(e,t),e.prototype.get_flyout=function(){return this.flyout},e.prototype.get_width=function(){return this.html_div?this.html_div.offsetWidth:0},e.prototype.get_height=function(){return this.html_div?this.html_div.offsetHeight:0},e.prototype.get_workspace_id=function(){if(this.workspace_)return this.workspace_.id},e.prototype.init=function(){var t=this;if(this.workspace_){var e=this.workspace_,i=e.get_options(),o=this.workspace_.get_workspace_drag_surface(),n=o&&o.get_svg();if(void 0!=n){this.html_div=(0,a.create_dom)("div","blocklyToolboxDiv"),this.html_div.setAttribute("dir",e.RTL?"RTL":"LTR"),void 0!==i.toolbox_background_class?this.html_div.classList.add(i.toolbox_background_class):this.html_div.style.background=this.theme.flyout.BACKGROUND_COLOR.toString(),this.children_container_=document.createElement("div"),this.children_container_.className="blocklyTreeRoot",(0,_.assert)(i.toolbox_config,"Toolbox is not defined."),this.populate(i.toolbox_config),this.html_div.appendChild(this.children_container_),(0,a.insert_after)(this.html_div,n),(0,a.insert_before)(this.flyout.create_dom("svg"),this.html_div),this.flyout.init(e),this.position();this.events.bind_event(this.html_div,"mousedown",this,(function(){t.mousedown_time=Date.now()})),this.events.bind_event(this.html_div,"touchmove",this,(function(){t.mousedown_time=void 0}));var r=(0,c.throttle)((function(e){return t.handle_mousedown(e)}),200);this.events.bind_event(this.html_div,"mouseup",this,(function(e){t.mousedown_time&&Date.now()-t.mousedown_time<200&&r(e),t.mousedown_time=void 0}))}else console.warn("Ref SVG not Found.")}},e.prototype.handle_mousedown=function(t){if(this.utils.is_right_button(t)||t.target==this.html_div)return this.utils.hide_chaff(!1),void this.touch_manager.clear_touch_identifier();this.utils.hide_chaff(!0);var e=this.get_node_from_event_(t);e&&!e.is_disabled()&&(e.is_selected()?this.clear_selection():e.is_selectable()&&this.set_selected_item(e),e.set_expanded(!e.is_expanded()),this.block_animations.toolbox_click_effect()),this.touch_manager.clear_touch_identifier()},e.prototype.populate=function(t){this.remove_children(),this.workspace_&&(Array.isArray(t)?this.build_by_config(t):this.sync_trees_(t),this.workspace_.resize_contents())},e.prototype.build_by_config=function(t){var e=this;t.forEach((function(t){var i=new u.TreeNode(t);e.add(i)}))},e.prototype.sync_nodes_=function(t,e){for(var i,o=0,n=void 0;o<t.childNodes.length;o++)if((n=t.childNodes[o])instanceof Element)switch(n.tagName.toUpperCase()){case"SEP":if(void 0==i)break;var r=n.getAttribute("gap");void 0!=r&&i.setAttribute("gap",r);break;case"BLOCK":case"SHADOW":case"LABEL":case"BUTTON":e.push_block(n),i=n}},e.prototype.sync_trees_=function(t){for(var e,i,o=0,n=void 0;o<t.childNodes.length;o++)if((n=t.childNodes[o])instanceof Element)switch(n.tagName.toUpperCase()){case"CATEGORY":var r=n.getAttribute("name");if(void 0==r)throw new ReferenceError("Child node does not have name.");var s=n.getAttribute("text")||void 0,_=n.getAttribute("color"),a=_&&(null===(e=this.theme.get_color(_))||void 0===e?void 0:e.fill.toString())||_||void 0,c=n.getAttribute("flyout_background")||void 0,l=n.getAttribute("element_classname")||void 0,d=n.getAttribute("element_disabled_classname")||void 0,h=n.getAttribute("element_classname_selected")||void 0,p=n.getAttribute("element_style")||void 0,g=n.getAttribute("element_selected_style")||void 0,f=n.getAttribute("icon")||void 0,v=n.getAttribute("selected_icon")||void 0,m=n.getAttribute("icon_html")||void 0,b=n.getAttribute("icon_selected_html")||void 0,y=new u.TreeNode({text:s,name:r,color:a,secondary_color:c,element:{unselected_classname:l,disabled_classname:d,selected_classname:h,style:p,selected_style:g},icon:{style:f,selected_style:v,html:m,selected_html:b}}),E=n.getAttribute("custom");E&&0===n.childElementCount?(y.set_blocks(E),y.get_element().dataset.custom=E):(this.sync_nodes_(n,y),0===y.get_blocks().length&&y.set_disabled(!0)),i=n,this.add(y);break;case"SEP":if(console.error("TreeSeparator is not implemented currently. "),void 0==i)break}},e.prototype.position=function(){void 0!=this.html_div&&(this.workspace_&&(void 0!=this.workspace_.get_parent_svg()?(this.toolbox_position==s.TOOLBOX_POSITION.RIGHT?(this.html_div.style.top="0",this.html_div.style.right="0"):(this.html_div.style.top="0",this.html_div.style.left="0"),this.flyout.position()):console.warn("Parent SVG not Found.")))},e.prototype.get_client_rect=function(){if(void 0!=this.html_div){var t=this.html_div.getBoundingClientRect(),e=this.workspace_.get_options().delete_area_margin,i=t.left,o=t.top,n=t.width,r=t.height;return new l.Rect(i-e[3],o-e[0],n+e[1]+e[3],r+e[0]+e[2])}},e.prototype.add_delete_style=function(){(0,a.add_class)(this.html_div,"blocklyToolboxDelete")},e.prototype.remove_delete_style=function(){(0,a.remove_class)(this.html_div,"blocklyToolboxDelete")},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.flyout.dispose(),(0,a.remove_node)(this.html_div),this.workspace_=void 0},e.prototype.get_selected=function(){return this.selected_node},e.prototype.get_last_selected=function(){return this.last_selected_node},e.prototype.set_selected_item=function(t){var e,i,o=this.selected_node;if(t!==o){this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.CATEGORY_WILL_CHANGE,workspace_id:(null===(e=this.workspace_)||void 0===e?void 0:e.id)||"",old_value:o,new_value:t})),o&&o.unselect();var n=[];if(t&&(t.select(),n=t.get_blocks(!0)),t&&n&&n.length>0){var r=t.get_flyout_background_color();if(r){var _=this.flyout.get_background();_&&(_.style.fill=r)}this.flyout.show(n),this.last_selected_node!==t&&this.flyout.scroll_to_start()}else this.flyout.hide();t&&(this.last_selected_node=t),this.selected_node=t,this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.CATEGORY,workspace_id:(null===(i=this.workspace_)||void 0===i?void 0:i.id)||"",old_value:o,new_value:t}))}},e.prototype.clear_selection=function(){this.set_selected_item()},e.prototype.refresh_selection=function(){if(void 0!=this.selected_node){var t=this.selected_node.get_blocks();void 0!=t&&this.flyout.show(t)}},e.prototype.find_node_by_name=function(t){if(t)for(var e=0;e<this.children_.length;e++){var i=this.children_[e];if(i.get_name()===t)return i;var o=i.find_node_by_name(t);if(o)return o}},e.prototype.new_node=function(t){return new u.TreeNode(t)},o.__decorate([(0,r.lazy_inject)(r.BINDING.events)],e.prototype,"events",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.utils)],e.prototype,"utils",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.touch_manager)],e.prototype,"touch_manager",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.block_animations)],e.prototype,"block_animations",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.theme)],e.prototype,"theme",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.VerticalFlyout)],e.prototype,"vertical_flyout_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.UIEvent)],e.prototype,"ui_event_factory",void 0),e=o.__decorate([(0,n.injectable)()],e)}(d.BaseNode);e.Toolbox=h},522:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.TreeNode=void 0;var o=i(98734),n=i(98030),r=i(61972),s=i(25461),_=function(t){function e(i){var o=t.call(this)||this;o.DEFAULT_CLASSNAMES={NORMAL:"blocklyTreeRow",SELECTED:"blocklyTreeSelected",DISABLED:"blockly_toolbox_disabled"},o.blocks=[];var n={text:void 0,name:"",color:"",secondary_color:o.theme.flyout.BACKGROUND_COLOR.toString(),element:{unselected_classname:"",disabled_classname:"",selected_classname:"",style:"",selected_style:""},icon:{style:void 0,selected_style:void 0,html:void 0,selected_html:void 0,font_id:void 0,selected_font_id:void 0},children:[],blocks:[],selectable:!0};return i.text&&(i.text=o.utils.replace_message_references(i.text)),o.config_=(0,r.parse_attr_deep)(n,i),o.init(),o.name_=o.config_.name||(0,r.unique_id)("treenode_"),o.selectable_=o.config_.selectable,o.blocks="string"===typeof o.config_.blocks?o.config_.blocks:Array.from(o.config_.blocks),Array.from(o.config_.children).forEach((function(t){var i=new e(t);o.add(i)})),o}return o.__extends(e,t),e.prototype.get_element=function(){return this.element_},e.prototype.get_color=function(){return this.config_.color},e.prototype.get_flyout_background_color=function(){return this.config_.secondary_color},e.prototype.init=function(){if(this.html_div=document.createElement("div"),this.html_div.className="blocklyTreeNode",this.element_=document.createElement("div"),this.element_.id=this.config_.name,this.element_.setAttribute("role","treeitem"),this.element_.setAttribute("name",this.config_.name),this.icon_el=document.createElement("div"),this.icon_el.className="blocklyTreeIcon",this.config_.icon.font_id?(0,s.create_font_icon)(this.config_.icon.font_id,this.icon_el):this.config_.icon.html&&(this.icon_el.innerHTML=this.config_.icon.html),this.config_.icon.style&&this.icon_el.setAttribute("style",this.config_.icon.style),this.element_.appendChild(this.icon_el),this.config_.color&&(this.element_.style.color=this.config_.color,this.element_.dataset.color=this.config_.color),this.config_.element.style&&this.element_.setAttribute("style",this.config_.element.style),void 0!=this.config_.text){var t=document.createElement("div");t.classList.add("blocklyTreeLabel"),t.textContent=this.config_.text,this.element_.appendChild(t)}this.children_container_=document.createElement("div"),this.children_container_.className="blocklyTreeChildren",this.html_div.appendChild(this.element_),this.html_div.appendChild(this.children_container_),this.element_.className=this.get_node_classname(),this.set_expanded(!1)},e.prototype.get_blocks=function(t){return this.blocks},e.prototype.set_blocks=function(t){"string"===typeof t||Array.isArray(t)?this.blocks=t:this.blocks=Array.from(t)},e.prototype.push_block=function(t){if("string"===typeof this.blocks)throw Error("Trying to add block to a node with custom key");this.blocks.push(t)},e.prototype.select=function(){this.disabled_||(this.selected_=!0,this.update_node())},e.prototype.unselect=function(){this.selected_=!1,this.update_node()},e.prototype.set_disabled=function(t){t!==this.disabled_&&(this.disabled_=t,this.update_node())},e.prototype.get_node_classname=function(){return this.disabled_?"\n        ".concat(this.DEFAULT_CLASSNAMES.NORMAL,"\n        ").concat(this.DEFAULT_CLASSNAMES.DISABLED,"\n        ").concat(this.config_.element.disabled_classname,"\n      "):this.is_selected()?"\n        ".concat(this.DEFAULT_CLASSNAMES.NORMAL,"\n        ").concat(this.DEFAULT_CLASSNAMES.SELECTED,"\n        ").concat(this.config_.element.selected_classname,"\n      "):"\n      ".concat(this.DEFAULT_CLASSNAMES.NORMAL,"\n      ").concat(this.config_.element.unselected_classname,"\n    ")},e.prototype.update_node=function(){if(this.element_.className=this.get_node_classname(),this.is_selected())return this.element_.style.backgroundColor=this.get_color(),this.config_.element.selected_style&&this.element_.setAttribute("style",this.config_.element.selected_style),void 0!=this.config_.icon.selected_style&&this.icon_el.setAttribute("style",this.config_.icon.selected_style),void 0!=this.config_.icon.selected_font_id?((0,s.remove_children)(this.icon_el),(0,s.create_font_icon)(this.config_.icon.selected_font_id,this.icon_el)):void 0!=this.config_.icon.selected_html&&(this.icon_el.innerHTML=this.config_.icon.selected_html),void this.element_.setAttribute("aria-selected","true");this.element_.style.backgroundColor="",this.config_.element.style&&this.config_.element.selected_style&&this.element_.setAttribute("style",this.config_.element.style),this.config_.icon.style&&this.config_.icon.selected_style&&this.icon_el.setAttribute("style",this.config_.icon.style),this.config_.icon.font_id&&this.config_.icon.selected_font_id?((0,s.remove_children)(this.icon_el),(0,s.create_font_icon)(this.config_.icon.font_id,this.icon_el)):this.config_.icon.html&&this.config_.icon.selected_html&&(this.icon_el.innerHTML=this.config_.icon.html),this.element_.setAttribute("aria-selected","false")},e.prototype.dispose=function(){if(this.parent_){var t=this.parent_.get_children(),e=t.indexOf(this);t.splice(e,1)}this.html_div.remove(),this.set_tree(void 0)},e.prototype.find_node_by_name=function(t){if(this.name_===t)return this;for(var e=0;e<this.children_.length;e++){var i=this.children_[e];if(i.get_name()===t)return i;var o=i.find_node_by_name(t);if(o)return o}},o.__decorate([(0,n.lazy_inject)(n.BINDING.theme)],e.prototype,"theme",void 0),o.__decorate([(0,n.lazy_inject)(n.BINDING.utils)],e.prototype,"utils",void 0),e}(i(87811).BaseNode);e.TreeNode=_},48462:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.shortest_string_length=e.equals=e.remove=void 0;var o=i(61972);e.remove=function(t,e){var i=t.indexOf(e),o=i>=0;return o&&t.splice(i,1),o},e.equals=function(t,e){if(!(0,o.is_array)(t)||!(0,o.is_array)(e)||t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},e.shortest_string_length=function(t){return t.length?t.reduce((function(t,e){return t.length<e.length?t:e})).length:0}},56905:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.fail=e.assert=void 0,e.assert=function(t,e){if(!t)throw new Error(e)},e.fail=function(t){console.error(t)}},61972:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.merge_deep=e.debounce=e.throttle=e.is_workspace=e.is_old_dropdown_option=e.is_comment_theme=e.is_field_mutation=e.is_field_dropdown=e.is_field_default_value=e.is_field_text_input=e.is_field_number=e.is_workspace_comment=e.is_block_group=e.is_block_svg=e.is_valid_color=e.parse_attr_deep=e.clone_deep=e.obj_for_each=e.unique_id=e.is_array_like=e.is_number=e.is_nil=e.is_array=e.is_object=e.is_func=e.is_string=e.BrowserFeature=void 0;var o=i(98734).__importStar(i(31016)),n=i(75102);function r(t){return t&&"[object Function]"==={}.toString.call(t)}function s(t){var e=typeof t;return"object"==e&&void 0!=t||"function"==e}function _(t){return Array.isArray(t)}e.BrowserFeature={TOUCH_ENABLED:"ontouchstart"in window||!!(document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!navigator||!navigator.maxTouchPoints&&!navigator.msMaxTouchPoints)},e.is_string=function(t){return"string"==typeof t||t instanceof String},e.is_func=r,e.is_object=s,e.is_array=_,e.is_nil=function(t){return void 0===t||null===t},e.is_number=function(t){return"number"==typeof t},e.is_array_like=function(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Number.MAX_SAFE_INTEGER}(t.length)&&!r(t)};var a=0;function c(t){return o.default?o.default(t):o(t)}e.unique_id=function(t){var e=++a;return t.toString()+e},e.obj_for_each=function(t,e){if(!s(t))throw new Error("param is not a Object");for(var i=Object.keys(t),o=0;o<i.length;o++){var n=i[o];e(t[n],n)}},e.clone_deep=c,e.parse_attr_deep=function t(e,i){if(!i)return e;var o=c(e);for(var n in o){var a=i[n];if(void 0!=a){var l=e[n];!s(l)||_(l)||r(l)?o[n]=a:o[n]=t(l,a)}}return o},e.is_valid_color=function(t){var e=document.createElement("span");return e.style.color=t,""!==e.style.color},e.is_block_svg=function(t){return!!t&&typeof t.type&&("block"===t.element_type||"block_group"==t.element_type||"param"===t.element_type||"param_color"===t.element_type)},e.is_block_group=function(t){return!!t&&typeof t.type&&"block_group"==t.element_type},e.is_workspace_comment=function(t){return!!t&&"comment"===t.element_type},e.is_field_number=function(t){return"FieldNumber"===(null===t||void 0===t?void 0:t.field_type)},e.is_field_text_input=function(t){return"FieldTextInput"===t.field_type},e.is_field_default_value=function(t){return"FieldDefaultValue"===t.field_type},e.is_field_dropdown=function(t){return"FieldDropdown"===(null===t||void 0===t?void 0:t.field_type)},e.is_field_mutation=function(t){return"FieldMutation"===(null===t||void 0===t?void 0:t.field_type)},e.is_comment_theme=function(t){return t&&Object.keys(n.THEME_COLOR_MAP).includes(t)},e.is_old_dropdown_option=function(t){return!!t&&!t.type},e.is_workspace=function(t){return!!t.add_flyout},e.throttle=function(t,e){var i=Date.now();return function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var r=Date.now();r-i>=e&&(t.apply(void 0,o),i=r)}},e.debounce=function(t,e){var i;return function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];void 0!==i&&clearTimeout(i),i=window.setTimeout((function(){t.apply(void 0,o)}),e)}},e.merge_deep=function t(e,i){var o=c(e);for(var n in i)null!=i[n]&&s(i[n])?o[n]=t(o[n]||Object.create(null),i[n]):o[n]=i[n];return o}},81558:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.get_nested_blocks_with_comment=e.get_outer_block=e.has_context=e.is_valid_context=e.cal_num_blocks=e.fire_block_onchange=e.update_disable_status=void 0;var o=i(14375),n=i(75102),r=i(56905),s=i(61972);function _(t){var e=t.previous_connection||t.output_connection;return!(!e||!e.context||e.source_block.is_shadow())}e.update_disable_status=function(t){if(!t.is_in_flyout){for(var e=["repeat_forever","repeat_n_times","repeat_forever_until"],i=!0,o=t.get_surround_parent();o;){if(e.includes(o.type)){i=!1;break}o=o.get_surround_parent()}if(i){if(!t.disabled)return;t.disabled=!1,t.update_disabled()}else{if(t.disabled)return;t.disabled=!0,t.update_disabled()}}},e.fire_block_onchange=function(t){for(var e={},i=0,o=t.get_descendants();i<o.length;i++){var n=o[i];n.onchange&&n.onchange(e)}},e.cal_num_blocks=function(t){return t.filter((function(t){return(0,s.is_block_svg)(t)&&!t.is_shadow()&&!(t.type.includes("parameter")&&t.parent_block&&t.parent_block.type.includes("procedures_2_def"))||(0,s.is_workspace_comment)(t)})).length},e.is_valid_context=function(t){var e,i,s=t.previous_connection||t.output_connection;if(!s||!s.target_connection||!_(t))return!0;for(var a=s.target_connection,c=function(){if((0,r.assert)(a.is_superior()),a.context===s.context){if(t.type===o.PROCEDURE_BLOCK_TYPES.PARAM||t.type===o.PROCEDURE_BLOCK_TYPES.ACTOR_PARAM){var _=!1,c=t.get_field_value("param_name")||"";return a.get_source_block().inputList.forEach((function(t){var e;if(t.type===n.InputType.VALUE){var i=null===(e=t.connection)||void 0===e?void 0:e.targetBlock();i&&i.get_field_value("param_name")===c&&(_=!0)}})),{value:_}}return{value:!0}}a=(null===(e=a.source_block.previous_connection)||void 0===e?void 0:e.target_connection)||(null===(i=a.source_block.output_connection)||void 0===i?void 0:i.target_connection)};a;){var l=c();if("object"===typeof l)return l.value}return!1},e.has_context=_,e.get_outer_block=function(t){var e=t;if(!e.is_output_block())return e;for(;e.parent_block&&e.parent_block.is_output_block();)e=e.parent_block;return e.parent_block&&!e.parent_block.is_output_block()&&(e=e.parent_block),e},e.get_nested_blocks_with_comment=function(t){return t.get_all_nested_blocks().filter((function(t){return t.comment}))}},42798:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.hsva_to_rgba=e.rgba_to_hex=e.hsv_to_rgb=e.rgb_to_hsv=e.darken=e.Color=void 0;var o=i(11214),n=function(){function t(t,e,i){this.r=0,this.g=0,this.b=0,this.a=1,!this.set(t)&&e&&(console.warn(i||"Cannot init Color with ".concat(t,", using ").concat(e,". ")),this.set(e))}return t.prototype.set=function(t){return"undefined"!==typeof t&&("string"===typeof t?this._set(t):(this.copy(t),!0))},t.prototype._set=function(t){var e=(t=String(t).toLowerCase().trim()).match(/^(?:rgb|rgba)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*(\d*\.?\d+)\s*)?\)$/);if(e){var i=Math.round(Number(e[1])),o=Math.round(Number(e[2])),n=Math.round(Number(e[3])),r=void 0===e[5]?1:Number(e[5]);return!(i<0||i>255||o<0||o>255||n<0||n>255||r<0||r>1)&&(this.r=i,this.g=o,this.b=n,this.a=r,!0)}var s=this.normalize_hexa(t);if(s){i=parseInt(s.substr(1,2),16),o=parseInt(s.substr(3,2),16),n=parseInt(s.substr(5,2),16),r=parseInt(s.substr(7,2),16)/255;return!(i<0||i>255||o<0||o>255||n<0||n>255||r<0||r>1)&&(this.r=i,this.g=o,this.b=n,this.a=r,!0)}return!1},t.prototype.normalize_hexa=function(t){if(t="0x"==t.substring(0,2)?"#".concat(t.substring(2)):t,/^#(?:[0-9a-f]{3}){1,2}$/i.test(t)||/^#(?:[0-9a-f]{4}){1,2}$/i.test(t))return 5===t.length&&(t=t.replace(/#(.)(.)(.)(.)/,"#$1$1$2$2$3$3$4$4")),4===t.length&&(t=t.replace(/#(.)(.)(.)/,"#$1$1$2$2$3$3ff")),7===t.length&&(t+="ff"),t.toLowerCase()},t.prototype.toString=function(){return"rgba(".concat(this.r,", ").concat(this.g,", ").concat(this.b,", ").concat(this.a,")")},t.prototype.clone=function(){var e=new t;return e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a,e},t.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.blend=function(t){var e=1-(1-this.a)*(1-t.a);return this.r=Math.round(t.r*t.a/e+this.r*this.a*(1-t.a)/e),this.g=Math.round(t.g*t.a/e+this.g*this.a*(1-t.a)/e),this.b=Math.round(t.b*t.a/e+this.b*this.a*(1-t.a)/e),this.a=e,this},t.prototype.equals=function(e){return e&&"string"!==typeof e||(e=new t(e)),this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},t}();e.Color=n;var r=new n("#000");e.darken=function(t,e,i){return r.a=(0,o.clamp)(e,0,1),((null===i||void 0===i?void 0:i.copy(t))||t.clone()).blend(r)},e.rgb_to_hsv=function(t,e,i){var o=t/255,n=e/255,r=i/255,s=Math.max(o,n,r),_=Math.min(o,n,r),a=s-_,c=0===s?0:a/s,l=s,d=s;if(s===_)d=0;else{switch(s){case o:d=(n-r)/a+(n<r?6:0);break;case n:d=(r-o)/a+2;break;case r:d=(o-n)/a+4}d/=6}return{h:Math.round(360*d),s:Math.round(1e3*c/10),v:Math.round(1e3*l/10)}},e.hsv_to_rgb=function(t){var e=t.h/360,i=t.s/100,o=t.v/100,n=0,r=0,s=0,_=Math.floor(6*e),a=6*e-_,c=o*(1-i),l=o*(1-a*i),d=o*(1-(1-a)*i);switch(_%6){case 0:n=o,r=d,s=c;break;case 1:n=l,r=o,s=c;break;case 2:n=c,r=o,s=d;break;case 3:n=c,r=l,s=o;break;case 4:n=d,r=c,s=o;break;case 5:n=o,r=c,s=l}return[Math.round(255*n),Math.round(255*r),Math.round(255*s)]},e.rgba_to_hex=function(t){var e=(256|t.r).toString(16).slice(1)+(256|t.g).toString(16).slice(1)+(256|t.b).toString(16).slice(1);if(1===t.a)return"#".concat(e);var i=(255*t.a|256).toString(16).slice(1);return"#".concat(e+=i)},e.hsva_to_rgba=function(t){var e=t.h/360,i=t.s/100,o=t.v/100,n=0,r=0,s=0,_=Math.floor(6*e),a=6*e-_,c=o*(1-i),l=o*(1-a*i),d=o*(1-(1-a)*i);switch(_%6){case 0:n=o,r=d,s=c;break;case 1:n=l,r=o,s=c;break;case 2:n=c,r=o,s=d;break;case 3:n=c,r=l,s=o;break;case 4:n=d,r=c,s=o;break;case 5:n=o,r=c,s=l}return{r:Math.round(255*n),g:Math.round(255*r),b:Math.round(255*s),a:t.a}}},25461:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.get_num_g=e.reset_all_block_id=e.insert_before=e.insert_after=e.clone_node=e.get_size_attr=e.get_translate=e.update_visibility_class=e.add_class_if_necessary=e.remove_class_if_necessary=e.is_in_same_shadow=e.is_inside_shadow=e.is_parent=e.xmlstr_to_dom=e.contains=e.has_class=e.get_owner_document=e.get_viewport_bbox=e.get_viewport_size=e.get_document_scroll=e.remove_children=e.create_dom=e.get_page_offset=e.parse_to_SVG=e.parse_to_DOM=e.remove_class=e.add_class=e.create_font_icon=e.create_div_element=e.create_svg_element=e.set_css_transform=e.remove_attribute=e.remove_node=e.XLINK_NS=e.SVG_NS=void 0;var o=i(98734),n=i(1530),r=i(75102),s=i(37767),_=o.__importStar(i(12988)),a=o.__importStar(i(11214)),c=o.__importStar(i(61972)),l=i(57754);e.SVG_NS="http://www.w3.org/2000/svg",e.XLINK_NS="http://www.w3.org/1999/xlink";var d="xlink:";function u(t,i,o){void 0===i&&(i={});var n=document.createElementNS(e.SVG_NS,t);for(var r in i)if(0===r.indexOf(d)){var s=r.slice(d.length);n.setAttributeNS(e.XLINK_NS,s,i[r])}else n.setAttribute(r,i[r]);return o&&o.appendChild(n),n}function h(t,e,i){t&&i.appendChild(c.is_string(t)?e.createTextNode(t):t)}function p(t){if(t&&"number"==typeof t.length){if(c.is_object(t))return"function"==typeof t.item||"string"==typeof t.item;if(c.is_func(t))return"function"==typeof t.item}return!1}function g(t){return c.is_object(t)&&t.nodeType>0}function f(){var t=window.document.body;return new a.Size(t.clientWidth,t.clientHeight)}function v(t,e){for(var i=e;i;){if(t===i)return!0;i=i.parentElement}return!1}function m(t,e){t.classList.contains(e)&&t.classList.remove(e)}function b(t,e){t.classList.contains(e)||t.classList.add(e)}e.remove_node=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},e.remove_attribute=function(t,e){l.is.ie(">=10")?t.setAttribute(e,void 0):t.removeAttribute(e)},e.set_css_transform=function(t,e){t.style.transform=e,t.style.webkitTransform=e},e.create_svg_element=u,e.create_div_element=function(t){var e=document.createElement("div");return t&&t.appendChild(e),e},e.create_font_icon=function(t,e){var i=u("svg",{fill:"currentColor"},e);return u("use",{"xlink:href":"#".concat(t)},i),i},e.add_class=function(t,e){var i=t.getAttribute("class")||"";return-1==" ".concat(i," ").indexOf(" ".concat(e," "))&&(i&&(i+=" "),t.setAttribute("class",i+e),!0)},e.remove_class=function(t,e){if(!t||!e)return!1;var i=t.getAttribute("class");if(void 0==i||-1==" ".concat(i," ").indexOf(" ".concat(e," ")))return!1;for(var o=i.split(/\s+/),n=0;n<o.length;n++)o[n]&&o[n]!=e||(o.splice(n,1),n--);return o.length?t.setAttribute("class",o.join(" ")):t.removeAttribute("class"),!0},e.parse_to_DOM=function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild},e.parse_to_SVG=function(t){var i=document.createElementNS(e.SVG_NS,"div");i.innerHTML="<svg xmlns=".concat(e.SVG_NS,">").concat(t,"</svg>");for(var o=document.createDocumentFragment();i.firstChild&&i.firstChild.firstChild;)o.appendChild(i.firstChild.firstChild);return o},e.get_page_offset=function(t){var e=t.getBoundingClientRect();return n.vec2.fromValues(e.left,e.top)},e.create_dom=function(t,e,i){t=String(t);var o=e,n=document.createElement(t);return o&&(c.is_string(o)?n.className=o:c.is_array(o)?n.className=o.join(" "):function(t,e){c.obj_for_each(e,(function(e,i){e&&e.implementsGoogStringTypedString&&(e=e.getTypedStringValue()),"style"==i?t.style.cssText=e:"class"==i?t.className=e:t.setAttribute(i,e)}))}(n,o)),i&&function(t,e,i,o){for(var n=o;n<i.length;n++){var r=i[n];if(c.is_array_like(r)&&!g(r))for(var s=p(r)?Array.from(r):r,_=0;_<s.length;++_)h(s[_],t,e);else h(r,t,e)}}(document,n,[t,e,i],2),n},e.remove_children=function(t){for(var e=t.firstChild;void 0!=e;)t.removeChild(e),e=t.firstChild},e.get_document_scroll=function(){var t=function(t){if(t.scrollingElement)return t.scrollingElement;return t.body||t.documentElement}(document),e=document.defaultView;return n.vec2.fromValues(e.pageXOffset||t.scrollLeft,e.pageYOffset||t.scrollTop)},e.get_viewport_size=f,e.get_viewport_bbox=function(){var t=f(),e=_.get_viewport_page_offset(document);return{right:t.width+e[0],bottom:t.height+e[1],top:e[1],left:e[0]}},e.get_owner_document=function(t){if(!t)throw new Error("Node cannot be undefined or undefined.");return t instanceof Node?t.nodeType==r.NodeType.DOCUMENT?document:t.ownerDocument:t instanceof Window?t.document:document},e.has_class=function(t,e){var i=t.getAttribute("class");return-1!=" ".concat(i," ").indexOf(" ".concat(e," "))},e.contains=function(t,e){if(!t||!e)return!1;if(t.contains&&e.nodeType==r.NodeType.ELEMENT)return t==e||t.contains(e);if("undefined"!=typeof t.compareDocumentPosition)return t==e||Boolean(16&t.compareDocumentPosition(e));for(;e&&t!=e;)e=e.parentNode;return e==t},e.xmlstr_to_dom=function(t){return(new DOMParser).parseFromString(t,"text/xml").firstChild},e.is_parent=v,e.is_inside_shadow=function(t){for(var e=null===t||void 0===t?void 0:t.parentElement;e;){if(e.classList.contains("blocklyShadow"))return!0;e=e.parentElement}return!1},e.is_in_same_shadow=function(t,e){for(var i=t.parentElement;i;){if(!i)return!1;if(i.classList.contains("blocklyShadow"))break;i=i.parentElement}return v(i,e)},e.remove_class_if_necessary=m,e.add_class_if_necessary=b,e.update_visibility_class=function(t,e){switch(e){case r.BlockVisibility.VISIBLE:m(t,s.VISIBILITY_CLASSNAME.HIDDEN),m(t,s.VISIBILITY_CLASSNAME.TRANSLUCENT);break;case r.BlockVisibility.TRANSLUCENT:m(t,s.VISIBILITY_CLASSNAME.HIDDEN),b(t,s.VISIBILITY_CLASSNAME.TRANSLUCENT);break;case r.BlockVisibility.HIDDEN:m(t,s.VISIBILITY_CLASSNAME.TRANSLUCENT),b(t,s.VISIBILITY_CLASSNAME.HIDDEN)}},e.get_translate=function(t){var e=t.style.transform||t.style.webkitTransform||t.getAttribute("transform");if(!e)return{x:0,y:0};var i=e.match(/translate\(([+-]?\d+)[^,]*,[\s]*([+-]?\d+)[^,]*\)/);if(!i)return{x:0,y:0};var o=i[1],n=i[2];return{x:Number(o)||0,y:Number(n)||0}},e.get_size_attr=function(t){return{width:parseFloat(t.getAttribute("width")||"0")||0,height:parseFloat(t.getAttribute("height")||"0")||0}},e.clone_node=function(t,e){return t.cloneNode(e)},e.insert_after=function(t,e){var i=e.nextSibling,o=e.parentNode;if(!o)throw new ReferenceError("Reference node has no parent.");i?o.insertBefore(t,i):o.appendChild(t)},e.insert_before=function(t,e){var i=e.parentNode;if(void 0==i)throw new ReferenceError("Reference node has no parent.");i.insertBefore(t,e)},e.reset_all_block_id=function(t){var e={},i={};return Array.isArray(t)?(t.forEach(o),t.forEach(n)):(o(t),n(t)),t;function o(t){if(t.attributes){var n=t.getAttribute("id");for(var r in n&&(e[n]=!0,i[n]=a.gen_uid()),t.childNodes)"object"===typeof t.childNodes[r]&&o(t.childNodes[r])}}function n(t){if(t.attributes){var e=t.getAttribute("id");e&&(t.id=i[e],t.setAttribute("id",i[e]));var o=t.getAttribute("def_id");for(var r in o&&i[o]&&t.setAttribute("def_id",i[o]),t.childNodes)"object"===typeof t.childNodes[r]&&n(t.childNodes[r])}}},e.get_num_g=function(t){var e=u("g",{"data-item-index":t,height:18,width:4+8*t.toString().length+4});return e.classList.add("svg_num"),u("text",{"font-weight":"900","font-size":"12pt","font-family":"NotoSansCJKsc-Black,NotoSansCJKsc","dominant-baseline":"central",transform:"translate(2, 9)"},e).textContent="".concat(t,"."),e}},74370:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.no_event=e.is_target_input=e.is_right_button=void 0,e.is_right_button=function(t){return 2==t.button},e.is_target_input=function(t){return t.target instanceof HTMLInputElement&&("textarea"==t.target.type||"text"==t.target.type||"number"==t.target.type||"email"==t.target.type||"password"==t.target.type||"search"==t.target.type||"tel"==t.target.type||"url"==t.target.type||t.target.isContentEditable)},e.no_event=function(t){t.preventDefault(),t.stopPropagation()}},22804:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.json=e.block=e.string=e.color=e.asserts=e.array=e.maths=e.math=e.base=e.event=e.dom=e.style=e.is=void 0;var o=i(98734),n=o.__importStar(i(12988));e.style=n;var r=o.__importStar(i(25461));e.dom=r;var s=o.__importStar(i(74370));e.event=s;var _=o.__importStar(i(61972));e.base=_;var a=o.__importStar(i(11214));e.math=a,e.maths=a;var c=o.__importStar(i(48462));e.array=c;var l=o.__importStar(i(56905));e.asserts=l;var d=o.__importStar(i(42798));e.color=d;var u=o.__importStar(i(53494));e.string=u;var h=i(57754);Object.defineProperty(e,"is",{enumerable:!0,get:function(){return h.is}});var p=o.__importStar(i(81558));e.block=p;var g=o.__importStar(i(34160));e.json=g},57754:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.is=void 0;var i=function(){function t(){this.userAgent=(navigator&&navigator.userAgent||"").toLowerCase(),this.platform=(navigator&&navigator.platform||"").toLowerCase(),this.comparator={"<":function(t,e){return t<e},"<=":function(t,e){return t<=e},">":function(t,e){return t>e},">=":function(t,e){return t>=e}}}return t.prototype.compare_version=function(t,e){var i=String(e),o=+(i.match(/\d+/)||NaN),n=i.match(/^[<>]=?|/)[0];return this.comparator[n]?this.comparator[n](t,o):t==o||o!==o},t.prototype.iphone=function(t){var e=this.ipad()?null:this.userAgent.match(/iphone(?:.+?os (\d+))?/);return null!==e&&this.compare_version(Number(e[1]||1),t)},t.prototype.ipad=function(t){var e=this.userAgent.match(/ipad.+?os (\d+)/);return null!==e&&this.compare_version(Number(e[1]),t)},t.prototype.ios=function(){return this.ipad()||this.iphone()},t.prototype.android=function(t){if(!t)return/android/.test(this.userAgent);var e=this.userAgent.match(/android.+?(\d+)/);try{return null!==e&&this.compare_version(Number(e[1]),t)}catch(i){return console.warn("cc android",i),!1}},t.prototype.ie=function(t){var e=this.userAgent.match(/(?:msie |trident.+?; rv:)(\d+)/);return null!==e&&this.compare_version(Number(e[1]),t)},t.prototype.webkit=function(){return/webkit\/([\d.]+)/.test(this.userAgent)},t.prototype.JavaFX=function(){return/JavaFX/i.test(this.userAgent)},t.prototype.firefox=function(){return/Firefox\/([\d.]+)/.test(this.userAgent)},t.prototype.safari=function(t){var e=this.userAgent.match(/version\/(\d+).+?safari/);return null!==e&&this.compare_version(Number(e[1]),t)},t.prototype.android_phone=function(){return/android/.test(this.userAgent)&&/mobile/.test(this.userAgent)},t.prototype.mobile=function(){return this.iphone()||this.android_phone()},t.prototype.Gecko=function(){return/Gecko/i.test(this.userAgent)},t.prototype.edge=function(t){var e=this.userAgent.match(/edge\/(\d+)/);return null!==e&&this.compare_version(Number(e[1]),t)},t.prototype.mac=function(){return/mac/.test(this.platform)},t.prototype.IOS17=function(){return/OS 17_/.test(navigator.userAgent)},t}();e.is=new i},34160:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.parse_visibility=e.parse_constraints=void 0;var o=i(75102);e.parse_constraints=function(t){var e=t.split(","),i=parseFloat(e[0]),o=parseFloat(e[1]),n=parseFloat(e[2]),r="true"===e[3]||null;return{min:isNaN(i)?-1/0:i,max:isNaN(o)?1/0:o,precision:isNaN(n)?0:n,mod:r}},e.parse_visibility=function(t){var e;switch(t){case"visible":e=o.BlockVisibility.VISIBLE;break;case"hidden":e=o.BlockVisibility.HIDDEN;break;case"translucent":e=o.BlockVisibility.TRANSLUCENT;break;default:return}return e}},11214:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.is_valid_number=e.lerp=e.to_radians=e.clamp=e.gen_uid=e.contains=e.Rect=e.Size=void 0;var i=function(t,e){this.width=t,this.height=e};e.Size=i;var o=function(){function t(t,e,i,o){this.left=t,this.top=e,this.width=i,this.height=o}return t.prototype.contains=function(t){return t[0]>=this.left&&t[0]<=this.left+this.width&&t[1]>=this.top&&t[1]<=this.top+this.height},t}();e.Rect=o,e.contains=function(t,e){return t.left<e[0]&&t.right>e[0]&&t.top<e[1]&&t.bottom>e[1]},e.gen_uid=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=t.length,i=[],o=0;o<20;o++)i[o]=t.charAt(Math.random()*e);return i.join("")},e.clamp=function(t,e,i){return Math.min(Math.max(t,e),i)},e.to_radians=function(t){return t*Math.PI/180},e.lerp=function(t,e,i){return t+i*(e-t)},e.is_valid_number=function(t){return/^[+-]?Infinity$/.test(t)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?$/.test(t)}},53494:function(t,e){function i(t,e){if(t.length<=e)return t;for(var i,s=t.trim().split(/\s+/),_=0;_<s.length;_++)s[_].length>e&&(e=s[_].length);var a,c=-1/0,l=1;do{i=c,a=t;var d=[],u=s.length/l,h=1;for(_=0;_<s.length-1;_++)h<(_+1.5)/u?(h++,d[_]=!0):d[_]=!1;c=n(s,d=o(s,d,e),e),t=r(s,d),l++}while(c>i);return a}function o(t,e,i){for(var r,s=n(t,e,i),_=0;_<e.length-1;_++)if(e[_]!=e[_+1]){var a=e.slice();a[_]=!a[_],a[_+1]=!a[_+1];var c=n(t,a,i);c>s&&(s=c,r=a)}return r?o(t,r,i):e}function n(t,e,i){for(var o=[0],n=[],r=0;r<t.length;r++)o[o.length-1]+=t[r].length,!0===e[r]?(o.push(0),n.push(t[r].charAt(t[r].length-1))):!1===e[r]&&o[o.length-1]++;var s=Math.max.apply(Math,o),_=0;for(r=0;r<o.length;r++)_-=2*Math.pow(Math.abs(i-o[r]),1.5),_-=Math.pow(s-o[r],1.5),-1!=".?!".indexOf(n[r])?_+=i/3:-1!=",;)]}".indexOf(n[r])&&(_+=i/4);return o.length>1&&o[o.length-1]<=o[o.length-2]&&(_+=.5),_}function r(t,e){for(var i=[],o=0;o<t.length;o++)i.push(t[o]),void 0!=e[o]&&i.push(e[o]?"\n":" ");return i.join("")}Object.defineProperty(e,"__esModule",{value:!0}),e.wrap=e.string_trim=e.string_is_empty_or_whitespace=e.case_insensitive_equals=e.case_insensitive_compare=void 0,e.case_insensitive_compare=function(t,e){var i=String(t).toLowerCase(),o=String(e).toLowerCase();return i<o?-1:i==o?0:1},e.case_insensitive_equals=function(t,e){return"string"===typeof t&&"string"===typeof e&&t.toLowerCase()==e.toLowerCase()},e.string_is_empty_or_whitespace=function(t){return/^[\s\xa0]*$/.test(t)},e.string_trim=function(t){return t.replace(/\s+$/,"").replace(/ +\n/g,"\n")},e.wrap=function(t,e){for(var o=t.split("\n"),n=0;n<o.length;n++)o[n]=i(o[n],e);return o.join("\n")}},12988:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.adjust_bboxes_for_rtl=e.get_computed_style=e.get_style=e.get_size=e.get_viewport_page_offset=void 0;var o=i(1530),n=i(25461),r=i(57754);function s(t){var e=t.offsetWidth,i=t.offsetHeight,o=r.is.webkit()&&!e&&!i;if((void 0!=e||o)&&t.getBoundingClientRect){var n=t.getBoundingClientRect();return{width:n.right-n.left,height:n.bottom-n.top}}return{width:e,height:i}}function _(t,e){return a(t,e)||function(t,e){return t.currentStyle?t.currentStyle[e]:void 0}(t,e)||t.style&&t.style[Number(e)]}function a(t,e){var i=(0,n.get_owner_document)(t);if(i.defaultView&&i.defaultView.getComputedStyle){var o=i.defaultView.getComputedStyle(t,void 0);if(o)return o[Number(e)]||o.getPropertyValue(e)||""}return""}e.get_viewport_page_offset=function(t){var e=t.body,i=t.documentElement,n=e.scrollLeft||i.scrollLeft,r=e.scrollTop||i.scrollTop;return o.vec2.fromValues(n,r)},e.get_size=function(t){return function(t,e){if("none"!=_(e,"display"))return t(e);var i=e.style,o=i.display,n=i.visibility,r=i.position;i.visibility="hidden",i.position="absolute",i.display="inline";var s=t(e);return i.display=o,i.position=r,i.visibility=n,s}(s,t)},e.get_style=_,e.get_computed_style=a,e.adjust_bboxes_for_rtl=function(t,e,i){e.left+=i.width,e.right+=i.width,t.left+=i.width,t.right+=i.width}},15924:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockDragSurfaceSvg=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=i(25461),a=i(37767),c=function(){function t(t){this.SVG_=void 0,this.drag_group_=void 0,this.container_=void 0,this.scale_=1,this.surface_xy_=void 0,this.container_=t,this.create_dom()}return t.prototype.create_dom=function(){this.SVG_||(this.SVG_=(0,_.create_svg_element)("svg",{xmlns:a.SVG_NS,"xmlns:html":a.HTML_NS,"xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",class:"blocklyBlockDragSurface"},this.container_),this.drag_group_=(0,_.create_svg_element)("g",{},this.SVG_))},t.prototype.set_blocks_and_show=function(t){this.clear_additions(),void 0!=this.drag_group_&&0!==this.drag_group_.childNodes.length&&console.error("Already dragging a block."),this.drag_group_&&this.SVG_&&(this.drag_group_.appendChild(t),this.SVG_.style.display="block",this.surface_xy_=r.vec2.fromValues(0,0))},t.prototype.translate_and_scale_group=function(t,e,i){this.scale_=i;var o=t.toFixed(0),n=e.toFixed(0);this.drag_group_&&this.drag_group_.setAttribute("transform","translate(".concat(o,", ").concat(n,") scale(").concat(i,")"))},t.prototype.set_scale=function(t){if(this.scale_=t,this.drag_group_){var e=this.drag_group_.getAttribute("transform"),i="scale(".concat(t,")");this.drag_group_.setAttribute("transform",e?e.replace(/scale\([0-9\.]+\)/,i):i)}},t.prototype.translate_surface_internal=function(){if(void 0==this.surface_xy_)throw new Error("surfaceXY_ can not be undefined");if(void 0==this.SVG_)throw new Error("SVG_ can not be undefined");var t=this.surface_xy_[0],e=this.surface_xy_[1],i=t.toFixed(0),o=e.toFixed(0);this.SVG_.style.display="block",(0,_.set_css_transform)(this.SVG_,"translate3d(".concat(i,"px, ").concat(o,"px, 0px)"))},t.prototype.translate_surface=function(t,e){this.surface_xy_=r.vec2.fromValues(t*this.scale_,e*this.scale_),this.translate_surface_internal()},t.prototype.get_surface_translation=function(){var t=this.utils.get_relative_xy(this.SVG_);return r.vec2.fromValues(t[0]/this.scale_,t[1]/this.scale_)},t.prototype.get_group=function(){return this.drag_group_},t.prototype.get_current_block=function(){if(this.drag_group_)return this.drag_group_.firstChild},t.prototype.clear_and_hide=function(t){var e=this.get_current_block();t?void 0!=e&&t.appendChild(e):this.drag_group_&&void 0!=e&&this.drag_group_.removeChild(e),this.SVG_&&(this.SVG_.style.display="none"),this.drag_group_&&(this.clear_additions(),0!==this.drag_group_.childNodes.length&&console.error("Drag group was not cleared.")),this.surface_xy_=void 0},t.prototype.clear_additions=function(){if(this.drag_group_)for(var t=this.drag_group_.childElementCount-1;t>=0;t--){var e=this.drag_group_.children[t];e.classList.contains("blocklyDraggable")||(0,_.remove_node)(e)}},o.__decorate([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.BlockDragSurfaceSvg=c},52096:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionDB=void 0;var o=i(98734),n=i(61455),r=function(){function t(){this.connections=[],this.connections=new Array}return t.prototype.add_connection=function(t){if(t.in_db)throw new Error("Connection already in database.");if(!t.get_source_block().is_in_flyout){var e=this.find_position_for_connection(t);this.connections.splice(e,0,t),t.in_db=!0}},t.prototype.find_connection=function(t){if(!this.connections.length)return-1;var e=this.find_position_for_connection(t);if(e>=this.connections.length)return-1;for(var i=t.y_,o=e,n=e;o>=0&&this.connections[o].y_==i;){if(this.connections[o]==t)return o;o--}for(;n<this.connections.length&&this.connections[n].y_==i;){if(this.connections[n]==t)return n;n++}return-1},t.prototype.find_position_for_connection=function(t){if(!this.connections.length)return 0;for(var e=0,i=this.connections.length;e<i;){var o=Math.floor((e+i)/2);if(this.connections[o].y_<t.y_)e=o+1;else{if(!(this.connections[o].y_>t.y_)){e=o;break}i=o}}return e},t.prototype.remove_connection=function(t){if(!t.in_db)throw new Error("Connection not in database.");var e=this.find_connection(t);if(-1==e)throw new Error("Unable to find connection in connectionDB.");t.in_db=!1,this.connections.splice(e,1)},t.prototype.get_neighbours=function(t,e){for(var i=t.x_,o=t.y_,n=this.connections,r=0,s=n.length-2,_=s;r<_;)n[_].y_<o?r=_:s=_,_=Math.floor((r+s)/2);var a=[];function c(t){var r=i-n[t].x_,s=o-n[t].y_;return Math.sqrt(r*r+s*s)<=e&&a.push(n[t]),s<e}if(r=_,s=_,n.length){for(;r>=0&&c(r);)r--;do{s++}while(s<n.length&&c(s))}return a},t.prototype.is_in_y_range=function(t,e,i){return Math.abs(this.connections[t].y_-e)<=i},t.prototype.search_for_closest=function(t,e,i){if(!t.source_block.is_stack_connectable()||!this.connections.length)return{connection:void 0,radius:e};var o=t.y_,n=t.x_;t.x_=n+i[0],t.y_=o+i[1];for(var r,s=this.find_position_for_connection(t),_=void 0,a=e,c=s-1;c>=0&&this.is_in_y_range(c,t.y_,e);)r=this.connections[c],t.is_connection_allowed(r,a)&&(_=r,a=r.distance_from(t)),c--;for(var l=s;l<this.connections.length&&this.is_in_y_range(l,t.y_,e);)r=this.connections[l],t.is_connection_allowed(r,a)&&(_=r,a=r.distance_from(t)),l++;return t.x_=n,t.y_=o,{connection:_,radius:a}},t=o.__decorate([(0,n.injectable)()],t)}();e.ConnectionDB=r},54693:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Grid=void 0;var o=i(98734),n=i(61455),r=i(25461),s=i(57754),_=function(){function t(t){this.scale=1;var e=t.svg_defs,i=t.svg_rnd,o=t.gridOptions;this.spacing=o.spacing,this.step=o.step,this.snap_to_grid=o.snap,this.grid_pattern=(0,r.create_svg_element)("pattern",{id:"blocklyGridPattern".concat(i),patternUnits:"userSpaceOnUse",fill:"transparent"},e),this.bg_rect=(0,r.create_svg_element)("rect",{class:"blinkGridPatternBg",fill:"transparent"},this.grid_pattern),this.outer_rect=(0,r.create_svg_element)("path",{class:"blinkGridPatternOuter",stroke:"rgb(136, 136, 136)"},this.grid_pattern),this.inner_lines=(0,r.create_svg_element)("path",{class:"blinkGridPatternInner",stroke:"rgb(136, 136, 136)"},this.grid_pattern),this.update()}return t.prototype.should_snap=function(){return this.snap_to_grid},t.prototype.move_to=function(t,e){this.grid_pattern.setAttribute("x",String(t)),this.grid_pattern.setAttribute("y",String(e)),(s.is.ie()||s.is.edge())&&this.set_scale(this.scale)},t.prototype.get_spacing=function(){return this.spacing},t.prototype.get_pattern_id=function(){return this.grid_pattern.id},t.prototype.dispose=function(){(0,r.remove_node)(this.grid_pattern)},t.prototype.update=function(){var t=this.spacing*this.scale||10,e=t*this.step;this.grid_pattern.setAttribute("width",e.toString()),this.grid_pattern.setAttribute("height",e.toString()),this.bg_rect.setAttribute("width",e.toString()),this.bg_rect.setAttribute("height",e.toString()),this.outer_rect.setAttribute("d","M ".concat(e," 0 L 0 0 0 ").concat(e));for(var i=[],o=[],n=1;n<this.step;n++)i.push("M 0 ".concat(n*t," L ").concat(e," ").concat(n*t)),o.push("M ".concat(n*t," 0 L ").concat(n*t," ").concat(e));this.inner_lines.setAttribute("d",i.join(" ")+o.join(" "))},t.prototype.set_scale=function(t){this.scale=t,this.update()},t.prototype.set_color=function(t,e){this.bg_rect.setAttribute("fill",t),this.outer_rect.setAttribute("stroke",e),this.inner_lines.setAttribute("stroke",e)},t=o.__decorate([(0,n.injectable)()],t)}();e.Grid=_},78429:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceAudio=void 0;var o=i(98734),n=i(61455),r=i(25461),s=i(57754),_=i(98030),a=function(){function t(t){this.last_sound_=void 0,this.SOUNDS_={},this.parent_workspace_=t}return t.prototype.load=function(t,e){if(t.length){var i,o;try{i=new window.Audio}catch(_){return}for(var n=0;n<t.length;n++){var r=t[n],s=r.match(/\.(\w+)$/);if(s&&i.canPlayType("audio/".concat(s[1]))){o=new window.Audio(r);break}}o&&o.play&&(this.SOUNDS_[e]=o)}},t.prototype.play=function(t,e){var i=this.SOUNDS_[t];if(i){var o=Date.now();if(void 0!=this.last_sound_&&o-this.last_sound_<this.theme.blink_params.SOUND_LIMIT)return;this.last_sound_=o;var n=void 0;(n=s.is.ie(9)||s.is.ipad()||s.is.android()?i:(0,r.clone_node)(i)).volume=void 0==e?1:e;var _=n.play();_&&_.catch((function(t){console.log(t)}))}else if(this.parent_workspace_){var a=this.parent_workspace_.get_audio_manager();a&&a.play(t,e)}},t.prototype.preload=function(){for(var t in this.SOUNDS_){if(this.SOUNDS_[t].volume=.01,s.is.ipad()||s.is.iphone())break}},o.__decorate([(0,_.lazy_inject)(_.BINDING.theme)],t.prototype,"theme",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.WorkspaceAudio=a},11734:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceDragSurfaceSvg=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(25461),_=i(37767),a=function(){function t(t,e){this.previous_sibling_=void 0,this.container_=t,this.SVG_=(0,s.create_svg_element)("svg",{xmlns:_.SVG_NS,"xmlns:html":_.HTML_NS,"xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",class:"blocklyWsDragSurface"}),e?(0,s.insert_after)(this.SVG_,e):this.container_.appendChild(this.SVG_)}return t.prototype.get_svg=function(){return this.SVG_},t.prototype.translate_surface=function(t,e){t=Number(t.toFixed(0)),e=Number(e.toFixed(0)),this.SVG_.style.display="block",(0,s.set_css_transform)(this.SVG_,"translate3d(".concat(t,"px, ").concat(e,"px, 0px)"))},t.prototype.set_contents_and_show=function(t,e,i,o){if(!this.SVG_)throw new Error("No Svg Element");0!==this.SVG_.childNodes.length&&console.error("Already dragging a block."),this.previous_sibling_=i,this.SVG_.style.display="none";var n=document.createDocumentFragment();n.appendChild(t),e&&n.appendChild(e),n.firstElementChild&&n.firstElementChild.setAttribute("transform","translate(0, 0) scale(".concat(o,")")),n.lastElementChild&&n.lastElementChild.setAttribute("transform","translate(0, 0) scale(".concat(o,")")),this.SVG_.appendChild(n),this.SVG_.style.display="block"},t.prototype.get_surface_translation=function(){return this.utils.get_relative_xy(this.SVG_)},t.prototype.clear_and_hide=function(t){if(!this.SVG_)throw new Error("No Svg_");var e=this.SVG_.childNodes[0],i=this.SVG_.childNodes[1];if(!e||!i||!(0,s.has_class)(e,"blocklyBlockCanvas")||!(0,s.has_class)(i,"blocklyBubbleCanvas"))throw new Error("Couldn't clear and hide the drag surface.  A node was missing.");void 0!=this.previous_sibling_?(0,s.insert_after)(e,this.previous_sibling_):t.insertBefore(e,t.firstChild),(0,s.insert_after)(i,e),this.SVG_.style.display="none",0!=this.SVG_.childNodes.length&&console.error("Drag surface was not cleared."),(0,s.set_css_transform)(this.SVG_,""),this.previous_sibling_=void 0},o.__decorate([(0,r.lazy_inject)(r.BINDING.utils)],t.prototype,"utils",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.WorkspaceDragSurfaceSvg=a},36908:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceSvg=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=i(75102),a=i(81558),c=i(11214),l=i(25461),d=i(48462),u=i(61972),h=i(57754),p=function(){function t(t,e,i,o){this.connectionDBList=[],this.degrade_translate=void 0,this.MAX_UNDO=1024,this.SCAN_ANGLE=3,this.listeners_=[],this.blockDB_=new Map,this.workspace_comment_db=new Map,this.undo_stack_=[],this.redo_stack_=[],this.top_blocks_=[],this.top_comments=[],this.is_clearing=!1,this.is_drag_surface_active_=!1,this.cached_parent_svg_=void 0,this.flyout_=void 0,this.toolbox_=void 0,this.inverse_screen_CTM_=void 0,this.inverse_screen_CTM_dirty_=!0,this.blocks_area_=void 0,this.workspace_area_=void 0,this.workspace_area_dirty_=!0,this.delete_area_flyout=void 0,this.is_flyout_rect_dirty_=!0,this.toolbox_category_callbacks_={},this.last_recorded_page_scroll_=void 0,this.resize_handler_wrapper_=void 0,this.rendered=!0,this.is_flyout=!1,this.resizes_enabled_=!0,this.toolbox_refresh_enabled_=!0,this.scroll_xy=r.vec2.create(),this.content_offset_by_view=r.vec2.create(),this.drag_delta_xy_=r.vec2.create(),this.scale=1,this.current_gesture_=void 0,this.workspace_drag_surface_=void 0,this.injection_div_=void 0,this.flyout_button_callbacks_={},this.custom_flyout_buttons=new Map,this.svg_group=void 0,this.svg_bubble_canvas_=void 0,this.target_workspace=void 0,this.event_dict=new Map,this.custom_change_events_=new Map,this.pre_paste=[],this.pre_paste_extend=[],this.gestures_enabled=!0,this.wheel_scroll_enabled=!0,this.offset=r.vec2.fromValues(0,0),this._draggable=!0,this._disabled_field_click=!1,this.is_hotkey_enable=!0,this.id=t.id||(0,c.gen_uid)(),this.workspace_db.add(this),this.options=t,this.RTL=!!this.options.RTL,this.toolbox_position=this.options.toolboxPosition,this.is_flyout=t.in_flyout,this.top_blocks_=[],this.top_comments=[],this.listeners_=[],this.undo_stack_=[],this.redo_stack_=[],this.get_metrics=t.get_metrics||this.get_metrics,this.set_metrics=t.set_metrics||this.set_metrics,this.init_connection_db(),e&&(this.block_drag_surface_=e),i&&(this.workspace_drag_surface_=i),o&&(this.injection_div_=o),this.audio_manager_=this.workspace_audio_factory(t.parentWorkspace),!t.in_flyout&&t.svg_defs&&t.svg_rnd&&(this.grid_=this.grid_factory(t))}var e;return e=t,t.prototype.get_element_from_db=function(t){return this.blockDB_.get(t)||this.workspace_comment_db.get(t)},t.prototype.get_options=function(){return this.options},t.prototype.get_undo_stack=function(){return this.undo_stack_},t.prototype.set_undo_stack=function(t){this.undo_stack_=t},t.prototype.get_redo_stack=function(){return this.redo_stack_},t.prototype.set_redo_stack=function(t){this.redo_stack_=t},t.prototype.get_toolbox=function(){return this.toolbox_},t.prototype.get_flyout=function(){return this.flyout_?this.flyout_:this.toolbox_?this.toolbox_.flyout:void 0},t.prototype.get_workspace_area=function(){var t=this.get_parent_svg();return this.workspace_area_dirty_&&void 0!=t&&(this.workspace_area_=t.getBoundingClientRect(),this.workspace_area_dirty_=!1),this.workspace_area_},t.prototype.get_delete_area_flyout=function(){if(!this.is_flyout_rect_dirty_)return this.delete_area_flyout;var t=this.flyout_||this.toolbox_&&this.toolbox_.flyout;return t&&t.is_visible()&&"none"!==this.get_options().delete_area?this.delete_area_flyout=t.get_client_rect():this.delete_area_flyout=void 0,this.is_flyout_rect_dirty_=!1,this.delete_area_flyout},t.prototype.get_block_drag_surface=function(){return this.block_drag_surface_},t.prototype.is_resizes_enabled=function(){return this.resizes_enabled_},t.prototype.get_scale=function(){return this.scale},t.prototype.get_delete_area_toolbox=function(){return this.delete_area_toolbox_},t.prototype.get_scrollbar=function(){return this._scrollbar},t.prototype.set_scrollbar=function(t){this._scrollbar=t},t.prototype.get_workspace_drag_surface=function(){return this.workspace_drag_surface_},Object.defineProperty(t.prototype,"use_workspace_drag_surface_",{get:function(){return this.degrade_translate?this.blockDB_.size<this.degrade_translate:!!this.workspace_drag_surface_},enumerable:!1,configurable:!0}),t.prototype.get_target_workspace=function(){return this.target_workspace},t.prototype.set_target_workspace=function(t){this.target_workspace=t},t.prototype.init_connection_db=function(){this.connectionDBList[_.CONNECTION_TYPE.INPUT_VALUE]=this.connection_db_factory(),this.connectionDBList[_.CONNECTION_TYPE.OUTPUT_VALUE]=this.connection_db_factory(),this.connectionDBList[_.CONNECTION_TYPE.NEXT_STATEMENT]=this.connection_db_factory(),this.connectionDBList[_.CONNECTION_TYPE.PREVIOUS_STATEMENT]=this.connection_db_factory()},t.prototype.remaining_capacity=function(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.get_all_blocks().length},t.prototype.undo=function(t){var e=t?this.redo_stack_:this.undo_stack_,i=t?this.undo_stack_:this.redo_stack_,o=e.pop();if(o){for(var n=[o],r=o._group;e.length&&r&&r==e[e.length-1]._group;){var s=e.pop();s&&n.push(s)}for(var _=0;_<n.length;_++){var a=n[_];i.push(a)}var c=this.events.filter(n,!!t);this.events.set_record_undo(!1),this.events.set_undoing(!0),this.set_resizes_enabled(!1);try{r&&this.events.set_group(r);for(_=0;_<c.length;_++){var l=c[_];l.run&&l.run(!!t)}r&&this.events.set_group(!1)}catch(d){console.error(d)}finally{this.set_resizes_enabled(!0),this.events.set_undoing(!1),this.events.set_record_undo(!0)}}},t.prototype.clear_undo=function(){this.undo_stack_.length=0,this.redo_stack_.length=0,this.events.clear_pending_undo()},t.prototype.get_all_blocks=function(){for(var t=this.get_top_blocks(!1),e=0;e<t.length;e++)t.push.apply(t,t[e].get_children());return t},t.prototype.add_top_block=function(t){this.top_blocks_.push(t)},t.prototype.add_top_comment=function(t){this.top_comments.push(t)},t.prototype.get_top_blocks=function(t,e){void 0===e&&(e=!1);var i=this.top_blocks_.filter((function(t){return!t.parent_group}));if(e&&(i=i.filter((function(t){return t.get_visibility()===_.BlockVisibility.VISIBLE}))),t&&i.length>1){var o=Math.sin((0,c.to_radians)(this.SCAN_ANGLE));this.RTL&&(o*=-1),i.sort((function(t,e){var i=t.get_relative_to_surface_xy(),n=e.get_relative_to_surface_xy();return i[1]+o*i[0]-(n[1]+o*n[0])}))}return i},t.prototype.get_last_block=function(){var t=this.get_top_blocks(!0),e=t[t.length-1];if(e){for(var i=e.get_full_next_block();i;)i=(e=i).get_full_next_block();return e}},t.prototype.get_top_comments=function(t,e){void 0===e&&(e=!1);var i=this.top_comments.slice();if(e&&(i=i.filter((function(t){return t.get_visibility()===_.BlockVisibility.VISIBLE}))),t&&i.length>1){var o=Math.sin((0,c.to_radians)(this.SCAN_ANGLE));this.RTL&&(o*=-1),i.sort((function(t,e){var i=t.get_relative_to_surface_xy(),n=e.get_relative_to_surface_xy();return i[1]+o*i[0]-(n[1]+o*n[0])}))}return i},t.prototype.get_top_elements=function(t,e){void 0===e&&(e=!1);var i=this.top_comments.slice();if(i=i.concat(this.top_blocks_.filter((function(t){return!t.parent_group}))),e&&(i=i.filter((function(t){return t.get_visibility()===_.BlockVisibility.VISIBLE}))),t&&i.length>1){var o=Math.sin((0,c.to_radians)(this.SCAN_ANGLE));this.RTL&&(o*=-1),i.sort((function(t,e){var i=t.get_relative_to_surface_xy(),n=e.get_relative_to_surface_xy();return i[1]+o*i[0]-(n[1]+o*n[0])}))}return i},t.prototype.remove_change_listener=function(t){(0,d.remove)(this.listeners_,t)},t.prototype.remove_top_block=function(t){if(!(0,d.remove)(this.top_blocks_,t))throw new Error("Block ".concat(t.type," [").concat(t.id,"] not present in workspace's list of top-most blocks."))},t.prototype.remove_top_comment=function(t){if(!(0,d.remove)(this.top_comments,t))throw new Error("Comment ".concat(t.get_text()," [").concat(t.id,"] not present in workspace's list of top-most comments."))},t.prototype.fire_change_listener=function(t){if(t.is_record_undo()&&this.events.is_record_undo())for(this.undo_stack_.push(t),this.redo_stack_.length=0;this.undo_stack_.length>this.MAX_UNDO&&this.MAX_UNDO>=0;)this.undo_stack_.shift();for(var e=this.listeners_.slice(),i=0;i<e.length;i++){(0,e[i])(t)}var o=this.event_dict.get("common");o&&o(t);var n=this.event_dict.get(t.type);if(n&&n(t),_.AllUIEvents.includes(t.type)){var r=this.event_dict.get(_.BlockEventType.UI);r&&r(t)}},t.prototype.get_block_by_id=function(t){var e=this.blockDB_.get(t),i=this.get_flyout();if(!e&&void 0!=i){var o=i.get_workspace();void 0!=o&&(e=o.blockDB_.get(t))}return e||void 0},t.prototype.add_change_listener=function(t,e){return void 0===e&&(e=!0),e?this.listeners_.push(t):this.listeners_.unshift(t),t},t.prototype.add_event_listener=function(t,e){this.event_dict.set(t,e)},t.prototype.add_custom_change_event=function(t,e){this.custom_change_events_.set(t,e)},t.prototype.get_change_event=function(t){return this.custom_change_events_.get(t)},t.prototype.create_dom=function(t){return this.svg_group=(0,l.create_svg_element)("g",{class:"blocklyWorkspace"}),t&&(this.svg_background_=(0,l.create_svg_element)("rect",{height:"100%",width:"100%",class:t},this.svg_group)),"blocklyMainBackground"==t&&this.grid_&&this.svg_background_&&(this.svg_background_.style.fill="url(#".concat(this.grid_.get_pattern_id(),")")),this.svg_block_canvas_=(0,l.create_svg_element)("g",{class:"blocklyBlockCanvas"},this.svg_group),this.svg_bubble_canvas_=(0,l.create_svg_element)("g",{class:"blocklyBubbleCanvas"},this.svg_group),this.is_flyout||(this.events.bind_event_with_checks(this.svg_group,"mousedown",this,this.on_mouse_down),this.options.ws_scrollable&&this.events.bind_event_with_checks(this.svg_group,"wheel",this,this.on_wheel_scroll)),this.options.has_categories&&(this.toolbox_=this.toolbox_factory(this)),this.record_delete_areas(),this.svg_group},t.prototype.paste=function(t,e,i){void 0===i&&(i=!1),t&&(0,l.reset_all_block_id)(t),this._paste(t,e,i,!1)},t.prototype._paste=function(t,e,i,o){var n;void 0===i&&(i=!1),void 0===o&&(o=!0),this.runtime_data.set_pasting(!0);try{for(var s=0;s<this.pre_paste.length;s++)t&&(t=(n=this.pre_paste[s].call(this,t,e,i||!1,o)).xml_block,e=n.mouse_position,i=n.is_move_to_default);if(!t)return;if(!this.rendered||t.getElementsByTagName("block").length>=this.remaining_capacity())return;this.current_gesture_&&this.current_gesture_.cancel(),this.events.disable();var _=this.resizes_enabled_;_&&this.set_resizes_enabled(!1);var c=void 0,l=e||{x:0,y:0};try{if(c=this.xml.dom_to_workspace_element(t,this),(0,u.is_block_svg)(c)&&(c=c.parent_group||c),!c)return;var d=void 0,h=void 0;if(e)l=e,c.move_by(r.vec2.fromValues(e.x,e.y));else{if(i){var p=this.get_origin_offset_in_pixels(),g=this.get_paste_offset();d=(g.left-p[0])/this.scale,h=(g.top-p[1])/this.scale}else{var f=t.getAttribute("x"),v=t.getAttribute("y");if(!f||!v)return;d=parseInt(f,10),h=parseInt(v,10)}if(isNaN(d)||isNaN(h))throw Error();this.RTL&&(d=-d);var m=void 0;do{m=!1;var b=this.get_all_blocks().slice();b=b.concat(this.top_comments.slice());for(s=0;s<b.length;s++){var y=b[s].get_relative_to_surface_xy();if(Math.abs(d-y[0])<=1&&Math.abs(h-y[1])<=1){m=!0;break}}if(!m){var E=(0,u.is_block_svg)(c)?c.get_connections(!1):[];for(s=0;s<E.length;s++){if(E[s].closest(this.theme.blink_params.SNAP_RADIUS,r.vec2.fromValues(d,h)).connection){m=!0;break}}}m&&(d+=this.theme.blink_params.SNAP_RADIUS,h+=2*this.theme.blink_params.SNAP_RADIUS)}while(m);l={x:d,y:h},c.move_by(r.vec2.fromValues(d,h))}}finally{this.events.enable(),_&&this.set_resizes_enabled(!0)}c.select();var k=this.events.get_group();return this.events.set_group(k||!0),!this.events.is_enabled()||(0,u.is_block_svg)(c)&&c.is_shadow()||this.events.fire(this.create_event_factory({block:c})),(0,u.is_block_svg)(c)&&((0,a.fire_block_onchange)(c),c.parent_group&&this.events.fire(this.change_event_factory("group_block",{block:c,old_value:void 0,new_value:[c.parent_group.id,c.parent_group.group_name,c.parent_group.group_stop_at||""]}))),this.events.set_group(k||!1),c.bring_to_front(),l}finally{this.runtime_data.set_pasting(!1)}},t.prototype.set_pre_paste=function(t){this.pre_paste.push(t)},t.prototype.set_pre_paste_extend=function(t){this.pre_paste_extend.push(t)},t.prototype.paste_extend=function(t,e,i){var o;void 0===i&&(i=!1);var n=this.events.get_group();this.events.set_group(n||!0),this.runtime_data.set_pasting(!0),(0,l.reset_all_block_id)(t);for(var r=0;r<this.pre_paste_extend.length;r++)t=(o=this.pre_paste_extend[r].call(this,t,e,i||!1)).xml_blocks,e=o.mouse_position,i=o.is_move_to_default;if(t.length<=1)return t[0]&&this._paste(t[0],e,i,!0),void this.events.set_group(n);var s=function(t){var e=t.getAttribute("x"),i=t.getAttribute("y");return{x:parseInt(e||"0",10),y:parseInt(i||"0",10)}},_=this.resizes_enabled_;_&&this.set_resizes_enabled(!1),e?this._paste(t[0],e,i):e=this._paste(t[0],void 0,i)||{x:0,y:0};for(var a=s(t[0]),c=e.x-a.x,d=e.y-a.y,u=(r=1,t.length);r<u;r++){var h=t[r],p=s(t[r]),g={x:p.x+c,y:p.y+d};this._paste(h,g,!1)}this.runtime_data.set_pasting(!1),this.events.set_group(n),_&&this.set_resizes_enabled(!0)},t.prototype.get_paste_offset=function(){var t={left:40,top:30},e=(0,l.get_translate)(this.get_parent_svg());return t.left+=e.x,t},t.prototype.record_delete_areas=function(){if(this.is_flyout_rect_dirty_=!0,"none"===this.get_options().delete_area)return this.delete_area_toolbox_=void 0,void(this.delete_area_flyout=void 0);this.flyout_?this.delete_area_toolbox_=this.flyout_.get_client_rect():this.toolbox_?this.delete_area_toolbox_=this.toolbox_.get_client_rect():this.delete_area_toolbox_=void 0},t.prototype.is_delete_area=function(t){var e=r.vec2.fromValues(t.clientX,t.clientY),i=this.get_delete_area_flyout();return this.delete_area_toolbox_&&this.delete_area_toolbox_.contains(e)||i&&i.contains(e)?_.DeleteArea.DELETE_AREA_TOOLBOX:_.DeleteArea.DELETE_AREA_NONE},t.prototype.set_gestures_enabled=function(t){this.gestures_enabled!==t&&(this.options.pinch&&(t?this.runtime_data.register_finger_events():this.runtime_data.unregister_finger_events()),this.gestures_enabled=t)},t.prototype.is_gestures_enabled=function(){return this.gestures_enabled},t.prototype.set_wheel_scroll_enabled=function(t){this.wheel_scroll_enabled!==t&&(this.wheel_scroll_enabled=t)},t.prototype.is_wheel_scroll_enabled=function(){return this.wheel_scroll_enabled},t.prototype.on_wheel_scroll=function(t){if(this.current_gesture_&&this.current_gesture_.cancel(),this.wheel_scroll_enabled&&this.gestures_enabled){var e=1===t.deltaMode?15:1;if(t.ctrlKey){var i=h.is.mac()?50:100,o=-t.deltaY/i*e,n=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm());this.zoom(n.x,n.y,o)}else{this.widget_div.hide(!0);var r=this.scroll_xy[0]-t.deltaX*e,s=this.scroll_xy[1]-t.deltaY*e;t.shiftKey&&0===t.deltaX&&(r=this.scroll_xy[0]-t.deltaY*e,s=this.scroll_xy[1]),this.start_drag_metrics=this.get_metrics(),this.scroll(r,s)}t.preventDefault()}},t.prototype.show_context_menu=function(t){var e=this;if(!this.options.readOnly&&!this.is_flyout){var i=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm()),o=this.get_origin_offset_in_pixels(),n=(0,l.get_translate)(this.get_parent_svg()),r={x:(i.x+n.x-o[0])/this.scale,y:(i.y+n.y-o[1])/this.scale},s=[];this.options.context_menu.workspace.forEach((function(t){if("number"===typeof t)switch(t){case _.WorkspaceOptionType.CLEAN_UP:return e.add_clean_up_option(s);case _.WorkspaceOptionType.PASTE:return e.add_paste_option(s,r);case _.WorkspaceOptionType.DELETE_ALL:return e.add_delete_all_blocks_option(s);case _.WorkspaceOptionType.COPY_ALL:return e.add_copy_all_blocks_option(s);case _.WorkspaceOptionType.GLOBAL_COMMENT:return e.add_global_comment_option(s,r);default:return console.warn("Undefined workspace menu option: ".concat(t))}var i=t(e);i&&s.push(i)}));var a={source:"workspace",options:s};this.context_menu.show(t,a,this.RTL)}},t.prototype.add_paste_option=function(t,e){var i=this,o=this.runtime_data.clipboard.get_content();t.push({text:this.Msg.PASTE,name:"paste",enabled:void 0!=o,callback:function(){o&&(Array.isArray(o)?i.paste_extend(o,e):i.paste(o,e))}})},t.prototype.add_clean_up_option=function(t){if(this._scrollbar){var e=this.get_top_elements(!0),i={text:this.Msg.CLEAN_UP,name:"clean_up",enabled:e.length>1,callback:this.clean_up.bind(this)};t.push(i)}},t.prototype.add_delete_all_blocks_option=function(t,e,i){var o=this;void 0===e&&(e=!0);var n=this.get_top_elements(!0,e),r=[];function s(t){if((0,u.is_block_svg)(t))if(t.is_deletable())r=r.concat(t.get_descendants());else for(var e=t.get_children(),i=0;i<e.length;i++)s(e[i]);else t.is_deletable()&&(r=r.concat([t]))}for(var _=0;_<n.length;_++)s(n[_]);var c=this.events.get_group(),l=function t(){""===c?(o.events.set_group(!0),c=o.events.get_group()):o.events.set_group(c);var e=r.shift();e&&(e.workspace?(e.dispose(!1,!0),window.setTimeout(t,10)):t()),o.events.set_group(!1)},d=(0,a.cal_num_blocks)(r),h={text:this.Msg.DELETE_X_BLOCKS.replace("%1",String(d)),name:"delete_all",enabled:d>0,callback:function(){o.current_gesture_&&o.current_gesture_.cancel(),!i||d<2?l():i(l)}};t.push(h)},t.prototype.add_copy_all_blocks_option=function(t,e){var i=this;void 0===e&&(e=!0);var o=this.get_top_elements(!0,e),n=0;o.forEach((function(t){(0,u.is_block_svg)(t)?n+=(0,a.cal_num_blocks)(t.get_descendants()):n++})),t.push({text:this.Msg.COPY_ALL.replace("%1",String(n)),name:"copy_all",enabled:n>0,callback:function(){i.runtime_data.clipboard.copy_all(o)}})},t.prototype.add_global_comment_option=function(t,e){var i=this;if("simplified"!==this.options.comment_type){var o={text:this.Msg.GLOBAL_COMMENT,name:"global_comment",enabled:!0,callback:function(){var t=i.events.get_group();i.events.set_group(t||!0);var o=i.new_workspace_comment(e);o.init_svg(),o.set_expanded(!0),o.focus(),i.events.set_group(t)}};t.push(o)}else console.warn("Trying to create global comment when using simplified comment. Ignoring this command. ")},t.prototype.new_workspace_comment=function(t,e){return this.workspace_comment_factory({workspace:this,type:this.options.comment_type,position:t,opt_id:e})},t.prototype.update_toolbox=function(t){var e="string"===typeof t?this.xml.text_to_dom(t):t;if(void 0!=e){if(!this.options.toolbox_config)throw new Error("Existing toolbox is undefined.  Can't create new toolbox.");if(e.getElementsByTagName("category").length){if(!this.toolbox_)throw new Error("Existing toolbox has no categories.  Can't change mode.");this.options.toolbox_config=e,this.toolbox_.populate(e)}else{if(!this.flyout_)throw new Error("Existing toolbox has categories.  Can't change mode.");this.options.toolbox_config=e,this.flyout_.show(e.childNodes)}}else if(this.options.toolbox_config)throw new Error("Can't nullify an existing toolbox.")},t.prototype.translate=function(t,e){if(this.use_workspace_drag_surface_&&this.is_drag_surface_active_&&this.workspace_drag_surface_)this.workspace_drag_surface_.translate_surface(t+this.offset[0],e+this.offset[1]);else{var i="translate(".concat(t,", ").concat(e,") scale(").concat(this.scale,")");void 0!=this.svg_block_canvas_&&this.svg_block_canvas_.setAttribute("transform",i),void 0!=this.svg_bubble_canvas_&&this.svg_bubble_canvas_.setAttribute("transform",i)}this.block_drag_surface_&&this.block_drag_surface_.translate_and_scale_group(t+this.offset[0],e+this.offset[1],this.scale)},t.prototype.new_block=function(t,e){return this.block_factory({workspace:this,id:e,prototype_name:t})},t.prototype.get_svg_xy=function(t){var e=r.vec2.create(),i=t,o=1,n=this.get_canvas(),s=this.get_bubble_canvas();(void 0!=n&&n.contains(i)||void 0!=s&&s.contains(i))&&(o=this.scale);do{var _=this.utils.get_relative_xy(i);i!=this.get_canvas()&&i!=this.get_bubble_canvas()||(o=1),r.vec2.scaleAndAdd(e,e,_,o),i=i.parentNode}while(i&&i!=this.get_parent_svg());return e},t.prototype.resize=function(){this.toolbox_&&this.toolbox_.position(),this.flyout_&&this.flyout_.position(),this._scrollbar?this._scrollbar.resize():this.translate(this.scroll_xy[0],this.scroll_xy[1]),this.update_screen_calculations()},t.prototype.update_screen_calculations=function(){this.inverse_screen_CTM_dirty_=!0,this.workspace_area_dirty_=!0,this.record_cached_areas()},t.prototype.record_cached_areas=function(){this.record_blocks_area_(),this.record_delete_areas()},t.prototype.record_blocks_area_=function(){var t=this.get_injection_div();this.blocks_area_=t?t.getBoundingClientRect():void 0},t.prototype.get_canvas=function(){return this.svg_block_canvas_},t.prototype.is_dragging=function(){return this.current_gesture_&&this.current_gesture_.is_dragging()},t.prototype.set_resizes_enabled=function(t){var e=!this.resizes_enabled_&&t;this.resizes_enabled_=t,e&&this.resize_contents()},t.prototype.cancel_current_gesture=function(){this.current_gesture_&&this.current_gesture_.cancel()},t.prototype.get_audio_manager=function(){return this.audio_manager_},t.prototype.get_gesture=function(t){var e="mousedown"==t.type||"touchstart"==t.type,i=this.current_gesture_;return i?e&&i.has_started()?void i.cancel():i:e?(this.current_gesture_=this.gesture_factory({event:t,workspace:this}),this.current_gesture_):void 0},t.prototype.get_grid=function(){return this.grid_},t.prototype.is_inside_workspace_area=function(t){var e=r.vec2.fromValues(t.clientX,t.clientY),i=this.get_workspace_area();return!!i&&(0,c.contains)(i,e)},t.prototype.is_inside_blocks_area=function(t){var e=r.vec2.fromValues(t.clientX,t.clientY);return!!(this.is_delete_area(t)||this.blocks_area_&&(0,c.contains)(this.blocks_area_,e))},t.prototype.setup_drag_surface=function(){if(this.use_workspace_drag_surface_&&this.workspace_drag_surface_&&!this.is_drag_surface_active_){if(void 0==this.svg_block_canvas_)throw new ReferenceError("Block Canvas not found when draging.");this.is_drag_surface_active_=!0;var t=this.svg_block_canvas_.previousSibling||void 0;if(void 0!=this.get_parent_svg()){var e=this.utils.get_relative_xy(this.svg_block_canvas_);this.workspace_drag_surface_&&(this.workspace_drag_surface_.set_contents_and_show(this.svg_block_canvas_,this.svg_bubble_canvas_,t,this.scale),this.workspace_drag_surface_.translate_surface(e[0]+this.offset[0],e[1]+this.offset[1]))}}},t.prototype.reset_drag_surface=function(){if(this.use_workspace_drag_surface_&&this.workspace_drag_surface_){this.is_drag_surface_active_=!1;var t=this.workspace_drag_surface_.get_surface_translation();this.workspace_drag_surface_.clear_and_hide(this.svg_group);var e="translate(".concat(t[0]-this.offset[0],", ").concat(t[1]-this.offset[1],") scale(").concat(this.scale,")");void 0!=this.svg_block_canvas_&&this.svg_block_canvas_.setAttribute("transform",e),void 0!=this.svg_bubble_canvas_&&this.svg_bubble_canvas_.setAttribute("transform",e)}},t.prototype.refresh_toolbox_selection=function(){if(this.toolbox_){this.toolbox_.flyout&&!this.current_gesture_&&this.toolbox_refresh_enabled_&&this.toolbox_.refresh_selection()}else{var t=this.target_workspace,e=null===t||void 0===t?void 0:t.get_toolbox();t&&e&&e.flyout&&!t.current_gesture_&&t.get_toolbox_refresh_enabled&&e.refresh_selection()}},t.prototype.register_toolbox_category_callback=function(t,e){this.toolbox_category_callbacks_&&(this.toolbox_category_callbacks_[t]=e)},t.prototype.get_parent_svg=function(){if(this.cached_parent_svg_)return this.cached_parent_svg_;for(var t=this.svg_group;t;){if("svg"==t.tagName)return this.cached_parent_svg_=t,t;t=t.parentNode}throw new Error("Workspace may not been init.")},t.prototype.get_blocks_bounding_box=function(){var t=this.get_top_blocks(!1);if(this.workspace_comment_db.forEach((function(e){t.push(e)})),!t.length)return{x:0,y:0,width:0,height:0};for(var e=t[0].get_bounding_rectangle(),i=1;i<t.length;i++){var o=t[i].get_bounding_rectangle();o.topLeft[0]<e.topLeft[0]&&(e.topLeft[0]=o.topLeft[0]),o.bottomRight[0]>e.bottomRight[0]&&(e.bottomRight[0]=o.bottomRight[0]),o.topLeft[1]<e.topLeft[1]&&(e.topLeft[1]=o.topLeft[1]),o.bottomRight[1]>e.bottomRight[1]&&(e.bottomRight[1]=o.bottomRight[1])}return{x:e.topLeft[0],y:e.topLeft[1],width:e.bottomRight[0]-e.topLeft[0],height:e.bottomRight[1]-e.topLeft[1]}},t.prototype.set_resize_handler_wrapper=function(t){this.resize_handler_wrapper_=t},t.prototype.resize_contents=function(){this.resizes_enabled_&&this.rendered&&(this._scrollbar&&this._scrollbar.resize(),this.inverse_screen_CTM_dirty_=!0)},t.prototype.get_bubble_canvas=function(){return this.svg_bubble_canvas_},t.prototype.add_flyout=function(t){var e=Object.assign({},this.options,{parentWorkspace:this});return this.flyout_=this.flyout_factory(e),this.flyout_.create_dom(t)},t.prototype.get_toolbox_category_callback=function(t){return this.toolbox_category_callbacks_?this.toolbox_category_callbacks_[t]:void 0},t.prototype.update_screen_calculations_if_scrolled=function(){var t=(0,l.get_document_scroll)();void 0!=this.last_recorded_page_scroll_&&r.vec2.equals(this.last_recorded_page_scroll_,t)||(this.last_recorded_page_scroll_=t,this.update_screen_calculations())},t.prototype.mark_focused=function(){this.options.parentWorkspace instanceof e?this.options.parentWorkspace.mark_focused():(this.Blink.mainWorkspace=this,this.set_browser_focus())},t.prototype.set_browser_focus=function(){document.activeElement&&document.activeElement.blur();try{this.get_parent_svg().focus()}catch(e){try{(t=this.get_parent_svg())&&t.setActive()}catch(e){var t;(t=this.get_parent_svg())&&t.focus()}}},t.prototype.get_inverse_screen_ctm=function(){var t=this.get_parent_svg();if(this.inverse_screen_CTM_dirty_&&void 0!=t){var e=t.getScreenCTM();e&&(this.inverse_screen_CTM_=e.inverse(),this.inverse_screen_CTM_dirty_=!1)}return this.inverse_screen_CTM_},t.prototype.get_origin_offset_in_pixels=function(){if(void 0==this.svg_block_canvas_)throw new ReferenceError("Block Canvas not found when get origin offset.");return this.utils.get_injection_div_xy(this.svg_block_canvas_)},t.prototype.get_injection_div=function(){return this.injection_div_},t.prototype.dispose=function(){var t;if(this.rendered=!1,this.current_gesture_&&this.current_gesture_.cancel(),this.listeners_.length=0,this.clear(),this.workspace_db.remove(this),this.svg_group&&((0,l.remove_node)(this.svg_group),this.svg_group=void 0),this.svg_block_canvas_=void 0,this.svg_bubble_canvas_=void 0,this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=void 0),this.flyout_&&(this.flyout_.dispose(),this.flyout_=void 0),this._scrollbar&&(this._scrollbar.dispose(),delete this._scrollbar),null===(t=this.grid_)||void 0===t||t.dispose(),this.grid_=void 0,this.toolbox_category_callbacks_={},this.flyout_button_callbacks_={},this.custom_flyout_buttons.clear(),!this.options.parentWorkspace){var e=this.get_parent_svg();if(void 0==e)throw new ReferenceError;var i=e.parentNode;void 0!=i&&(0,l.remove_node)(i)}this.resize_handler_wrapper_&&(this.events.unbind_event(this.resize_handler_wrapper_),this.resize_handler_wrapper_=void 0)},t.prototype.set_visible=function(t){this._scrollbar&&this._scrollbar.set_container_visible(t);var e=this.get_flyout();void 0!=e&&e.set_container_visible(t);var i=this.get_parent_svg();if(void 0==i)throw new ReferenceError("Workspace may not been init.");if(i.style.display=t?"block":"none",this.toolbox_&&(this.toolbox_.html_div.style.display=t?"block":"none"),t){for(var o=this.get_all_blocks(),n=o.length-1;n>=0;n--)o[n].render(!1);this.resize()}else this.utils.hide_chaff(!0)},t.prototype.glow_stack=function(t,e){var i=this.get_block_by_id(t);if(!i)throw new Error("Tried to glow stack on block that does not exist.");i.set_glow_stack(e)},t.prototype.on_mouse_down=function(t){var e=this.get_gesture(t);e&&e.handle_ws_start(t,this)},t.prototype.start_drag=function(t,e){var i=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm());i.x/=this.scale,i.y/=this.scale;var o=r.vec2.fromValues(i.x,i.y);this.drag_delta_xy_=r.vec2.sub(e,e,o)},t.prototype.move_drag=function(t){var e=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm());e.x/=this.scale,e.y/=this.scale;var i=r.vec2.fromValues(e.x,e.y);return r.vec2.fromValues(this.drag_delta_xy_[0]+i[0],this.drag_delta_xy_[1]+i[1])},t.prototype.is_draggable=function(){return!!this._scrollbar&&this._draggable},t.prototype.set_draggable=function(t){this._draggable=t},t.prototype.is_disabled_field_click=function(){return this._disabled_field_click},t.prototype.set_disabled_field_click=function(t){this._disabled_field_click=t},t.prototype.clean_up=function(t){this.set_resizes_enabled(!1);var e=this.events.get_group();this.events.set_group(e||!0);for(var i=this.get_top_elements(!0),o=r.vec2.fromValues(0,0),n=0;n<i.length;n++){i[n].sort(o)}if(t&&this._scrollbar){var s=this.get_metrics(),_=-s.contentLeft-t[0],a=-s.contentTop-t[1];this._scrollbar.set(_,a)}this.events.set_group(e),this.set_resizes_enabled(!0)},t.prototype.zoom=function(t,e,i){var o=this.options.zoomOptions.scaleSpeed,n=Math.pow(o,i),s=Math.max(this.options.zoomOptions.minScale,Math.min(this.scale*n,this.options.zoomOptions.maxScale));if(n=s/this.scale,this.scale!=s&&this.is_wheel_scroll_enabled()){if(this._scrollbar&&this.svg_block_canvas_){var _=this.svg_block_canvas_.getCTM();if(!_)return void console.error("Get Canvas CTM failed.");var a=this.get_parent_svg().createSVGPoint();a.x=t,a.y=e,t=(a=a.matrixTransform(_.inverse())).x,e=a.y;var c=_.translate(t*(1-n),e*(1-n)).scale(n);r.vec2.set(this.scroll_xy,c.e,c.f)}this.set_scale(s)}},t.prototype.zoom_center=function(t){var e=this.get_metrics(),i=e.viewWidth/2,o=e.viewHeight/2;this.zoom(i,o,t)},t.prototype.zoom_to_fit=function(){var t=this.get_metrics(),e=this.get_blocks_bounding_box(),i=e.width,o=e.height;if(i){var n=t.viewWidth,r=t.viewHeight;this.flyout_&&(n-=this.flyout_.get_width()),this._scrollbar||(i+=t.contentLeft,o+=t.contentTop);var s=n/i,_=r/o;this.set_scale(Math.min(s,_)),this.scroll_center()}},t.prototype.scroll_center=function(){if(this._scrollbar){this.widget_div.hide(!0),this.utils.hide_chaff(!1);var t=this.get_metrics(),e=(t.contentWidth-t.viewWidth)/2;this.flyout_&&(e-=this.flyout_.get_width()/2);var i=(t.contentHeight-t.viewHeight)/2;this._scrollbar.set(e,i)}},t.prototype.center_on_block=function(t){if(this._scrollbar){var e=this.get_block_by_id(t);if(e){var i=e.get_relative_to_surface_xy(),o=e.get_height_width(),n=i[1]+o.height/2,r=this.RTL?-1:1,s=i[0]+r*o.width/2,_=this.scale,a=s*_,c=n*_,l=this.get_metrics(),d=a-l.contentLeft,u=c-l.contentTop,h=d-l.viewWidth/2,p=u-l.viewHeight/2;this.utils.hide_chaff(),this._scrollbar.set(h,p)}}},t.prototype.set_scale=function(t){var e,i;t=Math.max(this.options.zoomOptions.minScale,Math.min(t,this.options.zoomOptions.maxScale)),this.rendered||(this.scale=t),this.events.is_enabled()&&(i=this.ui_event_factory({type:_.UIEventType.SCALE,workspace_id:this.id,old_value:this.scale,new_value:t})),this.scale=t,this.events.fire(i),null===(e=this.grid_)||void 0===e||e.set_scale(this.scale),this._scrollbar?this._scrollbar.resize():this.translate(this.scroll_xy[0],this.scroll_xy[1]),this.utils.hide_chaff(!1,!0);var o=function(e){var i=e.getAttribute("transform"),o="scale(".concat(t,")");e.setAttribute("transform",i?i.replace(/scale\([0-9\.]+\)/,o):o)};this.svg_block_canvas_&&o(this.svg_block_canvas_),this.svg_bubble_canvas_&&o(this.svg_bubble_canvas_),this.block_drag_surface_&&this.block_drag_surface_.set_scale(t),this.flyout_&&this.flyout_.reflow()},t.prototype.scroll=function(t,e){if(this._scrollbar&&this.start_drag_metrics){var i=this.start_drag_metrics;t=Math.min(t,-i.contentLeft),e=Math.min(e,-i.contentTop),t=Math.max(t,i.viewWidth-i.contentLeft-i.contentWidth),e=Math.max(e,i.viewHeight-i.contentTop-i.contentHeight),this.widget_div.hide(!0),this._scrollbar.set(-t-i.contentLeft,-e-i.contentTop)}},t.getDimensionsPx_=function(t){var e=0,i=0;return t&&(e=t.get_width(),i=t.get_height()),{width:e,height:i}},t.getContentDimensions_=function(t,e){return t._scrollbar?this.getContentDimensionsBounded_(t,e):this.getContentDimensionsExact_(t)},t.getContentDimensionsExact_=function(t){var e=t.get_blocks_bounding_box(),i=t.get_scale(),o=e.width*i,n=e.height*i,r=e.x*i,s=e.y*i;return{left:r,top:s,right:r+o,bottom:s+n,width:o,height:n}},t.getContentDimensionsBounded_=function(t,e){var i=this.getContentDimensionsExact_(t),o=e.width||0,n=e.height||0,r=o,s=n,_=t.options.workspace.content_margin;if("number"===typeof _)r=_,s=_;else{var a=_.match(/[0-9]+%/),c=a&&a[0]&&parseFloat(a[0])/100;("number"!==typeof c||isNaN(c))&&(console.error("option workspace.content_margin is not a valid percentage. Using default value (50%)."),c=.5),r=o*c,s=n*c}var l=Math.min(i.left-r,i.right-o),d=Math.max(i.right+r,i.left+o),u=Math.min(i.top-s,i.bottom-n);return{left:l,top:u,height:Math.max(i.bottom+s,i.top+n)-u,width:d-l}},t.prototype.get_metrics=function(){var t=e.getDimensionsPx_(this.toolbox_),i=this.flyout_||this.toolbox_&&this.toolbox_.flyout,o=i&&!i.is_auto_close()&&i.is_visible()?e.getDimensionsPx_(i):{width:0,height:0},n=this.utils.get_svg_size(this.get_parent_svg()),r=e.getContentDimensions_(this,n),s=0;this.toolbox_&&this.toolbox_position==_.TOOLBOX_POSITION.LEFT&&(s+=t.width,s+=o.width);var a=0;return this.toolbox_&&this.toolbox_position==_.TOOLBOX_POSITION.TOP&&(a=t.height,a+=o.height),{absoluteTop:a,absoluteLeft:s,contentHeight:r.height,contentWidth:r.width,contentTop:r.top,contentLeft:r.left,viewHeight:n.height||0,viewWidth:n.width||0,viewTop:-this.scroll_xy[1],viewLeft:-this.scroll_xy[0],flyoutWidth:o.width,flyoutHeight:o.height,toolboxWidth:t.width,toolboxHeight:t.height,toolboxPosition:this.toolbox_position}},t.prototype.set_metrics=function(t,e){var i,o=this;if(!this.get_scrollbar())throw new Error("Attempt to set top level workspace scroll without scrollbars.");var n=this.get_metrics();(0,u.is_number)(t.x)&&(this.content_offset_by_view[0]=t.x,this.scroll_xy[0]=-n.contentLeft-t.x),(0,u.is_number)(t.y)&&(this.content_offset_by_view[1]=t.y,this.scroll_xy[1]=-n.contentTop-t.y);var r=this.scroll_xy[0],s=this.scroll_xy[1];if(e){var _,a=-n.viewLeft,c=-n.viewTop,l=r,d=s,h=e.duration||500;window.requestAnimationFrame((function t(e){var i;_||(_=e);var n=e-_,r=n/h<.5?2*Math.pow(n/h,2):n/h*(4-n/h*2)-1,s=a+r*(l-a),u=c+r*(d-c);o.translate(s,u),null===(i=o.grid_)||void 0===i||i.move_to(s,u),n<h&&window.requestAnimationFrame(t)}))}else this.translate(r,s),null===(i=this.grid_)||void 0===i||i.move_to(r,s)},t.prototype.set_toolbox_refresh_enabled=function(t){var e=!this.toolbox_refresh_enabled_&&t;this.toolbox_refresh_enabled_=t,e&&this.refresh_toolbox_selection()},t.prototype.get_toolbox_refresh_enabled=function(){return this.toolbox_refresh_enabled_},t.prototype.clear=function(t){void 0===t&&(t=!0),this.set_resizes_enabled(!1),this.is_clearing=!0;var e=this.events.get_group();for(e||this.events.set_group(!0),t&&this.widget_div&&this.widget_div.hide(!0),t&&this.Blink.tooltip&&this.Blink.tooltip.hide();this.top_blocks_.length;)this.top_blocks_[0].dispose();for(;this.top_comments.length;)this.top_comments[0].dispose();e||this.events.set_group(!1),this.is_clearing=!1,this.set_resizes_enabled(!0)},t.prototype.register_button_callback=function(t,e){(0,u.is_func)(e)||console.error("Button callbacks must be functions."),this.flyout_button_callbacks_&&(this.flyout_button_callbacks_[t]=e)},t.prototype.get_button_callback=function(t){return this.flyout_button_callbacks_?this.flyout_button_callbacks_[t]:void 0},t.prototype.remove_button_callback=function(t){this.flyout_button_callbacks_&&(this.flyout_button_callbacks_[t]=void 0)},t.prototype.remove_toolbox_category_callback=function(t){this.toolbox_category_callbacks_&&(this.toolbox_category_callbacks_[t]=void 0)},t.prototype.clear_gesture=function(){this.current_gesture_=void 0},t.prototype.register_flyout_button=function(t,e){this.custom_flyout_buttons.set(t,e)},t.prototype.get_custom_flyout_button=function(t){return this.custom_flyout_buttons.get(t)},t.prototype.set_read_only=function(t){this.options.readOnly=t},t.prototype.set_hotkey_enable=function(t){this.is_hotkey_enable=t},t.prototype.get_hotkey_enable=function(){return this.is_hotkey_enable},t.prototype.show_external_comment_editor=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){return[2,window.prompt("Enter comment text",t)||""]}))}))},t.prototype.register_comment_editor=function(t){this.show_external_comment_editor=t},t.prototype.for_each_element_in_stack=function(t,e,i){var o;void 0===i&&(i=!1);var n=this.Blink.mainWorkspace.get_element_from_db(t);null===(o=null===n||void 0===n?void 0:n.get_top_parent())||void 0===o||o.for_each_descendant_element(e,i)},o.__decorate([(0,s.lazy_inject)(s.BINDING.Blink)],t.prototype,"Blink",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.Msg)],t.prototype,"Msg",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.context_menu)],t.prototype,"context_menu",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.xml)],t.prototype,"xml",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.widget_div)],t.prototype,"widget_div",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.ChangeEvent)],t.prototype,"change_event_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.WorkspaceComment)],t.prototype,"workspace_comment_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.BlockSvg)],t.prototype,"block_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.Toolbox)],t.prototype,"toolbox_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.VerticalFlyout)],t.prototype,"flyout_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.Gesture)],t.prototype,"gesture_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.ConnectionDB)],t.prototype,"connection_db_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.WorkspaceAudio)],t.prototype,"workspace_audio_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.Grid)],t.prototype,"grid_factory",void 0),t=e=o.__decorate([(0,n.injectable)()],t)}();e.WorkspaceSvg=p},12963:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockGroup=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(75102),_=i(56905),a=i(61972),c=i(81558),l=function(t){function e(e){var i=t.call(this,{workspace:e.workspace,id:e.id})||this;return i.element_type="block_group",i.group_type=0,i.nested_blocks_with_comment=[],i.decoration_block_paths=[],i.show_name_editor=function(t,e){return o.__awaiter(i,void 0,void 0,(function(){var i,n,r;return o.__generator(this,(function(o){switch(o.label){case 0:return(i=null===(r=this.workspace.options.block_group)||void 0===r?void 0:r.show_name_editor)?[4,i(t.get_text())]:(e.call(t),[2]);case 1:return void 0==(n=o.sent())||t.set_value(n),[2]}}))}))},i.init=function(){var t,e,o,n;i.events.disable();var r=i.origin_xy||i.origin_block.get_relative_to_surface_xy();i.move_by(r),i.set_chunk_visibility(i.origin_block.get_visibility());try{if(i.origin_block.is_starting_block())return i.group_type=s.BlockGroupType.START,void i.init_start_group();if(i.origin_block.output_connection)return i.group_type=s.BlockGroupType.OUTPUT,void i.init_output_group();i.group_type=s.BlockGroupType.EXECUTION,i.init_execution_group()}finally{if(i.origin_block.get_svg_root().style.display="none",i.origin_block.get_descendants(!1,!0).forEach((function(t){return t.set_comment_visible(!1)})),"simplified"===i.workspace.get_options().comment_type){if((0,c.get_nested_blocks_with_comment)(i.origin_block).forEach((function(t){var e;(0,a.is_block_group)(t)?(e=i.nested_blocks_with_comment).push.apply(e,t.nested_blocks_with_comment):i.nested_blocks_with_comment.push(t)})),i.nested_blocks_with_comment.length){var _=null===(t=i.nested_blocks_with_comment[0].comment)||void 0===t?void 0:t.get_text();i.set_comment_text(_),null===(e=i.comment)||void 0===e||e.init_svg(!0)}}else i.set_comment_text(null===(o=i.origin_block.comment)||void 0===o?void 0:o.get_text()),null===(n=i.comment)||void 0===n||n.init_svg(!0);i.origin_block.set_connectable(!1),i.events.enable()}},i.origin_block=e.origin_block,i.group_name=e.group_name,i.on_release=e.on_release,i.origin_block_display=i.origin_block.get_svg_root().style.display,i.origin_xy=e.origin_xy,i.group_stop_at=e.group_stop_at,i.init(),i}return o.__extends(e,t),e.prototype.init_start_group=function(){this.set_colour(this.theme.block_group_color.START_GROUP_FILL_COLOUR||this.origin_block.get_original_colour(),this.theme.block_group_color.START_GROUP_STROKE_COLOUR||this.origin_block.get_border_colour());var t=this.origin_block.inputList[0].fieldRow[0],e=this.field_icon_factory({src:t.src_||"",opt_is_head:!0}),i=this.field_text_input_factory({text:this.group_name});i.show_editor=this.show_name_editor.bind(this,i,i.show_editor),this.append_dummy_input("START_GROUP").append_field(e).append_field(this.Msg.START_GROUP_TAG,s.BLOCK_GROUP_TAG_FIELD_NAME).append_field(i,s.BLOCK_GROUP_NAME_FIELD_NAME),this.set_previous_statement(!1),this.set_next_statement(!1)},e.prototype.init_output_group=function(){var t;this.set_colour(this.theme.block_group_color.OUTPUT_GROUP_FILL_COLOUR||this.origin_block.get_original_colour(),this.theme.block_group_color.OUTPUT_GROUP_STROKE_COLOUR||this.origin_block.get_border_colour());var e=this.field_text_input_factory({text:this.group_name});e.margin_left=this.theme.renderer.SEP_SPACE_X+this.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT,e.show_editor=this.show_name_editor.bind(this,e,e.show_editor),this.append_dummy_input("OUTPUT_GROUP").append_field(this.Msg.OUTPUT_GROUP_TAG,s.BLOCK_GROUP_TAG_FIELD_NAME).append_field(e,s.BLOCK_GROUP_NAME_FIELD_NAME),(0,_.assert)(this.origin_block.output_connection),this.set_output(!0,null===(t=this.origin_block.output_connection)||void 0===t?void 0:t.check_),(0,_.assert)(this.output_connection);var i=this.origin_block.output_connection.target_connection;null===i||void 0===i||i.connect(this.output_connection)},e.prototype.init_execution_group=function(){this.set_colour(this.theme.block_group_color.EXECUTION_GROUP_FILL_COLOUR||this.origin_block.get_original_colour(),this.theme.block_group_color.EXECUTION_GROUP_STROKE_COLOUR||this.origin_block.get_border_colour());var t=this.field_text_input_factory({text:this.group_name});t.show_editor=this.show_name_editor.bind(this,t,t.show_editor),this.append_dummy_input("EXECUTION_GROUP").append_field(this.Msg.EXECUTION_GROUP_TAG,s.BLOCK_GROUP_TAG_FIELD_NAME).append_field(t,s.BLOCK_GROUP_NAME_FIELD_NAME),(0,_.assert)(this.origin_block.previous_connection),this.set_previous_statement(!0),(0,_.assert)(this.previous_connection);var e=this.origin_block.previous_connection.target_connection,i=void 0;if(this.group_stop_at){this.set_next_statement(!0);var o=this.workspace.get_block_by_id(this.group_stop_at);i=o&&o.previous_connection,(0,_.assert)(i),i.disconnect(),this.next_connection.connect(i)}else this.origin_block.last_connection_in_stack()&&this.set_next_statement(!0);null===e||void 0===e||e.disconnect(),null===e||void 0===e||e.connect(this.previous_connection)},e.prototype.options_add_set_blocks_group=function(t){var e=this;t.push({text:this.utils.replace_message_references("%{BKY_RELEASE_GROUP}"),name:"release_group",area:"block",enabled:!0,callback:function(){e.release()}})},e.prototype.dispose=function(t,e){var i;if(this.workspace){var o=this.events.get_group();if(this.events.set_group(o||!0),e&&this.rendered&&this.block_animations.dispose_ui_effect(this),this.release(),null===(i=this.origin_block)||void 0===i?void 0:i.workspace){var n=this.origin_block.get_descendants(!0,!0);if(n)for(var r=0;r<n.length;r++){var s=n[r];(0,a.is_block_group)(s)&&s.release()}this.origin_block.dispose(t,!1)}this.events.set_group(o)}},e.prototype.release=function(){var e,i,o,n,a,c,l,d;switch(this.events.disable(),this.group_name=this.get_field_value(s.BLOCK_GROUP_NAME_FIELD_NAME),this.origin_block.move_by(r.vec2.sub(r.vec2.create(),this.get_relative_to_surface_xy(),this.origin_block.get_relative_to_surface_xy())),this.origin_block.get_svg_root().style.display=this.origin_block_display,this.origin_block.set_connectable(!0),this.origin_block.set_chunk_visibility(this.get_visibility()),this.origin_block.update_chunk_visibility(),this.group_type){case s.BlockGroupType.EXECUTION:(0,_.assert)(this.origin_block.previous_connection,"Statement block must have prev conn. ");var u=null===(e=this.previous_connection)||void 0===e?void 0:e.target_connection;null===(i=this.previous_connection)||void 0===i||i.disconnect();var h=null===(o=this.next_connection)||void 0===o?void 0:o.target_connection;if(this.group_stop_at=null===h||void 0===h?void 0:h.source_block.id,null===(n=this.next_connection)||void 0===n||n.disconnect(),h){var p=this.origin_block.last_connection_in_stack();(0,_.assert)(p),p.connect(h)}(null===u||void 0===u?void 0:u.source_block.workspace)===this.origin_block.workspace&&(null===u||void 0===u||u.connect(this.origin_block.previous_connection));break;case s.BlockGroupType.OUTPUT:(0,_.assert)(this.origin_block.output_connection,"Output block must have output conn. ");var g=null===(a=this.output_connection)||void 0===a?void 0:a.target_connection;null===(c=this.output_connection)||void 0===c||c.disconnect(),null===g||void 0===g||g.connect(this.origin_block.output_connection)}this.origin_block.get_descendants(!1,!0).forEach((function(t){return t.set_comment_visible(!0)})),null===(l=this.origin_block.comment)||void 0===l||l.init_svg(!0),t.prototype.dispose.call(this,!1,!1),this.events.enable(),null===(d=this.on_release)||void 0===d||d.call(this)},e=o.__decorate([(0,n.injectable)()],e)}(i(91758).BlockSvg);e.BlockGroup=l},91758:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockSvg=void 0;var o=i(98734),n=i(1530),r=i(98030),s=i(75102),_=i(37767),a=i(56905),c=i(11214),l=i(25461),d=i(61972),u=i(42798),h=i(57754),p=i(48462),g=i(53494),f=i(3909),v=function(t){function e(e){var i,o=this;(o=t.call(this,e.workspace)||this).element_type="block",o.type="",o.tooltip="",o.inputList=[],o.width=0,o.svg_path_width=0,o.first_row_width=0,o.first_row_height=0,o.event_initialized=!1,o.warning=void 0,o.output_connection=void 0,o.previous_connection=void 0,o.next_connection=void 0,o.is_shadow_=!1,o.child_blocks=[],o.collapsed_=!1,o.collapsed_dirty=!1,o._is_insertion_marker=!1,o.getInput=o.get_input,o.get_inherited_disabled=function(){for(var t=o.get_surround_parent();t;){if(t.disabled)return!0;t=t.get_surround_parent()}return!1},o.get_root_block=o.get_top_parent,o.getFieldValue=o.get_field_value,o.jsonInit=function(t){var e=(0,d.clone_deep)(t),i=e.type?'Block "'.concat(e.type,'": '):"";(0,a.assert)(void 0==e.output||void 0==e.previousStatement,"".concat(i,"Must not have both an output and a previousStatement.")),void 0!=e.colour&&o.set_colour_from_json(e);for(var n=0,r=e["message".concat(n)];void 0!=r;){var s=e["args".concat(n)],_=e["lastDummyAlign".concat(n)];o.interpolate_(r,s||[],_),n++,r=e["message".concat(n)]}if(void 0!=e.inputsInline&&(o.inputs_inline=e.inputsInline),void 0!==e.output){var c=!0===e.output?void 0:e.output;o.set_output(!0,c,e.required_context)}if(void 0!==e.previousStatement&&o.set_previous_statement(!0),void 0!==e.nextStatement&&o.set_next_statement(!0),void 0!=e.enableContextMenu){var l=e.enableContextMenu;o.enable_context_menu=!!l}if(void 0!=e.helpUrl){l=e.helpUrl;var u=o.utils.replace_message_references(l);o.set_help_url(u)}if((0,d.is_string)(e.extensions)&&console.error('\n        JSON attribute "extensions" should be an array of strings.\n        Found raw string in JSON for "'.concat(e.type,'" block.\n      ')),void 0!=e.tooltip){l=e.tooltip,u=o.utils.replace_message_references(l);o.set_tooltip(u)}if(void 0!=e.mutator&&o.extensions.apply_mutator(e.mutator,o),Array.isArray(e.extensions))for(var h=e.extensions,p=0;p<h.length;++p)o.extensions.apply(h[p],o);void 0!=e.outputShape&&o.set_output_shape(e.outputShape),void 0!=e.category&&o.set_category(e.category),e.context_menu&&(o.context_menu_options_setting=e.context_menu)},o.appendDummyInput=o.append_dummy_input,o.context_menu_options_setting=o.workspace.options.context_menu.block,o.prevent_disable_style_change=!1,o.is_glowing_stack=!1,o.is_flashing=!1,o.removeInput=o.remove_input,o.visibility_=s.BlockVisibility.VISIBLE,o.visibility_for_undo=void 0,o.connectable_=!0,o.opacity=1,o.category_=void 0,o.output_shape=void 0,o.help_url="",o.colour_=o.theme.block_color.DEFAULT.fill,o.border_colour=o.theme.block_color.DEFAULT.border;var n=e.workspace,r=e.prototype_name;if(r&&(null===(i=o.svg_group)||void 0===i||i.classList.add(r)),o.id=e.id&&!n.get_block_by_id(e.id)?e.id:(0,c.gen_uid)(),o._is_insertion_marker=!!e.is_insertion_marker,o.enable_context_menu=!0,r){o.type=r;var _=o.Blink.Blocks[r];if(void 0==_)throw new Error("Error: Unknown block type ".concat(r,"."));Object.assign(o,_)}o.inputs_inline_default=o.inputs_inline,n.blockDB_.set(o.id,o),n.add_top_block(o);var u=void 0;return o.events.is_enabled()&&(u=o.create_event_factory({block:o})),o.svg_path=(0,l.create_svg_element)("path",{class:"blocklyPath"},o.svg_group),o.rendered=!1,o.Blink.mainWorkspace.options.tooltip&&(o.svg_path.tooltip=function(){return(0,d.is_func)(o.tooltip)?o.tooltip():o.tooltip},o.Blink.tooltip.bind_mouse_event(o.svg_path)),(0,d.is_func)(o.init)&&o.init(),(0,d.is_func)(o.onchange)&&o.set_on_change(o.onchange),u&&o.events.fire(u),o}return o.__extends(e,t),Object.defineProperty(e.prototype,"onchange",{get:function(){return this._onchange},set:function(t){this._onchange=null===t||void 0===t?void 0:t.bind(this)},enumerable:!1,configurable:!0}),e.prototype.render=function(t){console.warn("\n      why: opt_bubble ".concat(t,"\n    "))},e.prototype.set_warning_text=function(t,e){console.error("Warning is deprecated ".concat(t," ").concat(e))},e.prototype.get_previous_block=function(){return this.previous_connection&&this.previous_connection.targetBlock()},e.prototype.is_starting_block=function(){return void 0==this.output_connection&&void 0==this.previous_connection&&"factory_base"!==this.type},e.prototype.is_ending_block=function(){return void 0==this.next_connection&&void 0==this.output_connection&&void 0!=this.previous_connection},e.prototype.is_output_block=function(){return!this.previous_connection&&!this.next_connection&&!this.is_shadow()&&!!this.output_connection},e.prototype.is_include_special_input=function(){var t=this;return _.SPECIAL_CONNECTION_INPUT_NAME.some((function(e){return!!t.get_input(e)}))},e.prototype.is_wrap_shape=function(){return!this.is_starting_block()&&this.inputList.some((function(t){return t.type===s.InputType.STATEMENT}))},e.prototype.set_shadow=function(t){this.is_shadow_=t},e.prototype.is_shadow=function(){return this.is_shadow_},e.prototype.is_deletable=function(){return this.deletable_&&!this.is_shadow_&&!(this.workspace&&this.workspace.get_options().readOnly)},e.prototype.is_movable=function(){return this.movable_&&!this.is_shadow_},e.prototype.get_children=function(t){if(!t)return this.child_blocks;for(var e=[],i=0;i<this.inputList.length;i++){var o=this.inputList[i];if(o.connection){var n=o.connection.targetBlock();n&&e.push(n)}}var r=this.get_next_block();return r&&e.push(r),e},e.prototype.is_collapsed=function(){return this.collapsed_},e.prototype.set_collapsed=function(t,e){void 0===e&&(e=!1);var i=this.is_collapsed();if(i!=t||e)if(this.collapsed_dirty=!0,this.collapsed_=t,this.events.is_enabled()&&i!==t&&this.events.fire(this.change_event_factory("collapsed",{block:this,old_value:i,new_value:t})),e)for(var o=this.get_top_parent().get_descendants(!0,!0),n=o.length-1;n>=0;n--)o[n].update_collapsed(e);else this.rendered&&this.update_collapsed()},e.prototype.hide_into_group=function(t,e){var i,o,n=this;void 0===e&&(e={}),this.events.disable();var r=(null===(o=null===(i=this.workspace.options.block_group)||void 0===i?void 0:i.get_default_name)||void 0===o?void 0:o.bind(this,this))||this.to_string.bind(this),s=this.block_group_factory({workspace:this.workspace,origin_block:this,group_name:t||r(),id:e.id,on_release:function(){(0,a.assert)(n.parent_group),n.events.fire(n.change_event_factory("group_block",{block:n,old_value:[n.parent_group.id,n.parent_group.group_name,n.parent_group.group_stop_at||""],new_value:void 0})),n.parent_group=void 0},origin_xy:e.origin_xy,group_stop_at:e.group_stop_at});s.init_svg(),s.render(),this.parent_group=s,this.events.enable(),this.events.is_enabled()&&this.events.fire(this.change_event_factory("group_block",{block:this,old_value:void 0,new_value:[this.parent_group.id,this.parent_group.group_name,this.parent_group.group_stop_at||""]}))},e.prototype.update_collapsed=function(t){if(void 0===t&&(t=!1),this.collapsed_dirty||t){var e=this.rendered;this.rendered=!1;for(var i=0;i<this.inputList.length;i++){this.inputList[i].set_visible(!this.collapsed_)}if(_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)&&this.next_connection){this.collapsed_?this.next_connection.hide_all():this.next_connection.unhide_all();var o=this.next_connection.targetBlock();o&&o.set_visible_as_child(!this.collapsed_)}if(this.comment&&this.set_comment_visible(!this.collapsed_),this.collapsed_){this.warning&&this.warning.set_expanded(!1),t&&this.remove_input(_.COLLAPSED_INPUT_NAME,!0);var n=this.to_string(this.theme.blink_params.COLLAPSE_CHARS);this.append_dummy_input(_.COLLAPSED_INPUT_NAME).append_field(n).init()}else this.remove_input(_.COLLAPSED_INPUT_NAME,!0);this.rendered=e,(e||t)&&this.render(),this.collapsed_dirty=!1}},e.prototype.set_comment_visible=function(t){this.comment&&(t&&!this.is_collapsed()?(this.comment.get_svg_root().style.display="block",this.comment.reposition(),this.comment.bring_to_front()):this.comment.get_svg_root().style.display="none")},e.prototype.set_visible_as_child=function(t){this.rendered=t,this.get_svg_root().style.display=t?"block":"none",this.get_descendants(!1,!0).forEach((function(e){var i=t&&!e.is_collapsed()&&!e.get_collapsed_surround_parent();e.set_comment_visible(i)}))},e.prototype.get_collapsed_surround_parent=function(){var t=this.get_surround_parent();if(t)return t.is_collapsed()?t:t.get_collapsed_surround_parent();for(var e=this.get_parent();e&&(!_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(e.type)||!e.is_collapsed());)e=e.get_parent();return e},e.prototype.is_insertion_marker=function(){return this._is_insertion_marker},e.prototype.set_on_change=function(t){this.onchange&&this.workspace&&this.workspace.remove_change_listener(this.onchange),this.onchange=t,this.workspace.add_change_listener(this.onchange)},e.prototype.set_on_block_change=function(t){var e=this;if(!this.is_in_flyout&&!this.is_insertion_marker()){this.workspace.add_change_listener((function(i){i.type!==s.BlockEventType.CREATE&&i.type!==s.BlockEventType.CHANGE&&i.type!==s.BlockEventType.DELETE||e.id===i.get_block_id()&&t.call(e,i)}))}},e.prototype.append_block_input=function(t,e){var i=this.generate_block(t),o=e.connection;if(o){var n=i.output_connection||i.previous_connection;n&&n.connect(o),o.set_hidden(!0)}return i},e.prototype.generate_block=function(t){var e=this.utils.string_to_dom(t);return this.xml.dom_to_block(e,this.workspace)},e.prototype.interpolate_=function(t,e,i){for(var o=this.utils.tokenize_interpolation(t),n=[],r=0,s=[],_=0;_<o.length;_++){var a=o[_];if("number"==typeof a){if(a<=0||a>e.length)throw new Error('Block "'.concat(this.type,'": ')+"Message index %".concat(a," out of range."));if(n[a])throw new Error('Block "'.concat(this.type,'": ')+"Message index %".concat(a," duplicated."));n[a]=!0,r++,s.push(e[a-1])}else(a=a.trim())&&s.push(a)}if(r!=e.length)throw new Error('Block "'.concat(this.type,'": Message does not reference all ').concat(e.length," arg(s). Massage: ").concat(t));var c=s[s.length-1];if(s.length&&("string"==typeof c||c.type.startsWith("field_"))){var l={type:"input_dummy",name:""};i&&Object.assign(l,{align:i}),s.push(l)}var d=[];for(_=0;_<s.length;_++){var u=s[_];if("string"!=typeof u){var h=void 0,p=void 0;if("string"!=typeof u)if(u.custom)h=this.init_custom_field(u),d.push([h,u.name]);else{switch(u.type){case"input_shadow":p=this.append_shadow_input_json(u.name,u.field_type,u.default_text);break;case"input_value":p=this.append_value_input(u.name,void 0,void 0,u.default_shadow);break;case"input_statement":p=this.append_statement_input(u.name,void 0,u.provided_context);break;case"input_dummy":p=this.append_dummy_input(u.name);break;case"field_label":h=this.field_label_factory({text:this.utils.replace_message_references(u.text),opt_class:u.class});break;case"field_label_serializable":h=this.field_label_serializable_factory({text:this.utils.replace_message_references(u.text),opt_class:u.class});break;case"field_input":h=this.new_field_text_input_from_json(u);break;case"field_colour":h=this.field_colour_factory({colour:u.colour,opt_validator:u.validator});break;case"field_dropdown":h=this.field_dropdown_factory({menu_generator:u.options,opt_onchange:u.onchange,selected_index:u.selected_index,opt_validator:u.validator});break;case"field_dropdown_advanced":h=this.field_dropdown_factory({menu_generator:[],opt_onchange:u.onchange,selected_index:u.selected_index,opt_validator:u.validator,menu_generator_advanced:u.advanced_options});break;case"field_image":case"field_button":var g=this.parse_field_image_param_from_json(u),f=g.src,v=g.width,m=g.height,b=g.alt,y=g.callback,E=g.circle;h="field_image"===u.type?this.field_image_factory({src:f,width:v,height:m,opt_alt:b}):this.field_button_factory({src:f,width:v,height:m,opt_alt:b,opt_callback:y,has_circle:E});break;case"field_icon":if(!u.is_head)break;h=this.field_icon_factory({src:u.src,opt_alt:u.alt,opt_is_head:u.is_head});break;case"mutation_add_button":h=this.mutation_add_factory(void 0);break;case"mutation_remove_button":h=this.mutation_remove_factory(void 0);break;case"field_number":h=this.field_number_factory({opt_value:u.value,opt_min:u.min,opt_max:u.max,opt_precision:u.precision,opt_controller:u.controller});break;case"field_textdropdown":h=this.field_text_dropdown_factory(u.options);break;case"field_multiline_input":h=this.field_multiline_input(u);break;case"field_limit_length_input":h=this.field_limit_length_input(u);break;case"field_default_value":h=this.field_default_value(u);break;default:h=this.init_custom_field(u)}if(h)void 0!==u.margin_left&&(h.margin_left=u.margin_left),d.push([h,u.name]);else if(p){u.check&&p.set_check(u.check),void 0!==u.margin_left&&(p.margin_left=u.margin_left);for(var k=0;k<d.length;k++)p.append_field(d[k][0],d[k][1]);d.length=0}}else h=this.field_label_factory({text:u})}else d.push([u,void 0])}},e.prototype.init_custom_field=function(t){var e=this.registry.field.from_json(t);if(e)return e;var i=t.type;if(i){var o=i.split("_").map((function(t){return t[0].toUpperCase()+t.slice(1)})).join("");window.Blockly[o]&&(e=new window.Blockly[o](t))}if(!e)throw new ReferenceError("Trying to init an undefined type of field");return e},e.prototype.get_input=function(t){for(var e=0;e<this.inputList.length;e++){var i=this.inputList[e];if(i.name==t)return i}},e.prototype.set_disabled=function(t){var e=void 0;this.disabled!==t&&(this.events.is_enabled()&&(e=this.change_event_factory("disabled",{block:this,old_value:this.disabled,new_value:t})),this.disabled=t),this.is_rendered()&&this.update_disabled(),e&&this.events.fire(e)},e.prototype.set_editable=function(t){this.editable_=t;for(var e=0;e<this.inputList.length;e++)for(var i=this.inputList[e],o=0;o<i.fieldRow.length;o++){i.fieldRow[o].update_editable()}},e.prototype.set_connections_hidden=function(t){if(!t&&this.is_collapsed())this.output_connection&&this.output_connection.set_hidden(t),this.previous_connection&&this.previous_connection.set_hidden(t),this.next_connection&&!_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)&&(this.next_connection.set_hidden(t),(o=this.next_connection.targetBlock())&&o.set_connections_hidden(t));else for(var e=this.get_connections(!0),i=0;i<e.length;i++){var o,n=e[i];if(n.set_hidden(t),n.is_superior())(o=n.targetBlock())&&o.set_connections_hidden(t)}},e.prototype.get_surround_parent=function(){var t,e=this;do{if(t=e,!(e=e.get_parent()||e.parent_group))return}while(e.get_next_block()==t);return e},e.prototype.get_top_group=function(){for(var t=this,e=void 0;t;)t.parent_group&&(t=e=t.parent_group),t=t.get_parent();return e},e.prototype.get_top_parent=function(){for(var t=this;t.parent_block;)t=t.parent_block;return t},e.prototype.get_connections=function(t){var e=[];if((t||this.rendered)&&(this.output_connection&&e.push(this.output_connection),this.previous_connection&&e.push(this.previous_connection),this.next_connection&&e.push(this.next_connection),t||!this.is_collapsed()))for(var i=0;i<this.inputList.length;i++){var o=this.inputList[i];o.connection&&e.push(o.connection)}return e},e.prototype.get_full_next_connection=function(){if(this.next_connection)return this.next_connection;if(this.is_starting_block())for(var t=0;t<this.inputList.length;t++){var e=this.inputList[t];if(e.type===s.InputType.STATEMENT)return e.connection}},e.prototype.last_connection_in_stack=function(){for(var t=this.get_full_next_connection();t;){var e=t.targetBlock();if(!e)return t;t=e.next_connection}},e.prototype.get_input_with_connection=function(t){for(var e=0;e<this.inputList.length;e++){var i=this.inputList[e];if(i.connection==t)return i}},e.prototype.get_first_statement_connection=function(){for(var t=0;t<this.inputList.length;t++){var e=this.inputList[t];if(e.connection&&e.connection.type==s.CONNECTION_TYPE.NEXT_STATEMENT)return e.connection}},e.prototype.get_matching_connection=function(t,e){var i=this.get_connections(!0),o=t.get_connections(!0);if(!this.is_insertion_marker()&&i.length!=o.length)throw new Error("Connection lists did not match in length.");for(var n=0;n<o.length;n++)if(o[n]==e)return i[n]},e.prototype.unplug=function(t){if(this.output_connection)this.output_connection.is_connected()&&this.output_connection.disconnect();else if(this.previous_connection){var e=void 0;this.previous_connection.is_connected()&&(e=this.previous_connection.get_targe_connection(),this.previous_connection.disconnect());var i=this.get_next_block();if(t&&i){var o=this.next_connection;if(!o)return;var n=o.get_targe_connection();if(!n)return;n.disconnect(),e&&e.check_type(n)&&e.connect(n)}}},e.prototype.get_input_with_block=function(t){for(var e=0;e<this.inputList.length;e++){var i=this.inputList[e];if(i.connection&&i.connection.targetBlock()==t)return i}},e.prototype.get_input_target_block=function(t){var e=this.get_input(t);return e&&e.connection&&e.connection.targetBlock()},e.prototype.get_field_value=function(t){var e=this.get_field(t);if(e)return e.get_value()},e.prototype.get_shadow_field=function(t,e){void 0===e&&(e="NUM");var i=this.get_input(t);if(i&&i.connection){var o=i.connection.target_connection;if(o)return o.source_block.get_field(e)}},e.prototype.get_shadow_field_value=function(t,e){void 0===e&&(e="NUM");var i=this.get_shadow_field(t,e);if(i)return i.get_value()},e.prototype.set_field_value=function(t,e){var i=this.get_field(e);if(!i)throw new ReferenceError("Field ".concat(e," not found."));i.set_value(t)},e.prototype.get_input_with_field=function(t){for(var e=0;e<this.inputList.length;e++)for(var i=this.inputList[e],o=0;o<i.fieldRow.length;o++){if(i.fieldRow[o].name===t)return i}},e.prototype.set_next_statement=function(t,e){t?(void 0==e&&(e=void 0),this.next_connection||(this.next_connection=this.make_connection(s.CONNECTION_TYPE.NEXT_STATEMENT)),this.next_connection.set_check(e)):this.next_connection&&((0,a.assert)(!this.next_connection.is_connected(),"Must disconnect next statement before removing connection."),this.next_connection.dispose(),this.next_connection=void 0)},e.prototype.set_previous_statement=function(t,e){t?(void 0==e&&(e=void 0),this.previous_connection||((0,a.assert)(!this.output_connection,"Remove output connection prior to adding previous connection."),this.previous_connection=this.make_connection(s.CONNECTION_TYPE.PREVIOUS_STATEMENT)),this.previous_connection.set_check(e)):this.previous_connection&&((0,a.assert)(!this.previous_connection.is_connected(),"Must disconnect previous statement before removing connection."),this.previous_connection.dispose(),this.previous_connection=void 0)},e.prototype.set_output=function(t,e,i){if(t){if(!this.output_connection){if(void 0!=this.previous_connection)throw new Error("Remove previous connection prior to adding output connection.");this.output_connection=this.make_connection(s.CONNECTION_TYPE.OUTPUT_VALUE,i)}var o=(0,d.is_array)(e)&&e.indexOf("Any")>-1||"Any"===e;e&&!o&&this.output_connection.set_check(e)}else if(this.output_connection){if(this.output_connection.is_connected())throw new Error("Must disconnect output value before removing connection.");this.output_connection.dispose(),this.output_connection=void 0}},e.prototype.append_value_input=function(t,e,i,o){var n=this.append_input(s.InputType.VALUE,t,e,i);return"string"===typeof o?n.connection.set_shadow_from_string(o):n.connection.set_shadow_dom(o),n},e.prototype.respawn_all_shadows=function(){var t,e;null===(t=this.previous_connection)||void 0===t||t.respawn_shadow(),null===(e=this.next_connection)||void 0===e||e.respawn_shadow(),this.inputList.forEach((function(t){var e;null===(e=t.connection)||void 0===e||e.respawn_shadow()}))},e.prototype.append_statement_input=function(t,e,i){return this.append_input(s.InputType.STATEMENT,t,e,i)},e.prototype.append_dummy_input=function(t,e){return this.append_input(s.InputType.DUMMY,t||"",e)},e.prototype.append_shadow_input=function(t,e,i){return this.append_shadow(s.InputType.VALUE,t,e,(0,c.gen_uid)(),i)},e.prototype.append_math_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.math,e)},e.prototype.append_logic_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.logic,e)},e.prototype.append_text_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.text,e)},e.prototype.append_multiline_text_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.multiline_text,e)},e.prototype.append_default_value_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.default_value,e)},e.prototype.append_shadow_input_json=function(t,e,i,o){var n={text:'<shadow type="text"><field name="TEXT">'.concat(i=void 0==i?"":i,"</field></shadow>"),math:'<shadow type="math_number"><field name="NUM">'.concat(i,"</field></shadow>"),bool:'<empty type="logic_empty"><field name="BOOL"></field></empty>'};return this.append_shadow(s.InputType.VALUE,t,n[e],void 0,o)},e.prototype.append_input=function(t,e,i,o){var n=t===s.InputType.DUMMY?void 0:this.make_connection(t,o),r=this.input_factory({type:t,name:e,block:this,connection:n});return void 0===i?this.inputList.push(r):(i="number"===typeof i?i:this.get_input_index(i),this.inputList.splice(i,0,r)),r},e.prototype.get_descendants=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);for(var i=[this],o=this.get_children(t),n=0;n<o.length;n++){var r=o[n];e&&r.is_shadow()||i.push.apply(i,r.get_descendants(t,e))}return i},e.prototype.get_descendant_ids=function(){for(var t=[this.id],e=this.get_descendants(),i=0;i<e.length;i++){var o=e[i];t[i]=o.id}return t},e.prototype.get_nested_block=function(){for(var t=[],e=0;e<this.inputList.length;e++){var i=this.inputList[e];if(!(i.name in _.SPECIAL_CONNECTION_INPUT_NAME)&&(i.connection&&i.connection.type===s.CONNECTION_TYPE.INPUT_VALUE)){var o=i.connection.targetBlock();o&&t.push(o)}}return t},e.prototype.get_all_nested_blocks=function(){for(var t=[this],e=this.get_nested_block(),i=0;i<e.length;i++){var o=e[i];t.push.apply(t,o.get_all_nested_blocks())}return t},e.prototype.get_next_block=function(){return this.next_connection&&this.next_connection.targetBlock()},e.prototype.get_full_next_block=function(){var t=this.get_full_next_connection();return t&&t.targetBlock()},e.prototype.get_field=function(t){for(var e=0;e<this.inputList.length;e++)for(var i=this.inputList[e],o=0;o<i.fieldRow.length;o++){var n=i.fieldRow[o];if(n.name===t)return n}},e.prototype.get_field_icon=function(){for(var t=0;t<this.inputList.length;t++)for(var e=this.inputList[t],i=0;i<e.fieldRow.length;i++){var o=e.fieldRow[i];if("FieldIcon"===o.field_type)return o}},e.prototype.set_tooltip=function(t){this.tooltip=t},e.prototype.new_field_text_input_from_json=function(t){var e=this.utils.replace_message_references(t.text||""),i=this.field_text_input_factory({text:e,opt_validator:t.validator});return"boolean"==typeof t.spellcheck&&i.set_spell_check(t.spellcheck),i},e.prototype.parse_field_image_param_from_json=function(t){return{src:this.utils.replace_message_references(t.src),width:Number(this.utils.replace_message_references("".concat(t.width))),height:Number(this.utils.replace_message_references("".concat(t.height))),alt:this.utils.replace_message_references(t.alt||""),callback:"field_button"===t.type?t.callback:void 0,circle:"field_button"===t.type?t.circle:void 0}},e.prototype.mixin=function(t,e){if(!e){var i=[];for(var o in t){void 0!=this[o]&&i.push(o)}if(i.length)throw new Error("Mixin will overwrite block members: ".concat(JSON.stringify(i)))}Object.assign(this,t)},e.prototype.move_input_before=function(t,e){if(t!=e){for(var i=-1,o=e?-1:this.inputList.length,n=0;n<this.inputList.length;n++){var r=this.inputList[n];if(r.name==t){if(i=n,-1!=o)break}else if(e&&r.name==e&&(o=n,-1!=i))break}-1==i&&console.warn("Named input ".concat(t," not found.")),-1==o&&console.warn("Reference input ".concat(o," not found.")),this.move_numbered_input_before(i,o)}},e.prototype.to_string=function(t,e){void 0===e&&(e="...");var i=[],o=this.get_input(_.COLLAPSED_INPUT_NAME);if(o&&this.collapsed_)return o.fieldRow[0].get_text();for(var n=0;n<this.inputList.length;n++){for(var r,s=this.inputList[n],a=0;a<s.fieldRow.length;a++){var c=s.fieldRow[a];(0,d.is_field_dropdown)(c)&&!c.get_value()?i.push(e):i.push(c.get_text())}if(s.connection)(r=s.connection.targetBlock())?i.push(r.to_string(void 0,e)):i.push(e)}"start_on_click"===this.type&&((r=this.get_next_block())&&i.push(r.to_string(void 0,e)));var l=i.join(" ").trim()||" ";return t&&(l="".concat(l.substring(0,t-3)).concat(e)),l},Object.defineProperty(e.prototype,"use_drag_surface",{get:function(){var t=this.workspace.current_gesture_;return!(t&&t.is_start_from_flyout())&&this.workspace.degrade_translate?this.workspace.blockDB_.size<this.workspace.degrade_translate:!!this.workspace.get_block_drag_surface()},enumerable:!1,configurable:!0}),e.prototype.move_by=function(t){var e;this.events.is_enabled()&&!this.is_shadow()&&(e=this.move_event_factory({block:this}));var i=n.vec2.create();this.is_shadow()||(i=this.get_relative_to_surface_xy()),this.translate(n.vec2.add(i,i,t)),this.move_connections(t),e&&e.record_new(),this.rendered&&this.workspace.resize_contents(),e&&this.events.fire(e)},e.prototype.append_shadow=function(t,e,i,o,n){this.rendered,this.events.disable();var r=this.make_connection(t),s=this.input_factory({type:t,name:e,block:this,connection:r}),_=this.utils.string_to_dom(i);r.set_shadow_dom(_);var c=this.xml.dom_to_block_headless(_,this.workspace,o);if(c.output_connection?r.connect(c.output_connection):c.previous_connection?r.connect(c.previous_connection):(0,a.fail)("Child block does not have output or previous statement."),void 0===n?this.inputList.push(s):(n="number"===typeof n?n:this.get_input_index(n),this.inputList.splice(n,0,s)),!this.is_insertion_marker()&&this.rendered)for(var l=this.get_descendants(),d=0;d<l.length;d++)l[d].is_insertion_marker()||(l[d].init_svg(),l[d].render(!1));return this.update_disabled(),this.workspace.resize_contents(),this.events.enable(),s},e.prototype.move_connections=function(t){for(var e=this.get_connections(!0),i=0;i<e.length;i++)e[i].move_by(t);var o=this.get_icons();for(i=0;i<o.length;i++)o[i].reposition();for(i=0;i<this.child_blocks.length;i++)this.child_blocks[i].move_connections(t)},e.prototype.dispose=function(t,e){var i,o;if(null===(i=this.parent_group)||void 0===i||i.dispose(),this.workspace){this.utils.start_text_cache();var n,r=this.workspace;this.runtime_data.selected===this&&(this.unselect(),this.workspace.cancel_current_gesture()),this.context_menu.current_block==this&&this.context_menu.hide(),e&&this.rendered&&(this.unplug(t),this.block_animations.dispose_ui_effect(this)),this.rendered=!1,this.onchange&&this.workspace.remove_change_listener(this.onchange),this.unplug(t),this.events.is_enabled()&&(n=this.delete_event_factory({block:this})),this.events.disable();try{for(var s=this.get_icons(),_=0;_<s.length;_++)s[_].dispose()}finally{this.events.enable()}this.events.disable();try{this.workspace&&(this.workspace.remove_top_block(this),this.workspace.blockDB_.delete(this.id),this.workspace=void 0),this.runtime_data.selected==this&&(this.runtime_data.selected=void 0);for(_=this.child_blocks.length-1;_>=0;_--)this.child_blocks[_].dispose(!1);for(_=0;_<this.inputList.length;_++){this.inputList[_].dispose()}this.inputList.length=0;var a=this.get_connections(!0);for(_=0;_<a.length;_++){var c=a[_];c.is_connected()&&c.disconnect(),a[_].dispose()}}finally{this.events.enable()}(null===(o=this.Blink.tooltip)||void 0===o?void 0:o.get_element())===this.svg_path&&this.Blink.tooltip.hide(),this.is_shadow()||this.is_insertion_marker()||r.resize_contents(),(0,l.remove_children)(this.svg_group),delete this.svg_path,(0,l.remove_node)(this.svg_group),this.utils.stop_text_cache(),n&&this.events.fire(n)}},e.prototype.detach=function(){if(!this.workspace)throw new Error("Trying to detach a block without workspace.");this.events.disable();try{for(var t=this.get_icons(),e=0;e<t.length;e++)t[e].dispose();this.onchange&&this.workspace.remove_change_listener(this.onchange),this.workspace.blockDB_.delete(this.id),this.workspace.get_top_blocks(!1).includes(this)&&(this.workspace.remove_top_block(this),this.workspace=void 0,this.svg_group&&(0,l.remove_node)(this.svg_group));for(e=this.child_blocks.length-1;e>=0;e--)this.child_blocks[e].detach()}finally{this.events.enable()}},e.prototype.retach=function(t){t.add_top_block(this),this.set_workspace(t),this.init_svg();for(var e=this.get_descendants(),i=e.length-1;i>=0;i--){t.blockDB_.set(e[i].id,e[i]);var o=e[i].get_relative_to_surface_xy();e[i].move_by(n.vec2.negate(o,o))}},e.prototype.make_connection=function(t,e){return this.connection_factory({source:this,type:t,context:e})},e.prototype.show_context_menu=function(t){var e=this;if(!this.workspace.get_options().readOnly&&this.context_menu&&this.is_deletable()&&this.is_movable()&&!this.is_in_flyout){var i=[];this.context_menu_options_setting.forEach((function(t){if("number"===typeof t)switch(t){case s.BlockOptionType.COPY:return e.options_add_copy(i);case s.BlockOptionType.COPY_AND_PASTE:return e.options_add_duplicate(i);case s.BlockOptionType.ADD_COMMENT:return e.options_add_comments(i);case s.BlockOptionType.COLLAPSE:return e.options_add_collapse(i);case s.BlockOptionType.DELETE:return e.options_add_delete_blocks(i);case s.BlockOptionType.SET_GROUP:return void(e.workspace.options.block_group&&e.options_add_set_blocks_group(i));case s.BlockOptionType.VISIBILITY_CHANGE:return e.add_visibility_change_option(i);default:return console.warn("Undefined block menu option: ".concat(t))}var o=t(e);o&&i.push(o)})),this.context_menu.current_block=this,this.context_menu.show(t,{source:"block",options:i},this.RTL)}},e.prototype.options_add_copy=function(t){var e=this,i={text:this.Msg.DUPLICATE_BLOCK,name:"copy",area:"block",enabled:!0,callback:function(){e.runtime_data.clipboard.copy(e)}};this.get_descendants().length>this.workspace.remaining_capacity()&&(i.enabled=!1),t.push(i)},e.prototype.options_add_duplicate=function(t){var e=this;t.push({text:this.Msg.COPY_AND_PASTE,name:"copy_and_paste",enabled:!0,callback:function(){e.runtime_data.clipboard.duplicate(e)}})},e.prototype.options_add_comments=function(t){var e,i=this;this.is_editable()&&!this.is_collapsed()&&this.workspace.get_options().comments&&"block_group"!==this.element_type&&(e=this.comment?{enabled:!h.is.ie(),text:this.Msg.REMOVE_COMMENT,name:"remove_comment",callback:function(){i.comment&&i.set_comment_text(void 0)}}:{enabled:!h.is.ie(),text:this.Msg.ADD_COMMENT,name:"add_comment",callback:function(){return o.__awaiter(i,void 0,void 0,(function(){var t;return o.__generator(this,(function(e){switch(e.label){case 0:return"simplified"!==this.workspace.get_options().comment_type?[3,2]:[4,this.workspace.show_external_comment_editor("")];case 1:return void 0==(t=e.sent())||(this.set_comment_text(t),(0,a.assert)(this.comment),this.comment.init_svg(),this.comment.set_expanded(!0)),[2];case 2:return this.set_comment_text(""),(0,a.assert)(this.comment),this.comment.init_svg(),this.comment.focus(),[2]}}))}))}},t.push(e))},e.prototype.options_add_collapse=function(t){var e=this;if(this.workspace.get_options().collapse)if(this.is_collapsed()){var i={text:this.Msg.EXPAND_BLOCK,name:"expand",enabled:!0,callback:function(){e.set_collapsed(!1)}};t.push(i)}else{var o={enabled:!0,text:this.Msg.COLLAPSE_BLOCK,name:"collapse",callback:function(){e.set_collapsed(!0)}};t.push(o)}},e.prototype.options_add_delete_blocks=function(t){var e=this,i={text:this.Msg.DELETE_BLOCK,name:"delete",area:"block",enabled:!0,callback:function(){var t=e.events.get_group();e.events.set_group(t||!0),e.dispose(!0,!0),e.events.set_group(t)}};t.push(i)},e.prototype.options_add_set_blocks_group=function(t){var e=this,i={text:this.utils.replace_message_references("%{BKY_BLOCK_GROUP}"),name:"block_group",area:"block",enabled:!0,callback:function(){e.hide_into_group()}};t.push(i)},e.prototype.add_visibility_change_option=function(t){var e=this,i=this.get_root_block().get_visibility()===s.BlockVisibility.VISIBLE;t.push({text:this.utils.replace_message_references("%{BKY_".concat(i?"HIDE":"SHOW","_BLOCK_STACK}")),name:"change_visibility",enabled:!0,callback:function(){e.set_chunk_visibility(i?s.BlockVisibility.TRANSLUCENT:s.BlockVisibility.VISIBLE),e.update_chunk_visibility()}})},e.prototype.set_comment_text=function(t,e,i){(0,d.is_string)(t)&&(this.comment||(this.comment=this.workspace_comment_factory({workspace:this.workspace,type:this.workspace.options.comment_type,parent_block:this,opt_id:e,position:i})),this.comment.set_text(t)),!(0,d.is_string)(t)&&this.comment&&(this.comment.dispose(),this.comment=void 0)},e.prototype.get_comment_text=function(){if(this.comment){var t=this.comment.get_text();return(0,g.string_trim)(t)}return""},e.prototype.add_hover=function(){this.svg_group.setAttribute("filter","url(#".concat(f.FILTER.DRAG_SHADOW,")"))},e.prototype.remove_hover=function(){this.svg_group.removeAttribute("filter")},e.prototype.unselect=function(){this.runtime_data.selected==this&&(this.runtime_data.selected=void 0,this.remove_select(),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.SELECTED,workspace_id:this.workspace.id,block_id:this.id})))},e.prototype.init_svg=function(){if(void 0==this.svg_group)throw new ReferenceError("Cannot init svg to block without svg group.");if(!this._is_insertion_marker){for(var t=0;t<this.inputList.length;t++){this.inputList[t].init()}this.warning&&this.warning.create_icon()}this.update_colour(),this.update_movable(),this.init_events();var e=this.get_svg_root(),i=this.workspace.get_canvas();if((void 0==e||void 0==e.parentNode)&&void 0!=i){if(this.is_insertion_marker()&&this.output_connection)return;i.appendChild(this.svg_group)}},e.prototype.init_events=function(){var e=this;if(t.prototype.init_events.call(this),this.svg_path){this.is_in_flyout||this.is_shadow()||!this.is_output_block()||(this.svg_group.addEventListener("mouseover",(function(t){var i;t.stopPropagation(),!(0,l.is_inside_shadow)(t.relatedTarget)&&(null===(i=e.output_connection)||void 0===i?void 0:i.is_connected())&&e.svg_group.classList.add("output-block-hover")})),this.svg_group.addEventListener("mouseout",(function(t){t.stopPropagation(),(0,l.is_inside_shadow)(t.relatedTarget)||e.svg_group.classList.remove("output-block-hover")}))),this.is_in_flyout||!this.is_wrap_shape()&&!this.is_shadow()||(this.svg_path.addEventListener("mouseover",(function(t){t.stopPropagation(),i(!0)})),this.svg_path.addEventListener("mouseout",(function(t){t.stopPropagation(),i(!1)})));var i=function(t){var i=e.is_shadow()?e.parent_block:e;if(i&&i.is_wrap_shape()&&i.svg_path){var o=i.get_surround_parent(),n=o&&!o.is_starting_block(),r=i.svg_group.querySelector(".blocklySurroundShadow");if(t&&!r&&!i.workspace.is_dragging()){var s=(0,l.clone_node)(i.svg_path);s.classList.add("blocklySurroundShadow"),i.svg_group.appendChild(s),n||i.svg_path.setAttribute("filter","url(#".concat(f.FILTER.SURROUND_SHADOW,")"))}!t&&r&&(i.svg_group.removeChild(r),i.svg_path.removeAttribute("filter"))}}}},e.prototype.clear_hover_effect=function(){var t;(0,l.remove_class_if_necessary)(this.svg_group,"output-block-hover");var e=this.svg_group.querySelector(".blocklySurroundShadow");e&&(0,l.remove_node)(e),null===(t=this.svg_path)||void 0===t||t.removeAttribute("filter")},e.prototype.update_movable=function(){t.prototype.update_movable.call(this),this.is_shadow()&&"param_color"!==this.element_type&&(this.svg_group.classList.remove("blocklyDraggable"),this.svg_group.classList.add("blocklyShadow"))},e.prototype.update_disabled=function(){if(!this.svg_group||!this.svg_path)throw new ReferenceError("Cannot update disable to block without init.");if(!this.is_insertion_marker()&&!this.prevent_disable_style_change)if(this.disabled||this.get_inherited_disabled())(0,l.add_class_if_necessary)(this.svg_group,"blocklyDisabled"),this.is_shadow()||this.svg_path.setAttribute("fill","url(#".concat(this.workspace.get_options().disabledPatternId,")")),this.is_starting_block()&&(t=this.get_field_icon())&&t.image_element&&t.image_element.setAttribute("filter","url(#".concat(f.FILTER.DISABLED_HEAD_ICON,")"));else if(this.svg_group.classList.contains("blocklyDisabled")){var t;if(this.svg_group.classList.remove("blocklyDisabled"),this.is_starting_block())(t=this.get_field_icon())&&t.image_element&&t.image_element.removeAttribute("filter");this.update_colour()}for(var e=this.get_children(),i=0;i<e.length;i++){e[i].update_disabled()}},e.prototype.get_output_shape=function(){return void 0!=this.output_connection&&this.output_connection.get_output_shape()},e.prototype.is_text_shadow=function(){if(!this.is_shadow())return!1;for(var t=0;t<this.inputList.length;t++)for(var e=this.inputList[t],i=0;i<e.fieldRow.length;i++){var o=e.fieldRow[i];if((0,d.is_field_number)(o)||(0,d.is_field_text_input)(o)||"FieldTextDropdown"===o.field_type||"FieldMultilineInput"===o.field_type||"FieldLimitLengthInput"===o.field_type||"FieldDefaultValue"===o.field_type)return!0}return!1},e.prototype.get_relative_to_surface_xy=function(){var t,e,i=this.use_drag_surface?null===(t=this.workspace.get_block_drag_surface())||void 0===t?void 0:t.get_group():void 0,o=this.get_svg_root();if(void 0==o)return n.vec2.create();var r=n.vec2.create();do{if(n.vec2.add(r,r,this.utils.get_relative_xy(o)),this.use_drag_surface&&(null===(e=this.workspace.get_block_drag_surface())||void 0===e?void 0:e.get_current_block())==o){var s=this.workspace.get_block_drag_surface().get_surface_translation();n.vec2.add(r,r,[s[0],s[1]])}o=o.parentNode}while(o&&o!=this.workspace.get_canvas()&&o!=i);return r},e.prototype.get_relative_to_injection_div_xy=function(){var t=this.get_svg_root();return this.utils.get_injection_div_xy(t)},e.prototype.get_icons=function(){var t=[];return this.comment&&t.push(this.comment),this.warning&&t.push(this.warning),t},e.prototype.set_dragging=function(t){if(void 0!=this.svg_group){var e=this.svg_group;t?(e.translate_="",e.skew_="",this.runtime_data.dragging_connections=this.runtime_data.dragging_connections.concat(this.get_connections(!0)),(0,l.add_class)(e,"blocklyDragging")):(this.runtime_data.dragging_connections=[],(0,l.remove_class)(e,"blocklyDragging"));for(var i=0;i<this.child_blocks.length;i++)this.child_blocks[i].set_dragging(t)}else console.warn("Cannot set delete style for block without init.")},e.prototype.snap_to_grid=function(){if(this.workspace&&!(this.workspace.is_dragging()||this.workspace.current_gesture_&&this.workspace.current_gesture_.has_started)&&!this.get_parent()&&!this.is_in_flyout){var t=this.workspace.get_grid();if(t&&"string"!==typeof t&&t.should_snap()){var e=t.get_spacing(),i=e/2,o=this.get_relative_to_surface_xy();n.vec2.round(o,[Math.round((o[0]-i)/e)*e+i-o[0],Math.round((o[1]-i)/e)*e+i-o[1]]),0==o[0]&&0==o[1]||this.move_by(o)}}},e.prototype.schedule_snap_and_bump=function(){var t=this,e=this,i=this.events.get_group();window.setTimeout((function(){t.events.get_group()&&t.events.get_group()!==i||(t.events.set_group(i),e.snap_to_grid(),t.events.set_group(!1))}),this.theme.blink_params.BUMP_DELAY/2),window.setTimeout((function(){t.events.get_group()&&t.events.get_group()!==i||(t.events.set_group(i),e.bump_neighbours(),t.events.set_group(!1))}),this.theme.blink_params.BUMP_DELAY)},e.prototype.set_insertion_marker=function(t){if(this._is_insertion_marker=t,this._is_insertion_marker){var e=this.workspace.get_options().connection_effect,i=e?e.color:this.theme.insertion_marker.COLOR;this.set_colour(i),this.set_opacity(this.theme.insertion_marker.OPACITY),void 0!=this.svg_group&&(0,l.add_class)(this.svg_group,"InsertionMarker")}this.update_colour()},e.prototype.highlight_for_replacement=function(t){if(void 0!=this.svg_path&&void 0!=this.svg_group){if(t){if((0,l.add_class)(this.svg_group,"blocklyReplaceable"),!this.is_shadow()||"param_color"===this.element_type)return this.svg_path.setAttribute("stroke","#ffffff"),void this.svg_path.setAttribute("stroke-width","3");if(this.get_stroke_width()!==this.theme.shadow_style.NO_BORDER){var e=this.parent_block.get_colour();return this.svg_path.setAttribute("stroke",e.toString()),this.svg_path.setAttribute("stroke-width","2"),void this.svg_path.setAttribute("filter","url(#".concat(f.FILTER.REPLACEMENT_GLOW,")"))}return this.svg_path.setAttribute("stroke","#ffffff"),this.svg_path.setAttribute("stroke-width","3"),void(this.is_editable()&&!this.is_text_shadow()&&(this.svg_path.style.fillOpacity="0.1"))}(0,l.remove_class)(this.svg_group,"blocklyReplaceable"),this.svg_path.setAttribute("stroke",this.get_border_colour().toString()),this.svg_path.setAttribute("stroke-width",this.get_stroke_width()),this.svg_path.removeAttribute("filter"),this.svg_path.style.fillOpacity=""}else console.warn("Cannot highlight block without init.")},e.prototype.position_new_block=function(t,e,i){if(e.type==s.CONNECTION_TYPE.NEXT_STATEMENT){var o=n.vec2.create();n.vec2.sub(o,i.get_xy(),e.get_xy()),t.move_by(o)}},e.prototype.bring_to_front=function(){var t=this;if(this.workspace.svg_block_canvas_){var e=this;do{var i=e.get_svg_root();void 0!=i&&void 0!=i.parentNode&&i.parentNode.appendChild(i),e=e.get_parent()}while(e);var o=[];this.get_descendants().forEach((function(t){t.comment&&o.push(t.comment.get_svg_root())})),Array.from(this.workspace.svg_block_canvas_.children).forEach((function(e){o.includes(e)&&t.workspace.svg_block_canvas_.appendChild(e)}))}},e.prototype.get_parent=function(){return this.parent_block},e.prototype.set_parent=function(t){if(this.workspace.svg_block_canvas_){var e=this.get_parent();if(t!==e){if(this.utils.start_text_cache(),this.parent_block){if((0,p.remove)(this.parent_block.child_blocks,this),this.previous_connection&&this.previous_connection.is_connected())throw new Error("Still connected to previous block.");if(this.output_connection&&this.output_connection.is_connected())throw new Error("Still connected to parent block.");this.parent_block=void 0}else this.workspace.remove_top_block(this);this.parent_block=t,t?t.child_blocks.push(this):this.workspace.add_top_block(this),this.utils.stop_text_cache();var i=this.get_svg_root();if(!this.workspace.is_clearing&&i){var o=this.get_relative_to_surface_xy();if(t){t.get_svg_root().appendChild(i);var r=this.get_relative_to_surface_xy();this.move_connections(n.vec2.subtract(r,r,o)),this.is_shadow()&&this.set_colour(this.get_colour(),this.get_border_colour())}else e&&(this.runtime_data.selected===this&&this.workspace.is_dragging()||(this.workspace.svg_block_canvas_.appendChild(i),this.translate(o)))}}}},e.prototype.select=function(){if(this.is_shadow()&&this.get_parent()){var t=this.get_parent();void 0!=t&&t.select()}else if(this.runtime_data.selected!=this){var e=void 0;if(this.runtime_data.selected){e=this.runtime_data.selected.id,this.events.disable();try{this.runtime_data.selected.unselect()}catch(o){console.error(o)}finally{this.events.enable()}}if(this.runtime_data.selected=this,this.events.is_enabled()){var i=this.ui_event_factory({type:s.UIEventType.SELECTED,workspace_id:this.workspace.id,old_value:e,new_value:this.id});this.events.fire(i)}}},e.prototype.move_to_drag_surface=function(){this.clear_hover_effect(),"mobile"!==this.workspace.options.blockly_type&&this.svg_group.setAttribute("filter","url(#".concat(f.FILTER.DRAG_SHADOW,")")),t.prototype.move_to_drag_surface.call(this)},e.prototype.set_inputs_inline=function(t){var e;this.inputs_inline!==t&&(this.events.is_enabled()&&(e=this.change_event_factory("inline",{block:this,old_value:!!this.inputs_inline,new_value:t})),this.inputs_inline=t),this.rendered&&this.render(),e&&this.events.fire(e)},e.prototype.get_inputs_inline=function(){return void 0==this.inputs_inline||this.inputs_inline},e.prototype.set_glow_stack=function(t){this.is_glowing_stack=t;var e=this.svg_group;if(void 0==e)throw new Error("Block may not been init.");this.is_glowing_stack?(0,l.add_class_if_necessary)(e,"blocklyStackGlow"):(0,l.remove_class_if_necessary)(e,"blocklyStackGlow")},e.prototype.set_flash=function(t){this.is_flashing=t,this.block_animations.block_flash_effect(this,this.is_flashing)},e.prototype.add_select=function(){this.set_glow_stack(!0)},e.prototype.remove_select=function(){this.set_glow_stack(!1)},e.prototype.bump_neighbours=function(){if(this.workspace&&!(this.workspace.is_dragging()||this.workspace.current_gesture_&&this.workspace.current_gesture_.is_dragging()&&this.workspace.current_gesture_.has_started)&&this.events.is_record_undo()&&this.workspace.is_resizes_enabled()){var t=this.get_top_parent();if(!t.is_in_flyout&&(!_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)&&!this.is_include_special_input()||!this.is_collapsed()))for(var e=this.get_connections(!1),i=0;i<e.length;i++){var o=e[i],n=o.targetBlock();void 0!=n&&o.is_connected()&&o.is_superior()&&n.bump_neighbours();for(var r=o.neighbours_(this.theme.blink_params.SNAP_RADIUS),s=0;s<r.length;s++){var a=r[s];if(!o.is_connected()||!a.is_connected()){var c=a.get_source_block().get_top_parent();"hidden"!==(null===c||void 0===c?void 0:c.get_visibility())&&c!=t&&(o.is_superior()?a.bump_away_from(o):o.bump_away_from(a))}}}}},e.prototype.get_height_width=function(){var t=this.height,e=this.width;this.is_wrap_shape()&&!this.is_collapsed()&&this.inputList.forEach((function(t){if(t.type===s.InputType.STATEMENT&&t.connection){var i=t.connection.targetBlock();i&&(e=Math.max(e,i.get_height_width().width))}}));var i=this.get_full_next_block();if(this.is_collapsed()&&this.is_starting_block()&&(i=void 0),i){var o=i.get_height_width();t+=o.height,e=Math.max(e,o.width)}return{height:t,width:e}},e.prototype.get_blocks_svg_path_width=function(){var t=this.svg_path_width,e=this.get_next_block();return e&&(t=Math.max(t,e.get_blocks_svg_path_width())),t},e.prototype.tab=function(t,e){var i=this.create_tab_list(),o=t&&i.indexOf(t);"number"===typeof o&&-1!==o||(o=e?-1:i.length);var n=i[e?o+1:o-1];if(n)(0,d.is_func)(n.tab)?n.tab(void 0,e):(0,d.is_func)(n.show_editor)&&n.show_editor();else{var r=this.output_connection&&this.output_connection.targetBlock();if(r)r.tab(this,e);else{var s=e?this.get_next_block():this.get_previous_block();s&&s.tab(this,e)}}},e.prototype.create_tab_list=function(){for(var t=[],e=0;e<this.inputList.length;e++){for(var i=this.inputList[e],o=0;o<i.fieldRow.length;o++){var n=i.fieldRow[o];n.show_editor&&t.push(n)}if(i.connection){var r=i.connection.targetBlock();r&&t.push(r)}}return t},e.prototype.remove_input=function(t,e){for(var i=0;i<this.inputList.length;i++){var o=this.inputList[i];if(o.name==t){if(o.connection&&o.connection.is_connected()){o.connection.set_shadow_dom(void 0);var n=o.connection.targetBlock();n.is_shadow()?(this.events.disable(),n.dispose(),this.events.enable()):n.unplug()}return o.dispose(),this.inputList.splice(i,1),void(this.rendered&&this.render())}}e||console.warn("Input ".concat(t," not found.")),this.rendered&&this.render()},e.prototype.move_numbered_input_before=function(t,e){if(t==e)throw new Error("Can't move input to itself.");if(t>=this.inputList.length)throw new Error("Input index ".concat(t," out of bounds."));if(e>this.inputList.length)throw new Error("Reference input ".concat(e," out of bounds."));var i=this.inputList[t];this.inputList.splice(t,1),t<e&&e--,this.inputList.splice(e,0,i),this.rendered&&this.render()},e.prototype.is_render_notch=function(){return this.workspace.options.notch},e.prototype.get_visibility=function(){return this.visibility_},e.prototype.set_visibility=function(t){this.visibility_=t},e.prototype.set_chunk_visibility=function(t){var e,i=this.get_top_parent();i.visibility_!==t&&(this.events.is_enabled()&&(e=this.change_event_factory("visibility",{block:i,old_value:i.visibility_,new_value:t})),i.visibility_=t,e&&this.events.fire(e))},e.prototype.update_chunk_visibility=function(){if(!this.parent_block){this.events.disable();var t=this.get_top_parent(),e=t.get_descendants();(0,l.update_visibility_class)(t.svg_group,t.get_visibility());var i="hidden"!==t.get_visibility();t.set_connectable(i),t.comment&&t.comment.update_visibility(),e.forEach((function(e){e!==t&&e.visibility_!==s.BlockVisibility.VISIBLE&&(e.visibility_=s.BlockVisibility.VISIBLE,(0,l.update_visibility_class)(e.svg_group,s.BlockVisibility.VISIBLE),e.comment&&e.comment.update_visibility())})),this.events.enable()}},e.prototype.is_connectable=function(){return this.connectable_},e.prototype.set_connectable=function(t){this.connectable_=t},e.prototype.is_stack_connectable=function(){for(var t,e=this;e;){if(!e.is_connectable())return!1;e=null===(t=e.previous_connection)||void 0===t?void 0:t.targetBlock()}return!0},e.prototype.get_input_index=function(t){var e=this.get_input(t);return e?this.inputList.indexOf(e):-1},e.prototype.mutation_to_string=function(){if(!this.mutationToDom)return"";var t=this.mutationToDom();return t?this.xml.dom_to_text(t):""},e.prototype.string_to_mutation=function(t){if(this.domToMutation)if(t)this.domToMutation(this.xml.text_to_dom(t));else try{this.domToMutation(void 0)}catch(e){}},e.prototype.set_opacity=function(t){this.opacity=t,this.rendered&&this.update_colour()},e.prototype.to_dev_string=function(){var t=this.type?'"'.concat(this.type,'" block'):"Block";return this.id&&(t+=' (id="'.concat(this.id,'")')),t},e.prototype.is_rendered=function(){return this.rendered},e.prototype.set_rendered=function(t){this.rendered=t},e.prototype.set_category=function(t){this.category_=t},e.prototype.set_output_shape=function(t){this.output_shape=t},e.prototype.set_help_url=function(t){this.help_url=t},e.prototype.options_add_help=function(t){var e=this,i={enabled:!!((0,d.is_func)(this.help_url)?this.help_url():this.help_url),name:"help",text:this.Msg.HELP,callback:function(){e.show_help()}};t.push(i)},e.prototype.show_help=function(){this.help_url&&window.open(this.help_url)},e.prototype.sort=function(t){var e=this.get_relative_to_surface_xy();this.move_by(n.vec2.sub(e,t,e)),this.snap_to_grid(),n.vec2.add(t,t,[0,this.get_height_width().height+this.theme.renderer.MIN_HEIGHT])},e.prototype.for_each_descendant_element=function(t,e){var i;if(void 0===e&&(e=!1),t(this),this.comment&&t(this.comment),e){for(n=0;n<this.inputList.length;n++){(r=null===(i=this.inputList[n].connection)||void 0===i?void 0:i.targetBlock())&&r.for_each_descendant_element(t,!0)}var o=this.get_next_block();o&&o.for_each_descendant_element(t,!0)}else for(var n=0;n<this.child_blocks.length;n++){var r;(r=this.child_blocks[n]).for_each_descendant_element(t,!1)}},e.prototype.get_original_colour=function(){return this.colour_},e.prototype.get_border_colour=function(){var t;return this.is_shadow()&&"param"!==this.element_type&&"param_color"!==this.element_type?(null===(t=this.parent_block)||void 0===t?void 0:t.get_border_colour())||this.theme.block_color.DEFAULT.border:this.border_colour},e.prototype.get_stroke_width=function(){return this.is_shadow()&&"param"!==this.element_type&&"param_color"!==this.element_type?this.is_editable()&&this.is_text_shadow()?this.theme.shadow_style.BORDER:this.theme.shadow_style.NO_BORDER:"1px"},e.prototype.get_colour=function(){var t,e;if(this.is_shadow()&&"param"!==this.element_type&&"param_color"!==this.element_type)return this.is_editable()?this.theme.shadow_style.SHADOW_COLOR:this.theme.shadow_style.EMPTY_COLOR;if((this.disabled||this.get_inherited_disabled())&&!this.prevent_disable_style_change)return this.theme.disabled_color.fill;if(this.layer_colour&&this.is_output_block()&&(null===(t=this.parent_block)||void 0===t?void 0:t.get_colour())===this.colour_)return this.layer_colour;if(!this.is_editable()){var i=(null===(e=this.get_parent())||void 0===e?void 0:e.get_colour())||this.colour_;return(0,u.darken)(i,.1)}return this.colour_},e.prototype.set_colour_by_key=function(t){var e=t&&this.theme.get_color(t);e&&this.set_colour(e.fill,e.border,e.layer)},e.prototype.set_colour_from_json=function(t){this.set_colour_by_key(t.colour)},e.prototype.set_colour=function(t,e,i){this.colour_="string"===typeof t?new u.Color(t):t,this.border_colour=void 0!=e?"string"===typeof e?new u.Color(e):e:(0,u.darken)(this.colour_,.1),this.layer_colour=void 0!=i?"string"===typeof i?new u.Color(i):i:void 0,this.rendered&&this.update_colour()},e.prototype.update_colour=function(){if(!this.svg_path)throw new ReferenceError("Cannot update color without svg path.");this.svg_path.setAttribute("fill",this.get_colour().toString()),this.svg_path.setAttribute("stroke",this.get_border_colour().toString()),this.svg_path.setAttribute("stroke-opacity","1"),this.svg_path.setAttribute("stroke-width",this.get_stroke_width()),this.warning&&this.warning.update_colour()},e.prototype.update_layer_colour=function(){if(!this.disabled&&!this.get_inherited_disabled()&&this.is_output_block()&&this.svg_path){var t=this.get_colour().toString();this.svg_path.getAttribute("fill")!==t&&this.svg_path.setAttribute("fill",t);for(var e=0;e<this.child_blocks.length;e++){this.child_blocks[e].update_layer_colour()}}},o.__decorate([(0,r.lazy_inject)(r.BINDING.Blink)],e.prototype,"Blink",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.context_menu)],e.prototype,"context_menu",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.extensions)],e.prototype,"extensions",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.Msg)],e.prototype,"Msg",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.xml)],e.prototype,"xml",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.RenderedConnection)],e.prototype,"RenderedConnection",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.registry)],e.prototype,"registry",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldLabel)],e.prototype,"field_label_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldLabelSerializable)],e.prototype,"field_label_serializable_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldColour)],e.prototype,"field_colour_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldDropdown)],e.prototype,"field_dropdown_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldIcon)],e.prototype,"field_icon_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldButton)],e.prototype,"field_button_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.MutationAddButton)],e.prototype,"mutation_add_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.MutationRemoveButton)],e.prototype,"mutation_remove_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldNumber)],e.prototype,"field_number_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldTextDropdown)],e.prototype,"field_text_dropdown_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldTextInput)],e.prototype,"field_text_input_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldDefaultValue)],e.prototype,"field_default_value",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldImage)],e.prototype,"field_image_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldMultilineInput)],e.prototype,"field_multiline_input",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldLimitLengthInput)],e.prototype,"field_limit_length_input",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.Input)],e.prototype,"input_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.RenderedConnection)],e.prototype,"connection_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.ChangeEvent)],e.prototype,"change_event_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.WorkspaceComment)],e.prototype,"workspace_comment_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.BlockGroup)],e.prototype,"block_group_factory",void 0),e}(i(23257).WorkspaceElement);e.BlockSvg=v},15020:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Field=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=i(75102),a=i(11214),c=i(25461),l=i(74370),d=i(22804),u=function(){function t(t,e){var i;void 0===t&&(t=""),this.field_type="Field",this.editable=!0,this.visible_=!0,this.size_=new a.Size(0,0),this.text_="",this.name=void 0,this.margin_left=this.theme.renderer.SEP_SPACE_X,this.render_sep=this.margin_left,this.validator_=void 0,this.uneditable=!1,this.highlight=!1,this.set_value(t),this.validator_=e,this.max_display_length=(null===(i=this.workspace_db.current)||void 0===i?void 0:i.get_options().field_max_length)||50,this.value_before_editing=void 0}return t.prototype.set_validator=function(t){this.validator_=t},t.prototype.get_validator=function(){return this.validator_},t.prototype.set_value=function(t,e){var i,o=this.get_value();o!=t&&(this.source_block&&this.events.is_enabled()&&this.runtime_data.editing!==this&&(i=this.change_event_factory("field",{block:this.source_block,old_value:o,new_value:t,name:this.name})),this.set_text(t),i&&this.events.fire(i))},t.prototype.set_text=function(t){t!==this.text_&&(this.text_=t,this.force_rerender())},t.prototype.force_rerender=function(){this.size_.width=0,this.source_block&&this.source_block.rendered&&(this.source_block.is_collapsed()?this.source_block.update_collapsed(!0):this.source_block.render())},t.prototype.get_text=function(){return this.text_},t.prototype.get_value=function(){return this.text_},t.prototype.init=function(t,e){if(void 0===t&&(t=!0),!this.field_group&&this.source_block){if(this.field_group=(0,c.create_svg_element)("g",{}),this.visible_||(this.field_group.style.display="none"),this.source_block.is_shadow()||(this.border_rect=(0,c.create_svg_element)("rect",{rx:4,ry:4},this.field_group)),t&&(this.input_element=(0,c.create_svg_element)("g",{class:"blocklyInputElement"},this.field_group),d.is.safari()||d.is.mobile()?this.text_element=(0,c.create_svg_element)("text",{class:"blocklyText",dy:".4em","font-size":this.theme.font.SIZE},this.input_element):this.text_element=(0,c.create_svg_element)("text",{class:"blocklyText","dominant-baseline":"central","font-size":this.theme.font.SIZE},this.input_element)),this.update_editable(),void 0!=this.source_block){var i=this.source_block.get_svg_root();if(void 0==i)throw new ReferenceError("Field should have svg root when init.");i.appendChild(this.field_group)}this.bind_field_click_event(),!e&&this.render_()}},t.prototype.bind_field_click_event=function(){if(this.field_group&&this.source_block){var t=this.source_block.is_shadow()?this.field_group.parentElement:this.field_group;t?(this.mouse_down_wrapper=this.events.bind_event_with_checks(t,"mouseup",this,this.on_mouse_down),this.right_click_wrapper=this.events.bind_event_with_checks(t,"mousedown",this,this.on_right_click)):console.warn("Field has no parent element.")}},t.prototype.get_scaled_bbox=function(){if(void 0==this.source_block)throw new ReferenceError("Field has not been insert to workspace.");var t=this.source_block.get_workspace();if(void 0==t)throw new ReferenceError("Field's source block has not been insert to workspace.");if(!this.field_group)return new a.Size(0,0);var e=(0,c.get_size_attr)(this.border_rect||this.field_group),i=t.get_scale();return new a.Size(e.width*i,e.height*i)},t.prototype.update_editable=function(){var t=this.field_group;if(this.editable&&t){if(!this.source_block||!this.field_group)throw new Error("no necessary elements.");var e="blocklyEditable",i="blocklyNonEditable";this.source_block.is_editable()?((0,c.add_class)(t,e),(0,c.remove_class)(t,i)):((0,c.add_class)(t,i),(0,c.remove_class)(t,e),this.field_group.style.cursor="")}},t.prototype.on_mouse_down=function(t){if(this.source_block&&this.source_block.get_workspace()&&!this.source_block.is_in_flyout){this.tooltip&&this.tooltip.hide();var e=this.source_block.get_workspace().get_gesture(t);e&&e.set_start_field(this)}},t.prototype.on_right_click=function(t){if((0,l.is_right_button)(t)&&this.source_block&&this.source_block.get_workspace()&&!this.source_block.is_in_flyout){this.tooltip&&this.tooltip.hide();var e=this.source_block.get_workspace().get_gesture(t);e&&e.set_selected_field(this)}},t.prototype.is_currently_editable=function(){return this.editable&&!!this.source_block&&this.source_block.is_editable()},t.prototype.get_size=function(){return this.size_.width||this.render_(),this.size_},t.prototype.layout=function(t,e){if(void 0!=this.field_group){t[0]+=this.render_sep;var i=t[0],o=t[1]+(e-this.size_.height)/2,n=(0,c.get_translate)(this.field_group);n&&n.x===i&&n.y===o||this.field_group.setAttribute("transform","translate(".concat(i,",").concat(o,")")),t[0]+=this.size_.width}},t.prototype.dispose=function(){this.mouse_down_wrapper&&(this.events.unbind_event(this.mouse_down_wrapper),this.mouse_down_wrapper=void 0),this.right_click_wrapper&&(this.events.unbind_event(this.right_click_wrapper),this.right_click_wrapper=void 0),delete this.source_block,void 0!=this.field_group&&((0,c.remove_node)(this.field_group),this.field_group=void 0),(this.input_element||this.text_element)&&(this.input_element&&(0,c.remove_node)(this.input_element),this.text_element&&(0,c.remove_node)(this.text_element),delete this.text_element,delete this.input_element),this.validator_=void 0},t.prototype.render_=function(){var t,e;this.visible_?this.image_element?this.size_.width=parseFloat(this.image_element.getAttribute("width")||"0")||0:this.text_element?((0,c.remove_children)(this.text_element),this.text_element.appendChild(document.createTextNode(this.get_display_text())),this.update_width(),this.update_height(),null===(t=this.border_rect)||void 0===t||t.setAttribute("width","".concat(this.size_.width)),null===(e=this.border_rect)||void 0===e||e.setAttribute("height","".concat(this.size_.height))):this.size_.width=0:this.size_.width=0},t.prototype.update_width=function(){this.text_element&&(this.size_.width=this.utils.get_cached_width(this.text_element))},t.prototype.update_height=function(){this.source_block&&(this.size_.height=this.source_block.is_shadow()?this.theme.renderer.SHADOW_FIELD_HEIGHT:this.theme.renderer.FIELD_HEIGHT)},t.prototype.get_absolute_xy=function(){var t=this.border_rect||this.field_group;return t?(0,c.get_page_offset)(t):r.vec2.create()},t.prototype.get_svg_root=function(){return this.field_group},t.prototype.show_editor=function(t,e){throw new ReferenceError("show_editor \u4e0d\u80fd\u5728 field \u4e2d\u8c03\u7528\uff0c\u9700\u8981\u7531\u5b50\u7c7b\u5b9e\u73b0")},t.prototype.set_visible=function(t){if(this.visible_!=t){this.visible_=t;var e=this.get_svg_root(),i=this.input_element||this.text_element;e&&(e.style.display=t?"block":"none",this.render_()),i&&(i.style.display=t?"block":"none",this.render_())}},t.prototype.get_display_text=function(){var t=this.text_;return t?(t.length>this.max_display_length&&(t="".concat(t.substring(0,this.max_display_length-2),"\u2026")),t=t.replace(/\s/g,"\xa0")):"\xa0"},t.prototype.call_validator=function(t){if(void 0!=t){if(!this.validator_)return t;var e=this.validator_.call(this,t);if(void 0!=e)return e}},t.prototype.set_html_input_value=function(t){this.html_input&&(this.html_input.value=t)},t.prototype.focus=function(t){if(void 0===t&&(t=!0),this.source_block){var e=this.runtime_data.editing;t?(this.value_before_editing=this.get_value(),this.runtime_data.editing=this):(this.value_before_editing=void 0,this.runtime_data.editing=void 0);var i=this.runtime_data.editing;e&&e!==i&&this.events.is_enabled()&&(e.value_before_editing?(e.value_before_editing=void 0,this.events.fire(this.ui_event_factory({type:_.UIEventType.FIELD_FOCUS_CHANGE,workspace_id:this.source_block.workspace.id,old_value:void 0,new_value:this.name,block_id:this.source_block.id}))):this.events.fire(this.ui_event_factory({type:_.UIEventType.FIELD_FOCUS_CHANGE,workspace_id:this.source_block.workspace.id,old_value:this.name,new_value:void 0,block_id:this.source_block.id}))),i&&i!==e&&this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:_.UIEventType.FIELD_FOCUS_CHANGE,workspace_id:this.source_block.workspace.id,old_value:void 0,new_value:this.name,block_id:this.source_block.id}))}},t.prototype.set_uneditable=function(t){this.uneditable=t},t.prototype.set_highlight=function(t){this.highlight=t},t.prototype.is_uneditable=function(){return this.uneditable},t.prototype.is_highlight=function(){return this.highlight},o.__decorate([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.tooltip)],t.prototype,"tooltip",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.ChangeEvent)],t.prototype,"change_event_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Field=u},48979:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldButton=void 0;var o=i(98734),n=i(61455),r=i(61972),s=i(25461),_=i(22804),a=function(t){function e(e){var i=t.call(this,e)||this;return i.field_type="FieldButton",i.image_width=i.width_,i.image_height=i.height_,i.has_circle=e.has_circle,i.click_handler_=e.opt_callback,i.has_circle&&(i.image_width=.6*i.width_,i.image_height=.6*i.height_),i}return o.__extends(e,t),e.prototype.update_height=function(){this.size_.height=this.height_},e.prototype.init=function(){var t=this;if(!this.field_group){if(this.field_group=(0,s.create_svg_element)("g",{class:"fieldButton",cursor:"default"},void 0),this.visible_||(this.field_group.style.display="none"),this.has_circle&&(this.circle_element=(0,s.create_svg_element)("rect",{width:this.width_,height:this.height_,rx:this.width_/2,ry:this.width_/2,stroke:"rgba(0, 0, 0, .15)",fill:"rgba(255, 255, 255, .15)"},this.field_group),this.events.bind_event_with_checks(this.field_group,"mousedown",this,(function(){t.circle_element&&(t.circle_element.style.fill="rgba(0, 0, 0, .15)")}))),"string"===typeof this.src_?(this.image_element=(0,s.create_svg_element)("image",{height:"".concat(this.image_height,"px"),width:"".concat(this.image_width,"px")},this.field_group),this.set_value(this.src_)):(this.image_element=(0,s.create_svg_element)("g",{height:"".concat(this.height_,"px"),width:"".concat(this.width_,"px")},this.field_group),this.image_element.appendChild(this.src_)),_.is.firefox()&&(this.rect_element=(0,s.create_svg_element)("rect",{height:"".concat(this.height_,"px"),width:"".concat(this.width_,"px"),"fill-opacity":0},this.field_group)),void 0==this.source_block)throw new ReferenceError("Field should have source block when init.");this.source_block.get_svg_root().appendChild(this.field_group),this.events.bind_event_with_checks(this.field_group,"mouseup",this,this.on_click),this.mouse_down_wrapper=this.events.bind_event_with_checks(this.field_group,"mousedown",this,this.on_mouse_down)}},e.prototype.on_click=function(t){if(this.source_block){this.circle_element&&(this.circle_element.style.fill="rgba(255, 255, 255, .15)");var e=this.source_block.get_workspace().get_gesture(t);e&&e.is_dragging_block?e.handle_up(t):this.source_block.is_in_flyout||this.utils.is_right_button(t)||(e&&(e.update_is_mutation_click(!0),e.handle_up(t)),this.click_handler_&&this.click_handler_(this))}},e.prototype.get_img_scale=function(){return 1},e.prototype.layout=function(t,e){if(this.source_block&&(t[0]+=this.render_sep,!(0,r.is_nil)(this.image_element))){var i=this.get_img_scale(),o=Number(((1-i)*this.size_.width/2).toFixed(2)),n=this.source_block.previous_connection?4*o:3*o,s=1.5*o,_=(this.width_-this.image_width)/2,a=(this.height_-this.image_height)/2;this.circle_element&&this.circle_element.setAttribute("transform","scale(".concat(i,") translate(").concat(t[0]+n,", ").concat(t[1]+e/2-this.height_/2+s,")")),this.image_element.setAttribute("transform","scale(".concat(i,") translate(").concat(t[0]+n+_,", ").concat(t[1]+e/2-this.height_/2+s+a,")")),t[0]+=this.size_.width}},e=o.__decorate([(0,n.injectable)()],e)}(i(25939).FieldImage);e.FieldButton=a},94492:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldColour=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(25461),_=i(61972),a=i(12988),c=i(11214),l=function(t){function e(e){var o=t.call(this,e.colour,e.opt_validator)||this;return o.field_type="FieldColour",o.colour_=i.OVERRIDE_COLOR||"#cc33cc",o.size_=new c.Size(40,30),o.colour_=e.colour,o}var i;return o.__extends(e,t),i=e,e.prototype.init=function(){var e,i=this;t.prototype.init.call(this,!1),this.border_rect||(this.border_rect=(0,s.create_svg_element)("rect",{rx:4,ry:4},this.field_group)),this.border_rect.setAttribute("width",String(this.size_.width)),this.border_rect.setAttribute("height",String(this.size_.height)),this.border_rect.setAttribute("stroke","#fff"),this.border_rect.setAttribute("stroke-width","1.5"),this.border_rect.setAttribute("rx","15"),this.border_rect.setAttribute("ry","15"),this.border_rect.addEventListener("mouseover",(function(){i.runtime_data.editing!==i&&i.border_rect&&i.border_rect.setAttribute("stroke-width","3")})),this.border_rect.addEventListener("mouseleave",(function(){i.runtime_data.editing!==i&&i.border_rect&&i.border_rect.setAttribute("stroke-width","1.5")})),this.background_transparent_element||(this.background_transparent_element=(0,s.create_svg_element)("rect",{rx:15,ry:15,width:40,height:30,fill:"url(#transparentPattern)"}),null===(e=this.field_group)||void 0===e||e.insertBefore(this.background_transparent_element,this.border_rect)),this.set_value(this.get_value())},e.prototype.get_value=function(){return this.colour_},e.prototype.set_value=function(t){var e,i;this.source_block&&this.events.is_enabled()&&this.colour_!=t&&(i=this.change_event_factory("field",{block:this.source_block,old_value:this.colour_,new_value:t,name:this.name})),this.colour_=t,null===(e=this.border_rect)||void 0===e||e.setAttribute("fill",this.colour_),i&&this.events.fire(i)},e.prototype.render_=function(){(0,_.is_nil)(this.field_group)||this.border_rect&&this.field_group.appendChild(this.border_rect)},e.prototype.show_editor=function(){var t,e=this;this.widget_div.show(this,this.widget_dispose.bind(this)),this.border_rect&&(this.border_rect.setAttribute("stroke-width","3"),this.border_rect.setAttribute("filter","url(#hiblur)"));var o=document.createElement("div");o.classList.add("color_selector","clearfix"),i.COLOURS.forEach((function(t){var e=document.createElement("i");e.classList.add("color_selector_item"),e.dataset.value=t,e.style.background=t,o.appendChild(e)}));var n=(0,s.get_viewport_size)(),r=(0,a.get_viewport_page_offset)(document),c=this.get_absolute_xy(),l=this.get_scaled_bbox();this.widget_div.DIV.appendChild(o);var d=(0,a.get_size)(o);c[1]+d.height+l.height>=n.height+r[1]?c[1]-=d.height-1:c[1]+=l.height-1,c[0]>n.width+r[0]-d.width&&(c[0]=n.width+r[0]-d.width),this.widget_div.position(c[0],c[1],n,r,null===(t=this.source_block)||void 0===t?void 0:t.RTL),o.addEventListener("click",(function(t){var i=t.target;if(i.classList.contains("color_selector_item")){var o=i.dataset.value;e.widget_div.hide(),e.source_block&&(o=e.call_validator(o)),(0,_.is_nil)(o)||e.set_value(o)}}))},e.prototype.widget_dispose=function(){this.focus(!1),this.border_rect&&(this.border_rect.setAttribute("stroke-width","1.5"),this.border_rect.removeAttribute("filter")),this.events.set_group(!1)},e.prototype.layout=function(t,e){void 0!=this.field_group&&(t[0]+=this.render_sep,this.field_group.setAttribute("transform","translate(".concat(t[0],", ").concat(t[1]+(e-this.size_.height)/2,")")),t[0]+=this.size_.width)},e.COLUMNS=7,e.COLOURS=["#ffffff","#cccccc","#c0c0c0","#999999","#666666","#333333","#000000","#ffcccc","#ff6666","#ff0000","#cc0000","#990000","#660000","#330000","#ffcc99","#ff9966","#ff9900","#ff6600","#cc6600","#993300","#663300","#ffff99","#ffff66","#ffcc66","#ffcc33","#cc9933","#996633","#663333","#ffffcc","#ffff33","#ffff00","#ffcc00","#999900","#666600","#333300","#99ff99","#66ff99","#33ff33","#33cc00","#009900","#006600","#003300","#99ffff","#33ffff","#66cccc","#00cccc","#339999","#336666","#003333","#ccffff","#66ffff","#33ccff","#3366ff","#3333ff","#000099","#000066","#ccccff","#9999ff","#6666cc","#6633ff","#6600cc","#333399","#330099","#ffccff","#ff99ff","#cc66cc","#cc33cc","#993399","#663366","#330033"],o.__decorate([(0,r.lazy_inject)(r.BINDING.widget_div)],e.prototype,"widget_div",void 0),e=i=o.__decorate([(0,n.injectable)()],e)}(i(15020).Field);e.FieldColour=l},87546:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldDefaultValue=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(25461),_=function(t){function e(e){var i=t.call(this,{text:e.enable_empty?e.default_value:e.default_value||"0",opt_validator:e.opt_validator})||this;return i.has_been_edited=!1,i.enable_empty=!1,i.field_type="FieldDefaultValue",void 0!==e.enable_empty&&(i.enable_empty=e.enable_empty),i}return o.__extends(e,t),e.prototype.get_has_been_edited=function(){return this.has_been_edited},e.prototype.set_has_been_edited=function(t){if(t!==this.has_been_edited){if(this.source_block&&this.events.is_enabled()){var e=this.events.get_group();this.events.set_group(e||!0),this.events.fire(this.change_event_factory("field_default_value",{block:this.source_block,old_value:this.has_been_edited,new_value:t,name:this.name}))}this.has_been_edited=t,this.rerender()}},e.prototype.rerender=function(){this.text_element&&(this.has_been_edited?(0,s.remove_class_if_necessary)(this.text_element,"blocklyTextDefault"):(0,s.add_class)(this.text_element,"blocklyTextDefault"))},e.prototype.on_html_input_change=function(){this.set_has_been_edited(!0),t.prototype.on_html_input_change.call(this)},e.prototype.get_validated_value=function(t,e){return this.enable_empty||t?t:e},e.prototype.widget_dispose=function(){var e=this;return function(){if(e.html_input){var i=e.get_validated_value(e.html_input.value,e.html_input.defaultValue);t.prototype.widget_dispose.call(e,i)()}}},e.prototype.init=function(){t.prototype.init.call(this),this.text_element&&(this.has_been_edited||(0,s.add_class)(this.text_element,"blocklyTextDefault"))},o.__decorate([(0,r.lazy_inject)(r.BINDING.widget_div)],e.prototype,"widget_div",void 0),e=o.__decorate([(0,n.injectable)()],e)}(i(88891).FieldTextInput);e.FieldDefaultValue=_},5527:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldDropdown=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(75102),_=i(25461),a=i(57754),c=i(61972),l=i(56905),d=i(12988),u=i(11214),h=i(15020),p=i(82406),g=function(t){function e(e){var i=t.call(this,void 0,e.opt_validator)||this;i.field_type="FieldDropdown",i.value_="?",i.prefix_field=void 0,i.suffix_field=void 0,i.generate_customized_dropdown=void 0,i.menu_generator=e.menu_generator,i.menu_generator_advanced=e.menu_generator_advanced;for(var o=i.get_advanced_options()?i.get_expanded_advanced_options():i.get_basic_options(),n=(0,c.is_func)(e.selected_index)?e.selected_index():e.selected_index||0;o[n]&&(!i.get_option_value(o[n])||i.get_option_callback(o[n]));)n++;var r=o[n]&&i.get_option_value(o[n])||"?";return i.trim_options(),i.set_value(r),i.onchange=e.opt_onchange,i}return o.__extends(e,t),e.prototype.init=function(){this.source_block&&(this.arrow_=(0,p.draw_arrow)(this.source_block.workspace.options.dropdown.arrow_type),t.prototype.init.call(this),this.source_block.is_shadow()&&this.source_block.get_svg_root().classList.add("blocklyShadowDropdown"),this.field_group&&this.field_group.classList.add("blocklyFieldDropdown"))},e.prototype.bind_field_click_event=function(){if(this.source_block)if(this.source_block.is_shadow()){var e=this.source_block.get_svg_root();this.mouse_down_wrapper=this.events.bind_event_with_checks(e,"mouseup",this,this.on_mouse_down),this.right_click_wrapper=this.events.bind_event_with_checks(e,"mousedown",this,this.on_right_click)}else t.prototype.bind_field_click_event.call(this)},e.prototype.render_=function(){var t,e;if(this.visible_&&this.source_block){if(this.field_group&&this.arrow_){(0,_.remove_children)(this.field_group);var i=this.source_block.workspace.options.dropdown.padding,o=this.source_block.workspace.options.dropdown.padding+6;this.size_.width=this.border_rect?i:o,this.update_height(),this.render_border(),this.render_image_element(),this.render_text_element(),this.field_group.appendChild(this.arrow_),this.size_.width+=i;var n=this.border_rect?this.size_.width:this.size_.width-2,r=this.size_.height/2-7;this.arrow_.setAttribute("transform","translate(".concat(n,", ").concat(r,")")),this.size_.width+=12+i,this.change_editor_style(!1),this.source_block.is_shadow()?this.render_shadow_style():this.render_not_shadow_style(),null===(t=this.border_rect)||void 0===t||t.setAttribute("height",String(this.size_.height)),null===(e=this.border_rect)||void 0===e||e.setAttribute("width",String(this.size_.width))}}else this.size_.width=0},e.prototype.render_border=function(){this.field_group&&this.border_rect&&this.field_group.appendChild(this.border_rect)},e.prototype.render_not_shadow_style=function(){this.source_block&&this.arrow_&&(this.arrow_.style.fill=this.source_block.get_colour().toString())},e.prototype.render_shadow_style=function(){var t=this,e=function(){var e=t.source_block&&t.source_block.get_parent();e&&t.arrow_&&(t.arrow_.style.fill=e.get_colour().toString())};this.events.is_record_undo()?e():window.setTimeout(e)},e.prototype.render_text_element=function(){var t=this.get_display_text();if(t.trim()){var e;a.is.safari()||a.is.mobile()?this.text_element=(0,_.create_svg_element)("text",{class:"blocklyText",dy:".4em","font-size":this.theme.font.SIZE},this.field_group):this.text_element=(0,_.create_svg_element)("text",{class:"blocklyText","dominant-baseline":"central","font-size":this.theme.font.SIZE},this.field_group);var i=document.createTextNode(t);this.text_element.appendChild(i),this.text_element.setAttribute("text-anchor","start"),this.text_element.setAttribute("y",String(this.size_.height/2));var o=this.border_rect?this.size_.width:this.size_.width-2;return this.text_element.setAttribute("x",String(o)),e=this.utils.get_cached_width(this.text_element),e=this.update_min_width(e),this.size_.width+=e,e}},e.prototype.update_min_width=function(t){if(!this.text_element)return 20;if(t>=20)return t;var e=this.text_element.getAttribute("x"),i=(20-t)/2;return this.text_element.setAttribute("x",String(Number(e)+i)),20},e.prototype.render_image_element=function(){var t;if((0,l.assert)(this.field_group),this.image_json&&!(null===(t=this.image_json)||void 0===t?void 0:t.is_hide)){this.image_element=this.create_image(this.image_json),this.field_group.appendChild(this.image_element),this.image_element.setAttribute("x","".concat(this.size_.width)),this.image_element.setAttribute("y","".concat((this.size_.height-Number(this.image_element.getAttribute("height")))/2));var e="number"===typeof this.image_json.margin_right?this.image_json.margin_right:2;this.size_.width+=Number(this.image_element.getAttribute("width"))+e}},e.prototype.get_value=function(){return this.value_},e.prototype.show_editor=function(){var t=this;if(this.source_block)if(this.source_block.show_editor){this.source_block.show_editor((function(e){t.set_value(e)}),this.value_)}else{var e;if(!this.show_editor_extend(this))this.change_editor_style(!0),this.generate_customized_dropdown?e=this.generate_customized_dropdown():(e=this.create_dropdown_element(this.get_advanced_options()||this.get_basic_options(),this.name),this.update_widget_div_position(e))}},e.prototype.create_image=function(t){var e="string"===typeof t.src?(0,_.create_svg_element)("image",{"xlink:href":t.src,width:"100%",height:"100%"}):"number"===typeof t.src?(0,_.get_num_g)(t.src):(0,_.clone_node)(t.src,!0),i=t.width||e.getAttribute("width")||16,o=t.height||Number(e.getAttribute("height"))||16,n=(0,_.create_svg_element)("svg",{width:i,height:o});return n.appendChild(e),n},e.prototype.create_menu_item_div=function(t,e,i,o,n,r,s){var a=this;void 0===r&&(r=!0);var c=(0,_.create_div_element)();if(i){var l=this.create_image(i),d="number"===typeof i.margin_right?i.margin_right:2;l.style.marginRight="".concat(d,"px"),c.appendChild(l)}var u=document.createElement("span");return u.innerText=t,c.appendChild(u),c.classList.add("menu-item"),r||c.classList.add("menu_item_disable"),o&&c.classList.add("menu_button"),c.dataset.value=e,e===this.value_&&(c.classList.add("menu_item_selected"),null===n||void 0===n||n.classList.add("menu_item_selected")),s&&(c.tooltip=s,this.tooltip.bind_mouse_event(c)),c.addEventListener("click",(function(t){r&&(t.stopImmediatePropagation(),t.preventDefault(),o?o.call(a.set_value.bind(a)):void 0!==e&&a.set_value(e),a.widget_div.hide_if_owner(a),a.tooltip.hide(),a.events.set_group(!1))})),(o||void 0!==e&&r)&&(c.addEventListener("touchstart",(function(){c.classList.add("menu_touch_effect")})),c.addEventListener("touchend",(function(){c.classList.remove("menu_touch_effect")}))),c},e.prototype.create_menu_item=function(t,e){var i=this;if(!(0,c.is_old_dropdown_option)(t)&&"basic"===t.type)return this.create_menu_item_div(t.text,t.value,t.icon,t.callback,e,t.enabled,t.tooltip);if(!(0,c.is_old_dropdown_option)(t)&&"group"===t.type){var o=this.create_menu_item_div(t.name,void 0,void 0,void 0,e);o.classList.add("menu_group"),o.dataset.group_key=t.value||(0,u.gen_uid)();var n=this.create_dropdown_element(t.options,void 0,o);n.classList.add("menu_group_children"),n.dataset.group_key=o.dataset.group_key,o.addEventListener("mouseover",(function(t){t.stopPropagation(),i.update_group_children_div_position(n,o),o.classList.add("menu_group_expanded")}));var r=function(t){t.stopPropagation(),t.relatedTarget&&((0,_.is_parent)(n,t.relatedTarget)||(0,_.is_parent)(o,t.relatedTarget))||((0,_.remove_node)(n),o.classList.remove("menu_group_expanded"))};return o.addEventListener("mouseout",r),n.addEventListener("mouseout",r),o}if(!(0,c.is_old_dropdown_option)(t)&&"image_plus"===t.type){var a=void 0===t.index?void 0:"number"===typeof t.index?{src:t.index}:t.index,l=this.create_menu_item_div(t.text||"",t.value,a,t.callback,e,t.enabled,t.tooltip);l.classList.add("menu_item_image_plus");var d=this.create_image(t.image_plus),h=document.createElement("div");return h.classList.add("image_plus"),h.appendChild(d),l.lastElementChild&&(0,_.insert_before)(h,l.lastElementChild),l}if(!(0,c.is_old_dropdown_option)(t)&&"line"===t.type){var p=document.createElement("div");return p.classList.add("dropdown_divider"),p}return this.create_menu_item_div(t[s.OptionTypes.TEXT],t[s.OptionTypes.VALUE],t[s.OptionTypes.ICON],t[s.OptionTypes.TRIGGER_EVENT],e)},e.prototype.create_dropdown_element=function(t,e,i){var o=document.createElement("div");o.classList.add("blocklyDropdownMenu"),o.classList.add("menu-wrapper"),this.source_block&&o.classList.add(this.source_block.type),e&&o.classList.add(e);for(var n=0;n<t.length;n++)o.appendChild(this.create_menu_item(t[n],i));return o},e.prototype.update_group_children_div_position=function(t,e){document.body.appendChild(t);var i=(0,d.get_size)(t),o=(0,d.get_size)(e),n=e.getBoundingClientRect(),r=n.left,s=n.top,_=parseFloat((0,d.get_computed_style)(t,"padding-top"))||0,a=parseFloat((0,d.get_computed_style)(t,"padding-bottom"))||0;if(s+i.height-_>=window.innerHeight){var c=t.lastElementChild&&(0,d.get_size)(t.lastElementChild).height||0;s-=i.height,s+=a,s+=c}else s-=_;r+o.width+i.width>=window.innerWidth?r-=i.width:r+=o.width,t.style.left="".concat(r,"px"),t.style.top="".concat(s,"px")},e.prototype.update_widget_div_position=function(t){var e=this;this.widget_div.show(this,(function(){e.focus(!1),e.change_editor_style(!1),Array.from(document.querySelectorAll(".menu_group_children")).forEach((function(t){return(0,_.remove_node)(t)}))}));var i=this.widget_div.DIV;null===i||void 0===i||i.appendChild(t);var o=(0,p.position_dropdown)(t,this);this.widget_div.position(o[0],o[1])},e.prototype.show_editor_extend=function(t){return!1},e.prototype.change_editor_style=function(t){if(this.source_block){if(t)return!this.source_block.is_shadow()&&this.field_group&&this.field_group.setAttribute("data-showing","true"),void(this.source_block.is_shadow()&&this.source_block.svg_group.setAttribute("data-showing","true"));this.field_group&&this.field_group.removeAttribute("data-showing"),this.source_block.is_shadow()&&this.source_block.svg_group.removeAttribute("data-showing")}},e.prototype.set_value=function(t){if(this.get_advanced_options()||this.get_basic_options())if(void 0!=t){var e=this.get_option(t),i=e&&this.get_option_text(e)||"";if(t!==this.value_||i!==this.text_){var o,n=this.events.get_group();if(this.source_block&&(this.events.is_enabled()&&(!n&&this.events.set_group(!0),o=this.change_event_factory("field",{block:this.source_block,old_value:this.value_,new_value:t,old_text:this.text_,new_text:i,name:this.name})),this.onchange&&this.onchange(t)),this.value_=t,e){var r=this.get_option_icon(e);return r===this.image_json&&i===this.text_||(this.image_json=r,this.text_=i,this.force_rerender()),void(this.events.is_enabled()&&o&&(this.events.fire(o),this.events.set_group(n)))}this.value_="?",this.image_json=void 0,this.set_text("?"),this.events.is_enabled()&&o&&(this.events.fire(o),this.events.set_group(n))}else this.change_editor_style(!1)}else this.change_editor_style(!1)},e.prototype.set_text=function(t,e){(t!==this.text_||e&&e!==this.image_json)&&(this.text_=t,e&&(this.image_json=e),this.force_rerender())},e.prototype.trim_options=function(){if(this.prefix_field=void 0,this.suffix_field=void 0,!this.is_dynamic()){for(var t=this.get_options(),e=!1,i=0;i<t.length;i++){var o=t[i][0];"string"==typeof o?t[i][0]=this.utils.replace_message_references(o):(o&&void 0!=o.alt&&(o.alt=this.utils.replace_message_references(o.alt)),e=!0)}if(!(e||t.length<2)){var n=[];for(i=0;i<t.length;i++)n.push(t[i][0]);var r=this.utils.common_word_prefix(n),s=this.utils.common_word_suffix(n);if(r||s){r&&(this.prefix_field=n[0].substring(0,r-1)),s&&(this.suffix_field=n[0].substr(1-s));var _=[];for(i=0;i<t.length;i++){var a=t[i][0],c=t[i][1];a=a.substring(r,a.length-s),_[i]=[a,c,void 0,void 0,void 0]}this.menu_generator=_}}}},e.prototype.get_basic_options=function(){return(0,c.is_func)(this.menu_generator)?this.menu_generator.call(this):this.menu_generator},e.prototype.get_advanced_options=function(){if(this.menu_generator_advanced)return(0,c.is_func)(this.menu_generator_advanced)?this.menu_generator_advanced.call(this):this.menu_generator_advanced},e.prototype.get_options=function(){var t=this.get_advanced_options();if(!t)return this.get_basic_options();var e=[];return t.forEach((function t(i){(0,c.is_old_dropdown_option)(i)?e.push(i):"group"===i.type&&i.options.forEach(t)})),e},e.prototype.get_expanded_advanced_options=function(){var t=this.get_advanced_options();if(!t)return[];var e=[];return t.forEach((function t(i){(0,c.is_old_dropdown_option)(i)||"group"!==i.type?e.push(i):i.options.forEach(t)})),e},e.prototype.get_option=function(t){var e=this;return function i(o){for(var n=0;n<o.length;n++){var r=o[n];if((0,c.is_old_dropdown_option)(r)||"group"!==r.type){if(e.get_option_value(r)===t)return r}else{var s=i(r.options);if(s)return s}}}(this.get_advanced_options()||this.get_basic_options())},e.prototype.get_option_value=function(t){if((0,c.is_old_dropdown_option)(t))return t[s.OptionTypes.VALUE];switch(t.type){case"image_plus":case"basic":return t.value;default:return}},e.prototype.get_option_text=function(t){if((0,c.is_old_dropdown_option)(t))return t[s.OptionTypes.TEXT];switch(t.type){case"group":return t.name;case"image_plus":case"basic":return t.text;default:return}},e.prototype.get_option_icon=function(t){if((0,c.is_old_dropdown_option)(t))return t[s.OptionTypes.ICON];switch(t.type){case"image_plus":return void 0===t.index?void 0:"number"===typeof t.index?isNaN(t.index)?void 0:{src:t.index}:t.index;case"basic":return t.icon;default:return}},e.prototype.get_option_callback=function(t){if((0,c.is_old_dropdown_option)(t))return t[s.OptionTypes.TRIGGER_EVENT];switch(t.type){case"basic":case"image_plus":return t.callback;default:return}},e.prototype.update_btn_style=function(){},e.prototype.register_dropdown=function(t){this.generate_customized_dropdown=t},e.prototype.is_dynamic=function(){return this.menu_generator_advanced?(0,c.is_func)(this.menu_generator_advanced):(0,c.is_func)(this.menu_generator)},o.__decorate([(0,r.lazy_inject)(r.BINDING.widget_div)],e.prototype,"widget_div",void 0),e=o.__decorate([(0,n.injectable)()],e)}(h.Field);e.FieldDropdown=g},75662:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldIcon=void 0;var o=i(98734),n=i(61455),r=i(25461),s=i(22804),_=i(11214),a=function(t){function e(e){var i=t.call(this,e)||this;return i.field_type="FieldIcon",i.width_=i.theme.renderer.HEAD_ICON_WIDTH,i.height_=i.theme.renderer.HEAD_ICON_WIDTH,i.size_=new _.Size(0,0),i.opt_is_head_=e.opt_is_head||!1,i.set_value(i.utils.replace_message_references(e.src)),i}return o.__extends(e,t),e.prototype.is_head=function(){return this.opt_is_head_},e.prototype.init=function(){if(!this.field_group){if(!1===this.opt_is_head_&&void 0!=this.source_block){if("*"===this.text_||""===this.text_)return;this.size_=new _.Size(this.width_,this.height_)}this.field_group=(0,r.create_svg_element)("g",{transform:"translate(-".concat(this.theme.renderer.HEAD_ICON_WRAP_WIDTH/2,", -").concat(this.theme.renderer.HEAD_ICON_WRAP_WIDTH-this.theme.renderer.MIN_HEIGHT,")")}),this.visible_||(this.field_group.style.display="none");var t=this.theme.renderer.HEAD_ICON_WRAP_WIDTH/2;if((0,r.create_svg_element)("circle",{cx:t,cy:t,r:t,fill:void 0!=this.source_block?this.source_block.get_colour():"",stroke:void 0!=this.source_block?this.source_block.get_border_colour():this.theme.block_color.DEFAULT.border,class:"blockly_head_icon_wrapper"},this.field_group),this.image_element=(0,r.create_svg_element)("image",{height:"".concat(this.height_,"px"),width:"".concat(this.width_,"px"),x:t-this.width_/2,y:t-this.height_/2,class:"blockly_head_icon"},this.field_group),this.set_value(this.src_),s.is.Gecko()&&(0,r.create_svg_element)("rect",{height:"".concat(this.height_,"px"),width:"".concat(this.width_,"px"),"fill-opacity":0},this.field_group),void 0==this.source_block)throw new ReferenceError("Field should have source block when init.");var e=this.source_block.get_svg_root();if(void 0==e)throw new ReferenceError("Field should have svg root when init.");e.appendChild(this.field_group)}},e.prototype.layout=function(t){return t},e=o.__decorate([(0,n.injectable)()],e)}(i(25939).FieldImage);e.FieldIcon=a},25939:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldImage=void 0;var o=i(98734),n=i(61455),r=i(61972),s=i(11214),_=i(25461),a=function(t){function e(e){var o=t.call(this,e.opt_alt)||this;return o.field_type="FieldImage",o.editable=!1,o.src_=e.src,o.width_=isNaN(Number(e.width))?i.DEFAULT_WIDTH:Number(e.width),o.height_=isNaN(Number(e.height))?o.width_:Number(e.height),o.size_=new s.Size(o.width_,o.height_+2*o.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_VALUE_BLOCK),o.text_="",o.tag=e.opt_tag||void 0,o}var i;return o.__extends(e,t),i=e,e.prototype.update_width=function(){this.size_.width=this.width_},e.prototype.update_height=function(){this.size_.height=this.height_+2*this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_VALUE_BLOCK},e.prototype.set_value=function(t){void 0!=t&&(this.src_=t,this.image_element&&this.image_element.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t||""))},e.prototype.init=function(){if(!this.field_group){if(this.field_group=(0,_.create_svg_element)("g",{}),this.visible_||(this.field_group.style.display="none"),"string"===typeof this.src_?(this.image_element=(0,_.create_svg_element)("image",{height:"".concat(this.height_,"px"),width:"".concat(this.width_,"px")},this.field_group),this.set_value(this.src_)):(this.image_element=this.src_,this.field_group.appendChild(this.image_element)),void 0==this.source_block)throw new ReferenceError("Field should have source block before init.");if(void 0!=this.source_block){var t=this.source_block.get_svg_root();if(void 0==t)throw new ReferenceError("Field should have svg root before init.");t.appendChild(this.field_group)}}},e.prototype.layout=function(t,e){if(this.source_block&&(t[0]+=this.render_sep,!(0,r.is_nil)(this.image_element))){if("quote_left"===this.tag||"quote_right"===this.tag){var i="quote_left"==this.tag?t[0]-4:t[0]-6;return this.image_element.classList.add("blocklyQuote"),void this.image_element.setAttribute("transform","translate(".concat(i,", ").concat(t[1]+6,")"))}var o=this.get_img_scale(),n=Number(((1-o)*this.size_.width/2).toFixed(2)),s=this.source_block.previous_connection?4*n:3*n,_=1.5*n;this.image_element.setAttribute("transform","scale(".concat(o,") translate(").concat(t[0]+s,", ").concat(t[1]+e/2-this.height_/2+_,")")),t[0]+=this.size_.width}},e.prototype.get_img_scale=function(){return 1},e.prototype.on_mouse_down=function(t){if(t.preventDefault(),t.stopPropagation(),this.source_block&&this.source_block.get_workspace()&&!this.source_block.is_in_flyout){this.tooltip&&this.tooltip.hide();var e=this.source_block.get_workspace().get_gesture(t);e&&e.set_start_field(this)}},e.DEFAULT_WIDTH=20,e=i=o.__decorate([(0,n.injectable)()],e)}(i(15020).Field);e.FieldImage=a},91822:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldLabel=void 0;var o=i(98734),n=i(61455),r=i(11214),s=i(25461),_=i(57754),a=function(t){function e(e){var i=t.call(this,e.text)||this;return i.editable=!1,i.field_type="FieldLabel",i.size_=new r.Size(0,i.theme.renderer.SHADOW_FIELD_HEIGHT),i.class_=e.opt_class,i.set_value(e.text),i}return o.__extends(e,t),e.prototype.init=function(){if(!this.text_element){if(_.is.safari()||_.is.mobile()?this.text_element=(0,s.create_svg_element)("text",{class:"blocklyText","font-size":this.theme.font.SIZE,dy:".4em"}):this.text_element=(0,s.create_svg_element)("text",{class:"blocklyText","font-size":this.theme.font.SIZE,"dominant-baseline":"central"}),this.class_&&(0,s.add_class)(this.text_element,this.class_),this.visible_||(this.text_element.style.display="none"),void 0==this.source_block)throw new ReferenceError("Field should have source block when init.");if(void 0!=this.source_block){var t=this.source_block.get_svg_root();if(void 0==t)throw new ReferenceError("Field should have svg root when init.");t.appendChild(this.text_element)}this.source_block&&this.render_()}},e.prototype.layout=function(t,e){t[0]+=this.render_sep,this.text_element&&(this.text_element.setAttribute("transform","translate(".concat(t[0],",").concat(t[1]+e/2,")")),t[0]+=this.size_.width)},e=o.__decorate([(0,n.injectable)()],e)}(i(15020).Field);e.FieldLabel=a},55011:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldLabelSerializable=void 0;var o=i(98734),n=i(61455),r=function(t){function e(e){var i=t.call(this,e)||this;return i.editable=!0,i.field_type="FieldLabelSerializable",i}return o.__extends(e,t),e.prototype.get_display_text=function(){var t=this.text_;return t.length>this.max_display_length&&(t="".concat(t.substring(0,this.max_display_length-2),"\u2026")),t=t.replace(/\s/g,"\xa0")},e=o.__decorate([(0,n.injectable)()],e)}(i(91822).FieldLabel);e.FieldLabelSerializable=r},22495:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldLimitLengthInput=void 0;var o=i(98734),n=i(61455),r=function(t){function e(e){var i=t.call(this,e)||this;return i.padding_x=0,i.field_type="FieldLimitLengthInput",i.max_length=e.max_length,i}return o.__extends(e,t),e.prototype.render_=function(){var e,i;this.visible_&&this.text_element&&this.source_block?(t.prototype.render_.call(this),this.padding_x=15,null===(e=this.text_element)||void 0===e||e.setAttribute("x",String(this.padding_x)),this.size_.width=this.size_.width+2*this.padding_x,null===(i=this.border_rect)||void 0===i||i.setAttribute("width",String(this.size_.width+15))):this.size_.width=0},e.prototype.on_html_input_change=function(){this.html_input&&this.source_block&&(!this.is_composition_inputting&&this.max_length&&this.html_input.value.length>this.max_length&&(this.html_input.value=this.html_input.value.substr(0,this.max_length)),t.prototype.on_html_input_change.call(this))},e=o.__decorate([(0,n.injectable)()],e)}(i(88891).FieldTextInput);e.FieldLimitLengthInput=r},89502:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldMultilineInput=void 0;var o=i(98734),n=i(61455),r=i(57754),s=i(25461),_=function(t){function e(e){var i=t.call(this,e)||this;return i.padding_y=3,i.line_height=22,i.padding_x=0,i.field_type="FieldMultilineInput",i.max_length=e.max_length,i.max_width=e.max_width,i.padding=e.padding,i}return o.__extends(e,t),e.prototype.get_display_text=function(){return this.text_?this.text_:"\xa0"},e.prototype.render_=function(){var t,e,i,o,n,_,a,c,l=this;if(this.visible_&&this.text_element&&this.source_block){(0,s.remove_children)(this.text_element),this.text_element.setAttribute("text-anchor","start"),this.text_element.setAttribute("dominant-baseline","central");var d=this.get_display_text();this.utils.start_text_cache();var u=0,h=(0,s.create_svg_element)("tspan");this.text_element.appendChild(h);for(var p=0,g=Array.from(d),f=0;f<g.length;f++){h.textContent=g.slice(p,f+1).join("").replace(/\n/g,"").replace(/\s/g,"\xa0");var v=this.utils.get_cached_width(h);u=Math.max(u,v);var m=g[f],b=g[f+1],y=void 0!==this.max_width&&v>=this.max_width&&void 0!==g[f+1];("\n"===m||y)&&(h=(0,s.create_svg_element)("tspan"),this.text_element.appendChild(h),y&&"\n"===b&&f++,p=f+1)}this.utils.stop_text_cache(),this.padding_x=(null===(t=this.padding)||void 0===t?void 0:t.x)||0,this.padding_y=(null===(e=this.padding)||void 0===e?void 0:e.y)||0,this.source_block.is_shadow()||(this.padding_x=u>=this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD?this.theme.renderer.TEXT_PADDING_IN_FIELD:(this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD+2*this.theme.renderer.TEXT_PADDING_IN_FIELD-u)/2);var E=this.padding_y;Array.from(this.text_element.children).forEach((function(t,e){""===t.textContent&&(t.innerHTML="&nbsp;"),t.setAttribute("x","".concat(l.padding_x)),0===e?(t.setAttribute("dy","0"),E=l.theme.renderer.FIELD_HEIGHT):(t.setAttribute("dy","".concat(l.line_height)),E+=l.line_height)})),this.size_.height=E,this.size_.width=u+2*this.padding_x,null===(i=this.border_rect)||void 0===i||i.setAttribute("width",String(this.size_.width)),null===(o=this.border_rect)||void 0===o||o.setAttribute("height",String(this.size_.height)),null===(n=this.text_element)||void 0===n||n.setAttribute("dy","0"),navigator.vendor.includes("Google")||navigator.userAgent.includes("Chrome")?null===(_=this.text_element)||void 0===_||_.setAttribute("y","".concat(this.theme.renderer.FIELD_HEIGHT/2)):!r.is.safari()&&!r.is.ios()||r.is.ipad()&&r.is.IOS17()?null===(c=this.text_element)||void 0===c||c.setAttribute("y","".concat(this.theme.renderer.FIELD_HEIGHT/2)):null===(a=this.text_element)||void 0===a||a.setAttribute("y","".concat(this.line_height))}else this.size_.width=0},e.prototype.widget_create=function(){if(!this.source_block)throw new Error("[FieldMultilineInput] Trying to create widget before init on a block. ");return this.html_input=t.prototype.widget_create.call(this,"textarea","blocklyHtmlTextarea"),this.html_input.style.lineHeight="".concat(this.line_height,"px"),this.html_input.style.paddingTop=this.source_block.is_shadow()&&this.source_block.height<=this.theme.renderer.MIN_HEIGHT_SHADOW?"".concat((this.source_block.height-this.line_height)/2,"px"):"".concat(this.padding_y,"px"),this.source_block.is_shadow()?(this.html_input.style.paddingLeft="".concat(this.padding_x||23,"px"),this.html_input.style.paddingRight="".concat(.8*(this.padding_x||23),"px")):(this.html_input.style.paddingLeft="".concat(this.padding_x,"px"),this.html_input.style.paddingRight="".concat(.8*this.padding_x,"px")),this.html_input},e.prototype.on_html_input_keydown=function(e){"Enter"!==e.key&&t.prototype.on_html_input_keydown.call(this,e)},e.prototype.on_html_input_change=function(){this.html_input&&this.source_block&&(!this.is_composition_inputting&&this.max_length&&this.html_input.value.length>this.max_length&&(this.html_input.value=this.html_input.value.substr(0,this.max_length)),t.prototype.on_html_input_change.call(this),this.html_input.style.paddingTop=this.source_block.is_shadow()&&this.source_block.height<=this.theme.renderer.MIN_HEIGHT_SHADOW?"".concat((this.source_block.height-this.line_height)/2,"px"):"".concat(this.padding_y,"px"),this.source_block.is_shadow()||(this.html_input.style.paddingLeft="".concat(this.padding_x,"px"),this.html_input.style.paddingRight="".concat(this.padding_x,"px")))},e=o.__decorate([(0,n.injectable)()],e)}(i(88891).FieldTextInput);e.FieldMultilineInput=_},94648:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.MutationRemoveButton=e.MutationAddButton=e.FieldMutation=void 0;var o=i(98734),n=i(61455),r=i(25461),s=function(t){function e(e,i,o){void 0===o&&(o=20);var n=t.call(this,{src:"",width:o,height:o})||this;return n.is_add=e,n.index_=i,n.field_type="FieldMutation",n}return o.__extends(e,t),e.prototype.init=function(){var t,e=this;if(!this.field_group){this.field_group=(0,r.create_svg_element)("g",{},void 0),this.visible_||(this.field_group.style.display="none"),this.image_element=(0,r.create_svg_element)("g",{width:this.width_,height:this.height_,class:"fieldButton"},this.field_group),this.rect_element=(0,r.create_svg_element)("rect",{width:this.width_,height:this.height_,rx:this.width_/2,ry:this.width_/2,stroke:"rgba(0, 0, 0, .15)",fill:"rgba(255, 255, 255, .15)"},this.image_element),(0,r.create_svg_element)("line",{stroke:"#fff","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10,x1:this.width_/3,y1:this.height_/2,x2:2*this.width_/3,y2:this.height_/2},this.image_element),this.is_add&&(0,r.create_svg_element)("line",{stroke:"#fff","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10,x1:this.width_/2,y1:this.height_/3,x2:this.width_/2,y2:2*this.height_/3},this.image_element),this.events.bind_event_with_checks(this.field_group,"mousedown",this,(function(){e.rect_element&&(e.rect_element.style.fill="rgba(0, 0, 0, .15)")}));var i=null===(t=this.source_block)||void 0===t?void 0:t.get_svg_root();if(void 0==i)throw new ReferenceError("Field should have svg root when init.");i.appendChild(this.field_group),this.events.bind_event_with_checks(this.field_group,"mouseup",this,this.on_click),this.mouse_down_wrapper=this.events.bind_event_with_checks(this.field_group,"mousedown",this,this.on_mouse_down)}},e.prototype.get_img_scale=function(){return 1},e.prototype.on_click=function(t){var e,i;if(this.source_block){this.rect_element&&(this.rect_element.style.fill="rgba(255, 255, 255, .15)");var o=this.source_block.get_workspace().get_gesture(t);if(o&&o.is_dragging_block)o.handle_up(t);else if(!this.source_block.is_in_flyout&&!this.utils.is_right_button(t)){if(o&&(o.update_is_mutation_click(!0),o.handle_up(t)),!this.events.is_enabled())return;var n=this.events.get_group();this.events.set_group(n||!0);var r=this.source_block;this.is_add?null===(e=r.addMutation)||void 0===e||e.call(r,this.index_,this.name):null===(i=r.removeMutation)||void 0===i||i.call(r,this.index_,this.name),r.bump_neighbours(),this.events.set_group(n)}}},e.prototype.set_index=function(t){this.index_=t},e}(i(25939).FieldImage);e.FieldMutation=s;var _=function(t){function e(){return t.call(this,!0)||this}return o.__extends(e,t),e=o.__decorate([(0,n.injectable)()],e)}(s);e.MutationAddButton=_;var a=function(t){function e(e){return void 0===e&&(e=void 0),t.call(this,!1,e)||this}return o.__extends(e,t),e=o.__decorate([(0,n.injectable)()],e)}(s);e.MutationRemoveButton=a},98961:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldNumber=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(75102),_=i(37767),a=i(11214),c=i(25461),l=i(22804),d=function(t){function e(e){var i=t.call(this,{text:e.opt_value&&!isNaN(e.opt_value)?String(e.opt_value):"0",opt_validator:e.opt_validator})||this;return i.controller_option=void 0,i.controller=void 0,i.min_=-1/0,i.max_=1/0,i.precision_=0,i.should_show_quote=!1,i.field_type="FieldNumber",i.set_constraints(e.opt_min,e.opt_max,e.opt_precision),i.allow_text=void 0,i.controller_option=e.opt_controller||void 0,e.opt_controller&&i.set_controller_option(e.opt_controller),i}var i;return o.__extends(e,t),i=e,e.prototype.show_input_controller=function(t){},e.prototype.hide_input_controller=function(){},e.prototype.init=function(){!this.field_group&&this.source_block&&(this.update_allow_text(),this.field_group=(0,c.create_svg_element)("g",{}),this.visible_||(this.field_group.style.display="none"),this.source_block.is_shadow()||(this.border_rect=(0,c.create_svg_element)("rect",{rx:4,ry:4},this.field_group),this.field_group&&this.field_group.classList.add("blocklyFieldTextInput")),this.input_element=(0,c.create_svg_element)("g",{class:"blocklyInputElement"},this.field_group),this.text_element=(0,c.create_svg_element)("text",{class:"blocklyText","font-size":this.theme.font.SIZE,"dominant-baseline":"central"},this.input_element),this.update_editable(),this.source_block.get_svg_root().appendChild(this.field_group),this.bind_field_click_event(),this.update_input(),this.render_())},e.prototype.set_constraints=function(t,e,i){i=parseFloat(i),this.precision_=isNaN(i)?0:i,t=parseFloat(t),this.min_=isNaN(t)?-1/0:t,e=parseFloat(e),this.max_=isNaN(e)?1/0:e,this.set_value(this.get_validated_value(this.get_value()))},e.prototype.get_validated_value=function(t){if(!(0,a.is_valid_number)(t))return this.allow_text?t:"";var e=parseFloat(t);if(this.precision_&&(e=Math.round(e/Number(this.precision_))*Number(this.precision_)),!this.exceptions||-1===this.exceptions.indexOf(e)){if(void 0!=this.mod_&&e!==1/0&&e!==-1/0){var i=Number(this.max_),o=Number(this.min_),n=i-o;e%=n,this.mod_?e<=o?e+=n:e>i&&(e-=n):e<o?e+=n:e>=i&&(e-=n)}e=(0,a.clamp)(e,this.min_,this.max_)}return String(e)},e.prototype.set_allow_text=function(t){"undefined"===typeof this.allow_text&&void 0!==t&&(this.allow_text=t)},e.prototype.update_allow_text=function(){var t,e;if("undefined"===typeof this.allow_text&&(null===(t=this.source_block)||void 0===t?void 0:t.parent_block)){var o=!1,n=this.source_block.parent_block,r=null===(e=n.get_input_with_block(this.source_block))||void 0===e?void 0:e.name;(i.WHITE_LIST_BLOCKS.includes(n.type)||Object.keys(i.WHITE_LIST_SPECIAL).includes(n.type)&&i.WHITE_LIST_SPECIAL[n.type]===r)&&(o=!0),this.set_allow_text(o)}},e.prototype.set_mod=function(t){this.mod_=t?"true"===t:void 0},e.prototype.set_exceptions=function(t){this.exceptions=t||void 0},e.prototype.widget_dispose=function(){var e=this;return function(){if(e.html_input){var i=e.get_validated_value(e.html_input.value)||e.html_input.defaultValue;t.prototype.widget_dispose.call(e,i)(),e.controller&&e.controller.hide()}}},e.prototype.reset_text_element=function(){var t=this;if(this.input_element&&this.text_element){(0,c.remove_children)(this.input_element);var e=function(){l.is.safari()||l.is.mobile()?t.text_element=(0,c.create_svg_element)("text",{class:"blocklyText",dy:".4em","font-size":t.theme.font.SIZE},t.input_element):t.text_element=(0,c.create_svg_element)("text",{class:"blocklyText","dominant-baseline":"central","font-size":t.theme.font.SIZE},t.input_element)};this.should_show_quote?((0,c.create_svg_element)("path",{d:_.ICON.LEFT_QUOTA,transform:"translate(".concat(i.LEFT_QUOTE_X,", ").concat(i.QUOTE_Y,")"),class:"blocklyQuote"},this.input_element),e(),this.quote_right=(0,c.create_svg_element)("path",{d:_.ICON.RIGHT_QUOTA,class:"blocklyQuote"},this.input_element)):(delete this.quote_right,e())}},e.prototype.add_quote_input=function(){var t;if(this.visible_&&this.text_element){this.quote_right||this.reset_text_element(),(0,c.remove_children)(this.text_element);var e=document.createTextNode(this.get_display_text());this.text_element.appendChild(e),this.update_width();var o=i.LEFT_QUOTE_X+i.QUOTE_WIDTH+this.size_.width;null===(t=this.quote_right)||void 0===t||t.setAttribute("transform","translate(".concat(o,", ").concat(i.QUOTE_Y,")"))}else this.size_.width=0},e.prototype.remove_quote_input=function(){this.quote_right&&this.reset_text_element()},e.prototype.update_input=function(){this.should_show_quote=!!this.allow_text&&!(0,a.is_valid_number)(this.get_display_text()),this.should_show_quote?this.add_quote_input():this.remove_quote_input()},e.prototype.set_text=function(t){null!==t&&(t=String(t))!==this.text_&&(this.text_=t,this.update_input(),this.force_rerender(),this.controller&&this.controller.update_value(Number(t)))},e.prototype.set_controller_option=function(t){switch(this.controller_option=t,t.type){case s.ControllerType.SLIDER:this.controller=this.slider_controller;break;case s.ControllerType.ANGLE_SCALE:this.controller=this.angle_controller;break;case s.ControllerType.COLOR_PICKER:this.controller=this.color_controller}},e.prototype.get_controller_option=function(){return this.controller_option},e.prototype.show_editor=function(t,e){var i=this;if(!this.source_block)throw new ReferenceError("source_block is undefined");this.workspace_=this.source_block.get_workspace();if(this.widget_div.show(this,(function(){i.focus(!1),i.runtime_data.editing===i&&i.focus(!1),e&&e(),i.widget_dispose()()})),void 0==this.widget_div.DIV)throw new Error("DIV is undefined");return this.html_input=this.widget_create(),this.bind_input_events(),this.html_input.focus(),this.html_input.select(),this.controller&&this.controller_option&&this.controller.show(this,this.controller_option),this.html_input},e.QUOTE_WIDTH=10,e.LEFT_QUOTE_X=-10,e.QUOTE_Y=0,e.WHITE_LIST_BLOCKS=["math_arithmetic","logic_compare","variables_set","change_variable","cloud_variables_set","change_cloud_variable","lists_append","lists_index_of","lists_is_exist","cloud_lists_append","cloud_lists_index_of","cloud_lists_is_exist","procedures_2_callnoreturn","procedures_2_callreturn","procedures_2_return_value","wood_block_set","wood_block_get","auto_player_set_feature"],e.WHITE_LIST_SPECIAL={lists_insert_value:"VALUE",lists_replace:"VALUE",cloud_lists_insert_value:"VALUE",cloud_lists_replace:"VALUE"},o.__decorate([(0,r.lazy_inject)(r.BINDING.slider_controller)],e.prototype,"slider_controller",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.angle_controller)],e.prototype,"angle_controller",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.color_controller)],e.prototype,"color_controller",void 0),e=i=o.__decorate([(0,n.injectable)()],e)}(i(88891).FieldTextInput);e.FieldNumber=d},72454:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldTextDropdown=void 0;var o=i(98734),n=i(61455),r=i(25461),s=i(88891),_=i(82406),a=function(t){function e(e){var i,o=this;return(o=t.call(this,{text:(null===(i=e()[0])||void 0===i?void 0:i.value)||""})||this).get_options=e,o.field_type="FieldTextDropdown",o.menu_items=[],o.padding_x=10,o.text_margin=0,o}return o.__extends(e,t),e.prototype.render_=function(){var t,e;this.size_.width=0,this.visible_&&this.field_group&&this.source_block&&(this.size_.width=this.padding_x,this.update_height(),this.render_text_element(),this.render_arrow(),null===(t=this.border_rect)||void 0===t||t.setAttribute("width",String(this.size_.width)),null===(e=this.border_rect)||void 0===e||e.setAttribute("height",String(this.size_.height)))},e.prototype.render_text_element=function(){if(this.text_element&&this.field_group){(0,r.remove_children)(this.text_element),this.text_element.appendChild(document.createTextNode(this.get_display_text()));var t=this.utils.get_cached_width(this.text_element);this.text_margin=t<this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD?(this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD-t)/2:0,this.size_.width+=this.text_margin,this.text_element.setAttribute("y",String(this.size_.height/2)),this.text_element.setAttribute("x",String(this.size_.width)),this.size_.width+=t+this.text_margin}},e.prototype.render_arrow=function(){var t=this;if(this.field_group&&this.source_block)if(this.arrow||(this.arrow=(0,_.draw_arrow)(this.source_block.workspace.options.dropdown.arrow_type),this.field_group.appendChild(this.arrow)),this.size_.width+=this.source_block.workspace.options.dropdown.padding,this.arrow.setAttribute("transform","translate(".concat(this.size_.width,", ").concat(this.size_.height/2-7,")")),this.size_.width+=12+this.source_block.workspace.options.dropdown.padding,this.source_block.is_shadow()){var e=function(){var e,i=null===(e=t.source_block)||void 0===e?void 0:e.get_parent();i&&t.arrow&&(t.arrow.style.fill=i.get_colour().toString())};this.events.is_record_undo()?e():window.setTimeout(e)}else this.arrow.style.fill=this.source_block.get_colour().toString()},e.prototype.widget_dispose=function(){var e=this;return function(){t.prototype.widget_dispose.call(e)(),e.menu&&(0,r.remove_node)(e.menu),e.menu_items=[],e.menu=void 0}},e.prototype.show_editor=function(){var e=t.prototype.show_editor.call(this);if(!this.source_block)return e;var i=this.source_block.workspace.get_scale();return e.style.paddingLeft="".concat((this.padding_x+this.text_margin)*i,"px"),e.style.textAlign="start",this.menu=this.create_dropdown_element(),e},e.prototype.create_dropdown_element=function(){var t=this;this.menu_items=[];var e=document.createElement("div");e.classList.add("menu-wrapper");for(var i=this.get_options(),o=function(o){var r=i[o],s=document.createElement("div");s.classList.add("menu-item"),s.dataset.value=r.value,s.innerText=r.value,s.setAttribute("tabindex","-1"),s.style.outline="none",r.value===n.get_value()&&s.classList.add("menu_item_selected"),e.appendChild(s);s.style.minWidth="".concat(172,"px"),s.addEventListener("click",(function(){t.set_html_input_value(r.value),t.widget_div.hide()})),n.menu_items.push(s)},n=this,s=0;s<i.length;s++)o(s);e.classList.add("blocklyDropdownMenu");var a=(0,r.create_dom)("div",{style:"position: fixed",class:"blocklyWidgetDiv"});a.appendChild(e),document.body.appendChild(a),a.style.display="block";var c=(0,_.position_dropdown)(e,this);return a.style.left="".concat(c[0],"px"),a.style.top="".concat(c[1],"px"),a},e.prototype.highlight_matched=function(){var t=this;if(this.menu)for(var e=function(e,o){var n=i.menu_items[e];if(i.get_value()===n.dataset.value){n.classList.add("menu-item-hover");var r=n.getBoundingClientRect(),s=i.menu.getBoundingClientRect(),_=r.top<s.top,a=r.bottom>s.bottom;(_||a)&&requestAnimationFrame((function(){t.menu&&(n.scrollIntoView(_),t.menu.classList.contains("scroll-smooth")||t.menu.classList.add("scroll-smooth"))}))}else n.classList.remove("menu-item-hover")},i=this,o=0,n=this.menu_items.length;o<n;o++)e(o)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.menu&&(0,r.remove_node)(this.menu),this.widget_div.hide_if_owner(this)},e.prototype.on_html_input_change=function(){t.prototype.on_html_input_change.call(this),this.html_input.style.paddingLeft="".concat((this.padding_x+this.text_margin)*this.workspace_.get_scale(),"px"),this.highlight_matched()},e=o.__decorate([(0,n.injectable)()],e)}(s.FieldTextInput);e.FieldTextDropdown=a},88891:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.FieldTextInput=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(11214),_=i(25461),a=i(57754),c=function(t){function e(e){var i=t.call(this,e.text,e.opt_validator)||this;return i.field_type="FieldTextInput",i.spellcheck_=!0,i.is_composition_inputting=!1,i.on_start_composition=function(){i.is_composition_inputting=!0},i.on_end_composition=function(){i.is_composition_inputting=!1},i.size_=new s.Size(0,30),i}var i;return o.__extends(e,t),i=e,e.prototype.resize_editor=function(){var t;if(this.source_block&&this.workspace_){var e,i,o=this.widget_div.DIV;if(this.field_group&&o)this.source_block.is_shadow()?(e={width:this.source_block.width,height:this.source_block.height},i=(0,_.get_page_offset)(this.source_block.svg_group)):(e=(0,_.get_size_attr)(this.border_rect||this.field_group),i=(0,_.get_page_offset)(this.field_group)),o.style.width="".concat(e.width,"px"),o.style.height="".concat(e.height,"px"),o.style.left="".concat(i[0],"px"),o.style.top="".concat(i[1],"px"),o.style.transformOrigin="top left",o.style.transform="scale(".concat(null!==(t=this.workspace_.get_scale())&&void 0!==t?t:1,")")}},e.prototype.show_editor=function(t,e){var i=this;if(!this.source_block)throw new ReferenceError("source_block is undefined");this.workspace_=this.source_block.get_workspace();if(this.widget_div.show(this,(function(){i.focus(!1),e&&e(),i.widget_dispose()()})),void 0==this.widget_div.DIV)throw new Error("DIV is undefined");return this.html_input=this.widget_create(),this.bind_input_events(),this.html_input.focus(),this.html_input.select(),this.html_input},e.prototype.update_width=function(){if(this.text_element&&this.source_block){var t=this.utils.get_cached_width(this.text_element);if(!this.source_block.is_shadow()){var e=t>=this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD?this.theme.renderer.TEXT_PADDING_IN_FIELD:(this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD+2*this.theme.renderer.TEXT_PADDING_IN_FIELD-t)/2;this.text_element.setAttribute("x","".concat(e)),t+=2*e}this.size_.width=t}},e.prototype.update_height=function(){var e;t.prototype.update_height.call(this),null===(e=this.text_element)||void 0===e||e.setAttribute("y",String(this.size_.height/2))},e.prototype.layout=function(t,e){this.field_group&&this.text_element&&(t[0]+=this.render_sep,this.field_group.setAttribute("transform","translate(".concat(t[0],", ").concat(t[1]+(e-this.size_.height)/2,")")),t[0]+=this.size_.width)},e.prototype.validate_=function(){var t="true";this.html_input&&(this.source_block&&(t=this.call_validator(this.html_input.value)),void 0==t?(0,_.add_class)(this.html_input,"blocklyInvalidInput"):(0,_.remove_class)(this.html_input,"blocklyInvalidInput"))},e.prototype.widget_dispose=function(t){var e=this;return function(){var i,o;if(e.source_block&&e.workspace_&&e.html_input){t||(t=e.html_input.value);var n,r=e.events.get_group();e.events.set_group(r||!0),t!==e.html_input.defaultValue&&e.events.is_enabled()&&(n=e.change_event_factory("field",{block:e.source_block,old_value:e.html_input.defaultValue,new_value:t,name:e.name})),e.set_text(t),(null===(i=e.source_block)||void 0===i?void 0:i.rendered)&&e.source_block.render(),e.html_input.onKeyDownWrapper_&&e.events.unbind_event(e.html_input.onKeyDownWrapper_),e.html_input.onKeyUpWrapper_&&e.events.unbind_event(e.html_input.onKeyUpWrapper_),e.html_input.onKeyPressWrapper_&&e.events.unbind_event(e.html_input.onKeyPressWrapper_),e.html_input.onInputWrapper_&&e.events.unbind_event(e.html_input.onInputWrapper_||[]),e.html_input.onWorkspaceChangeWrapper_&&(null===(o=e.workspace_)||void 0===o||o.remove_change_listener(e.html_input.onWorkspaceChangeWrapper_)),e.html_input.on_composition_start_wrapper_&&e.events.unbind_event(e.html_input.on_composition_start_wrapper_),e.html_input.on_composition_end_wrapper_&&e.events.unbind_event(e.html_input.on_composition_end_wrapper_),delete e.html_input;var s=e.widget_div.DIV.style;s.width="auto",s.height="auto",s.fontSize="",s.transition="",s.boxShadow="",s.borderRadius="",n&&e.events.fire(n),e.events.set_group(!1)}}},e.prototype.on_html_input_keydown=function(t){var e;if(this.html_input){13==t.keyCode?this.widget_div.hide():27==t.keyCode?(this.html_input.value=this.html_input.defaultValue,this.widget_div.hide()):9==t.keyCode&&(this.widget_div.hide(),null===(e=this.source_block)||void 0===e||e.tab(this,!t.shiftKey),t.preventDefault())}},e.prototype.on_html_input_change=function(){var t;if(this.html_input){var e=this.html_input.value;e!==this.html_input.oldValue_?(this.html_input.oldValue_=e,this.set_value(e),this.validate_()):a.is.webkit()&&(null===(t=this.source_block)||void 0===t||t.render()),this.resize_editor()}},e.prototype.widget_create=function(t,e){var o;void 0===t&&(t="input"),void 0===e&&(e="blocklyHtmlInput");var n=this.widget_div.DIV;if(!this.source_block||!this.workspace_||!n)throw new Error("Trying to create a field editor without a source block.");var r=(0,_.create_dom)(t,e);if(r.setAttribute("spellcheck",String(this.spellcheck_)),r.style.fontSize="".concat(i.FONTSIZE,"pt"),r.value=r.defaultValue=this.text_,r.oldValue_=void 0,r.style.webkitAppearance="none",n.appendChild(r),this.resize_editor(),this.validate_(),"dark"===this.source_block.workspace.options.theme)return r;if(this.source_block.is_shadow()){n.style.borderRadius="".concat(i.FONTSIZE,"pt"),r.style.borderRadius="".concat(i.FONTSIZE,"pt");var s=(null===(o=this.source_block.parent_block)||void 0===o?void 0:o.get_colour())||"#fff";r.style.boxShadow="inset ".concat(s," 0px 0px 0px 2px")}else{n.style.borderRadius="4px",r.style.borderRadius="4px";s=this.source_block.get_colour()||"#fff";r.style.boxShadow="inset ".concat(s," 0px 0px 0px 2px")}return n.style.transition="box-shadow 0.25s ease 0s",n.style.boxShadow="rgba(255, 255, 255, 1) 0px 0px 0px 3px",r},e.prototype.bind_input_events=function(){var t;this.html_input&&(this.html_input.onKeyDownWrapper_=this.events.bind_event_with_checks(this.html_input,"keydown",this,this.on_html_input_keydown),this.html_input.onKeyUpWrapper_=this.events.bind_event_with_checks(this.html_input,"keyup",this,this.on_html_input_change),this.html_input.onKeyPressWrapper_=this.events.bind_event_with_checks(this.html_input,"keypress",this,this.on_html_input_change),this.html_input.onInputWrapper_=this.events.bind_event(this.html_input,"input",this,this.on_html_input_change),this.html_input.onWorkspaceChangeWrapper_=this.resize_editor.bind(this),null===(t=this.workspace_)||void 0===t||t.add_change_listener(this.html_input.onWorkspaceChangeWrapper_),this.html_input.on_composition_start_wrapper_=this.events.bind_event_with_checks(this.html_input,"compositionstart",this,this.on_start_composition),this.html_input.on_composition_end_wrapper_=this.events.bind_event_with_checks(this.html_input,"compositionend",this,this.on_end_composition))},e.prototype.set_spell_check=function(t){this.spellcheck_=t},e.prototype.set_value=function(e){if(void 0!=e){if(this.source_block){var i=this.call_validator(e);void 0!=i&&(e=i)}t.prototype.set_value.call(this,e)}},e.prototype.init=function(){var e;t.prototype.init.call(this,!0),(null===(e=this.source_block)||void 0===e?void 0:e.is_shadow())&&this.source_block.get_svg_root().classList.add("blocklyShadowTextInput"),this.field_group&&this.field_group.classList.add("blocklyFieldTextInput")},e.FONTSIZE=12,o.__decorate([(0,r.lazy_inject)(r.BINDING.widget_div)],e.prototype,"widget_div",void 0),e=i=o.__decorate([(0,n.injectable)()],e)}(i(15020).Field);e.FieldTextInput=c},82406:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.draw_arrow=e.position_dropdown=void 0;var o=i(1530),n=i(25461),r=i(12988);e.position_dropdown=function(t,e){var i=e.get_svg_root();if(!e.source_block||!i)return o.vec2.create();var s=(0,n.get_viewport_size)(),_=(0,r.get_viewport_page_offset)(document),a=e.source_block.is_shadow()?(0,n.get_page_offset)(e.source_block.get_svg_root()):(0,n.get_page_offset)(e.border_rect||i),c=e.source_block.get_workspace().get_scale(),l=e.source_block.is_shadow()?{width:e.source_block.width*c,height:e.source_block.height*c}:{width:e.get_size().width*c,height:e.get_size().height*c},d=e.source_block.is_shadow()?e.source_block.parent_block:e.source_block;if(!d)return o.vec2.create();var u=e.source_block.workspace.options.dropdown,h=u.menu.scalable?Math.max(c,1):1;t.parentElement&&(t.parentElement.style.transform="scale(".concat(h,")"),t.parentElement.style.transformOrigin="left top");var p=(0,r.get_size)(t),g=document.createElement("div");g.classList.add("dropdown-triangle");var f=d.inputList.find((function(t){return t.fieldRow.indexOf(e)>-1})),v=((((null===f||void 0===f?void 0:f.height)||d.first_row_height)+2)*c-l.height)/2;if(a[1]<=s.height/2+_[1]?(a[1]+=l.height+v,t.classList.add("lower"),g.classList.add("lower")):(a[1]-=p.height+v,t.classList.add("upper"),g.classList.add("upper"),g.style.top="".concat(p.height,"px")),(0,n.insert_before)(g,t),"first"===u.menu.align){var m=e.image_element?Number(e.image_element.getAttribute("x")):e.text_element?Number(e.text_element.getAttribute("x")):NaN;m=isNaN(m)?u.padding:m;var b=t.firstElementChild?parseFloat((0,r.get_computed_style)(t.firstElementChild,"padding-left")):-m*c;a[0]=a[0]+m*c-b*h,a[0]=Math.min(a[0],s.width+_[0]-p.width)}else"center"===u.menu.align?(t.parentElement&&(t.parentElement.style.transform="scale(".concat(h,") translateX(-50%)")),a[0]+=l.width/2,a[0]=Math.min(a[0],s.width+_[0]-p.width/2),a[0]=Math.max(a[0],_[0]+p.width/2)):"left"===u.menu.align&&(a[0]=Math.min(a[0],s.width+_[0]-p.width));return a},e.draw_arrow=function(t){void 0===t&&(t="triangle");var e=(0,n.create_svg_element)("g",{class:"blocklyDropdownArrow"});return"line"===t&&(0,n.create_svg_element)("path",{d:"M5.99695526,7.90416306 L9.03751442,4.8636039 C9.38898628,4.51213203 9.95883476,4.51213203 10.3103066,4.8636039 C10.6617785,5.21507576 10.6617785,5.78492424 10.3103066,6.1363961 L6.63335137,9.81335137 C6.2818795,10.1648232 5.71203102,10.1648232 5.36055916,9.81335137 L1.6836039,6.1363961 C1.33213203,5.78492424 1.33213203,5.21507576 1.6836039,4.8636039 C2.03507576,4.51213203 2.60492424,4.51213203 2.9563961,4.8636039 L5.99695526,7.90416306 Z"},e),"triangle"===t&&(0,n.create_svg_element)("path",{d:"M2.49351315,4 L9.50652922,4 C9.77906561,4 10,4.24184373 10,4.54017309 C10,4.65100154 9.96885725,4.75914782 9.91079624,4.84994202 L6.4042882,9.76954945 C6.24799884,10.0139504 5.94030478,10.0733882 5.71703428,9.90230757 C5.66983808,9.86614356 5.62879151,9.82121232 5.59575417,9.76954945 L2.08924613,4.84994202 C1.93295678,4.60554109 1.98725573,4.26872671 2.21052624,4.09764605 C2.29347055,4.03409011 2.39226671,4 2.49351315,4 Z"},e),e}},13769:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Input=void 0;var o=i(98734),n=i(61455),r=i(98030),s=i(61972),_=function(){function t(t){this.field_width=0,this.field_height=0,this.margin_left=this.theme.renderer.SEP_SPACE_X,this.render_width=0,this.render_height=0,this.width=0,this.height=0,this.visible_=!0,this.setCheck=this.set_check,this.appendField=this.append_field,this.type=t.type,this.name=t.name,this.source_block=t.block,this.connection=t.connection,this.fieldRow=[]}return t.prototype.is_visible=function(){return this.visible_},t.prototype.init=function(){if(void 0!=this.source_block){var t=this.source_block.get_workspace();if(void 0!=t&&t.rendered)for(var e=0;e<this.fieldRow.length;e++)this.fieldRow[e].init()}else console.warn("Trying to init an input without its source block.")},t.prototype.dispose=function(){for(var t=0;t<this.fieldRow.length;t++){this.fieldRow[t].dispose()}this.connection&&this.connection.dispose(),delete this.source_block},t.prototype.set_visible=function(t){var e=[];if(this.visible_==t)return e;this.visible_=t;for(var i=0;i<this.fieldRow.length;i++){var o=this.fieldRow[i];o.opt_is_head_||o.set_visible(t)}if(this.connection){t?e=this.connection.unhide_all():this.connection.hide_all();var n=this.connection.targetBlock();n&&n.set_visible_as_child(t)}return e},t.prototype.set_check=function(t){if(!this.connection)throw new Error("This input does not have a connection.");return this.connection.set_check(t),this},t.prototype.append_field=function(t,e){return this.insert_field_at(this.fieldRow.length,t,e),this},t.prototype.insert_field_at=function(t,e,i){if(t<0||t>this.fieldRow.length)throw new Error("index ".concat(t," out of bounds."));return e||i?((0,s.is_string)(e)&&(e=this.field_label_factory({text:this.utils.replace_message_references(e)})),e.source_block=this.source_block,void 0!=i&&(e.name=i),void 0!=this.source_block&&this.source_block.rendered&&e.init(),(0,s.is_field_dropdown)(e)&&e.prefix_field&&(t=this.insert_field_at(t,e.prefix_field)),this.fieldRow.splice(t,0,e),++t,(0,s.is_field_dropdown)(e)&&e.suffix_field&&(t=this.insert_field_at(t,e.suffix_field)),void 0!=this.source_block&&this.source_block.rendered&&this.source_block.render(),t):0},t.prototype.remove_field=function(t){for(var e,i,o=0,n=this.fieldRow.length;o<n;o++){var r=this.fieldRow[o];if(r.name===t)return r.dispose(),this.fieldRow.splice(o,1),(null===(e=this.source_block)||void 0===e?void 0:e.rendered)&&(null===(i=this.source_block)||void 0===i||i.render()),!0}return!1},t.prototype.get_field=function(t){for(var e=0,i=this.fieldRow.length;e<i;e++){var o=this.fieldRow[e];if(o.name===t)return o}},o.__decorate([(0,r.lazy_inject)(r.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.FieldLabel)],t.prototype,"field_label_factory",void 0),t=o.__decorate([(0,n.injectable)()],t)}();e.Input=_},10777:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.RenderedConnection=void 0;var o=i(98734),n=i(61455),r=o.__importDefault(i(81692)),s=i(1530),_=i(98030),a=i(75102),c=i(61972),l=i(25461),d=i(37767),u=function(){function t(t){var e=this;this.x_=0,this.y_=0,this.hidden_=!1,this.in_db=!1,this.shadow_dom=void 0,this.can_connect_to_previous=function(t){if(e.target_connection)return!1;if(-1!=e.runtime_data.dragging_connections.indexOf(t))return!1;var i=e.source_block.get_first_statement_connection(),o=void 0!=i,n=e==i,r=e==e.source_block.next_connection;if(o&&!n&&!r)return!1;var s=void 0!=e.source_block.previous_connection;if(n&&s)return!0;if(r||n&&!s){if(!t.target_connection)return!0;var _=t.targetBlock();return!!_&&(!!_.is_insertion_marker()&&!_.get_previous_block())}return!1},this.source_block=t.source,this.type=t.type,this.context=t.context;var i=t.source.get_workspace();i&&i.connectionDBList&&(this.db_=i.connectionDBList[t.type],this.db_opposite=i.connectionDBList[a.OPPOSITE_TYPE[t.type]],this.hidden_=!this.db_),this.offset_in_block=s.vec2.create()}var e;return e=t,t.connect_reciprocally=function(t,e){t&&e||console.error("Cannot connect undefined connections."),t.target_connection=e,e.target_connection=t},t.prototype.get_targe_connection=function(){return this.target_connection},t.prototype.move_to=function(t){var e,i;this.in_db&&(null===(e=this.db_)||void 0===e||e.remove_connection(this)),this.x_=t[0],this.y_=t[1],this.hidden_||null===(i=this.db_)||void 0===i||i.add_connection(this)},t.prototype.move_by=function(t){this.move_to(s.vec2.fromValues(t[0]+this.x_,t[1]+this.y_))},t.prototype.highlight=function(){var t,e=null===(t=this.workspace_db.current)||void 0===t?void 0:t.get_options().connection_effect,i=e?e.color:"#fff";this.type==a.CONNECTION_TYPE.INPUT_VALUE||this.type===a.CONNECTION_TYPE.OUTPUT_VALUE?this.highlight_input(i):this.type===a.CONNECTION_TYPE.NEXT_STATEMENT?this.highlight_statement(i,!0):this.type===a.CONNECTION_TYPE.PREVIOUS_STATEMENT&&this.highlight_statement(i,!1)},t.prototype.highlight_input=function(t){var i=this.source_block.get_relative_to_surface_xy(),o=this.x_-i[0],n=this.y_-i[1],r="";if(this.target_connection){var s=this.target_connection.source_block.svg_path,_=void 0;void 0!=s&&(_=s.getAttribute("d")),"string"===typeof _&&(r=_)}e.highlighted_path=(0,l.create_svg_element)("path",{filter:"url(#blur-1px)",class:"blocklyHighlightedConnectionCover",transform:"translate(".concat(o,", ").concat(n,")"),fill:t,d:r},this.source_block.get_svg_root())},t.prototype.highlight_statement=function(t,i){var o=this.source_block,n=this.offset_in_block[0],s=i?this.offset_in_block[1]-1:-3;e.highlighted_path=(0,l.create_svg_element)("g",{class:"g_blockly_next_statement_underline",transform:"translate(0, ".concat(s,")")},this.source_block.get_svg_root()),(0,l.create_svg_element)("circle",{r:"4",cx:n,cy:"2",fill:t},e.highlighted_path),(0,l.create_svg_element)("circle",{r:"8",cx:n,cy:"2",fill:t,"fill-opacity":"0.3",filter:"url(#blur-1px)"},e.highlighted_path);var _=(0,l.create_svg_element)("rect",{x:n,y:"0",rx:"2",width:"0",height:"3",fill:t},e.highlighted_path),a=this.get_path_top_length(o)-n||o.width-o.block_renderer.padding_r-n;this.offset_in_block[1]>=80&&(a=75),"controls_if"===this.source_block.type&&(this.offset_in_block[1]>=100&&(a=55),this.offset_in_block[1]>=140&&(a=75)),(0,r.default)({targets:_,width:{value:a,duration:200,easing:"easeOutQuad"}})},t.prototype.get_path_top_length=function(t){var e=t.get_svg_root().querySelector("path");if(e){var i=e.getAttribute("d").match(/H\s.*?\s/gi);if(void 0==i)return 0;var o=i.map((function(t){return t.match(/\d+(.\d+)?/g)}));return Math.max.apply(Math,o)}return 0},t.prototype.unhighlight=function(){e.highlighted_path&&((0,l.remove_node)(e.highlighted_path),delete e.highlighted_path)},t.prototype.set_offset_in_block=function(t,e){this.offset_in_block[0]=t,this.offset_in_block[1]=e},t.prototype.move_to_offset=function(t){this.move_to(s.vec2.fromValues(t[0]+this.offset_in_block[0],t[1]+this.offset_in_block[1]))},t.prototype.tighten=function(){if(void 0==this.target_connection)throw new ReferenceError("Target connection not found.");var t=this.target_connection.get_xy();if(s.vec2.sub(t,t,[this.x_,this.y_]),0!==t[0]||0!==t[1]){var e=this.targetBlock(),i=e.get_svg_root(),o=this.utils.get_relative_xy(i);s.vec2.sub(o,o,t),i.setAttribute("transform","translate(".concat(o[0],", ").concat(o[1],")")),e.move_connections(s.vec2.negate(t,t))}},t.prototype.targetBlock=function(){if(this.is_connected()&&void 0!=this.target_connection)return this.target_connection.get_source_block()},t.prototype.closest=function(t,e){return this.db_opposite?this.db_opposite.search_for_closest(this,t,e):{connection:void 0,radius:t}},t.prototype.connect_to_inferior=function(t){(function(t){var i,o,n,r,s,_=this,c=this,l=c.get_source_block(),d=t.get_source_block(),u=!1;c==l.get_first_statement_connection()&&(u=!0);var h,p,g=this.source_block.get_workspace(),f=null===(o=null===(i=g.current_gesture_)||void 0===i?void 0:i.block_dragger)||void 0===o?void 0:o.connection_pre_block_options;if(f){if(f.is_surrounding_c&&!u)return;if(u&&!f.is_surrounding_c)return}t.is_connected()&&(u&&(s=t.target_connection),t.disconnect());if(c.is_connected()){var v=c.targetBlock(),m=c.get_shadow_dom();if(c.set_shadow_dom(void 0),v&&v.is_shadow())this.events.disable(),m=d.is_shadow()?this.xml.block_to_dom(d):this.xml.block_to_dom(v),v.dispose(),v=void 0,this.events.enable();else if(c.type==a.CONNECTION_TYPE.NEXT_STATEMENT){if(v&&!v.previous_connection)throw new Error("Orphan block does not have a previous connection.");for(var b=d;b.next_connection;){var y=b.get_next_block();if(!y||y.is_shadow()){v&&v.previous_connection&&v.previous_connection.check_type(b.next_connection)&&(b.next_connection.connect(v.previous_connection),v=void 0);break}b=y}}if(v&&(c.disconnect(),this.events.is_record_undo())){var E=this.events.get_group();window.setTimeout((function(){_.events.get_group()&&_.events.get_group()!==E?console.error("current group ".concat(_.events.get_group(),", blocking scheduled bump")):v&&v.get_workspace()&&!v.get_parent()&&(_.events.set_group(E),v.output_connection?v.output_connection.bump_away_from(c):v.previous_connection&&v.previous_connection.bump_away_from(c),_.events.set_group(!1))}),this.theme.blink_params.BUMP_DELAY)}m&&c.set_shadow_dom(m)}u&&s&&l.previous_connection&&s.connect(l.previous_connection);if(d.visibility_for_undo=d.get_visibility(),this.events.is_enabled()){if(f){if(f.type===a.CONNECTION_TYPE.NEXT_STATEMENT&&(null===(n=f.pre_connect_block)||void 0===n?void 0:n.id)!==d.id)return;if(f.type===a.CONNECTION_TYPE.PREVIOUS_STATEMENT&&(null===(r=f.pre_connect_block)||void 0===r?void 0:r.id)!==l.id)return void(f.next_connect_block_id&&(null===d||void 0===d?void 0:d.id)===f.next_connect_block_id&&(e.connect_reciprocally(c,t),d.set_parent(l)))}h=this.move_event_factory({block:d}),p=this.ui_event_factory({type:a.UIEventType.CONNECT,workspace_id:l.get_workspace().id,old_value:{block_id:d.id,is_surrounding_c:u},new_value:{block_id:l.id,is_surrounding_c:u}})}e.connect_reciprocally(c,t),d.set_parent(l),h&&(h.record_new(),this.events.fire(h));p&&setTimeout((function(){_.events.fire(p)}))}).call(this,t);var i=this,o=i.get_source_block(),n=t.get_source_block();o.rendered&&(o.update_disabled(),o.update_collapsed()),n.rendered&&n.update_disabled(),o.rendered&&n.rendered&&(i.type==a.CONNECTION_TYPE.NEXT_STATEMENT||i.type==a.CONNECTION_TYPE.PREVIOUS_STATEMENT?n.render():o.render())},t.prototype.disconnect_internal=function(t,e){var i;this.events.is_enabled()&&(i=this.move_event_factory({block:e}));var o=this.target_connection;o&&(o.target_connection=void 0,this.target_connection=void 0,e.set_parent(void 0),i&&(i.record_new(),this.events.fire(i)),e.visibility_for_undo&&this.events.is_undoing()&&(e.set_chunk_visibility(e.visibility_for_undo),e.update_chunk_visibility(),e.visibility_for_undo=void 0),t.is_rendered()&&t.render(),e.is_rendered()&&(e.update_disabled(),e.render()))},t.prototype.respawn_shadow=function(){var t,e=this.get_source_block(),i=this.get_shadow_dom();if(e.get_workspace()&&!this.is_connected()&&i){this.events.disable();var o="color_picker"===i.getAttribute("type")?this.xml.dom_to_block(i,e.get_workspace()):this.xml.dom_to_block_headless(i,e.get_workspace());if(i.setAttribute("id",o.id),this.set_shadow_dom(i),o.output_connection)this.connect(o.output_connection);else{if(!o.previous_connection)throw new Error("Child block does not have output or previous statement.");this.connect(o.previous_connection)}this.xml.parse_fields(i,o),e.rendered&&(o.init_svg(),o.render()),this.type===a.CONNECTION_TYPE.INPUT_VALUE&&this.source_block.is_collapsed()&&(null===(t=this.target_connection)||void 0===t||t.hide_all(),o.set_visible_as_child(!1)),this.events.enable()}},t.prototype.neighbours_=function(t){var e;return(null===(e=this.db_opposite)||void 0===e?void 0:e.get_neighbours(this,t))||[]},t.prototype.bump_away_from=function(t){if(this.source_block.is_stack_connectable()&&t.get_source_block().is_stack_connectable()){var e=this.source_block.get_workspace();if(!e||!e.is_dragging()){var i=this.source_block.get_root_block();if(!i.is_in_flyout){var o=!1;if(!i.is_movable()){if(!(i=t.get_source_block().get_root_block()).is_movable())return;t=this,o=!0}var n=this.runtime_data.selected==i;n||i.add_select();var r=t.x_+this.theme.blink_params.SNAP_RADIUS-this.x_,_=t.y_+this.theme.blink_params.SNAP_RADIUS-this.y_;o&&(_=-_),i.RTL&&(r=-r),i.move_by(s.vec2.fromValues(r,_)),n||i.remove_select()}}}},t.prototype.unhide_all=function(){this.set_hidden(!1);var t=[];if(this.type!=a.CONNECTION_TYPE.INPUT_VALUE&&this.type!=a.CONNECTION_TYPE.NEXT_STATEMENT)return t;var e=this.targetBlock();if(e){var i=void 0;e.is_collapsed()?(i=[],e.output_connection&&i.push(e.output_connection),e.next_connection&&i.push(e.next_connection),e.previous_connection&&i.push(e.previous_connection)):i=e.get_connections(!0);for(var o=0;o<i.length;o++)t.push.apply(t,i[o].unhide_all());t.length||(t[0]=e)}return t},t.prototype.hide_all=function(){var t;if(this.set_hidden(!0),this.target_connection){var e=this.targetBlock();if(void 0==e)throw new Error("target_block should not be undefined");for(var i=e.get_descendants(),o=0;o<i.length;o++){for(var n=i[o],r=n.get_connections(!0),s=0;s<r.length;s++)r[s].set_hidden(!0);null===(t=n.warning)||void 0===t||t.set_expanded(!1)}}},t.prototype.is_connection_allowed=function(t,e){return!!t.source_block.is_stack_connectable()&&(!(this.distance_from(t)>e)&&function(t){if(t.get_source_block().is_insertion_marker())return!1;if(!t.get_source_block().is_rendered())return!1;if(d.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(t.get_source_block().type)&&t.get_source_block().is_collapsed())return!1;if(t.get_source_block().get_collapsed_surround_parent())return!1;if("procedures_2_defnoreturn"==t.source_block.type&&t.target_connection&&"procedures_2_stable_parameter"==t.target_connection.source_block.type)return!1;if(t.target_connection&&t.target_connection.source_block.is_shadow()&&"param"===t.target_connection.source_block.element_type)return!1;if("script_variables"==t.source_block.type&&t.target_connection&&"script_variables_param"==t.target_connection.source_block.type)return!1;if("traverse_number"==t.source_block.type&&t.target_connection&&"traverse_number_param"==t.target_connection.source_block.type)return!1;if("self_listen_with_param"==t.source_block.type&&t.target_connection&&"self_listen_param"==t.target_connection.source_block.type)return!1;if("on_bump_actor"==t.source_block.type&&t.target_connection&&"on_bump_actor_param"==t.target_connection.source_block.type)return!1;if(this.can_connect_with_reason(t)!=a.CONNECTABLE_TYPE.CAN_CONNECT)return!1;switch(t.type){case a.CONNECTION_TYPE.PREVIOUS_STATEMENT:return this.can_connect_to_previous(t);case a.CONNECTION_TYPE.OUTPUT_VALUE:return!1;case a.CONNECTION_TYPE.INPUT_VALUE:if((e=t.targetBlock())&&t.target_connection&&!e.is_movable()&&!e.is_shadow())return!1;break;case a.CONNECTION_TYPE.NEXT_STATEMENT:var e;if((e=t.targetBlock())&&t.is_connected_to_non_insertion_marker()&&!this.source_block.next_connection&&!e.is_shadow()&&e.next_connection)return!1;break;default:throw new Error("Unknown connection type in is_connection_allowed")}if(-1!=this.runtime_data.dragging_connections.indexOf(t))return!1;return!0}.call(this,t))},t.prototype.distance_from=function(t){var e=this.x_-t.x_,i=this.y_-t.y_;return Math.sqrt(e*e+i*i)},t.prototype.get_shadow_dom=function(){if(this.shadow_dom)return"string"===typeof this.shadow_dom&&(this.shadow_dom=this.utils.string_to_dom(this.shadow_dom)),this.shadow_dom},t.prototype.get_shadow_string=function(){return this.shadow_dom&&"string"!==typeof this.shadow_dom?this.xml.dom_to_text(this.shadow_dom):this.shadow_dom},t.prototype.set_shadow_dom=function(t){this.shadow_dom=t},t.prototype.set_shadow_from_string=function(t){this.shadow_dom=t},t.prototype.connect=function(t,e){if(void 0===e&&(e=!1),this.target_connection==t)return!1;var i=!0;try{this.check_connection(t)}catch(r){e||console.error(r),i=!1}if(!i)return!1;var o=this.is_superior()?this:t,n=this.is_superior()?t:this;return o.connect_to_inferior(n),n.source_block.update_layer_colour(),!0},t.prototype.on_check_changed=function(){if(this.is_connected()&&this.target_connection&&!this.check_type(this.target_connection)){var t=this.is_superior()?this.targetBlock():this.source_block;if(void 0==t)throw new ReferenceError("Connection source block not found.");t.unplug(),this.source_block.bump_neighbours()}},t.prototype.get_output_shape=function(){return this.check_&&1==this.check_.length&&"Boolean"==this.check_[0]?a.OutputShape.HEXAGONAL:a.OutputShape.ROUND},t.prototype.get_xy=function(){return s.vec2.fromValues(this.x_,this.y_)},t.prototype.set_hidden=function(t){this.hidden_=t,this.db_&&(t&&this.in_db?this.db_.remove_connection(this):t||this.in_db||this.db_.add_connection(this))},t.prototype.get_source_block=function(){return this.source_block},t.prototype.dispose=function(){if(this.is_connected())throw new Error("Disconnect connection before disposing of it.");this.in_db&&this.db_&&this.db_.remove_connection(this),delete this.db_,delete this.db_opposite},t.prototype.is_connected_to_non_insertion_marker=function(){var t=this.targetBlock();return!!t&&!t.is_insertion_marker()},t.prototype.disconnect=function(){var t=this.target_connection;if(t){var e,i,o;t.target_connection!==this&&console.error("Target connection not connected to source connection."),this.is_superior()?(e=this.source_block,i=t.get_source_block(),o=this):(e=t.get_source_block(),i=this.source_block,o=t);var n=o==e.get_first_statement_connection(),r=this.ui_event_factory({type:a.UIEventType.DISCONNECT,block_id:i.id,workspace_id:i.get_workspace().id,new_value:n,old_value:n});this.events.is_enabled()&&this.events.fire(r),this.disconnect_internal(e,i),o.respawn_shadow(),i.update_layer_colour()}},t.prototype.set_check=function(t){return t?(this.check_=(0,c.is_array)(t)?t:[t],this.on_check_changed()):this.check_=void 0,this},t.prototype.is_connected=function(){return!!this.target_connection},t.prototype.check_type=function(t){if(!this.check_||!t.check_)return!0;for(var e=0;e<this.check_.length;e++)if(-1!=t.check_.indexOf(this.check_[e]))return!0;return!1},t.prototype.check_connection=function(t){switch(this.can_connect_with_reason(t)){case a.CONNECTABLE_TYPE.CAN_CONNECT:break;case a.CONNECTABLE_TYPE.REASON_SELF_CONNECTION:throw new Error("Attempted to connect a block to itself.");case a.CONNECTABLE_TYPE.REASON_DIFFERENT_WORKSPACES:throw new Error("Blocks not on same workspace.");case a.CONNECTABLE_TYPE.REASON_WRONG_TYPE:throw new Error("Attempt to connect incompatible types.");case a.CONNECTABLE_TYPE.REASON_TARGET_NULL:throw new Error("Target connection is undefined.");case a.CONNECTABLE_TYPE.REASON_CHECKS_FAILED:var e="Connection checks failed. ";throw e+="".concat(this," expected ").concat(this.check_,", found ").concat(t.check_);case a.CONNECTABLE_TYPE.REASON_SHADOW_PARENT:throw new Error("Connecting non-shadow to shadow block.");default:throw new Error("Unknown connection failure: this should never happen!")}},t.prototype.can_connect_with_reason=function(t){return t?(this.is_superior()?(e=this.source_block,i=t.get_source_block()):(i=this.source_block,e=t.get_source_block()),e&&e===i?a.CONNECTABLE_TYPE.REASON_SELF_CONNECTION:t.type!==a.OPPOSITE_TYPE[this.type]?a.CONNECTABLE_TYPE.REASON_WRONG_TYPE:e&&i&&e.get_workspace()!==i.get_workspace()?a.CONNECTABLE_TYPE.REASON_DIFFERENT_WORKSPACES:this.check_type(t)?e.is_shadow()&&!i.is_shadow()&&"param_color"!==e.element_type?a.CONNECTABLE_TYPE.REASON_SHADOW_PARENT:a.CONNECTABLE_TYPE.CAN_CONNECT:a.CONNECTABLE_TYPE.REASON_CHECKS_FAILED):a.CONNECTABLE_TYPE.REASON_TARGET_NULL;var e,i},t.prototype.is_superior=function(){return this.type==a.CONNECTION_TYPE.INPUT_VALUE||this.type==a.CONNECTION_TYPE.NEXT_STATEMENT},t.prototype.remove_shadow=function(){if(this.is_superior()){this.set_shadow_dom(void 0);var t=this.targetBlock();t&&t.is_shadow()&&(this.events.disable(),this.disconnect_internal(this.source_block,t),t.dispose(),this.events.enable())}},o.__decorate([(0,_.lazy_inject)(_.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.xml)],t.prototype,"xml",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.theme)],t.prototype,"theme",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.MoveEvent)],t.prototype,"move_event_factory",void 0),o.__decorate([(0,_.lazy_inject)(_.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),t=e=o.__decorate([(0,n.injectable)()],t)}();e.RenderedConnection=u},16145:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.block_render_svg=void 0;var o=i(98734),n=i(1530),r=i(75102),s=i(37767),_=i(61972),a=i(17946),c=i(44827),l=i(39772),d=i(66517);e.block_render_svg=function(t){return function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fixed_size_rule=[function(t,i){e.is_starting_block()||e.is_collapsed()||t!==e.inputList.length-1||!e.inputList[t-1]||e.inputList[t-1].type!==r.InputType.STATEMENT||(e.inputList[t].height=26,e.inputList[t].width=e.theme.renderer.INPUT_EXTRA_ROW_WIDTH,i.padding_l=52,i.padding_r=16)},function(t,i){(0,_.is_block_group)(e)&&e.group_type===r.BlockGroupType.OUTPUT&&(e.inputList[t].height=48,i.height=48)},function(t){e.is_starting_block()&&e.inputList[t].type===r.InputType.STATEMENT&&(e.inputList[t].render_height=0,e.inputList[t].height=0)}],e}return o.__extends(e,t),e.prototype.get_block_renderer=function(){return this.is_starting_block()?new a.HeadBlockRenderer(this):void 0!=this.output_connection?this.is_shadow()&&"param_color"!==this.element_type?new c.ShadowBlockRenderer(this):new l.OutputBlockRenderer(this):new d.BlockRenderer(this)},e.prototype.render=function(t){this.width=0,this.svg_path_width=0,this.block_renderer=this.get_block_renderer(),this.utils.start_text_cache(),this.rendered=!0;var e=0;this.warning&&(e=this.warning.render_icon(e,this.block_renderer));var i=this._render_compute(e);if(this.render_draw_(i),this.render_move_connections_(),this.comment&&this.comment.rendered&&this.comment.reposition(),!1!==t){var o=this.get_parent();o?o.render(!0):this.workspace.resize_contents()}this.utils.stop_text_cache(),this.update_chunk_visibility()},e.prototype.render_fields_=function(t,e,i){for(var o=0;o<t.length;++o){t[o].layout(e,i)}return e},e.prototype.create_row_for_input_=function(t,e){return Object.assign([],{type:t.type!==r.InputType.STATEMENT?r.InputRowType.INLINE:r.InputRowType.STATEMENT,padding_l:t.type===r.InputType.STATEMENT&&this.is_starting_block()?e:this.block_renderer.padding_l+e,padding_r:this.block_renderer.padding_r,height:0})},e.prototype.compute_input_height_=function(t){return t.type===r.InputType.STATEMENT?this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT:this.block_renderer.min_height},e.prototype.compute_input_width_=function(t){var e;if(!this.is_output_block())return 0;switch(null===(e=t.connection)||void 0===e?void 0:e.get_output_shape()){case r.OutputShape.ROUND:return this.theme.renderer.INPUT_SHAPE_ROUND_WIDTH;case r.OutputShape.HEXAGONAL:return this.theme.renderer.INPUT_SHAPE_HEXAGONAL_WIDTH;default:return 0}},e.prototype._render_compute=function(t){for(var e,i=this.inputList,o=Object.assign([],{type:r.InputRowType.INLINE,right_edge:0,statement_width:0,height:0}),n=this.get_inputs_inline()&&!this.is_collapsed(),s=function(s){var a,c=i[s];if(!c.is_visible())return"continue";n&&void 0!=e&&e!==r.InputType.STATEMENT&&c.type!==r.InputType.STATEMENT?a=o[o.length-1]:(a=_.create_row_for_input_(c,void 0==e?t:0),e=c.type,o.push(a)),a.push(c),c.field_width=0,c.field_height=0;for(var l=0;l<c.fieldRow.length;l++){var d=c.fieldRow[l],u=d.get_size();d.render_sep=a.length>1||l>0||_.is_starting_block()?d.margin_left:0,c.field_width+=d.render_sep+u.width,c.field_height=Math.max(c.field_height,u.height)}if(c.render_width=0,c.render_height=0,c.connection){var h=c.connection.targetBlock();if(h){var p=h.get_height_width();h.is_shadow()&&"param_color"!==h.element_type?c.field_height=Math.max(c.field_height,p.height):c.render_height=Math.max(c.render_height,p.height),c.render_width=Math.max(c.render_width,p.width)}}c.height=Math.max(_.compute_input_height_(a),c.field_height+2*_.block_renderer.get_field_padding_y(),c.render_height+2*_.block_renderer.get_block_padding_y(c.type)),c.width=Math.max(_.compute_input_width_(c),c.field_width+c.render_width),_.fixed_size_rule.forEach((function(t){return t(s,a)})),a.height=Math.max(a.height,c.height)},_=this,a=0;a<i.length;a++)s(a);return o.forEach((function(t){t.forEach((function(e){e.height=t.height}))})),o.right_edge=Math.max(o.right_edge,this.block_renderer.min_width(this)-this.block_renderer.padding_r),o},e.prototype.render_draw_=function(t){var e=[];this.render_draw_top_(e);var i=this.render_draw_right_(e,t);this.render_draw_bottom_(e,i),this.render_draw_left_(e);var o=e.join(" ");this.svg_path&&(this.svg_path.setAttribute("d",o),this.RTL&&this.svg_path.setAttribute("transform","scale(-1 1)"))},e.prototype.render_move_connections_=function(){var t=this.get_relative_to_surface_xy();void 0!=this.previous_connection&&this.previous_connection.move_to_offset(t),void 0!=this.output_connection&&this.output_connection.move_to_offset(t);for(var e=0;e<this.inputList.length;++e){var i=this.inputList[e].connection;i&&(i.move_to_offset(t),i.is_connected()&&i.tighten())}this.next_connection&&(this.next_connection.move_to_offset(t),this.next_connection.is_connected()&&this.next_connection.tighten())},e.prototype.render_draw_top_=function(t){if(this.block_renderer.render_path_start(t,this),void 0!=this.previous_connection){var e=0;this.is_render_notch()&&(e=this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NTOCH_START_PADDING),this.previous_connection.set_offset_in_block(e,0)}},e.prototype.render_draw_right_=function(t,e){for(var i=n.vec2.create(),o=0,a=0,c=0,l=e.length;c<l;c++){var d=e[c],u=e[c-1];i[0]=d.padding_l,d.type==r.InputRowType.INLINE?u&&u.type==r.InputRowType.STATEMENT&&c!==l-1?this.render_row_inline_(t,i,c,e,this.block_renderer.edge_width,Math.max(this.theme.renderer.MIN_WIDTH-o,o)):this.render_row_inline_(t,i,c,e,this.block_renderer.edge_width):d.type==r.InputRowType.STATEMENT&&((void 0!=u&&!this.is_starting_block()||0==this.inputs_inline)&&this.block_renderer.render_edge_shape_right(t,this,!0,i,a),this.render_row_statement(t,i,d,c,e)),i[1]+=d.height,o=i[0],a=d.height}if(0===e.length&&(i[0]=e.right_edge,t.push("H","".concat(i[0])),this.block_renderer.render_edge_shape_right(t,this,this.inputs_inline,i,a),this.width=Math.max(this.width,i[0]+this.block_renderer.padding_r),this.svg_path_width=Math.max(this.width,i[0]+this.block_renderer.padding_r),i[1]=this.block_renderer.min_height),this.height=i[1],e[e.length-1]&&e[e.length-1][0].name===s.COLLAPSED_INPUT_NAME)return this.block_renderer.render_edge_shape_collapsed_right(t,this),i;if((0,_.is_block_group)(this)){var h=this.block_renderer.render_group_decoration_blocks(this);return t.push("h ".concat(h)),i[0]+=h,this.block_renderer.render_edge_shape_group_right(t,this),this.width+=h+this.theme.renderer.GROUP_RIGHT_EXTENDED_WIDTH,this.group_type===r.BlockGroupType.EXECUTION&&(this.height+=this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT+this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT),i}return(e[e.length-1]&&e[e.length-1].type!==r.InputType.STATEMENT||this.is_starting_block())&&this.block_renderer.render_edge_shape_right(t,this,this.inputs_inline,i,a),i},e.prototype.render_row_inline_=function(t,e,i,o,n,s){for(var _=o[i],a=0;a<_.length;a++){var c=_[a];if(e=this.render_fields_(c.fieldRow,e,_.height||0),c.type==r.InputType.VALUE){e[0]+=0===c.fieldRow.length&&0===a?0:c.margin_left;var l=c.connection,d=l.targetBlock();c.connection&&c.connection.get_targe_connection()&&void 0!=d&&l.set_offset_in_block(e[0],e[1]+(_.height-d.height)/2),e[0]+=c.render_width}s&&(e[0]=Math.max(e[0],s))}var u=o.right_edge,h=o[i-1];void 0!=h&&h.type===r.InputType.STATEMENT&&(u=this.theme.renderer.STATEMENT_OTHER_ROW_MIN_WIDTH-this.theme.renderer.BLOCK_EDGE_WIDTH),o.right_edge=Math.max(e[0],u),e[0]=Math.max(e[0],o.right_edge),0===i&&(this.first_row_width=e[0]+_.padding_r,this.first_row_height=_.height),this.width=Math.max(this.width,e[0]+_.padding_r),this.svg_path_width=Math.max(this.width,e[0]+_.padding_r);var p=Math.min(_.height/2,n);t.push("H","".concat(e[0]+_.padding_r-p))},e.prototype.draw_statement_input_=function(t,e,i){this.is_render_notch()&&(t.push("H ".concat(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER)),t.push(this.theme.renderer.NOTCH_PATH_RIGHT)),1==i.length&&0==i[0].fieldRow.length?t.push("H ".concat(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)):t.push("H ".concat(e+this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)),t.push("".concat(this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_TOP," v ").concat(i.height-2*this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS," ").concat(this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_BOTTOM)),this.is_render_notch()&&(t.push("H ".concat(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.NTOCH_START_PADDING)),t.push(this.theme.renderer.NOTCH_PATH_LEFT))},e.prototype.render_row_statement=function(t,e,i,o,n){var _=i[0];this.render_fields_(_.fieldRow,e,i.height||0),this.is_starting_block()&&0!=this.inputs_inline||(this.draw_statement_input_(t,e[0],i),1==i.length&&0==i[0].fieldRow.length||(e[0]+=this.theme.renderer.STATEMENT_MIN_WIDTH));var a=e[0];if(this.is_render_notch()&&(this.is_starting_block()?s.SPECIAL_CONNECTION_INPUT_NAME.includes(_.name)&&(a=this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH):a=this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.STATEMENT_MIN_WIDTH),!_.connection)throw new Error("Statement connection should be renderable.");if(_.connection.set_offset_in_block(a,e[1]),o==n.length-1||n[o+1].type==r.InputType.STATEMENT){if(this.is_starting_block())return;var c=this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT/2,l=Math.max(this.theme.renderer.INPUT_EXTRA_ROW_WIDTH-c,e[0]+this.theme.renderer.ROW_PADDING);t.push("H ".concat(l)),t.push("a ".concat(c," ").concat(c," 0,0,1 0, ").concat(this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT)),e[1]+=this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT}},e.prototype.render_draw_bottom_=function(t,e){if(!s.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)||!this.is_collapsed()){(0,_.is_block_group)(this)&&this.group_type===r.BlockGroupType.EXECUTION&&(this.block_renderer.render_group_bottom(t),e[0]=this.theme.renderer.STATEMENT_MIN_WIDTH,e[1]+=this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT+this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT);var i=this.next_connection||this.is_include_special_input()&&!this.is_collapsed(),o=0;this.is_render_notch()&&i&&(this.block_renderer.render_path_notch_bottom(t),o=this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NTOCH_START_PADDING),this.next_connection&&this.next_connection.set_offset_in_block(o,e[1])}},e.prototype.render_draw_left_=function(t){void 0!=this.output_connection&&this.output_connection.set_offset_in_block(0,0),this.block_renderer.render_path_end(t,this),t.push("z")},e}(t)}},66517:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockRenderer=void 0;var o=i(98734),n=i(75102),r=i(98030),s=i(25461),_=function(){function t(t){this.edge_width=this.theme.renderer.BLOCK_EDGE_WIDTH,this.padding_l=this.theme.renderer.ROW_PADDING,this.padding_r=this.theme.renderer.ROW_PADDING,this.min_height=this.theme.renderer.MIN_HEIGHT,this.CORNER_LEFT_TOP="a ".concat(this.theme.renderer.CORNER_RADIUS," ").concat(this.theme.renderer.CORNER_RADIUS," 0 0 1 ").concat(this.theme.renderer.CORNER_RADIUS," -").concat(this.theme.renderer.CORNER_RADIUS),this.CORNER_LEFT_BOTTOM="a ".concat(this.theme.renderer.CORNER_RADIUS," ").concat(this.theme.renderer.CORNER_RADIUS," 0 0 1 -").concat(this.theme.renderer.CORNER_RADIUS," -").concat(this.theme.renderer.CORNER_RADIUS),t.is_render_notch()&&(this.padding_l=this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER+this.theme.renderer.NOTCH_WIDTH,this.padding_r=this.theme.renderer.ROW_PADDING+8,void 0!==this.theme.renderer.ROW_PADDING_LEFT_WITH_NOTCH&&(this.padding_l=t.is_wrap_shape()?this.theme.renderer.ROW_PADDING+this.theme.renderer.ROW_PADDING_LEFT_WITH_NOTCH:this.theme.renderer.ROW_PADDING_LEFT_WITH_NOTCH),void 0!==this.theme.renderer.ROW_PADDING_RIGHT_WITH_NOTCH&&(this.padding_r=this.theme.renderer.ROW_PADDING_RIGHT_WITH_NOTCH))}return t.prototype.min_width=function(t){return(t&&t.is_render_notch()||t)&&this.theme.renderer.MIN_WIDTH},t.prototype.render_path_start=function(t,e){t.push("m 0,".concat(this.theme.renderer.CORNER_RADIUS)),t.push(this.CORNER_LEFT_TOP),e.is_render_notch()&&void 0!=e.previous_connection&&this.render_path_notch_top(t)},t.prototype.render_path_notch_top=function(t){t.push("H","".concat(this.theme.renderer.NTOCH_START_PADDING)),t.push(this.theme.renderer.NOTCH_PATH_LEFT)},t.prototype.render_path_notch_bottom=function(t){t.push("H","".concat(this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER)),t.push(this.theme.renderer.NOTCH_PATH_RIGHT)},t.prototype.render_edge_shape_right=function(t,e,i,o,n){void 0===i&&(i=!0);var r=n?Math.min(n/2,this.edge_width):this.edge_width,s=e.height;t.push("a ".concat(r," ").concat(r," 0 0 1 ").concat(r," ").concat(r)),0==i?t.push("V ".concat(s-this.min_height/2)):(o[1]>2*r&&!n&&t.push("v ".concat(o[1]-2*r)),n&&t.push("v ".concat(n-2*r))),t.push("a ".concat(r," ").concat(r," 0 0 1 -").concat(r," ").concat(r))},t.prototype.render_edge_shape_collapsed_right=function(t,e){var i=e.height;t.push(this.theme.renderer.COLLAPSED_PATH),t.push("v ".concat(i-this.min_height+e.height/2))},t.prototype.render_edge_shape_group_right=function(t,e){var i=e.height-5.5-3.5;t.push("h ".concat(this.theme.renderer.GROUP_RIGHT_EDGE_WIDTH,"\n      ").concat(this.theme.renderer.GROUP_TOP_RIGHT_PATH,"\n      l -8.6 ").concat(i,"\n      ").concat(this.theme.renderer.GROUP_BOTTOM_RIGHT_PATH))},t.prototype.render_path_end=function(t,e){var i=e.is_render_notch()?this.theme.renderer.CORNER_RADIUS:this.theme.renderer.CORNER_RADIUS_END_BLOCK_WITHOUD_NOTCH;if(e.is_ending_block())return t.push("H",i.toString()),void t.push("a","".concat(i,",").concat(i," 0 0,1 -").concat(i,",-").concat(i));t.push("H ".concat(this.theme.renderer.CORNER_RADIUS)),t.push(this.CORNER_LEFT_BOTTOM)},t.prototype.get_decoration_path=function(t,e,i,o,n){var r=o-28*t,_=n?12:8;return(0,s.create_svg_element)("path",{d:"\n        m ".concat(this.theme.renderer.STATEMENT_MIN_WIDTH+4*t," ").concat(_+8*t,",\n        h ").concat(r,",\n        v 20, a 20 20 0 0 1 -20 20,\n        h -").concat(r-22,",\n        a 2 2 0 0 1 -2 -2, z"),fill:e.toString(),stroke:i.toString(),class:"decoration_for_collapsed_blocks"})},t.prototype.render_group_decoration_blocks=function(t){if(!t.svg_path)return 0;t.decoration_block_paths.forEach(s.remove_node),t.decoration_block_paths.length=0;var e=t.origin_block,i=e.get_full_next_block(),o=Math.min(this.theme.renderer.EXECUTION_GROUP_DECORATION_WIDTH,t.width-this.theme.renderer.STATEMENT_MIN_WIDTH-this.theme.renderer.EXECUTION_GROUP_DECORATION_RIGHT_MARGIN);if(i){var n=this.get_decoration_path(1,i.get_original_colour(),i.get_border_colour(),o,!1);t.decoration_block_paths.unshift(n),t.svg_group.insertBefore(n,t.svg_path)}var r=this.get_decoration_path(0,e.get_original_colour(),e.get_border_colour(),o,!i);return t.decoration_block_paths.unshift(r),t.svg_group.insertBefore(r,t.svg_path),0},t.prototype.render_group_bottom=function(t){t.push("H ".concat(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)),t.push(this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_TOP),t.push("v ".concat(this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT-2*this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)),t.push(this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_BOTTOM),t.push(this.theme.renderer.GROUP_EXTRA_ROW_RIGHT)},t.prototype.get_field_padding_y=function(){return this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_FIELD},t.prototype.get_block_padding_y=function(t){return t!==n.InputType.VALUE?this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_STATEMENT_BLOCK:this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_VALUE_BLOCK},o.__decorate([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),t}();e.BlockRenderer=_},17946:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.HeadBlockRenderer=void 0;var o=i(98734),n=i(25461),r=function(t){function e(e){var i=t.call(this,e)||this;return i.padding_l=i.theme.renderer.ROW_PADDING_HEAD,e.is_render_notch()&&(i.padding_l=i.theme.renderer.NTOCH_START_PADDING+i.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER+i.theme.renderer.NOTCH_WIDTH-i.theme.renderer.SEP_SPACE_X,void 0!==i.theme.renderer.ROW_PADDING_HEAD_WITH_NOTCH&&(i.padding_l=i.theme.renderer.ROW_PADDING_HEAD+i.theme.renderer.ROW_PADDING_HEAD_WITH_NOTCH-i.theme.renderer.SEP_SPACE_X)),i}return o.__extends(e,t),e.prototype.get_decoration_path=function(t,e,i,o){var r=o-28*t;return(0,n.create_svg_element)("path",{d:"\n        m ".concat(4*t," ").concat(8+8*t,",\n        h ").concat(r,",\n        v 20, a 20 20 0 0 1 -20 20,\n        h -").concat(r-22,",\n        a 2 2 0 0 1 -2 -2, z"),fill:e.toString(),stroke:i.toString(),class:"decoration_for_collapsed_blocks"})},e.prototype.render_group_decoration_blocks=function(t){t.decoration_block_paths.forEach(n.remove_node),t.decoration_block_paths.length=0;var e=Math.min(this.theme.renderer.EXECUTION_GROUP_DECORATION_WIDTH,t.width-this.theme.renderer.EXECUTION_GROUP_DECORATION_RIGHT_MARGIN),i=t.origin_block.get_full_next_block();if(i){var o=i.get_full_next_block();if(o){var r=this.get_decoration_path(1,o.get_original_colour(),o.get_border_colour(),e);t.decoration_block_paths.unshift(r),t.svg_group.insertBefore(r,t.svg_path)}var s=this.get_decoration_path(0,i.get_original_colour(),i.get_border_colour(),e);t.decoration_block_paths.unshift(s),t.svg_group.insertBefore(s,t.svg_path)}return 0},e}(i(66517).BlockRenderer);e.HeadBlockRenderer=r},39772:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.OutputBlockRenderer=void 0;var o=i(98734),n=i(75102),r=i(25461),s=function(t){function e(e){var i=t.call(this,e)||this;return i.padding_l=i.theme.renderer.ROW_PADDING_OUTPUT,i.padding_r=i.theme.renderer.ROW_PADDING_OUTPUT,i.edge_width=i.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT,i.min_height=i.theme.renderer.MIN_HEIGHT_OUTPUT,e.get_output_shape()===n.OutputShape.HEXAGONAL&&(i.edge_width=i.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT_HEXAGONAL),i}return o.__extends(e,t),e.prototype.min_width=function(t){return t&&this.theme.renderer.MIN_WIDTH_OUTPUT},e.prototype.render_path_start=function(t,e){e&&t.push("m ".concat(this.edge_width,",0"))},e.prototype.render_edge_shape_right=function(t,e){if(e.get_output_shape()===n.OutputShape.HEXAGONAL)t.push("a ".concat(this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS,", ").concat(this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS," 0 0,1 \n          ").concat(this.theme.renderer.CORNER_OFFSET_X,", ").concat(this.theme.renderer.CORNER_OFFSET_Y)),t.push("l ".concat(this.edge_width," ").concat(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a ".concat(this.theme.renderer.HEX_CENTER_CORNER_RADIUS,", ").concat(this.theme.renderer.HEX_CENTER_CORNER_RADIUS," 0 0,1 \n          0, ").concat(this.theme.renderer.CENTER_CORNER_OFFSET)),t.push("l -".concat(this.edge_width," ").concat(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a ".concat(this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS,",").concat(this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS," 0 0,1 \n          -").concat(this.theme.renderer.CORNER_OFFSET_X,", ").concat(this.theme.renderer.CORNER_OFFSET_Y));else{t.push("a ".concat(this.edge_width," ").concat(this.edge_width," 0 0 1 ").concat(this.edge_width," ").concat(this.edge_width));var i=e.height-2*this.edge_width;i>0&&t.push("v ".concat(i)),t.push("a ".concat(this.edge_width," ").concat(this.edge_width," 0 0 1 -").concat(this.edge_width," ").concat(this.edge_width))}},e.prototype.render_path_end=function(t,e){if(e.get_output_shape()===n.OutputShape.HEXAGONAL)t.push("H ".concat(this.edge_width)),t.push("a ".concat(this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS,",").concat(this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS," 0 0,1 \n          -").concat(this.theme.renderer.CORNER_OFFSET_X,", -").concat(this.theme.renderer.CORNER_OFFSET_Y)),t.push("l -".concat(this.edge_width," -").concat(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a ".concat(this.theme.renderer.HEX_CENTER_CORNER_RADIUS,",").concat(this.theme.renderer.HEX_CENTER_CORNER_RADIUS," 0 0,1 \n            0, -").concat(this.theme.renderer.CENTER_CORNER_OFFSET)),t.push("l ".concat(this.edge_width," -").concat(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a ".concat(this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS,",").concat(this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS," 0 0,1 \n          ").concat(this.theme.renderer.CORNER_OFFSET_X,", -").concat(this.theme.renderer.CORNER_OFFSET_Y));else{t.push("H ".concat(this.edge_width)),t.push("a ".concat(this.edge_width," ").concat(this.edge_width," 0 0 1 -").concat(this.edge_width," -").concat(this.edge_width));var i=e.height-2*this.edge_width;i>0&&t.push("v -".concat(i)),t.push("a ".concat(this.edge_width," ").concat(this.edge_width," 0 0 1 ").concat(this.edge_width," -").concat(this.edge_width))}},e.prototype.render_edge_shape_collapsed_right=function(t,e){var i=e.height;t.push(this.theme.renderer.COLLAPSED_PATH),t.push("v ".concat(i-this.min_height+e.height/2-this.theme.renderer.CORNER_OFFSET_X))},e.prototype.get_layered_value_descendants=function(t,e){var i;if(void 0===e&&(e=!0),!t.output_connection)return[];for(var o=[],r=0;r<t.inputList.length;r++){var s=t.inputList[r];if(s.type===n.InputType.VALUE){var _=null===(i=s.connection)||void 0===i?void 0:i.targetBlock();if(!(!_||e&&_.is_shadow()))for(var a=this.get_layered_value_descendants(_,e),c=0;c<a.length;c++)o[c]=o[c]||[],o[c]=o[c].concat(a[c])}}return o.unshift([t]),o},e.prototype.select_output_group_children=function(t){for(var e,i,o=t.origin_block,n=this.get_layered_value_descendants(o,!0),r=[],s=1;s<n.length;s++)r=r.concat(n[s]);var _=function(t){return t.get_original_colour()===o.get_original_colour()};for(s=0;s<r.length;s++){var a=r[s];if(e)if(i){if(!_(e)&&!_(i))break;_(i)||(e=i),i=a}else i=a;else e=a}return[e,i]},e.prototype.render_decoration_block=function(t,e,i,o,s){var _=i;return s===n.OutputShape.HEXAGONAL?(0,r.create_svg_element)("path",{d:"\n            m ".concat(e+t*this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET-5," 6,\n            h ").concat(_+10,",\n            a 3,3 0 0,1 2,1\n            l ").concat(this.edge_width," ").concat(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X,",\n            a 2,2 0 0,1 0,2\n            l -").concat(this.edge_width," ").concat(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X,"\n            a 3,3 0 0,1 -2,1\n            h -").concat(_+10,",\n            a 3,3 0 0,1 -2,-1\n            l -").concat(this.edge_width," -").concat(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X,"\n            a 2,2 0 0,1 0,-2\n            l ").concat(this.edge_width," -").concat(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X,"\n            a 3,3 0 0,1 2,-1\n          "),fill:o.get_original_colour(),stroke:o.get_border_colour(),class:"decoration_for_collapsed_blocks"}):(0,r.create_svg_element)("path",{d:"\n            m ".concat(e+t*this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET," 6,\n            h ").concat(_,",\n            a ").concat(this.edge_width," ").concat(this.edge_width," 0 0 1 0 ").concat(2*this.edge_width,",\n            h -").concat(_,",\n            a ").concat(this.edge_width," ").concat(this.edge_width," 0 0 1 0 -").concat(2*this.edge_width),fill:o.get_original_colour(),stroke:o.get_border_colour(),class:"decoration_for_collapsed_blocks"})},e.prototype.render_group_decoration_blocks=function(t){t.decoration_block_paths.forEach(r.remove_node),t.decoration_block_paths.length=0;var e=this.select_output_group_children(t),i=e[0],o=e[1],s=0,_=t.get_field(n.BLOCK_GROUP_TAG_FIELD_NAME),a=this.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT+this.theme.renderer.SEP_SPACE_X+_.get_size().width+this.theme.renderer.SEP_SPACE_X+this.theme.renderer.OUTPUT_GROUP_DECORATION_PADDING,c=t.get_field(n.BLOCK_GROUP_NAME_FIELD_NAME).get_size().width,l=t.origin_block.get_output_shape()||n.OutputShape.ROUND,d=this.render_decoration_block(0,a,c,t.origin_block,l);if(o){var u=this.render_decoration_block(2,a,c,o,l);t.decoration_block_paths.unshift(u),t.svg_group.insertBefore(u,t.svg_group.lastChild),s+=this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET}if(i){var h=this.render_decoration_block(1,a,c,i,l);t.decoration_block_paths.unshift(h),t.svg_group.insertBefore(h,t.svg_group.lastChild),s+=this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET}return t.decoration_block_paths.unshift(d),t.svg_group.insertBefore(d,t.svg_group.lastChild),s+=this.theme.renderer.OUTPUT_GROUP_DECORATION_PADDING},e.prototype.get_field_padding_y=function(){return this.theme.renderer.OUTPUT_ROW_PADDING_Y_TO_FIELD},e.prototype.get_block_padding_y=function(){return this.theme.renderer.OUTPUT_ROW_PADDING_Y_TO_VALUE_BLOCK},e}(i(66517).BlockRenderer);e.OutputBlockRenderer=s},44827:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ShadowBlockRenderer=void 0;var o=i(98734),n=i(75102),r=i(61972),s=function(t){function e(e){var i=t.call(this,e)||this;if("param"===e.element_type||"param_color"===e.element_type)return i;switch(i.padding_l=i.theme.renderer.ROW_PADDING_SHADOW,i.padding_r=i.theme.renderer.ROW_PADDING_SHADOW,i.min_height=i.theme.renderer.MIN_HEIGHT_SHADOW,e.get_output_shape()){case n.OutputShape.HEXAGONAL:i.edge_width=i.theme.renderer.BLOCK_EDGE_WIDTH_SHADOW_HEXAGONAL;break;case n.OutputShape.ROUND:i.edge_width=i.theme.renderer.BLOCK_EDGE_WIDTH_SHADOW_ROUND;break;default:i.edge_width=i.theme.renderer.BLOCK_EDGE_WIDTH_SHADOW}return 1!==e.inputList.length||1!==e.inputList[0].fieldRow.length||(0,r.is_field_number)(e.inputList[0].fieldRow[0])||(0,r.is_field_text_input)(e.inputList[0].fieldRow[0])||(0,r.is_field_default_value)(e.inputList[0].fieldRow[0])||(i.padding_l=i.theme.renderer.ROW_PADDING_OUTPUT_NON_TEXT,i.padding_r=i.theme.renderer.ROW_PADDING_OUTPUT_NON_TEXT),i}return o.__extends(e,t),e.prototype.min_width=function(e){return"param"===e.element_type||"param_color"===e.element_type?t.prototype.min_width.call(this,e):e.get_output_shape()===n.OutputShape.HEXAGONAL?this.theme.renderer.MIN_WIDTH_SHADOW_HEXAGONAL-(this.theme.renderer.CORNER_OFFSET_X+this.theme.renderer.CORNER_OFFSET_X+.54):this.theme.renderer.MIN_WIDTH_SHADOW},e.prototype.get_field_padding_y=function(){return this.theme.renderer.SHADOW_ROW_PADDING_Y_TO_FIELD},e.prototype.get_block_padding_y=function(){return 0},e}(i(39772).OutputBlockRenderer);e.ShadowBlockRenderer=s},81563:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceComment=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=i(75102),a=i(3909),c=i(37767),l=i(25461),d=i(11214),u=i(61972),h=i(23257),p=[214,126],g=[140,68],f=[40,40],v=function(t){function e(e,i,o,n,s,_){var a=t.call(this,e)||this;a.element_type="comment",a.SIZE=24,a.width=f[0],a.height=f[1],a.left_top_offset=[-12,-12],a.color_theme="BLUE",a.text_="",a.bubble_width_=p[0],a.bubble_height_=p[1],a.parent_width_=0,a.relative_position_=r.vec2.create(),a.expanded_=!1,a.prev_text_l=0,a.is_textarea_focused=!1,a.auto_layout_=!0,a.parent_block_=i,_&&(p[0]=_[0],p[1]=_[1],a.bubble_width_=p[0],a.bubble_height_=p[1]);var c=a.workspace.is_resizes_enabled();if(a.workspace.set_resizes_enabled(!1),a.events.disable(),a.id=void 0!=n?n:(0,d.gen_uid)(),a.svg_group.classList.add("blocklyWorkspaceComment"),a.update_movable(),i){if(i.is_rendered()){a.parent_width_=i.first_row_width;var l=i.is_starting_block(),h=s?"pc"===s?a.parent_width_+160:l?-43:-20:a.parent_width_+60;a.relative_position_=r.vec2.fromValues(h,i.first_row_height/2)}a.deletable_=!1}var g=void 0;if(o)if(a.parent_block_){g=(0,u.clone_deep)(a.get_relative_position()),a.set_relative_position(r.vec2.fromValues(o.x,o.y));var v=a.parent_block_.get_relative_to_surface_xy();a.translate(r.vec2.add(v,v,a.relative_position_))}else a.translate(r.vec2.fromValues(o.x,o.y));if(e.workspace_comment_db.set(a.id,a),i||e.add_top_comment(a),a.init_events(),a.events.enable(),a.events.is_enabled()){if(a.parent_block_){var m=a.change_event_factory("comment",{block:a.parent_block_,old_value:void 0,new_value:a.id});a.events.fire(m)}else a.events.fire(a.create_event_factory({block:a}));if(o&&a.parent_block_){var b=a.move_event_factory({block:a});b.set_record_undo(!1),g&&b.set_old_coord(g),b.record_new(),a.events.fire(b)}}return a.workspace.set_resizes_enabled(c),a}return o.__extends(e,t),e.prototype.init_svg=function(){var t;this.parent_block_&&!this.svg_line_&&(this.svg_line_=(0,l.create_svg_element)("line",{class:"blocklyCommentLine",x1:0,y1:0},this.svg_group),this.svg_line_.style.stroke=_.THEME_COLOR_MAP[this.color_theme].toString()),this.svg_icon||(this.svg_icon=(0,l.create_svg_element)("g",{class:"blocklyCommentGroup",filter:"url(#".concat(a.FILTER.BOXSHADOW,")")}),this.draw_icon(this.svg_icon),this.events.bind_event_with_checks(this.svg_icon,"mouseup",this,this.on_icon_click)),this.reposition(),this.expanded_?this.show_editor():this.update_icon(),this.rendered=!0,null===(t=this.workspace.get_canvas())||void 0===t||t.appendChild(this.svg_group)},e.prototype.update_icon=function(){this.svg_icon&&(this.svg_icon.setAttribute("transform","translate(".concat(this.left_top_offset[0],", ").concat(this.left_top_offset[1],")")),this.expanded_||this.svg_group.appendChild(this.svg_icon))},e.prototype.get_icon=function(){return this.svg_icon},e.prototype.draw_line=function(){if(this.parent_block_&&this.svg_group&&this.svg_line_){var t=this.compute_line_connect_position();t[0]!==Number(this.svg_line_.getAttribute("x2"))&&this.svg_line_.setAttribute("x2","".concat(t[0])),t[1]!==Number(this.svg_line_.getAttribute("y2"))&&this.svg_line_.setAttribute("y2","".concat(t[1]))}},e.prototype.draw_icon=function(t,e,i){e=e||this.SIZE,i=i||"url(#CommentLinearGradient-".concat(this.color_theme,")"),(0,l.create_svg_element)("circle",{class:"blocklyCommentShape",r:e/2,cx:e/2,cy:e/2,fill:i},t),(0,l.create_svg_element)("path",{class:"blocklyCommentSymbol",transform:"scale(".concat(e/24,") translate(4,4)"),d:"M6.98347343,1.49411736 C7.33446274,1.16471383 7.86095956,1 8.38745638,1 C8.91395321,1 9.44045003,1.16471383 9.79146505,1.49411736 C10.2301953,1.82354502 10.4057028,2.23529341 10.4057028,2.72941077 C10.4057028,3.22352813 10.2301953,3.63530065 9.79146505,3.96470418 C9.35270913,4.29413184 8.91395321,4.45882154 8.38745638,4.45882154 C7.86095956,4.45882154 7.33446274,4.29413184 6.89573253,3.96470418 C6.54471751,3.63530065 6.28146909,3.22352813 6.28146909,2.72941077 C6.3692357,2.23529341 6.54471751,1.82354502 6.98347343,1.49411736 L6.98347343,1.49411736 Z M10.3500141,14.3956806 C9.75084061,14.5982168 9.33065616,14.744752 9.08946072,14.8352862 C8.6507048,15 8.21197458,15 7.68547776,15 C6.89573253,15 6.19372819,14.8352862 5.75497227,14.4235378 C5.31624206,14.0117653 5.05299365,13.5999928 5.05299365,13.0235305 C5.05299365,12.7764719 5.05299365,12.611758 5.14073455,12.3646994 C5.14073455,12.1176407 5.22847545,11.870582 5.31624206,11.6235233 L6.19372819,8.90587781 C6.28146909,8.65881913 6.3692357,8.41176045 6.3692357,8.16470177 C6.4569766,7.91764308 6.4569766,7.75295338 6.4569766,7.5058947 C6.4569766,7.17646704 6.3692357,6.92940836 6.19372819,6.76471866 C6.01822068,6.60000483 5.75497227,6.60000483 5.31624206,6.60000483 C5.05299365,6.60000483 4.87748614,6.60000483 4.61423772,6.68234968 C4.52669943,6.70973993 4.43188454,6.73712818 4.32979305,6.76451443 C4.19006969,6.80197087 4.04642345,6.71909078 4.00894402,6.57937358 C4.00300701,6.55724137 4,6.53442576 4,6.51151108 C4,6.30823881 4.12437054,6.12566505 4.31352762,6.05123915 C5.07451793,5.75187496 5.58425502,5.57793699 5.84273888,5.52942525 C6.3692357,5.36471142 6.80796592,5.28236657 7.33446274,5.28236657 C8.12420797,5.28236657 8.82621231,5.44705627 9.26496823,5.85882878 C9.70369844,6.18823231 9.96694685,6.68234968 9.96694685,7.25883602 L9.96694685,7.91764308 C9.96694685,8.24707075 9.87920595,8.49412943 9.79146505,8.74118811 L8.91395321,11.4588336 C8.82621231,11.7058923 8.73847141,11.952951 8.73847141,12.2000097 C8.6507048,12.4470683 8.6507048,12.694127 8.6507048,12.8588167 C8.6507048,13.1882444 8.73847141,13.4353031 8.91395321,13.5999928 C9.08946072,13.7647066 9.35270913,13.7647066 9.87920595,13.7647066 C10.0547135,13.7647066 10.3179619,13.7647066 10.5812103,13.6823617 C10.6420133,13.6633368 10.7063269,13.6443129 10.7741511,13.6252899 C10.8691243,13.5986609 10.967707,13.6540565 10.9943439,13.7490274 C11.0075127,13.7959791 11.0009105,13.8462737 10.97607,13.8882359 C10.8348216,14.1268423 10.6126922,14.3068868 10.3500141,14.3956806 Z"},t)},e.prototype.on_icon_click=function(t){this.workspace.is_dragging()||this.utils.is_right_button(t)||this.set_expanded(!0)},e.prototype.get_bounding_rectangle=function(){var e=t.prototype.get_bounding_rectangle.call(this),i=e.topLeft,o=e.bottomRight;return{topLeft:r.vec2.add(r.vec2.create(),i,this.left_top_offset),bottomRight:r.vec2.add(r.vec2.create(),o,this.left_top_offset)}},e.prototype.get_parent_block=function(){return this.parent_block_},e.prototype.get_top_parent=function(){return this.get_root_block()||this},e.prototype.get_root_block=function(){for(var t=this.parent_block_;null===t||void 0===t?void 0:t.parent_block;)t=t.parent_block;return t},e.prototype.dispose=function(e,i){var o;this.events.is_enabled()&&(o=this.parent_block_?this.change_event_factory("comment",{block:this.parent_block_,old_value:this.xml.comment_to_dom_with_xy(this),new_value:void 0}):this.delete_event_factory({block:this})),this.workspace.workspace_comment_db.delete(this.id),this.parent_block_||this.workspace.remove_top_comment(this),t.prototype.dispose.call(this,e,i&&!this.parent_block_),this.events.fire(o)},e.prototype.show_context_menu=function(t){var e=this;if(!this.workspace.get_options().readOnly&&this.context_menu&&!this.is_in_flyout){var i=function(t){var i=(0,l.create_svg_element)("g",{width:16,height:16});return e.draw_icon(i,16,_.THEME_COLOR_MAP[t].toString()),i},o=function(t){var i=e.color_theme;i!==t&&(e.set_color_theme(t),e.events.is_enabled()&&e.events.fire(e.change_event_factory("comment_color",{block:e,old_value:i,new_value:t})))},n=[{text:this.Msg.BLUE_COMMENT,name:"comment_set_color_blue",enabled:!0,callback:o.bind(this,"BLUE"),icon:i("BLUE"),selected:"BLUE"===this.color_theme},{text:this.Msg.GREEN_COMMENT,name:"comment_set_color_green",enabled:!0,callback:o.bind(this,"GREEN"),icon:i("GREEN"),selected:"GREEN"===this.color_theme},{text:this.Msg.YELLOW_COMMENT,name:"comment_set_color_yellow",enabled:!0,callback:o.bind(this,"YELLOW"),icon:i("YELLOW"),selected:"YELLOW"===this.color_theme},{text:this.Msg.RED_COMMENT,name:"comment_set_color_red",enabled:!0,callback:o.bind(this,"RED"),icon:i("RED"),selected:"RED"===this.color_theme},{text:this.Msg.DELETE_COMMENT,name:"comment_delete",enabled:!0,callback:function(){e.parent_block_?e.parent_block_.set_comment_text(void 0):e.dispose(void 0,!0)}}];this.context_menu.current_block=this,this.context_menu.show(t,{source:"block",options:n},this.RTL)}},e.prototype.get_color_theme=function(){return this.color_theme},e.prototype.get_colour=function(){return _.THEME_COLOR_MAP[this.color_theme]},e.prototype.set_color_theme=function(t,e){var i=this;if(t!==this.color_theme)if((0,u.is_comment_theme)(t)){var o=_.THEME_COLOR_MAP[this.color_theme];this.color_theme=t;var n,r=_.THEME_COLOR_MAP[this.color_theme];if(this.svg_line_&&(this.svg_line_.style.stroke=r.toString()),this.bubble_&&(this.bubble_.style.background="linear-gradient(to bottom, ".concat(r," 4px, #fff 4px)"),this.expanded_&&!e&&this.empty_border&&(this.empty_border.classList.add("blocklyCommentBorder"),this.empty_border.style.backgroundColor=o.toString(),this.empty_border.addEventListener("animationend",(function(){i.empty_border&&(i.empty_border.classList.remove("blocklyCommentBorder"),i.empty_border.style.backgroundColor="transparent")})))),this.svg_icon)(n=this.svg_icon.querySelector("circle"))&&n.setAttribute("fill","url(#CommentLinearGradient-".concat(this.color_theme,")"));if(this.sub_icon)(n=this.sub_icon.querySelector("circle"))&&n.setAttribute("fill",r.toString())}else console.warn("Trying to set invalid color theme: ".concat(t))},e.prototype.move_by=function(t){var e;this.events.is_enabled()&&(e=this.move_event_factory({block:this}));var i=this.get_relative_to_surface_xy();this.translate(r.vec2.add(this.location_,i,t)),this.parent_block_&&(r.vec2.add(this.relative_position_,this.relative_position_,t),this.draw_line()),e&&e.record_new(),this.rendered&&this.workspace.resize_contents(),e&&this.events.fire(e)},e.prototype.sort=function(t){var e=this.get_relative_to_surface_xy(),i=r.vec2.fromValues(t[0]+20,t[1]+20);this.move_by(r.vec2.sub(e,i,e)),r.vec2.add(t,t,[0,this.get_height_width().height+this.theme.renderer.MIN_HEIGHT])},e.prototype.get_text=function(){return this.text_},e.prototype.set_text=function(t){var e;this.text_!=t&&(this.events.is_enabled()&&(e=this.change_event_factory("comment_text",{block:this,old_value:this.text_,new_value:t})),this.text_=t),this.textarea_&&(this.textarea_.value=t),this.text_layout(),e&&this.events.fire(e)},e.prototype.get_bubble_size=function(){return{width:this.bubble_width_,height:this.bubble_height_}},e.prototype.set_bubble_size=function(t,e){(t=Math.max(g[0],t))!==this.bubble_width_&&(this.bubble_width_=t,this.bubble_&&this.bubble_.setAttribute("width","".concat(t)),this.bubble_shadow_&&this.bubble_shadow_.setAttribute("width","".concat(t)),this.expanded_&&(this.width=t)),(e=Math.max(g[1],e))!==this.bubble_height_&&(this.bubble_height_=e,this.bubble_&&this.bubble_.setAttribute("height","".concat(e)),this.bubble_shadow_&&this.bubble_shadow_.setAttribute("height","".concat(e)),this.expanded_&&(this.height=e))},e.prototype.get_relative_position=function(){return this.parent_block_?this.relative_position_:this.location_},e.prototype.set_relative_position=function(t){this.relative_position_=t},e.prototype.set_expanded=function(t){var e;t!=this.expanded_&&(this.expanded_=t,this.rendered&&(this.events.is_enabled()&&(e=this.change_event_factory("comment_expand",{block:this,old_value:!t,new_value:t})),t?this.show_editor():this.hide_editor(),this.update_visibility(),this.events.fire(e),this.workspace.resize_contents()))},e.prototype.is_expanded=function(){return this.expanded_},e.prototype.update_visibility=function(){if(this.parent_block_){var t=this.parent_block_;(0,u.is_block_svg)(t)&&(t=t.get_root_block());var e=t.get_visibility();(0,l.update_visibility_class)(this.svg_group,e)}},e.prototype.reposition=function(){if(this.parent_block_&&this.parent_block_.is_rendered()){var t=this.parent_block_.get_relative_to_surface_xy();if(this.parent_width_&&this.parent_width_!==this.parent_block_.first_row_width)this.relative_position_[0]>this.parent_width_/2&&(this.relative_position_[0]-=this.parent_width_,this.relative_position_[0]+=this.parent_block_.first_row_width);this.parent_width_=this.parent_block_.first_row_width,this.translate(r.vec2.add(t,t,this.relative_position_)),this.draw_line()}},e.prototype.show_editor=function(){var t=this;if(this.svg_icon&&(0,l.remove_node)(this.svg_icon),this.left_top_offset=[-20,-20],!this.bubble_||!this.bubble_shadow_){this.bubble_=(0,l.create_svg_element)("foreignObject",{width:this.bubble_width_,height:this.bubble_height_,class:"blocklyCommentBubble",transform:"translate(".concat(this.left_top_offset[0],", ").concat(this.left_top_offset[1],")")}),this.bubble_.style.background="linear-gradient(to bottom, ".concat(_.THEME_COLOR_MAP[this.color_theme]," 4px, #fff 4px)"),this.empty_border=document.createElement("div"),this.empty_border.classList.add("blockCommentEmptyBorder"),this.bubble_.appendChild(this.empty_border);var e=document.createElement("div");e.classList.add("blocklyCommentBubbleLabel");var i=document.createElement("div");this.sub_icon=(0,l.create_svg_element)("svg",{width:14,height:14,class:"blocklyCommentBubbleIcon"},i),this.draw_icon(this.sub_icon,14,_.THEME_COLOR_MAP[this.color_theme].toString());var o=document.createElement("div");o.textContent=this.Msg.COMMENT,i.appendChild(o),e.appendChild(i);var n=(0,l.create_svg_element)("svg",{width:12,height:12,class:"blocklyCommentBubbleClose"},e);(0,l.create_svg_element)("path",{d:"m8,4 l3.834 3.834 c0.352,0.352 0.352,0.92 0,1.278 l-0.32,0.32 c-0.352,0.352 -0.92,0.352 -1.278,0 l-2.926,-2.926 l-2.926,2.926 c-0.352,0.352 -0.92,0.352 -1.278,0 l-0.32,-0.32 c-0.352,-0.352 -0.352,-0.92 0,-1.278 l3.834,-3.834 q 0.6892,-0.8 1.3784,0 z"},n),e.appendChild(n),this.textarea_=document.createElementNS(c.HTML_NS,"textarea"),this.textarea_.classList.add("blocklyCommentTextarea"),this.textarea_.placeholder=this.parent_block_?this.Msg.WHATS_THIS:this.Msg.SAY_SOMETHING,this.events.bind_event_with_checks(this.textarea_,"mousedown",this,this.textarea_mouse_down),this.events.bind_event_with_checks(this.textarea_,"blur",this,(function(e){e.stopPropagation(),e.preventDefault(),t.textarea_&&t.set_text(t.textarea_.value||""),t.is_textarea_focused=!1})),this.events.bind_event_with_checks(this.textarea_,"input",this,(function(e){e.stopPropagation(),e.preventDefault(),t.text_layout()})),this.events.bind_event_with_checks(n,"mousedown",this,(function(t){t.stopPropagation(),t.preventDefault(),this.set_expanded(!1)}));var r=document.createElement("div");r.classList.add("blocklyCommentTopContainer");var s=document.createElement("div");s.classList.add("blocklyCommentMainContainer"),s.appendChild(e),s.appendChild(this.textarea_),this.bubble_.appendChild(r),r.appendChild(s);var d=document.createElement("div");d.classList.add("blocklyCommentBottomContainer"),this.bubble_.appendChild(d);var u=this.create_resize_controllers();u&&(r.appendChild(u.ew_resize),d.appendChild(u.ns_resize),d.appendChild(u.nwse_resize)),this.bubble_shadow_=(0,l.create_svg_element)("rect",{width:this.bubble_width_,height:this.bubble_height_,filter:"url(#".concat(a.FILTER.BOXSHADOW,")"),transform:"translate(".concat(this.left_top_offset[0],", ").concat(this.left_top_offset[1],")")})}this.textarea_&&(this.textarea_.value=this.text_),this.svg_group.appendChild(this.bubble_shadow_),this.svg_group.appendChild(this.bubble_),this.height=this.bubble_height_,this.width=this.bubble_width_,this.bring_to_front()},e.prototype.text_layout=function(){if(this.textarea_&&this.auto_layout_){if(this.textarea_.value.length>=this.prev_text_l){var t=this.textarea_.scrollHeight+52;return this.set_bubble_size(this.bubble_width_,Math.max(t,p[1])),void(this.prev_text_l=this.textarea_.value.length)}this.set_bubble_size(this.bubble_width_,p[1]),this.prev_text_l=0,this.text_layout()}},e.prototype.hide_editor=function(){this.bubble_shadow_&&(0,l.remove_node)(this.bubble_shadow_),this.bubble_&&(0,l.remove_node)(this.bubble_),this.width=f[0],this.height=f[1],this.left_top_offset=[-12,-12],this.update_icon()},e.prototype.textarea_mouse_down=function(t){var e=this;if(this.textarea_)if(this.is_textarea_focused)t.stopPropagation();else{this.bring_to_front();var i=this.events.bind_event_with_checks(this.textarea_,"mouseup",this,(function(){e.textarea_&&e.textarea_.focus(),e.is_textarea_focused=!0,e.select(),e.events.unbind_event(i),e.workspace.cancel_current_gesture(),e.touch_manager.clear_touch_identifier()}))}},e.prototype.create_resize_controllers=function(){if(this.bubble_){var t={ew_resize:document.createElement("div"),ns_resize:document.createElement("div"),nwse_resize:document.createElement("div")};return t.ew_resize.classList.add("blocklyCommentEWResize"),this.events.bind_event_with_checks(t.ew_resize,"mousedown",this,this.resize_mouse_down.bind(this,"ew")),t.ns_resize.classList.add("blocklyCommentNSResize"),this.events.bind_event_with_checks(t.ns_resize,"mousedown",this,this.resize_mouse_down.bind(this,"ns")),t.nwse_resize.classList.add("blocklyCommentNWSEResize"),this.events.bind_event_with_checks(t.nwse_resize,"mousedown",this,this.resize_mouse_down.bind(this,"nwse")),t}},e.prototype.unbind_resize_events=function(){this.on_mouseup_wrapper&&(this.events.unbind_event(this.on_mouseup_wrapper),this.on_mouseup_wrapper=void 0),this.on_mousemove_wrapper&&(this.events.unbind_event(this.on_mousemove_wrapper),this.on_mousemove_wrapper=void 0)},e.prototype.resize_mouse_down=function(t,e){this.bring_to_front(),this.select(),e.stopPropagation(),e.preventDefault(),this.utils.is_right_button(e)||(this.workspace.start_drag(e,r.vec2.fromValues(this.bubble_width_,this.bubble_height_)),this.select(),this.size_before_resize=[this.bubble_width_,this.bubble_height_],this.on_mouseup_wrapper=this.events.bind_event_with_checks(document,"mouseup",this,this.bubble_mouse_up),this.on_mousemove_wrapper=this.events.bind_event_with_checks(document,"mousemove",this,this.resize_mouse_move.bind(this,t)))},e.prototype.resize_mouse_move=function(t,e){this.auto_layout_=!1;var i=this.workspace.move_drag(e);t.indexOf("e")>-1&&t.indexOf("w")>-1&&this.set_bubble_size(i[0],this.bubble_height_),t.indexOf("n")>-1&&t.indexOf("s")>-1&&this.set_bubble_size(this.bubble_width_,i[1])},e.prototype.bubble_mouse_up=function(){this.touch_manager.clear_touch_identifier(),this.unbind_resize_events(),this.size_before_resize&&(this.size_before_resize[0]!==this.bubble_width_||this.size_before_resize[1]!==this.bubble_height_)&&this.events.is_enabled()&&this.events.fire(this.change_event_factory("comment_resize",{block:this,old_value:this.size_before_resize,new_value:[this.bubble_width_,this.bubble_height_]})),this.size_before_resize=void 0},e.prototype.is_auto_layout=function(){return this.auto_layout_},e.prototype.set_auto_layout=function(t){this.auto_layout_=t},e.prototype.focus=function(){var t,e;if(this.set_expanded(!0),this.textarea_){var i=(0,l.get_viewport_size)();if(this.textarea_.getBoundingClientRect().left>=i.width){var o=this.get_relative_to_surface_xy()[0]+this.left_top_offset[0],n=this.workspace.get_metrics(),r=this.workspace.get_scale();o=o*r-n.contentLeft,o-=n.viewWidth,o+=this.bubble_width_*r,null===(e=null===(t=this.workspace.get_scrollbar())||void 0===t?void 0:t.h_scroll)||void 0===e||e.set(o),this.textarea_.focus()}else this.textarea_.focus()}},Object.defineProperty(e.prototype,"use_drag_surface",{get:function(){return!!this.workspace.get_block_drag_surface()&&!this.parent_block_},enumerable:!1,configurable:!0}),e.prototype.compute_line_connect_position=function(){var t=r.vec2.scale(r.vec2.create(),this.relative_position_,-1);if(!this.parent_block_||!this.parent_block_.rendered)return t;var e=r.vec2.create();e[1]=this.parent_block_.first_row_height/2;var i=this.parent_block_.first_row_width,o=this.relative_position_[0]>i/2;return o&&(e[0]+=i),this.parent_block_.is_starting_block()&&!o&&(e[0]-=22),r.vec2.add(t,t,e)},e.prototype.cancel_operation=function(){this.is_textarea_focused&&(this.textarea_.value=this.text_,this.textarea_.blur()),this.size_before_resize&&(this.set_bubble_size(this.size_before_resize[0],this.size_before_resize[1]),this.bubble_mouse_up()),this.unselect()},o.__decorate([(0,s.lazy_inject)(s.BINDING.touch_manager)],e.prototype,"touch_manager",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.Msg)],e.prototype,"Msg",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.xml)],e.prototype,"xml",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.json)],e.prototype,"json",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.ChangeEvent)],e.prototype,"change_event_factory",void 0),e=o.__decorate([(0,n.injectable)()],e)}(h.WorkspaceElement);e.WorkspaceComment=v},96312:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.SimplifiedWorkspaceComment=void 0;var o=i(98734),n=i(61455),r=i(1530),s=i(98030),_=i(75102),a=i(25461),c=i(61972),l=i(11214),d=i(81558),u=i(3909),h=function(t){function e(e,i,o,n){var s=t.call(this,e)||this;s.element_type="comment",s.icon_size=32,s.h_distance=-6,s.icon_offset=4,s.icon_limit=3,s.text_="",s.width=s.icon_size,s.height=s.icon_size,s.left_top_offset=[-s.icon_size/2,-s.icon_size/2],s.bubble_width_=214,s.bubble_height_=126,s.auto_layout_=!0,s.relative_position_=r.vec2.create(),s.expanded_=!1,s.color_theme="BLUE",s.is_textarea_focused=!1,s.parent_block_=i,s.base_block=i;var _=s.workspace.is_resizes_enabled();return s.workspace.set_resizes_enabled(!1),s.events.disable(),s.id=void 0!=n?n:(0,l.gen_uid)(),s.svg_group.classList.add("blocklyWorkspaceComment"),s.update_movable(),i&&(s.deletable_=!1),o&&s.translate(r.vec2.fromValues(o.x,o.y)),e.workspace_comment_db.set(s.id,s),i||e.add_top_comment(s),s.init_events(),s.events.enable(),s.events.is_enabled()&&(s.parent_block_?s.events.fire(s.change_event_factory("comment",{block:s.parent_block_,old_value:void 0,new_value:s.id})):s.events.fire(s.create_event_factory({block:s}))),s.workspace.set_resizes_enabled(_),s}return o.__extends(e,t),e.prototype.get_icon=function(){return this.svg_icon},e.prototype.get_text=function(){return this.text_},e.prototype.set_text=function(t){var e;this.text_!=t&&(this.events.is_enabled()&&(e=this.change_event_factory("comment_text",{block:this,old_value:this.text_,new_value:t})),this.text_=t),e&&this.events.fire(e),this.comment_bubble.update_bubble("edit",this)},e.prototype.init_svg=function(t){var e,i,o=this;if(this.parent_block_){var n=(0,d.get_outer_block)(this.parent_block_);this.base_block=n;var r=(0,d.get_nested_blocks_with_comment)(n),s=r[0];if(s!==this.parent_block_)return null===(e=null===s||void 0===s?void 0:s.comment)||void 0===e||e.init_svg(!0),void(this.svg_icon||(this.svg_icon=(0,a.create_svg_element)("g",{},this.svg_group),this.reposition()));r.forEach((function(t){var e;t!==o.parent_block_&&t.comment&&t.comment.rendered&&(t.comment.rendered=!1,null===(e=o.workspace.get_canvas())||void 0===e||e.removeChild(t.comment.svg_group))})),this.svg_icon&&this.svg_group.removeChild(this.svg_icon),this.svg_icon=(0,a.create_svg_element)("g",{},this.svg_group);for(var _=r.length>this.icon_limit?this.icon_limit-1:r.length-1,c=_;c>=0;c--){var l=r[c],u=(0,a.create_svg_element)("g",{class:"blocklySimplifiedCommentIcon"},this.svg_icon);this.draw_icon(u,l.get_colour().toString());var h=this.icon_offset*(_-c);u.setAttribute("transform","translate(".concat(this.left_top_offset[0]-h,", ").concat(this.left_top_offset[1],")"))}if(this.events.bind_event_with_checks(this.svg_icon,"mouseup",this,this.on_icon_click),this.reposition(),this.rendered=!0,null===(i=this.workspace.get_canvas())||void 0===i||i.appendChild(this.svg_group),this.update_visibility(),this.events.is_record_undo()&&this.events.is_enabled()&&!t&&1===this.svg_icon.childElementCount){var p=this.svg_icon.firstElementChild;p.style.opacity="0",setTimeout(this.comment_bubble.animate_once.bind(this,p,"createCommentAnimation",(function(){p.style.opacity=""})))}}},e.prototype.draw_icon=function(t,e){e=e||"#608FEE",(0,a.create_svg_element)("rect",{width:this.icon_size,height:this.icon_size,fill:"none",stroke:"none"},t),(0,a.create_svg_element)("path",{d:"M10,4 L20,4 C24.418278,4 28,7.581722 28,12 L28,21 L28,21 L30.2365586,27.7096759 C30.4112064,28.2336192 30.1280464,28.7999392 29.6041031,28.974587 C29.3524967,29.0584558 29.0778786,29.0389393 28.8406617,28.9203309 L19,24 L19,24 L10,24 C5.581722,24 2,20.418278 2,16 L2,12 C2,7.581722 5.581722,4 10,4 Z",fill:e},t),(0,a.create_svg_element)("circle",{fill:"#fff",cx:8,cy:14,r:2},t),(0,a.create_svg_element)("circle",{fill:"#fff",cx:15,cy:14,r:2},t),(0,a.create_svg_element)("circle",{fill:"#fff",cx:22,cy:14,r:2},t),t.setAttribute("filter","url(#".concat(u.FILTER.SURROUND_SHADOW_DARK,")")),t.setAttribute("transform-origin","".concat(this.icon_size," ").concat(this.icon_size))},e.prototype.reposition=function(){var t=this.base_block||this.parent_block_;if(t&&t.rendered){var e=this.h_distance-this.icon_size/2;t.is_starting_block()&&(e-=22),this.relative_position_=r.vec2.fromValues(e,t.first_row_height/2);var i=t.get_relative_to_surface_xy();this.translate(r.vec2.add(i,i,this.relative_position_))}},e.prototype.show_editor=function(){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(e){switch(e.label){case 0:return[4,this.workspace.show_external_comment_editor(this.text_)];case 1:return void 0==(t=e.sent())||this.set_text(t),[2]}}))}))},e.prototype.focus=function(){this.show_editor()},e.prototype.on_icon_click=function(t){this.workspace.is_dragging()||this.utils.is_right_button(t)||this.comment_bubble.popup(this)},e.prototype.get_bounding_rectangle=function(){var e=t.prototype.get_bounding_rectangle.call(this),i=e.topLeft,o=e.bottomRight;return{topLeft:r.vec2.add(r.vec2.create(),i,this.left_top_offset),bottomRight:r.vec2.add(r.vec2.create(),o,this.left_top_offset)}},e.prototype.get_parent_block=function(){return this.parent_block_},e.prototype.get_top_parent=function(){return this.get_root_block()||this},e.prototype.get_root_block=function(){for(var t=this.parent_block_;null===t||void 0===t?void 0:t.parent_block;)t=t.parent_block;return t},e.prototype.dispose=function(){var e,i=this;this.comment_bubble.update_bubble("remove",this),this.events.is_enabled()&&(e=this.parent_block_?this.change_event_factory("comment",{block:this.parent_block_,old_value:this.xml.comment_to_dom_with_xy(this),new_value:void 0}):this.delete_event_factory({block:this})),this.workspace.workspace_comment_db.delete(this.id),this.parent_block_||this.workspace.remove_top_comment(this),t.prototype.dispose.call(this),this.events.fire(e),setTimeout((function(){if(i.parent_block_){var t=(0,d.get_outer_block)(i.parent_block_),e=(0,d.get_nested_blocks_with_comment)(t)[0];e&&e.comment&&e.rendered&&e.comment.init_svg(!0)}}))},e.prototype.show_context_menu=function(t){},e.prototype.on_mouse_down=function(e){this.parent_block_||t.prototype.on_mouse_down.call(this,e)},e.prototype.sort=function(t){if(this.rendered){var e=this.get_relative_to_surface_xy(),i=r.vec2.fromValues(t[0]+this.icon_size/2,t[1]+this.icon_size/2);this.move_by(r.vec2.sub(e,i,e)),r.vec2.add(t,t,[0,this.get_height_width().height+this.theme.renderer.MIN_HEIGHT])}},e.prototype.get_bubble_size=function(){return{width:this.bubble_width_,height:this.bubble_height_}},e.prototype.set_bubble_size=function(t,e){this.bubble_width_=t,this.bubble_height_=e},e.prototype.is_auto_layout=function(){return this.auto_layout_},e.prototype.set_auto_layout=function(t){this.auto_layout_=t},e.prototype.get_relative_position=function(){return this.parent_block_?this.relative_position_:this.location_},e.prototype.set_relative_position=function(t){this.relative_position_=t},e.prototype.set_expanded=function(t){this.expanded_=t},e.prototype.is_expanded=function(){return this.expanded_},e.prototype.update_visibility=function(){if(this.parent_block_){var t=this.parent_block_;(0,c.is_block_svg)(t)&&(t=t.get_root_block());var e=t.get_visibility();(0,a.update_visibility_class)(this.svg_group,e)}},e.prototype.get_color_theme=function(){return this.color_theme},e.prototype.set_color_theme=function(t){t!==this.color_theme&&(this.color_theme=t)},e.prototype.get_colour=function(){return _.THEME_COLOR_MAP[this.color_theme]},e.prototype.draw_line=function(){},e.prototype.cancel_operation=function(){},o.__decorate([(0,s.lazy_inject)(s.BINDING.xml)],e.prototype,"xml",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.ChangeEvent)],e.prototype,"change_event_factory",void 0),o.__decorate([(0,s.lazy_inject)(s.BINDING.SimplifiedCommentBubble)],e.prototype,"comment_bubble",void 0),e=o.__decorate([(0,n.injectable)()],e)}(i(23257).WorkspaceElement);e.SimplifiedWorkspaceComment=h},23257:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceElement=void 0;var o=i(98734),n=i(1530),r=i(98030),s=i(75102),_=i(25461),a=i(3909),c=function(){function t(t){this.id="",this.width=0,this.height=0,this.rendered=!1,this.deletable_=!0,this.movable_=!0,this.editable_=!0,this.disabled=!1,this.location_=n.vec2.create(),this.visibility_=s.BlockVisibility.VISIBLE,this.event_initialized=!1,this.svg_group=(0,_.create_svg_element)("g",{}),this.svg_group.translate_="",this.workspace=t,this.is_in_flyout=t.is_flyout,this.RTL=t.RTL}return t.prototype.get_svg_root=function(){return this.svg_group},t.prototype.set_workspace=function(t){this.workspace=t},t.prototype.get_workspace=function(){return this.workspace},t.prototype.set_deletable=function(t){this.deletable_=t},t.prototype.is_deletable=function(){return this.deletable_&&!(this.workspace&&this.workspace.get_options().readOnly)},t.prototype.set_delete_style=function(t){void 0!=this.svg_group?t?(0,_.add_class_if_necessary)(this.svg_group,"blocklyDraggingDelete"):(0,_.remove_class_if_necessary)(this.svg_group,"blocklyDraggingDelete"):console.warn("Cannot set delete style for block without init.")},t.prototype.set_movable=function(t){this.movable_=t},t.prototype.is_movable=function(){return this.movable_},t.prototype.update_movable=function(){if(void 0==this.svg_group)throw new ReferenceError("Cannot update movable to block without svg group.");var t=this.svg_group.classList;this.is_movable()?t.add("blocklyDraggable"):t.remove("blocklyDraggable")},t.prototype.set_editable=function(t){this.editable_=t},t.prototype.is_editable=function(){return this.editable_},t.prototype.set_disabled=function(t){this.disabled=t},t.prototype.get_location=function(){return this.location_},t.prototype.move_by=function(t){var e;this.events.is_enabled()&&(e=this.move_event_factory({block:this}));var i=this.get_relative_to_surface_xy();this.translate(n.vec2.add(this.location_,i,t)),e&&e.record_new(),this.workspace.resize_contents(),e&&this.events.fire(e)},t.prototype.dispose=function(t,e){if(this.workspace){var i=this.workspace;this.runtime_data.selected===this&&(this.unselect(),i.cancel_current_gesture()),this.context_menu.current_block==this&&this.context_menu.hide(),e&&this.rendered&&this.block_animations.dispose_ui_effect(this),this.rendered=!1,(0,_.remove_node)(this.svg_group),(0,_.remove_children)(this.svg_group),i.resize_contents()}},t.prototype.on_mouse_down=function(t){if(this.workspace){var e=this.workspace.get_gesture(t);e&&e.handle_block_start(t,this)}},Object.defineProperty(t.prototype,"use_drag_surface",{get:function(){return!!this.workspace.get_block_drag_surface()},enumerable:!1,configurable:!0}),t.prototype.get_relative_to_surface_xy=function(){var t,e,i=this.use_drag_surface?null===(t=this.workspace.get_block_drag_surface())||void 0===t?void 0:t.get_group():void 0,o=this.svg_group;if(void 0==o)return n.vec2.create();var r=n.vec2.create();do{if(n.vec2.add(r,r,this.utils.get_relative_xy(o)),this.use_drag_surface&&(null===(e=this.workspace.get_block_drag_surface())||void 0===e?void 0:e.get_current_block())==o){var s=this.workspace.get_block_drag_surface().get_surface_translation();n.vec2.add(r,r,[s[0],s[1]])}o=o.parentNode}while(o&&o!=this.workspace.get_canvas()&&o!=i);return r},t.prototype.translate=function(t){var e=this.svg_group;if(void 0==e)throw new ReferenceError("Block should have svg root when translating.");e.setAttribute("transform","translate(".concat(t[0],", ").concat(t[1],")")),this.location_=t},t.prototype.move_off_drag_surface=function(t){var e;if(this.svg_group&&this.workspace.svg_block_canvas_){var i=this.svg_group.getAttribute("filter");i&&i.includes(a.FILTER.DRAG_SHADOW)&&this.svg_group.removeAttribute("filter"),this.use_drag_surface?(this.translate(t),null===(e=this.workspace.get_block_drag_surface())||void 0===e||e.clear_and_hide(this.workspace.svg_block_canvas_)):this.location_=t}},t.prototype.set_mouse_through_style=function(t){void 0!=this.svg_group?t?(0,_.add_class_if_necessary)(this.svg_group,"blocklyDraggingMouseThrough"):(0,_.remove_class_if_necessary)(this.svg_group,"blocklyDraggingMouseThrough"):console.warn("Cannot set the style for block without init.")},t.prototype.set_dragging=function(t){if(void 0!=this.svg_group){var e=this.svg_group;t?(e.translate_="",e.skew_="",(0,_.add_class_if_necessary)(e,"blocklyDragging")):(0,_.remove_class_if_necessary)(e,"blocklyDragging")}else console.warn("Cannot set delete style for block without init.")},t.prototype.move_during_drag=function(t){var e;this.svg_group&&(this.use_drag_surface?null===(e=this.workspace.get_block_drag_surface())||void 0===e||e.translate_surface(t[0],t[1]):(this.svg_group.translate_="translate(".concat(t[0],", ").concat(t[1],")"),this.svg_group.setAttribute("transform",this.svg_group.translate_+this.svg_group.skew_)))},t.prototype.bring_to_front=function(){var t=this.svg_group;void 0!=t&&void 0!=t.parentNode&&t.parentNode.appendChild(t)},t.prototype.select=function(){if(this.runtime_data.selected!=this){var t=void 0;if(this.runtime_data.selected){t=this.runtime_data.selected.id,this.events.disable();try{this.runtime_data.selected.unselect()}catch(i){console.error(i)}finally{this.events.enable()}}var e=this.ui_event_factory({type:s.UIEventType.SELECTED,workspace_id:this.workspace.id,old_value:t,new_value:this.id});this.runtime_data.selected=this,this.events.fire(e)}},t.prototype.unselect=function(){if(this.runtime_data.selected==this){var t=this.ui_event_factory({type:s.UIEventType.SELECTED,workspace_id:this.workspace.id,old_value:this.id,new_value:void 0});this.runtime_data.selected=void 0,this.events.fire(t)}},t.prototype.move_to_drag_surface=function(){var t;if(this.svg_group)if(this.use_drag_surface){var e=this.get_relative_to_surface_xy();this.clear_transform_attributes();var i=this.workspace.get_block_drag_surface();null===i||void 0===i||i.translate_surface(e[0],e[1]),null===i||void 0===i||i.set_blocks_and_show(this.svg_group)}else null===(t=this.workspace.svg_block_canvas_)||void 0===t||t.appendChild(this.svg_group)},t.prototype.clear_transform_attributes=function(){this.svg_group&&(0,_.remove_attribute)(this.svg_group,"transform")},t.prototype.get_bounding_rectangle=function(){var t=this.get_relative_to_surface_xy(),e=this.get_height_width();return{topLeft:t,bottomRight:n.vec2.fromValues(t[0]+e.width,t[1]+e.height)}},t.prototype.get_height_width=function(){return{height:this.height,width:this.width}},t.prototype.get_visibility=function(){return this.visibility_},t.prototype.init_events=function(){if(!this.workspace.get_options().readOnly&&!this.event_initialized){var t=this.get_svg_root();void 0!=t&&(this.events.bind_event_with_checks(t,"mousedown",this,this.on_mouse_down),this.event_initialized=!0)}},t.prototype.get_top_parent=function(){return this},t.prototype.for_each_descendant_element=function(t){t(this)},o.__decorate([(0,r.lazy_inject)(r.BINDING.context_menu)],t.prototype,"context_menu",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.block_animations)],t.prototype,"block_animations",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.utils)],t.prototype,"utils",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.MoveEvent)],t.prototype,"move_event_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.DeleteEvent)],t.prototype,"delete_event_factory",void 0),o.__decorate([(0,r.lazy_inject)(r.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),t}();e.WorkspaceElement=c},28377:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getCharWeight=void 0;var i=[0,493,493,493,493,493,493,493,0,0,0,0,0,0,493,493,493,493,493,493,493,493,493,493,493,493,493,493,493,0,493,493,444,468,733,977,977,1450,1108,444,580,580,724,977,444,724,444,487,977,977,977,977,977,977,977,977,977,977,444,444,977,977,977,790,1438,1047,1021,1115,1132,922,885,1165,1157,397,830,1024,879,1368,1157,1204,986,1204,1015,990,983,1149,1047,1518,1055,1018,1029,580,487,580,977,934,769,852,952,865,952,883,549,944,911,365,397,838,374,1361,904,915,946,944,579,807,550,904,836,1208,808,838,832,580,383,580,977,0,891,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,419,468,977,977,977,977,383,925,769,1400,594,1029,977,0,1079,769,724,977,516,536,769,952,925,444,769,390,638,1029,1218,1271,1374,790,1047,1047,1047,1047,1047,1047,1505,1115,922,922,922,922,419,423,522,500,1180,1157,1204,1204,1204,1204,1204,977,1199,1149,1149,1149,1149,1018,969,965,852,852,852,852,852,852,1415,865,883,883,883,883,414,415,543,518,900,904,915,915,915,915,915,977,915,904,904,904,904,838,946,838];e.getCharWeight=function(t){var e;return null!==(e=i[t])&&void 0!==e?e:1600}},76518:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.is_short_block=e.render_short_block_content_overflow=e.render_short_block_content=e.compute_inline_offset=e.get_short_block_define_from_xml=e.get_short_block_content_min_width=e.get_short_block_content_dy=e.get_short_block_content_dx=e.get_short_block_height=e.SvgPath=void 0;var o=i(75102),n=i(42798),r=i(25461),s=i(28377),_=i(65906);function a(t){return Array.from(t.attributes).reduce((function(t,e){var i;return Object.assign(t,((i={})[e.name]=e.value,i))}),{})}Object.defineProperty(e,"SvgPath",{enumerable:!0,get:function(){return _.SvgPath}}),e.get_short_block_height=function(t,e){var i;void 0===e&&(e=1);var n=(i={},i[o.ShortBlockShape.EVENT]=48,i[o.ShortBlockShape.BOOLEAN_VALUE]=36,i[o.ShortBlockShape.ANY_VALUE]=36,i[o.ShortBlockShape.EXECUTE]=40,i[o.ShortBlockShape.EXECUTE_WITH_SLOT]=48,i)[t];return t===o.ShortBlockShape.EXECUTE_WITH_SLOT?n*e+12:n},e.get_short_block_content_dx=function(t){var e;return(e={},e[o.ShortBlockShape.EVENT]=52,e[o.ShortBlockShape.BOOLEAN_VALUE]=18,e[o.ShortBlockShape.ANY_VALUE]=18,e[o.ShortBlockShape.EXECUTE]=16,e[o.ShortBlockShape.EXECUTE_WITH_SLOT]=16,e)[t]},e.get_short_block_content_dy=function(t,e){var i;void 0===e&&(e=0);var n=(i={},i[o.ShortBlockShape.EVENT]=28,i[o.ShortBlockShape.BOOLEAN_VALUE]=18,i[o.ShortBlockShape.ANY_VALUE]=18,i[o.ShortBlockShape.EXECUTE]=20,i[o.ShortBlockShape.EXECUTE_WITH_SLOT]=20,i)[t];return t===o.ShortBlockShape.EXECUTE_WITH_SLOT?n+48*e:n},e.get_short_block_content_min_width=function(t){var e;return(e={},e[o.ShortBlockShape.EVENT]=48,e[o.ShortBlockShape.BOOLEAN_VALUE]=20,e[o.ShortBlockShape.ANY_VALUE]=20,e[o.ShortBlockShape.EXECUTE]=44,e[o.ShortBlockShape.EXECUTE_WITH_SLOT]=44,e)[t]},e.get_short_block_define_from_xml=function(t){var e=t.getElementsByTagName("short")[0];if(!e)return null;var i=a(e);i.shape&&(i.shape=Number(i.shape)),i.nextStatement&&(i.nextStatement="true"===i.nextStatement),i.min_width&&(i.min_width=Number(i.min_width));for(var o=0,n=Array.from(t.getElementsByTagName("args"));o<n.length;o++){var r=n[o],s=r.getAttribute("name");if(s){i[s]=[];for(var _=0;_<r.childNodes.length;_++){var c=r.childNodes[_];switch(c.nodeName){case"text":case"boolslot":case"icon":case"rect":case"colour":case"circle":case"round":var l=a(c),d=Object.assign(l,{type:c.nodeName,textContent:c.textContent});d.width&&(d.width=Number(d.width)),d.height&&(d.height=Number(d.height)),d.offset&&(d.offset=Number(d.offset)),d.max_width&&(d.max_width=Number(d.max_width)),i[s].push(d)}}}}return i},e.compute_inline_offset=function t(e,i,o){var n=e[o];if(!n)return null;if("block"!==n.type)return null;if(!n.inline)return null;if(n.xml.getAttribute("inline_end"))return null;var r=i[o],s=Number(n.xml.getAttribute("h_gap"))||16,_=n.block.svg_group.getBoundingClientRect(),a=_.width,c=_.height,l=t(e,i,o-1);return l?{dx:a+s+l.dx,dy:Math.max(-c-r,l.dy)}:{dx:a+s,dy:-c-r}};var c={text:2,icon:2,boolslot:4,rect:4,colour:4,circle:4,round:4};function l(t){var e=t.g,i=t.cursor,o=t.block_max_width,n=t.dx,r=t.dy,s=t.id,_=t.is_last_arg;if(!e.lastElementChild||!o)return 0;if(_&&o>=i-n||!_&&o>=i-n+12)return 0;if("text"!==e.lastElementChild.tagName){var a=e.lastElementChild.getBoundingClientRect().width;e.removeChild(e.lastElementChild);var c=d("...",i-=a,r);return e.appendChild(c),(i+=c.getBoundingClientRect().width)-n}var l=i-o-n,u=e.lastElementChild,h=u.getBoundingClientRect().width,p=e.lastElementChild.textContent||"",g="".concat(m(p,h-l-6),"...");u.textContent=g;var f=e.querySelector('rect[data-id="'.concat(s,'"]'));if(!f)return i-=h,(i+=u.getBoundingClientRect().width)-n;var v=f.getBoundingClientRect().width;i-=v;var b=v-l;if(b<34||l<0){e.removeChild(f),e.removeChild(u);c=d("...",i,r);return e.appendChild(c),(i+=c.getBoundingClientRect().width)-n}return f.setAttribute("width","".concat(b,"px")),(i+=b)-n}function d(t,e,i){t=t.replace(/\x20/g,"&nbsp;");var o=(0,r.create_svg_element)("text",{class:"blocklyText","font-size":"16px","dominant-baseline":"central",transform:"translate(".concat(e,",").concat(i,")")});return o.innerHTML=t,o}function u(t,e,i){return(0,r.create_svg_element)("rect",{fill:"rgba(255, 255, 255, 0.15)",stroke:"rgba(0, 0, 0, 0.1)",transform:"translate(".concat(t,", ").concat(e-14,")"),rx:4,width:i,height:28})}function h(t,e,i,o){return(0,r.create_svg_element)("rect",{fill:o||"#FFBB55",stroke:"rgba(0, 0, 0, 0.1)",transform:"translate(".concat(t,", ").concat(e-17,")"),rx:17,width:i,height:34})}function p(t,e,i){var o="rgba(0, 0, 0, 0.1)";if(i){var s=new n.Color(i);s.a=.6,o=s.toString()}var _=(0,r.create_svg_element)("path",{class:"blocklyPath",fill:o,stroke:"rgba(0, 0, 0, 0.1)","dominant-baseline":"central",transform:"translate(".concat(t,",").concat(e-15,")")});return _.setAttribute("d","M 1,16 a 2,2 0 0,1 0,-2 l 9,-13 a 2,2 0 0,1 2,-1 h 20 a 2,2 0 0,1 2,1 l 9,13 a 2,2 0 0,1 0,2 l -9,13 a 2,2 0 0,1 -2,1 H 12 a 2,2 0 0,1 -2,-1 l -9,-13 z"),_}function g(t,e,i){return(0,r.create_svg_element)("rect",{fill:i,width:40,height:30,rx:15,ry:15,stroke:"#ffffff","stroke-width":1.5,transform:"translate(".concat(t,",").concat(e-15,")")})}function f(t,e,i){var o=t.width,n=void 0===o?24:o,s=t.height,_=void 0===s?24:s,a=t.src;return(0,r.create_svg_element)("image",{width:"".concat(n,"px"),height:"".concat(_,"px"),"xlink:href":a,transform:"translate(".concat(e,",").concat(i-Number(_)/2,")")})}function v(t,e,i,o){var s="rgba(0, 0, 0, 0.1)";if(o){var _=new n.Color(o);_.a=.5,s=_.toString()}return(0,r.create_svg_element)("rect",{fill:s,stroke:"rgba(0, 0, 0, 0.1)",transform:"translate(".concat(t,", ").concat(e-14,")"),rx:14,ry:14,width:i,height:28})}function m(t,e){var i=100*e,o=0,n=t.split("").map((function(t){var e=t.charCodeAt(0),n=(0,s.getCharWeight)(e);return(o+=n)<=i+1?e:-1})).filter((function(t){return-1!==t}));return String.fromCharCode.apply(String,n).replace(/\x20/g,"&nbsp;")}e.render_short_block_content=function(t,e,i){for(var o=i.dx,n=i.dy,s=i.min_width,_=i.center,a=void 0!==_&&_,b=i.colour,y=i.max_width?i.max_width-2*o:void 0,E=o,k=(0,r.create_svg_element)("g",{},e),T=0;T<t.length;T++){var w=t[T],O=Math.random().toString(36).slice(2);if(T>0){var N=t[T-1];E+=Math.max(c[w.type],c[N.type])}if("text"===w.type){var I=w.content,A=w.max_width,C=d(I,E,n);k.appendChild(C);var S=C.getBoundingClientRect().width;if(A&&S>A){var x="".concat(m(I,A),"...");C.innerHTML=x,E+=A+4}else E+=S}else if("rect"===w.type){E+=6,(C=d(I=w.content,E,n)).setAttribute("data-id",O),k.appendChild(C),(D=u((E+=R=C.getBoundingClientRect().width)-R-6,n,R+12)).setAttribute("data-id",O),k.insertBefore(D,C),E+=6}else if("round"===w.type){var R;E+=17,(C=d(I=w.content,E,n)).setAttribute("data-id",O),k.appendChild(C),(D=h((E+=R=C.getBoundingClientRect().width)-R-17,n,R+34,b)).setAttribute("data-id",O),k.insertBefore(D,C),E+=17}else if("boolslot"===w.type){C=p(E,n,b);k.appendChild(C),E+=C.getBoundingClientRect().width}else if("icon"===w.type){var L=w.offset;0===T&&(E+=void 0===L?-6:L);C=f(w,E,n);k.appendChild(C),E+=C.getBoundingClientRect().width}else if("colour"===w.type){C=g(E,n,w.color);k.appendChild(C),E+=C.getBoundingClientRect().width}else if("circle"===w.type){E+=6,(C=d(I=w.content,E,n)).setAttribute("data-id",O),k.appendChild(C);var D,M=C.getBoundingClientRect().width;M<16&&(C.setAttribute("transform","translate(".concat(E+(16-M)/2,",").concat(n,")")),M=16),(D=v((E+=M)-M-6,n,M+12,b)).setAttribute("data-id",O),k.insertBefore(D,C),E+=6}var P=l({g:k,cursor:E,block_max_width:y,dx:o,dy:n,id:O,is_last_arg:T===t.length-1});if(P>0)return{width:P}}if(a){var B=k.getBoundingClientRect().width;B<s&&k.setAttribute("transform","translate(".concat((s-B)/2,",0)"))}return{width:Math.max(E-o,s)}},e.render_short_block_content_overflow=l,e.is_short_block=function(t){return!!t.getElementsByTagName("short")[0]}},65906:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.SvgPath=void 0;var o=i(25461),n=function(){function t(){this.d=[],this.height=0,this.width=0}return t.create=function(){return new t},t.prototype.moveTo=function(t,e){return this.d.push("m ".concat(t,",").concat(e)),this.width+=t,this.height+=e,this},t.prototype.hLineTo=function(t){return this.d.push("h ".concat(t)),this.width+=t,this},t.prototype.vLineTo=function(t){return this.d.push("v ".concat(t)),this.height+=t,this},t.prototype.lineTo=function(t,e){return this.d.push("l ".concat(t,",").concat(e)),this.width+=t,this.height+=e,this},t.prototype.arcTo=function(t,e,i){return this.width+=t,this.height+=e,this.d.push("a ".concat(i,",").concat(i," 0 0 1 ").concat(t,",").concat(e)),this},t.prototype.close=function(){return this.d.push("z"),this},t.prototype.clear=function(){return this.d=[],this.width=0,this.height=0,this},t.prototype.toString=function(){return this.d.join(" ")},t.prototype.dom=function(t){return(0,o.create_svg_element)("path",Object.assign(t,{d:this.toString()}))},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t}();e.SvgPath=n},94232:function(t,e,i){e.K4=e.I=e.BU=e.mx=void 0;var o=i(98734),n=o.__importStar(i(37064));e.I=n;var r=i(27807),s=i(9528),_=i(70267),a=i(47188).i8;console.log("%c\u2b50\ufe0f Codemao Blink - v".concat(a," \u2b50\ufe0f"),'\n  color: #FFDB29;\n  text-shadow: 0 1px 0 #BF7000;\n  padding: 140px 10px 20px 35px;\n  background: no-repeat left / 150px 150px url("http://kn-cdn.codemao.cn/blink/blink-main-compressed.jpeg");\n  ');var c=(0,r.get_instance)();(0,_.bind_di_modules)(c),e.mx=c.get(s.BINDING.Blink),window.Blockly=e.mx,e.BU=o.__importStar(i(22804));var l=i(1530);Object.defineProperty(e,"K4",{enumerable:!0,get:function(){return l.vec2}})},87409:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.en=void 0,e.en={DUPLICATE_BLOCK:"Copy",COPY_ALL:"Copy %1 Blocks",ADD_COMMENT:"Add Comment",REMOVE_COMMENT:"Remove Comment",DELETE_BLOCK:"Delete Block",DELETE_X_BLOCKS:"Delete %1 Blocks",DELETE_ALL_BLOCKS:"Delete all %1 blocks?",CLEAN_UP:"Clean up Blocks",COLLAPSE_BLOCK:"Collapse Block",COLLAPSE_ALL:"Collapse All Blocks",EXPAND_BLOCK:"Expand Block",EXPAND_ALL:"Expand All Blocks",UNDO:"Undo",REDO:"Redo",PASTE:"Paste",COPY_AND_PASTE:"Copy and Paste",GLOBAL_COMMENT:"Add Workspace Comment",COMMENT:"Comment",BLUE_COMMENT:"Blue Comment",GREEN_COMMENT:"Green Comment",YELLOW_COMMENT:"Yellow Comment",RED_COMMENT:"Red Comment",DELETE_COMMENT:"Delete Comment",WHATS_THIS:"Describe this functionality...",SAY_SOMETHING:"Say something...",START_ON_CLICK:"%1 When Start clicked",START_ON_CLICK_2:"%1 When Start clicked %2 %3",ON_RUNNING_GROUP_ACTIVATED:"%1 On running group activated",SELF_LISTEN:"%1 When I receive %2 %3 %4",SELF_BROADCAST:"Broadcast %1",SELF_BROADCAST_AND_WAIT:"Broadcast and wait",WHEN:"%1 when %2 %3",TERMINATE:"terminate",REPEAT_FOREVER:"Forever %1 %2",REPEAT_N_TIMES:"Repeat %1 times %2 %3",REPEAT_FOREVER_UNTIL:"Repeat forever until %1 %2 %3",BREAK:"Quit loop",WARP:"Warp %1 %2",WAIT_SECS:"Wait %1 secs",WAIT_UNTIL:"Wait until %1",DESTRUCT:"Destruct",CONTROLS_IF_MSG_IF:"If",CONTROLS_IF_MSG_ELSEIF:"Else if",CONTROLS_IF_MSG_ELSE:"Else",CONTROLS_IF_TOOLTIP_1:"If a value is true, then do some statements.",CONTROLS_IF_TOOLTIP_2:"If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",CONTROLS_IF_TOOLTIP_3:"If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",CONTROLS_IF_TOOLTIP_4:"If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",TELL:"Make %1 run %2 %3",SYNC_TELL:"Make %1 run and wait %2 %3",GET_TIME:"Current %1",YEAR:"Year",MONTH:"Month",DATE:"Date",WEEK:"Week",WEEK0:"Sunday",WEEK1:"Monday",WEEK2:"Tuesday",WEEK3:"Wednesday",WEEK4:"Thursday",WEEK5:"Friday",WEEK6:"Saturday",HOUR:"Hour",MINUTE:"Minute",SECOND:"Second",TIMER:"Timer",RESET_TIMER:"Reset timer",MATH_NUMBER_TOOLTIP:"A number.",RANDOM_NUM:"Pick random %1 to %2",DIVISIBLE_BY:"%1 is divisible by %2",CALCULATE:"Math expression %1",CALCULATE_TOOLTIPS:"Enter math expression and calculate the results quickly",MATH_ARITHMETIC:"%1 %2 %3",MATH_ARITHMETIC_TOOLTIP_ADD:"Return the sum of the two numbers.",MATH_ARITHMETIC_TOOLTIP_MINUS:"Return the difference of the two numbers.",MATH_ARITHMETIC_TOOLTIP_MULTIPLY:"Return the product of the two numbers.",MATH_ARITHMETIC_TOOLTIP_DIVIDE:"Return the quotient of the two numbers.",MATH_ARITHMETIC_TOOLTIP_POWER:"Return the first number raised to the power of the second number.",MATH_SINGLE:"%1 %2",MATH_SINGLE_OP_ROOT:"Sqrt",MATH_SINGLE_TOOLTIP_ROOT:"Return the square root of a number.",MATH_SINGLE_OP_ABSOLUTE:"Abs",MATH_SINGLE_TOOLTIP_ABS:"Return the absolute value of a number.",MATH_SINGLE_TOOLTIP_NEG:"Return the negation of a number.",MATH_SINGLE_TOOLTIP_LN:"Return the natural logarithm of a number.",MATH_SINGLE_TOOLTIP_LOG10:"Return the base 10 logarithm of a number.",MATH_SINGLE_TOOLTIP_EXP:"Return e to the power of a number.",MATH_SINGLE_TOOLTIP_POW10:"Return 10 to the power of a number.",MATH_ROUND:"%1 %2",MATH_ROUND_TOOLTIP:"Round a number up or down.",MATH_ROUND_OPERATOR_ROUND:"Round",MATH_ROUND_OPERATOR_ROUNDUP:"Round up",MATH_ROUND_OPERATOR_ROUNDDOWN:"Round down",MATH_MODULO_TITLE:"Remainder of %1 \xf7 %2",MATH_MODULO_TOOLTIP:"Return the remainder from dividing the two numbers.",MATH_NUMBER_PROPERTY:"%1 %2",MATH_IS_EVEN:"even",MATH_IS_ODD:"odd",MATH_IS_PRIME:"prime",MATH_IS_WHOLE:"whole",MATH_IS_POSITIVE:"positive",MATH_IS_NEGATIVE:"negative",MATH_IS_TOOLTIP:"Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",MATH_DEGREES:"degrees",LOGIC_NEGATE_TITLE:"%1 false",LOGIC_BOOLEAN_TRUE:"true",LOGIC_BOOLEAN_FALSE:"false",LOGIC_BOOLEAN_TOOLTIP:"Returns either true or false.",LOGIC_COMPARE:"%1 %2 %3",LOGIC_COMPARE_TOOLTIP_EQ:"Return true if both inputs equal each other.",LOGIC_COMPARE_TOOLTIP_NEQ:"Return true if both inputs are not equal to each other.",LOGIC_COMPARE_TOOLTIP_LT:"Return true if the first input is smaller than the second input.",LOGIC_COMPARE_TOOLTIP_LTE:"Return true if the first input is smaller than or equal to the second input.",LOGIC_COMPARE_TOOLTIP_GT:"Return true if the first input is greater than the second input.",LOGIC_COMPARE_TOOLTIP_GTE:"Return true if the first input is greater than or equal to the second input.",LOGIC_OPERATION:"%1 %2 %3",LOGIC_OPERATION_TOOLTIP_AND:"Return true if both inputs are true.",LOGIC_OPERATION_AND:"and",LOGIC_OPERATION_TOOLTIP_OR:"Return true if at least one of the inputs is true.",LOGIC_OPERATION_OR:"or",TEXT_TEXT_TOOLTIP:"A letter, word, or line of text.",TEXT_SELECT:"Substring of %1 from %2 to %3",TEXT_LENGTH:"Length of %1",TEXT_CONTAIN:"%1 contains %2",TEXT_SPLIT:"Split %1 by %2",TEXT_JOIN_TOOLTIP:"Create a piece of text by joining together a_ny number of items.",TEXT_JOIN_TITLE_HEAD:"put",TEXT_JOIN_TITLE_TAIL:"together",VARIABLES_GET:"%1",VARIABLES_SET:"Set variable %1 to %2",CHANGE_VARIABLE:"%2 variable %1 by %3",INCREASE:"Increase",DECREASE:"Decrease",LISTS_GET:"%1",LISTS_APPEND:"Append %1 to the last of list %2",LISTS_INSERT_VALUE:"Insert %3 at %2 of %1",LISTS_COPY:"Copy lists %2 to %1",LISTS_LENGTH:"Get the length of list %1",LISTS_IS_EXIST:"If list %1 contains %2",LISTS_INDEX_OF:"Index of %1 in %2",PROCEDURES_PARAMETER:"Parameter %1",PROCEDURES_RETURN_VALUE:"Return %1 %2",PROCEDURES_DEFNORETURN_TITLE:"Define function",PROCEDURES_DEFNORETURN_PROCEDURE:"Function",PROCEDURES_DEFNORETURN_TOOLTIP:"create a function.",PROCEDURES_DEFRETURN_RETURN:"Return",COLOR_PICKER:"%1",RED:"Red",GREEN:"Green",BLUE:"Blue",HUE:"Hue",SATURATION:"Saturation",BRIGHTNESS:"Brightness",OPACITY:"Opacity",SELECT_COLOR_PARAM_TYPE:"Select color selection method",COLOR_PREVIEW:"Color preview"}},52734:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.zh_hans=void 0,e.zh_hans={DUPLICATE_BLOCK:"\u590d\u5236",COPY_ALL:"\u590d\u5236\u6240\u6709\u79ef\u6728\uff08 %1 \u5757\uff09",ADD_COMMENT:"\u6dfb\u52a0\u6ce8\u91ca",REMOVE_COMMENT:"\u5220\u9664\u6ce8\u91ca",DELETE_BLOCK:"\u5220\u9664\u79ef\u6728\u5757",DELETE_X_BLOCKS:"\u5220\u9664\u6240\u6709\u79ef\u6728\uff08 %1 \u5757\uff09",DELETE_ALL_BLOCKS:"\u5220\u9664\u6240\u6709 %1 \u5757\u5417?",CLEAN_UP:"\u6574\u7406\u79ef\u6728",COLLAPSE_BLOCK:"\u6298\u53e0\u79ef\u6728\u5757",COLLAPSE_ALL:"\u6298\u53e0\u6240\u6709\u79ef\u6728",EXPAND_BLOCK:"\u5c55\u5f00\u79ef\u6728\u5757",EXPAND_ALL:"\u5c55\u5f00\u6240\u6709\u79ef\u6728",UNDO:"\u64a4\u9500",REDO:"\u91cd\u505a",PASTE:"\u7c98\u8d34",COPY_AND_PASTE:"\u590d\u5236\u5e76\u7c98\u8d34",GLOBAL_COMMENT:"\u6dfb\u52a0\u5168\u5c40\u6ce8\u91ca",COMMENT:"\u6ce8\u91ca",BLUE_COMMENT:"\u84dd\u8272\u6ce8\u91ca",GREEN_COMMENT:"\u7eff\u8272\u6ce8\u91ca",YELLOW_COMMENT:"\u9ec4\u8272\u6ce8\u91ca",RED_COMMENT:"\u7ea2\u8272\u6ce8\u91ca",DELETE_COMMENT:"\u5220\u9664\u6ce8\u91ca",WHATS_THIS:"\u8fd9\u662f\u4ec0\u4e48\u529f\u80fd\u2026",SAY_SOMETHING:"\u8bf4\u4e9b\u4ec0\u4e48\u2026",START_ON_CLICK:"%1 \u5f53 \u5f00\u59cb \u88ab\u70b9\u51fb",START_ON_CLICK_2:"%1 \u5f53 \u5f00\u59cb \u88ab\u70b9\u51fb %2 %3",ON_RUNNING_GROUP_ACTIVATED:"%1 \u5f53 \u5207\u6362\u5230 \u5f53\u524d\u5c4f\u5e55",SELF_LISTEN:"%1 \u5f53 \u6536\u5230 \u5e7f\u64ad %2 %3 %4",SELF_BROADCAST:"\u53d1\u9001\u5e7f\u64ad %1",SELF_BROADCAST_AND_WAIT:"\u53d1\u9001\u5e7f\u64ad %1 \u5e76\u7b49\u5f85",WHEN:"%1 \u5f53 %2 %3",TERMINATE:"\u505c\u6b62",REPEAT_FOREVER:"\u91cd\u590d\u6267\u884c %1 %2",REPEAT_N_TIMES:"\u91cd\u590d\u6267\u884c %1 \u6b21 %2 %3",REPEAT_FOREVER_UNTIL:"\u91cd\u590d\u6267\u884c\u76f4\u5230 %1 %2 %3",BREAK:"\u9000\u51fa\u5faa\u73af",WARP:"\u4e00\u6b65\u6267\u884c %1 %2",WAIT_SECS:"\u7b49\u5f85 %1 \u79d2",WAIT_UNTIL:"\u4fdd\u6301\u7b49\u5f85\u76f4\u5230 %1",DESTRUCT:"\u9500\u6bc1\u81ea\u8eab",CONTROLS_IF_MSG_IF:"\u5982\u679c",CONTROLS_IF_MSG_ELSEIF:"\u5426\u5219\u5982\u679c",CONTROLS_IF_MSG_ELSE:"\u5426\u5219",CONTROLS_IF_TOOLTIP_1:"\u5982\u679c\u503c\u4e3a\u771f\uff0c\u6267\u884c\u4e00\u4e9b\u8bed\u53e5\u3002",CONTROLS_IF_TOOLTIP_2:"\u5982\u679c\u503c\u4e3a\u771f\uff0c\u5219\u6267\u884c\u7b2c\u4e00\u5757\u8bed\u53e5\u3002\u5426\u5219\uff0c\u5219\u6267\u884c\u7b2c\u4e8c\u5757\u8bed\u53e5\u3002",CONTROLS_IF_TOOLTIP_3:"\u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u4e3a\u771f\uff0c\u5219\u6267\u884c\u7b2c\u4e00\u5757\u7684\u8bed\u53e5\u3002\u5426\u5219\uff0c\u5982\u679c\u7b2c\u4e8c\u4e2a\u503c\u4e3a\u771f\uff0c\u5219\u6267\u884c\u7b2c\u4e8c\u5757\u7684\u8bed\u53e5\u3002",CONTROLS_IF_TOOLTIP_4:"\u5982\u679c\u7b2c\u4e00\u4e2a\u503c\u4e3a\u771f\uff0c\u5219\u6267\u884c\u7b2c\u4e00\u5757\u5bf9\u8bed\u53e5\u3002\u5426\u5219\uff0c\u5982\u679c\u7b2c\u4e8c\u4e2a\u503c\u4e3a\u771f\uff0c\u5219\u6267\u884c\u8bed\u53e5\u7684\u7b2c\u4e8c\u5757\u3002\u5982\u679c\u6ca1\u6709\u503c\u4e3a\u771f\uff0c\u5219\u6267\u884c\u6700\u540e\u4e00\u5757\u7684\u8bed\u53e5\u3002",TELL:"\u544a\u8bc9 %1 \u6267\u884c %2 %3",SYNC_TELL:"\u544a\u8bc9 %1 \u6267\u884c\u5e76\u7b49\u5f85 %2 %3",GET_TIME:"\u5f53\u524d %1",YEAR:"\u5e74",MONTH:"\u6708",DATE:"\u65e5",WEEK:"\u661f\u671f",WEEK0:"\u661f\u671f\u65e5",WEEK1:"\u661f\u671f\u4e00",WEEK2:"\u661f\u671f\u4e8c",WEEK3:"\u661f\u671f\u4e09",WEEK4:"\u661f\u671f\u56db",WEEK5:"\u661f\u671f\u4e94",WEEK6:"\u661f\u671f\u516d",HOUR:"\u5c0f\u65f6",MINUTE:"\u5206\u949f",SECOND:"\u79d2",TIMER:"\u8ba1\u65f6\u5668",RESET_TIMER:"\u91cd\u7f6e \u8ba1\u65f6\u5668",MATH_NUMBER_TOOLTIP:"\u4e00\u4e2a\u6570\u5b57\u3002",RANDOM_NUM:"\u5728 %1 \u5230 %2 \u95f4\u968f\u673a\u6574\u6570",DIVISIBLE_BY:"%1 \u80fd\u88ab %2 \u6574\u9664",CALCULATE:"\u6570\u5b66\u8fd0\u7b97 %1",CALCULATE_TOOLTIPS:"\u76f4\u63a5\u8f93\u5165\u6570\u5b66\u5f0f\u5b50\u8fdb\u884c\u8fd0\u7b97",MATH_ARITHMETIC:"%1 %2 %3",MATH_ARITHMETIC_TOOLTIP_ADD:"\u8fd4\u56de\u4e24\u4e2a\u6570\u503c\u7684\u548c\u3002",MATH_ARITHMETIC_TOOLTIP_MINUS:"\u8fd4\u56de\u4e24\u4e2a\u6570\u503c\u7684\u5dee\u503c\u3002",MATH_ARITHMETIC_TOOLTIP_MULTIPLY:"\u8fd4\u56de\u4e24\u4e2a\u6570\u503c\u7684\u4e58\u79ef\u3002",MATH_ARITHMETIC_TOOLTIP_DIVIDE:"\u8fd4\u56de\u4e24\u4e2a\u6570\u503c\u7684\u5546\u3002",MATH_ARITHMETIC_TOOLTIP_POWER:"\u8fd4\u56de\u4ee5\u7b2c\u4e00\u4e2a\u6570\u503c\u4e3a\u5e95\u6570\uff0c\u4ee5\u7b2c\u4e8c\u4e2a\u6570\u503c\u4e3a\u5e42\u7684\u7ed3\u679c\u3002",MATH_SINGLE:"%1 %2",MATH_SINGLE_OP_ROOT:"\u7b97\u672f\u5e73\u65b9\u6839",MATH_SINGLE_TOOLTIP_ROOT:"\u8fd4\u56de\u4e00\u4e2a\u6570\u7684\u5e73\u65b9\u6839\u3002",MATH_SINGLE_OP_ABSOLUTE:"\u7edd\u5bf9\u503c",MATH_SINGLE_TOOLTIP_ABS:"\u8fd4\u56de\u4e00\u4e2a\u6570\u7684\u7edd\u5bf9\u503c\u3002",MATH_SINGLE_TOOLTIP_NEG:"\u8fd4\u56de\u6307\u5b9a\u6578\u5b57\u7684\u903b\u8f91\u975e",MATH_SINGLE_TOOLTIP_LN:"\u8fd4\u56de\u4e00\u4e2a\u6570\u7684\u81ea\u7136\u5bf9\u6570\u3002",MATH_SINGLE_TOOLTIP_LOG10:"\u8fd4\u56de\u4e00\u4e2a\u6570\u7684\u5bf9\u6570\u3002",MATH_SINGLE_TOOLTIP_EXP:"\u8fd4\u56de\u6307\u5b9a\u6578\u5b57\u6307\u6578\u7684 e",MATH_SINGLE_TOOLTIP_POW10:"\u8fd4\u56de\u4e00\u4e2a\u6570\u768410\u6b21\u5e42\u3002",MATH_ROUND:"%1 %2",MATH_ROUND_TOOLTIP:"\u6570\u5b57\u5411\u4e0a\u6216\u5411\u4e0b\u820d\u5165\u3002",MATH_ROUND_OPERATOR_ROUND:"\u56db\u820d\u4e94\u5165",MATH_ROUND_OPERATOR_ROUNDUP:"\u5411\u4e0a\u820d\u5165",MATH_ROUND_OPERATOR_ROUNDDOWN:"\u5411\u4e0b\u820d\u5165",MATH_MODULO_TITLE:"%1 \xf7 %2 \u7684\u4f59\u6570",MATH_MODULO_TOOLTIP:"\u8fd4\u56de\u8fd9\u4e24\u4e2a\u6570\u5b57\u76f8\u9664\u540e\u7684\u4f59\u6570\u3002",MATH_NUMBER_PROPERTY:"%1 %2",MATH_IS_EVEN:"\u662f\u5076\u6570",MATH_IS_ODD:"\u662f\u5947\u6570",MATH_IS_PRIME:"\u662f\u8d28\u6570",MATH_IS_WHOLE:"\u662f\u6574\u6570",MATH_IS_POSITIVE:"\u662f\u6b63\u6570",MATH_IS_NEGATIVE:"\u662f\u8d1f\u6570",MATH_IS_TOOLTIP:"\u5982\u679c\u6570\u5b57\u662f\u5076\u6570\u3001\u5947\u6570\u3001\u975e\u8d1f\u6574\u6570\u3001\u6b63\u6570\u3001\u8d1f\u6570\u6216\u5982\u679c\u5b83\u53ef\u88ab\u67d0\u6570\u5b57\u6574\u9664\uff0c\u5219\u8fd4\u56de\u771f\u6216\u5047\u3002",MATH_DEGREES:"\u5ea6",LOGIC_NEGATE_TITLE:"%1 \u4e0d\u6210\u7acb",LOGIC_BOOLEAN_TRUE:"\u6210\u7acb",LOGIC_BOOLEAN_FALSE:"\u4e0d\u6210\u7acb",LOGIC_BOOLEAN_TOOLTIP:"\u8fd4\u56de\u771f\u6216\u5047\u3002",LOGIC_COMPARE:"%1 %2 %3",LOGIC_COMPARE_TOOLTIP_EQ:"\u5982\u679c\u4e24\u4e2a\u8f93\u5165\u7ed3\u679c\u76f8\u7b49\uff0c\u5219\u8fd4\u56de\u771f\u3002",LOGIC_COMPARE_TOOLTIP_NEQ:"\u5982\u679c\u4e24\u4e2a\u8f93\u5165\u7ed3\u679c\u4e0d\u76f8\u7b49\uff0c\u5219\u8fd4\u56de\u771f\u3002",LOGIC_COMPARE_TOOLTIP_LT:"\u5982\u679c\u7b2c\u4e00\u4e2a\u8f93\u5165\u7ed3\u679c\u6bd4\u7b2c\u4e8c\u4e2a\u5c0f\uff0c\u5219\u8fd4\u56de\u771f\u3002",LOGIC_COMPARE_TOOLTIP_LTE:"\u5982\u679c\u7b2c\u4e00\u4e2a\u8f93\u5165\u7ed3\u679c\u5c0f\u4e8e\u6216\u7b49\u4e8e\u7b2c\u4e8c\u4e2a\u8f93\u5165\u7ed3\u679c\uff0c\u5219\u8fd4\u56de\u771f\u3002",LOGIC_COMPARE_TOOLTIP_GT:"\u5982\u679c\u7b2c\u4e00\u4e2a\u8f93\u5165\u7ed3\u679c\u6bd4\u7b2c\u4e8c\u4e2a\u5927\uff0c\u5219\u8fd4\u56de\u771f\u3002",LOGIC_COMPARE_TOOLTIP_GTE:"\u5982\u679c\u7b2c\u4e00\u4e2a\u8f93\u5165\u7ed3\u679c\u5927\u4e8e\u6216\u7b49\u4e8e\u7b2c\u4e8c\u4e2a\u8f93\u5165\u7ed3\u679c\uff0c\u5219\u8fd4\u56de\u771f\u3002",LOGIC_OPERATION:"%1 %2 %3",LOGIC_OPERATION_AND:"\u4e14",LOGIC_OPERATION_OR:"\u6216",LOGIC_OPERATION_TOOLTIP_AND:"\u5982\u679c\u4e24\u4e2a\u8f93\u5165\u7ed3\u679c\u90fd\u4e3a\u771f\uff0c\u5219\u8fd4\u56de\u771f\u3002",LOGIC_OPERATION_TOOLTIP_OR:"\u5982\u679c\u81f3\u5c11\u6709\u4e00\u4e2a\u8f93\u5165\u7ed3\u679c\u4e3a\u771f\uff0c\u5219\u8fd4\u56de\u771f\u3002",TEXT_TEXT_TOOLTIP:"\u4e00\u4e2a\u5b57\u6bcd\u3001\u5355\u8bcd\u6216\u4e00\u884c\u6587\u672c\u3002",TEXT_SELECT:"%1 \u7684\u7b2c %2 \u5230\u7b2c %3 \u4e2a\u5b57\u7b26",TEXT_LENGTH:"%1 \u7684\u957f\u5ea6",TEXT_CONTAIN:"%1 \u5305\u542b %2",TEXT_SPLIT:"\u628a %1 \u6309 %2 \u5206\u5f00\u6210\u5217\u8868",TEXT_JOIN_TOOLTIP:"\u901a\u8fc7\u4e32\u8d77\u4efb\u610f\u6570\u91cf\u7684\u9879\u4ee5\u5efa\u7acb\u4e00\u6bb5\u6587\u5b57\u3002",TEXT_JOIN_TITLE_HEAD:"\u628a",TEXT_JOIN_TITLE_TAIL:"\u653e\u5728\u4e00\u8d77",VARIABLES_GET:"%1",VARIABLES_SET:"\u8bbe\u7f6e\u53d8\u91cf %1 \u7684\u503c\u4e3a %2",CHANGE_VARIABLE:"\u5c06\u53d8\u91cf %1 %2 %3",INCREASE:"\u589e\u52a0",DECREASE:"\u51cf\u5c11",LISTS_GET:"%1",LISTS_APPEND:"\u6dfb\u52a0 %1 \u5230 %2 \u672b\u5c3e",LISTS_INSERT_VALUE:"\u63d2\u5165 %3 \u5230 %1 \u7684\u7b2c %2 \u9879",LISTS_COPY:"\u590d\u5236 %2 \u5230 %1",LISTS_LENGTH:"%1 \u7684\u957f\u5ea6",LISTS_IS_EXIST:"%1 \u4e2d\u5305\u542b %2",LISTS_INDEX_OF:"%2 \u4e2d\u7b2c\u4e00\u4e2a %1 \u7684\u4f4d\u7f6e",PROCEDURES_PARAMETER:"\u53c2\u6570%1",PROCEDURES_RETURN_VALUE:"\u8fd4\u56de %1 %2",PROCEDURES_DEFNORETURN_TITLE:"\u5b9a\u4e49\u51fd\u6570",PROCEDURES_DEFNORETURN_PROCEDURE:"\u51fd\u6570",PROCEDURES_DEFNORETURN_TOOLTIP:"\u521b\u5efa\u4e00\u4e2a\u51fd\u6570\u3002",PROCEDURES_DEFRETURN_RETURN:"\u8fd4\u56de",COLOR_PICKER:"%1",RED:"\u7ea2\u8272",GREEN:"\u7eff\u8272",BLUE:"\u84dd\u8272",HUE:"\u8272\u76f8",SATURATION:"\u9971\u548c\u5ea6",BRIGHTNESS:"\u660e\u5ea6",OPACITY:"\u4e0d\u900f\u660e\u5ea6",SELECT_COLOR_PARAM_TYPE:"\u9009\u53c2\u65b9\u5f0f",COLOR_PREVIEW:"\u989c\u8272\u9884\u89c8"}},57341:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.zh_hant=void 0,e.zh_hant={DUPLICATE_BLOCK:"\u8907\u88fd",COPY_ALL:"\u8907\u88fd\u6240\u6709\u7a4d\u6728\uff08 %1 \u500b)",ADD_COMMENT:"\u52a0\u5165\u8a3b\u89e3",REMOVE_COMMENT:"\u79fb\u9664\u8a3b\u89e3",DELETE_BLOCK:"\u522a\u9664\u7a4d\u6728",DELETE_X_BLOCKS:"\u522a\u9664\u6240\u6709\u7a4d\u6728\uff08 %1 \u500b\uff09",DELETE_ALL_BLOCKS:"\u522a\u9664\u5171 %1 \u500b\u7a4d\u6728\uff1f",CLEAN_UP:"\u6574\u7406\u7a4d\u6728",COLLAPSE_BLOCK:"\u6536\u5408\u7a4d\u6728",COLLAPSE_ALL:"\u6536\u5408\u7a4d\u6728",EXPAND_BLOCK:"\u5c55\u958b\u7a4d\u6728",EXPAND_ALL:"\u5c55\u958b\u6240\u6709\u7a4d\u6728",UNDO:"\u64a4\u9500",REDO:"\u91cd\u8a66",PASTE:"\u7c98\u8cbc",COPY_AND_PASTE:"\u8907\u88fd\u4e26\u7c98\u8cbc",GLOBAL_COMMENT:"\u6dfb\u52a0\u5168\u5c40\u8a3b\u91cb",COMMENT:"\u8a3b\u91cb",BLUE_COMMENT:"\u85cd\u8272\u8a3b\u91cb",GREEN_COMMENT:"\u7da0\u8272\u8a3b\u91cb",YELLOW_COMMENT:"\u9ec3\u8272\u8a3b\u91cb",RED_COMMENT:"\u7d05\u8272\u8a3b\u91cb",DELETE_COMMENT:"\u522a\u9664\u8a3b\u91cb",WHATS_THIS:"\u9019\u662f\u4ec0\u9ebc\u529f\u80fd\u2026",SAY_SOMETHING:"\u8aaa\u4e9b\u4ec0\u9ebc\u2026",START_ON_CLICK:"%1 \u7576 \u958b\u59cb \u88ab\u9ede\u64ca",start_on_click_2:"%1 \u7576 \u958b\u59cb \u88ab\u9ede\u64ca %2 %3",ON_RUNNING_GROUP_ACTIVATED:"%1 \u7576 \u5207\u63db\u5230 \u7576\u524d\u5c4f\u5e55",SELF_LISTEN:"%1 \u7576 \u6536\u5230 \u5ee3\u64ad %2 %3 %4",SELF_BROADCAST:"\u767c\u9001\u5ee3\u64ad %1",SELF_BROADCAST_AND_WAIT:"\u767c\u9001\u5ee3\u64ad %1 \u4e26\u7b49\u5f85",WHEN:"%1 \u7576 %2 %3",TERMINATE:"\u505c\u6b62",REPEAT_FOREVER:"\u91cd\u8907\u57f7\u884c %1 %2",REPEAT_N_TIMES:"\u91cd\u8907\u57f7\u884c %1 \u6b21 %2 %3",REPEAT_FOREVER_UNTIL:"\u91cd\u8907\u57f7\u884c\u76f4\u5230 %1 %2 %3",BREAK:"\u9000\u51fa\u5faa\u74b0",WARP:"\u4e00\u6b65\u57f7\u884c %1 %2",WAIT_SECS:"\u7b49\u5f85 %1 \u79d2",WAIT_UNTIL:"\u4fdd\u6301\u7b49\u5f85\u76f4\u5230 %1",DESTRUCT:"\u92b7\u6bc0\u81ea\u8eab",CONTROLS_IF_MSG_IF:"\u5982\u679c",CONTROLS_IF_MSG_ELSEIF:"\u5426\u5247\u5982\u679c",CONTROLS_IF_MSG_ELSE:"\u5426\u5247",CONTROLS_IF_TOOLTIP_1:"\u7576\u503c\u70ba true \u6642\uff0c\u57f7\u884c\u4e00\u4e9b\u9673\u8ff0\u5f0f\u3002",CONTROLS_IF_TOOLTIP_2:"\u7576\u503c\u70ba true \u6642\uff0c\u57f7\u884c\u7b2c\u4e00\u500b\u9673\u8ff0\u5f0f\uff0c\u5426\u5247\uff0c\u57f7\u884c\u7b2c\u4e8c\u500b\u9673\u8ff0\u5f0f\u3002",CONTROLS_IF_TOOLTIP_3:"\u5982\u679c\u7b2c\u4e00\u500b\u503c\u70ba true\uff0c\u5247\u57f7\u884c\u7b2c\u4e00\u500b\u9673\u8ff0\u5f0f\u3002\u5426\u5247\uff0c\u7576\u7b2c\u4e8c\u500b\u503c\u70ba true \u6642\uff0c\u5247\u57f7\u884c\u7b2c\u4e8c\u500b\u9673\u8ff0\u5f0f\u3002",CONTROLS_IF_TOOLTIP_4:"\u5982\u679c\u7b2c\u4e00\u500b\u503c\u70ba true\uff0c\u5247\u57f7\u884c\u7b2c\u4e00\u500b\u9673\u8ff0\u5f0f\u3002\u5426\u5247\u7576\u7b2c\u4e8c\u500b\u503c\u70ba true \u6642\uff0c\u5247\u57f7\u884c\u7b2c\u4e8c\u500b\u9673\u8ff0\u5f0f\u3002\u5982\u679c\u524d\u5e7e\u500b\u6558\u8ff0\u90fd\u4e0d\u70ba ture\uff0c\u5247\u57f7\u884c\u6700\u5f8c\u4e00\u500b\u9673\u8ff0\u5f0f\u3002",TELL:"\u544a\u8a34 %1 \u57f7\u884c %2 %3",SYNC_TELL:"\u544a\u8a34 %1 \u57f7\u884c\u4e26\u7b49\u5f85 %2 %3",GET_TIME:"\u7576\u524d %1",YEAR:"\u5e74",MONTH:"\u6708",DATE:"\u65e5",WEEK:"\u661f\u671f",WEEK0:"\u661f\u671f\u65e5",WEEK1:"\u661f\u671f\u4e00",WEEK2:"\u661f\u671f\u4e8c",WEEK3:"\u661f\u671f\u4e09",WEEK4:"\u661f\u671f\u56db",WEEK5:"\u661f\u671f\u4e94",WEEK6:"\u661f\u671f\u516d",HOUR:"\u5c0f\u6642",MINUTE:"\u5206\u9418",SECOND:"\u79d2",TIMER:"\u8a08\u6642\u5668",RESET_TIMER:"\u91cd\u7f6e \u8a08\u6642\u5668",MATH_NUMBER_TOOLTIP:"\u4e00\u500b\u6578\u5b57\u3002",RANDOM_NUM:"\u5728 %1 \u5230 %2 \u9593\u96a8\u6a5f\u6574\u6578",DIVISIBLE_BY:"%1 \u80fd\u88ab %2 \u6574\u9664",CALCULATE:"\u6578\u5b78\u904b\u7b97 %1",CALCULATE_TOOLTIPS:"\u8f38\u5165\u6578\u5b78\u7b49\u5f0f\u9032\u884c\u904b\u7b97",MATH_ARITHMETIC:"%1 %2 %3",MATH_ARITHMETIC_TOOLTIP_ADD:"\u8fd4\u56de\u5169\u500b\u6578\u5b57\u7684\u7e3d\u548c\u3002",MATH_ARITHMETIC_TOOLTIP_MINUS:"\u8fd4\u56de\u5169\u500b\u6578\u5b57\u7684\u5dee\u3002",MATH_ARITHMETIC_TOOLTIP_MULTIPLY:"\u8fd4\u56de\u5169\u500b\u6578\u5b57\u7684\u4e58\u7a4d\u3002",MATH_ARITHMETIC_TOOLTIP_DIVIDE:"\u8fd4\u56de\u5169\u500b\u6578\u5b57\u7684\u5546\u3002",MATH_ARITHMETIC_TOOLTIP_POWER:"\u8fd4\u56de\u7b2c\u4e8c\u500b\u6578\u5b57\u7684\u6307\u6578\u7684\u7b2c\u4e00\u500b\u6578\u5b57\u3002",MATH_SINGLE:"%1 %2",MATH_SINGLE_OP_ROOT:"\u7b97\u6578\u5e73\u65b9\u6839",MATH_SINGLE_TOOLTIP_ROOT:"\u8fd4\u56de\u6307\u5b9a\u6578\u5b57\u7684\u5e73\u65b9\u6839\u3002",MATH_SINGLE_OP_ABSOLUTE:"\u7d55\u5c0d\u503c",MATH_SINGLE_TOOLTIP_ABS:"\u8fd4\u56de\u6307\u5b9a\u6578\u5b57\u7684\u7d55\u5c0d\u503c\u3002",MATH_SINGLE_TOOLTIP_NEG:"\u8fd4\u56de\u6307\u5b9a\u6578\u5b57\u7684\u903b\u8f91\u975e",MATH_SINGLE_TOOLTIP_LN:"\u8fd4\u56de\u6307\u5b9a\u6578\u5b57\u7684\u81ea\u7136\u5c0d\u6578\u3002",MATH_SINGLE_TOOLTIP_LOG10:"\u8fd4\u56de\u6307\u5b9a\u6578\u5b57\u7684\u5c0d\u6578\u3002",MATH_SINGLE_TOOLTIP_EXP:"\u8fd4\u56de\u6307\u5b9a\u6578\u5b57\u6307\u6578\u7684 e",MATH_SINGLE_TOOLTIP_POW10:"\u8fd4\u56de\u6307\u5b9a\u6578\u5b57\u6307\u6578\u768410\u7684\u51aa\u6b21\u3002",MATH_ROUND:"%1 %2",MATH_ROUND_TOOLTIP:"\u5c07\u6578\u5b57\u7121\u689d\u4ef6\u9032\u4f4d\u6216\u7121\u689d\u4ef6\u6368\u53bb\u3002.",MATH_ROUND_OPERATOR_ROUND:"\u56db\u6368\u4e94\u5165",MATH_ROUND_OPERATOR_ROUNDUP:"\u5411\u4e0a\u820d\u5165",MATH_ROUND_OPERATOR_ROUNDDOWN:"\u5411\u4e0b\u820d\u5165",MATH_MODULO_TITLE:"%1 \xf7 %2 \u7684\u9918\u6578",MATH_MODULO_TOOLTIP:"\u56de\u50b3\u5169\u500b\u6578\u5b57\u76f8\u9664\u7684\u9918\u6578\u3002",MATH_NUMBER_PROPERTY:"%1 %2",MATH_IS_EVEN:"\u662f\u5076\u6570",MATH_IS_ODD:"\u662f\u5947\u6570",MATH_IS_PRIME:"\u662f\u8d28\u6570",MATH_IS_WHOLE:"\u662f\u6574\u6570",MATH_IS_POSITIVE:"\u662f\u6b63\u6570",MATH_IS_NEGATIVE:"\u662f\u8d1f\u6570",MATH_IS_TOOLTIP:"\u5982\u679c\u6570\u5b57\u662f\u5076\u6570\u3001\u5947\u6570\u3001\u975e\u8d1f\u6574\u6570\u3001\u6b63\u6570\u3001\u8d1f\u6570\u6216\u5982\u679c\u5b83\u53ef\u88ab\u67d0\u6570\u5b57\u6574\u9664\uff0c\u5219\u8fd4\u56de\u771f\u6216\u5047\u3002",MATH_DEGREES:"\u5ea6",LOGIC_NEGATE_TITLE:"%1 \u4e0d\u6210\u7acb",LOGIC_BOOLEAN_TRUE:"\u6210\u7acb",LOGIC_BOOLEAN_FALSE:"\u4e0d\u6210\u7acb",LOGIC_BOOLEAN_TOOLTIP:"\u8fd4\u56de\u771f\u6216\u5047\u3002",LOGIC_COMPARE:"%1 %2 %3",LOGIC_COMPARE_TOOLTIP_EQ:"\u5982\u679c\u9019\u5169\u500b\u8f38\u5165\u5340\u584a\u7684\u7d50\u679c\u76f8\u7b49\uff0c\u8fd4\u56de true\u3002",LOGIC_COMPARE_TOOLTIP_NEQ:"\u5982\u679c\u9019\u5169\u500b\u8f38\u5165\u5340\u584a\u7684\u7d50\u679c\u4e0d\u76f8\u7b49\uff0c\u8fd4\u56de true\u3002",LOGIC_COMPARE_TOOLTIP_LT:"\u5982\u679c\u7b2c\u4e00\u500b\u8f38\u5165\u7d50\u679c\u6bd4\u7b2c\u4e8c\u500b\u5c0f\uff0c\u8fd4\u56de true\u3002",LOGIC_COMPARE_TOOLTIP_LTE:"\u5982\u679c\u7b2c\u4e00\u500b\u8f38\u5165\u7d50\u679c\u5c0f\u65bc\u6216\u7b49\u65bc\u7b2c\u4e8c\u500b\uff0c\u8fd4\u56de true\u3002",LOGIC_COMPARE_TOOLTIP_GT:"\u5982\u679c\u7b2c\u4e00\u500b\u8f38\u5165\u7d50\u679c\u5927\u65bc\u7b2c\u4e8c\u500b\uff0c\u8fd4\u56de true\u3002",LOGIC_COMPARE_TOOLTIP_GTE:"\u5982\u679c\u7b2c\u4e00\u500b\u8f38\u5165\u7d50\u679c\u5927\u65bc\u6216\u7b49\u65bc\u7b2c\u4e8c\u500b\uff0c\u8fd4\u56de true\u3002",LOGIC_OPERATION:"%1 %2 %3",LOGIC_OPERATION_AND:"\u4e14",LOGIC_OPERATION_OR:"\u6216",LOGIC_OPERATION_TOOLTIP_AND:"\u5982\u679c\u5169\u500b\u8f38\u5165\u7d50\u679c\u90fd\u70ba true\uff0c\u5247\u8fd4\u56de true\u3002",LOGIC_OPERATION_TOOLTIP_OR:"\u5982\u679c\u81f3\u5c11\u4e00\u500b\u8f38\u5165\u7d50\u679c\u70ba true\uff0c\u8fd4\u56de true\u3002",TEXT_TEXT_TOOLTIP:"\u4e00\u500b\u5b57\u5143\u3001\u4e00\u500b\u55ae\u8a5e\uff0c\u6216\u4e00\u4e32\u6587\u5b57\u3002",TEXT_SELECT:"%1 \u7684\u7b2c %2 \u5230\u7b2c %3 \u500b\u5b57\u5143",TEXT_LENGTH:"%1 \u7684\u9577\u5ea6",TEXT_CONTAIN:"%1 \u5305\u542b %2",TEXT_SPLIT:"\u628a %1 \u6309 %2 \u5206\u958b\u6210\u5217\u8868",TEXT_JOIN_TOOLTIP:"\u901a\u904e\u9023\u63a5\u4efb\u610f\u6578\u91cf\u7684\u9805\u76ee\u4f86\u5efa\u7acb\u4e00\u4e32\u6587\u5b57\u3002",TEXT_JOIN_TITLE_HEAD:"\u628a",TEXT_JOIN_TITLE_TAIL:"\u653e\u5728\u4e00\u8d77",VARIABLES_GET:"%1",VARIABLES_SET:"\u8a2d\u7f6e\u8b8a\u91cf %1 \u7684\u503c\u4e3a %2",CHANGE_VARIABLE:"\u5c07\u8b8a\u91cf %1 %2 %3",INCREASE:"\u589e\u52a0",DECREASE:"\u6e1b\u5c11",LISTS_GET:"%1",LISTS_APPEND:"\u6dfb\u52a0 %1 \u5230 %2 \u672b\u5c3e",LISTS_INSERT_VALUE:"\u63d2\u5165 %3 \u5230 %1 \u7684\u7b2c %2 \u9805",LISTS_COPY:"\u8907\u88fd %2 \u5230 %1",LISTS_LENGTH:"%1 \u7684\u9577\u5ea6",LISTS_IS_EXIST:"%1 \u4e2d\u5305\u542b %2",LISTS_INDEX_OF:"%2 \u4e2d\u7b2c\u4e00\u500b %1 \u7684\u4f4d\u7f6e",PROCEDURES_PARAMETER:"\u53c3\u6578%1",PROCEDURES_RETURN_VALUE:"\u8fd4\u56de %1 %2",PROCEDURES_DEFNORETURN_TITLE:"\u5b9a\u7fa9\u51fd\u6578",PROCEDURES_DEFNORETURN_PROCEDURE:"\u51fd\u6578",PROCEDURES_DEFNORETURN_TOOLTIP:"\u5275\u5efa\u4e00\u500b\u51fd\u6578\u3002",PROCEDURES_DEFRETURN_RETURN:"\u8fd4\u56de",COLOR_PICKER:"%1",RED:"\u7d05\u8272",GREEN:"\u7da0\u8272",BLUE:"\u85cd\u8272",HUE:"\u8272\u76f8",SATURATION:"\u98fd\u548c\u5ea6",BRIGHTNESS:"\u4eae\u5ea6",OPACITY:"\u4e0d\u900f\u660e\u5ea6",SELECT_COLOR_PARAM_TYPE:"\u9078\u53c3\u65b9\u5f0f",COLOR_PREVIEW:"\u984f\u8272\u9810\u89bd"}},6517:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.register_procedure_blocks=e.icon_procedure=void 0;var o=i(98734),n=i(56905),r=i(98030),s=i(61972),_=i(27929),a=i(4124);e.icon_procedure="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNiAzNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0xOCAzNkM4LjA1OSAzNiAwIDI3Ljk0MSAwIDE4UzguMDU5IDAgMTggMHMxOCA4LjA1OSAxOCAxOC04LjA1OSAxOC0xOCAxOHptMC0xYzkuMzg5IDAgMTctNy42MTEgMTctMTdTMjcuMzg5IDEgMTggMSAxIDguNjExIDEgMThzNy42MTEgMTcgMTcgMTd6IiBmaWxsPSIjRDc4MDU4IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48Y2lyY2xlIGZpbGw9IiNGRkYiIGN4PSIxOCIgY3k9IjE4IiByPSIxNyIvPjxwYXRoIGQ9Ik0yNy4xNTcgMjIuOTM1Yy0uMDQzLjE1LS4yMzUuMjUzLS40OS4zOWEuOTEyLjkxMiAwIDAgMS0uNjg1LjA4NC44Ni44NiAwIDAgMS0uNDQtLjMyNWwtMi4yOTItMy4wMzItMi43OCAzLjAxN2MtLjMzMi4zNi0uNzA4LjQxMy0xLjEzOC4xNTgtLjE3Ny0uMTAzLS41LS40ODctLjUzOC0uNjYtLjAzNi0uMTczLjAzMi0uMzU0LjIxLS41NDhsMy4wNzMtMy4zNDUtMi4yNC0yLjk2M2MtLjA5Mi0uMTM2LS4xMDEtLjI5NC0uMDI4LS40NzQuMDctLjE4LjIzNi0uMjg3LjQxMy0uMzkyLjI1NC0uMTQzLjQ4Ny0uMTQ3LjY2LS4xMzQuMTczLjAxLjMzLjExLjQ3NS4yOTNsMS44NjEgMi40MjcgMi4yNTQtMi40NTVjLjE5NS0uMjE2LjQxNi0uMjkyLjYyOS0uMzUzLjIxMi0uMDYxLjYzLjE1OC44Ni4yODYuMjM0LjEyNy4zNTYuMjczLjM3LjQzOC4wMTUuMTY0LS4wNS4zMjYtLjE5Ni40ODZsLTIuNzUzIDIuOTg1IDIuNzE3IDMuNzI1YS40MDUuNDA1IDAgMCAxIC4wNTguMzkyem0tNy4wNzUtMTQuODVjLS45NTYtLjEwNy0yLjk1Ni0uMjUtNC4xNjkuNTM0LTEuMjE1Ljc4OC0xLjkxMyAyLjE0LTIuMjUxIDMuNzVsLS40NzcgMi4yNzJIOS43NjJjLS4zOTggMC0uNzE1LjExNC0uNzQ4LjgyNy4wMzMuMzg5LjM1LjY5Ny43NDguNjk3aDMuMDk1bC0yLjA0IDkuOTY2cy0uNTIyIDEuNjI2LjYyIDEuNjk3Yy45OTguMDYzIDEuMTk2LTEuNTYxIDEuMTk2LTEuNTYxbDIuMDU3LTEwLjEwMmgyLjYxM2EuNzYyLjc2MiAwIDAgMCAwLTEuNTI0aC0yLjI4OGwuNDUyLTIuMjI3Yy45NjctMy41NSAyLjc3MS0yLjY4OCA0LjQzOC0yLjY4OC4yNzMgMCAxLjMwMS4wNzIgMS4zNzMtLjYzMi4wOTEtLjg4LS43OTQtLjk2My0xLjE5Ni0xLjAwOHpNOSAxNS41OGMwLS4wNDYuMDQ1LS4wNjkuMDU4LS4xMS0uMDEzLS4wMjMtLjA1OC0uMDQzLS4wNTgtLjA2N3YuMTc3eiIgZmlsbD0iI0YwOEY2MyIgZmlsbC1ydWxlPSJub256ZXJvIi8+PC9nPjwvc3ZnPgo=",e.register_procedure_blocks=function(t,i,c,l){var d=t.di_container.get(r.BINDING.FieldIcon),u=t.di_container.get(r.BINDING.FieldTextInput),h=t.di_container.get(r.BINDING.MutationAddButton),p=t.di_container.get(r.BINDING.MutationRemoveButton),g=t.di_container.get(r.BINDING.FieldLabelSerializable),f=t.di_container.get(r.BINDING.CreateEvent),v=t.di_container.get(r.BINDING.ChangeEvent);t.define_block_with_object(a.PROCEDURE_BLOCK_TYPES.DEF,{init:function(){var r=this,l=(0,s.is_func)(i)?i():i,g=d({src:e.icon_procedure,opt_is_head:!0}),f=t.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,m=f,b=l.get_procedure_by_def(this.id);b&&(m=b.name);var y=u({text:m,opt_validator:function(e){var i=l.get_procedure_by_def(r.id);return i?t.events.is_undoing()?i.name:e:(0,_.get_legal_procedure_name)(e,l.get_occupied_procedure_names().concat([f]))}});y.set_spell_check(!1),this.is_in_flyout||this.is_insertion_marker()||(y.on_mouse_down=function(){return o.__awaiter(r,void 0,void 0,(function(){var e,i,r,s,d,u;return o.__generator(this,(function(o){switch(o.label){case 0:return e=this.id,[4,c.call(this,e)];case 1:return(i=o.sent())?(r=t.mainWorkspace.get_block_by_id(e),(0,n.assert)(r),l.get_procedure_by_name(i)&&(s=i,i=(0,_.get_legal_procedure_name)(i,l.get_occupied_procedure_names()),console.warn("Procedure ".concat(s," def exists. Renaming block [").concat(e,"] to ").concat(i))),d=l.get_procedure_by_def(e),(0,n.assert)(d),d.disabled?(console.warn("Trying to rename deleted procedure ".concat(e)),[2]):(u=d.name,t.events.disable(),l.rename_procedure(u,i),y.set_value(i),t.events.enable(),t.events.fire(v("procedure_rename",{block:r,old_value:u,new_value:i,name:a.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME})),[2])):[2]}}))}))}),this.append_dummy_input("PROCEDURES_2_DEFNORETURN_DEFINE").append_field(g).append_field(t.Msg.PROCEDURES_DEFNORETURN_TITLE).append_field(y,a.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME);var E=p(void 0);E.margin_left=12,this.append_dummy_input(a.PROCEDURE_BLOCK_INPUT_NAMES.DEF_MUTATOR).append_field(E).append_field(h()),this.append_statement_input("STACK",void 0,a.PROCEDURE_CONTEXT),this.set_inputs_inline(!0),this.set_colour(t.theme.block_color.ORANGE_4.fill),this.set_tooltip(t.Msg.PROCEDURES_DEFNORETURN_TOOLTIP)},addMutation:function(e){return o.__awaiter(this,void 0,void 0,(function(){var r,_,c,d,u,h,p,g,f,m,b,y;return o.__generator(this,(function(o){switch(o.label){case 0:return r=this.id,_=void 0,"string"===typeof e&&e?[3,2]:[4,l.call(this,r)];case 1:c=o.sent(),e=null===c||void 0===c?void 0:c.param_name,_=null===c||void 0===c?void 0:c.default_value,o.label=2;case 2:return e?(d=t.mainWorkspace.get_block_by_id(r),(0,n.assert)(d),u=(0,s.is_func)(i)?i():i,h=u.get_procedure_by_def(r),(0,n.assert)(h),h.disabled?(console.warn("Trying to add param to deleted procedure ".concat(r)),[2]):(p=u.get_procedure_param_names(h.name)).includes(e)?(console.warn("Param ".concat(e," exists.")),[2]):(g=p.length,t.events.disable(),f=d.append_math_shadow("".concat(a.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX).concat(g),a.PROCEDURE_BLOCK_INPUT_NAMES.DEF_MUTATOR),m='<block type="'.concat(a.PROCEDURE_BLOCK_TYPES.PARAM_ON_BLOCK,'"></block>'),(b=d.append_block_input(m,f)).set_field_value(e,a.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_NAME),void 0!==_&&b.set_field_value("=".concat(_),a.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_DEFAULT_VALUE),t.events.enable(),t.events.is_enabled()&&(y=t.events.get_group(),t.events.set_group(y||!0),t.events.fire(v("change_procedure_param",{block:d,old_value:void 0,new_value:{param_name:e,default_value:_}})),t.events.set_group(y)),[2])):[2]}}))}))},removeMutation:function(){var e,o=(0,s.is_func)(i)?i():i,n=o.get_procedure_name_by_def(this.id),r=null===(e=o.get_procedure_by_name(n))||void 0===e?void 0:e.params;if(r&&0!==r.length){t.events.disable();var _="".concat(a.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX).concat(r.length-1),c=this.get_input(_),l=c&&c.connection&&c.connection.targetBlock();l&&l.dispose(void 0,!1),this.remove_input(_),t.events.enable();var d=r[r.length-1];t.events.is_enabled()&&t.events.fire(v("change_procedure_param",{block:this,old_value:d,new_value:void 0}))}},domToMutation:function(t){if(t)for(var e=t.children.length,i=0;i<e;i++){var o=t.children[i];if("arg"===o.nodeName.toLowerCase()){var r=o.getAttribute("name");(0,n.assert)(r),this.append_math_shadow("".concat(a.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX).concat(i),a.PROCEDURE_BLOCK_INPUT_NAMES.DEF_MUTATOR)}}},mutationToDom:function(){for(var t=document.createElement("mutation"),e=this.inputList.filter((function(t){return t.name.startsWith(a.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX)})),i=0;i<e.length;i++){var o=document.createElement("arg");o.setAttribute("name",e[i].name),t.appendChild(o)}return t}}),t.define_block_with_object(a.PROCEDURE_BLOCK_TYPES.PARAM_ON_BLOCK,{init:function(){var e=this,i=g({text:""});i.on_mouse_down=function(t){t.preventDefault()},this.append_dummy_input().append_field(i,a.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_NAME);var o=g({text:""});o.margin_left=2,this.append_dummy_input().append_field(o,a.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_DEFAULT_VALUE),this.set_output(!0),this.set_inputs_inline(!0),this.set_colour(t.theme.block_color.ORANGE_7.fill);this.on_mouse_down=function(i){var o=t.events.get_group();if(t.events.set_group(o||!0),0===i.button){var n=e.workspace.get_gesture(i);if(n){var r=n.handle_move.bind(n),s=n.handle_up.bind(n),_=0,c=!1;n.handle_move=function(o){if(c)r(o);else if(_<10)_++;else{n.is_dragging_block=!0;var s=function(){t.events.disable();var i=e.get_field_value(a.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_NAME)||"",o=e.workspace.new_block(a.PROCEDURE_BLOCK_TYPES.PARAM),n=e.get_relative_to_surface_xy();return o.move_by(n),o.set_field_value(i,a.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_NAME),o.init_svg(),o.render(),t.events.enable(),t.events.is_enabled()&&t.events.fire(f({block:o,source:"other"})),o}();s.select(),n.handle_block_start(i,s),n.target_block=s,c=!0}},n.handle_up=function(e){s(e),t.events.set_group(o)}}}}}}),t.define_block_with_object(a.PROCEDURE_BLOCK_TYPES.RETURN,{init:function(){this.append_dummy_input("PROCEDURES_2_DEFRETURN_RETURN").append_field(t.Msg.PROCEDURES_DEFRETURN_RETURN),this.append_math_shadow(a.PROCEDURE_BLOCK_INPUT_NAMES.RETURN_VALUE),this.append_dummy_input(a.PROCEDURE_BLOCK_INPUT_NAMES.RETURN_MUTATOR).append_field(p(void 0),"REMOVE_MUTATOR"),this.set_previous_statement(!0),this.set_next_statement(!1),this.set_inputs_inline(!0),this.set_colour(t.theme.block_color.ORANGE_4.fill),this.itemCount_=1},addMutation:function(e){var i;if(0===this.itemCount_){var o=this.get_input(a.PROCEDURE_BLOCK_INPUT_NAMES.RETURN_MUTATOR);(0,n.assert)(o),o.remove_field("ADD_MUTATOR"),o.append_field(p(void 0),"REMOVE_MUTATOR"),this.append_math_shadow(a.PROCEDURE_BLOCK_INPUT_NAMES.RETURN_VALUE,a.PROCEDURE_BLOCK_INPUT_NAMES.RETURN_MUTATOR);var r=this.get_input(a.PROCEDURE_BLOCK_INPUT_NAMES.RETURN_VALUE),s=r&&(null===(i=r.connection)||void 0===i?void 0:i.targetBlock());e&&(t.events.disable(),null===s||void 0===s||s.set_field_value(e.toString(),"NUM"),t.events.enable()),this.itemCount_=1,this.render(),t.events.is_enabled()&&t.events.fire(v("mutation",{block:this,old_value:void 0,new_value:e||1}))}},removeMutation:function(){var e,i;if(!(this.itemCount_<1)){var o=this.get_input(a.PROCEDURE_BLOCK_INPUT_NAMES.RETURN_VALUE),r=o&&(null===(e=o.connection)||void 0===e?void 0:e.targetBlock()),s="";if(null===r||void 0===r?void 0:r.is_shadow())s=r.get_field_value("NUM")||"";else{var _=null===(i=null===o||void 0===o?void 0:o.connection)||void 0===i?void 0:i.get_shadow_dom(),c=null===_||void 0===_?void 0:_.firstChild;c&&null!==c.textContent&&(s=c.textContent)}this.remove_input(a.PROCEDURE_BLOCK_INPUT_NAMES.RETURN_VALUE);var l=this.get_input(a.PROCEDURE_BLOCK_INPUT_NAMES.RETURN_MUTATOR);(0,n.assert)(l),l.remove_field("REMOVE_MUTATOR"),l.append_field(h(),"ADD_MUTATOR"),this.itemCount_=0,this.render(),t.events.is_enabled()&&t.events.fire(v("mutation",{block:this,old_value:s,new_value:void 0}))}},mutationToDom:function(){var t=document.createElement("mutation");return t.setAttribute("items",String(this.itemCount_)),t},domToMutation:function(t){var e;t&&(0===parseInt(t.getAttribute("items")||"0",10)&&(null===(e=this.removeMutation)||void 0===e||e.call(this)))}});var m={build_inputs:function(){var e=this,o=(0,s.is_func)(i)?i():i,n=this.append_dummy_input("NAME").append_field(g({text:""}),a.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME).fieldRow[0];n.set_validator((function(i){if(t.runtime_data.is_pasting())return n.get_value()||i;var r=o.get_procedure_by_caller_id(e.id);return r?r.name:i}))},domToMutation:function(e){var o,r=(0,s.is_func)(i)?i():i,_=e.getAttribute("name");(0,n.assert)(_);var c=e.getAttribute("def_id"),l=c?r.get_procedure_by_def(c):r.get_procedure_by_name(_);_=l?l.name:_,t.events.disable(),this.set_field_value(_,a.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME),t.events.enable();for(var d=l?l.params.length:e.childNodes.length,u=0;u<d;u++){var h=e.childNodes[u];if(!h||"procedures_2_parameter_shadow"===h.nodeName.toLowerCase()){var p=h.getAttribute("value"),g=this.append_default_value_shadow("".concat(a.PROCEDURE_BLOCK_INPUT_NAMES.ARG_PREFIX).concat(u)),f=p||"0",v=null===(o=null===g||void 0===g?void 0:g.connection)||void 0===o?void 0:o.targetBlock();if(null===v||void 0===v?void 0:v.is_shadow()){var m=v.get_field("TEXT");m&&(0,s.is_field_default_value)(m)&&m.set_value(f)}}}},mutationToDom:function(){var t=(0,s.is_func)(i)?i():i,e=document.createElement("mutation"),o=this.get_field_value(a.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME);(0,n.assert)(o),e.setAttribute("name",o);var r=t.get_procedure_by_name(o)||t.get_procedure_by_def(o);(0,n.assert)(r),e.setAttribute("def_id",r.def_id);for(var _=r.params,c=0;c<_.length;c++){var l=document.createElement("procedures_2_parameter_shadow"),d=_[c];l.setAttribute("name",d.param_name),l.setAttribute("value",d.default_value||"0"),e.appendChild(l)}return e},addMutation:function(t){var e,i=this.inputList.filter((function(t){return t.name.includes(a.PROCEDURE_BLOCK_INPUT_NAMES.ARG_PREFIX)})).length,o=this.append_default_value_shadow("".concat(a.PROCEDURE_BLOCK_INPUT_NAMES.ARG_PREFIX).concat(i)),n=t||"0",r=null===(e=null===o||void 0===o?void 0:o.connection)||void 0===e?void 0:e.targetBlock();if(null===r||void 0===r?void 0:r.is_shadow()){var _=r.get_field("TEXT");_&&(0,s.is_field_default_value)(_)&&_.set_value(n)}this.is_collapsed()?this.update_collapsed(!0):this.render()},removeMutation:function(){var t=this.inputList.filter((function(t){return t.name.includes(a.PROCEDURE_BLOCK_INPUT_NAMES.ARG_PREFIX)})).length;if(!t)throw Error("Trying to remove no-existent arg input on a call block");this.remove_input("".concat(a.PROCEDURE_BLOCK_INPUT_NAMES.ARG_PREFIX).concat(t-1)),this.is_collapsed()?this.update_collapsed(!0):this.render()}};t.define_block_with_object(a.PROCEDURE_BLOCK_TYPES.CALL_RETURN,o.__assign(o.__assign({},m),{init:function(){m.build_inputs.call(this),this.set_output(!0),this.set_inputs_inline(!0),this.set_colour(t.theme.block_color.ORANGE_4.fill)}})),t.define_block_with_object(a.PROCEDURE_BLOCK_TYPES.CALL_NORETURN,o.__assign(o.__assign({},m),{init:function(){m.build_inputs.call(this),this.set_previous_statement(!0),this.set_next_statement(!0),this.set_inputs_inline(!0),this.set_colour(t.theme.block_color.ORANGE_4.fill)}})),t.define_blocks_with_json_array([{type:a.PROCEDURE_BLOCK_TYPES.PARAM,message0:"%1",args0:[{type:"field_label_serializable",name:a.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_NAME,text:"x"}],output:!0,colour:"%{BKY_ORANGE_7}",required_context:a.PROCEDURE_CONTEXT,extensions:["param_block"]}])}},4124:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.PROCEDURE_CONTEXT=e.PROCEDURE_BLOCK_FIELD_NAMES=e.PROCEDURE_BLOCK_INPUT_NAMES=e.PROCEDURE_BLOCK_TYPES=void 0,function(t){t.DEF="procedures_2_defnoreturn",t.RETURN="procedures_2_return_value",t.CALL_RETURN="procedures_2_callreturn",t.CALL_NORETURN="procedures_2_callnoreturn",t.PARAM_ON_BLOCK="procedures_2_stable_parameter",t.PARAM="procedures_2_parameter",t.ACTOR_PARAM="procedures_2_actor_param"}(e.PROCEDURE_BLOCK_TYPES||(e.PROCEDURE_BLOCK_TYPES={})),function(t){t.DEF_MUTATOR="PROCEDURES_2_DEFNORETURN_MUTATOR",t.DEF_STATEMENT="STACK",t.RETURN_VALUE="VALUE",t.RETURN_MUTATOR="PROCEDURES_2_DEFRETURN_RETURN_MUTATOR",t.PARAM_PREFIX="PARAMS",t.ARG_PREFIX="ARG"}(e.PROCEDURE_BLOCK_INPUT_NAMES||(e.PROCEDURE_BLOCK_INPUT_NAMES={})),function(t){t.PROCEDURE_NAME="NAME",t.PARAM_NAME="param_name",t.PARAM_DEFAULT_VALUE="param_default_value"}(e.PROCEDURE_BLOCK_FIELD_NAMES||(e.PROCEDURE_BLOCK_FIELD_NAMES={})),e.PROCEDURE_CONTEXT="PROCEDURE_CONTEXT"},66132:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.register_default_procedure_events=void 0;var o=i(98734),n=i(98030),r=o.__importStar(i(37064)),s=i(56905),_=i(61972),a=i(4124),c=i(27929),l=i(50618);e.register_default_procedure_events=function(t,e){var i=(0,n.get_instance)().get(n.BINDING.events),o=(0,n.get_instance)().get(n.BINDING.ChangeEvent);t.add_custom_change_event("procedure_rename",(function(n){var r=(0,_.is_func)(e)?e():e,l=this.get_old_value(),d=this.get_new_value(),u=this.get_block_id();(0,s.assert)("string"===typeof l),(0,s.assert)("string"===typeof d);var h=t.get_block_by_id(u);(0,s.assert)(h);var p=r.get_procedure_name_by_def(u),g=n?d:l,f=(0,c.get_legal_procedure_name)(g,r.get_occupied_procedure_names());i.disable(),r.rename_procedure(p,f);var v=h.get_field("NAME");v&&v.set_value(f),i.enable(),i.fire(o("procedure_rename",{block:h,old_value:p,new_value:f,name:a.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME}))})),t.add_custom_change_event("change_procedure_param",(function(n){var r,c,l,d,u=(0,_.is_func)(e)?e():e,h=this.get_old_value(),p=this.get_new_value(),g=this.get_block_id(),f=n?p:h,v=n?h:p,m=t.get_block_by_id(g);(0,s.assert)(m);var b=u.get_procedure_by_def(g);if((0,s.assert)(b),i.disable(),"undefined"===typeof v&&"object"===typeof f){if(null===(r=m.addMutation)||void 0===r||r.call(m,f.param_name),void 0!==f.default_value){var y=b.params.length,E=null===(l=null===(c=m.get_input("".concat(a.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX).concat(y)))||void 0===c?void 0:c.connection)||void 0===l?void 0:l.targetBlock();(0,s.assert)(E),E.set_field_value("=".concat(f.default_value),a.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_DEFAULT_VALUE)}}else"undefined"===typeof f&&"object"===typeof v&&(null===(d=m.removeMutation)||void 0===d||d.call(m));i.enable(),i.fire(o("change_procedure_param",{block:m,old_value:v,new_value:f}))}));var d=function(e){t.add_change_listener((function i(o){o.type!==r.BlockEventType.END_DRAG&&o.type!==r.BlockEventType.DELETE||(setTimeout((function(){e(o)})),t.remove_change_listener(i))}))},u=function(n,c){if(!c||c.type!==r.BlockEventType.DELETE){var l=t.get_block_by_id(n.get_block_id());if(l){var d=i.is_record_undo();i.set_record_undo(!1);var u=(0,_.is_func)(e)?e():e;if(l.type===a.PROCEDURE_BLOCK_TYPES.DEF){var h=u.load_def_from_block(l);(0,s.assert)(h),i.disable();var p=l.get_field(a.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME),g=null===p||void 0===p?void 0:p.get_value();(0,s.assert)(p),p.set_value(h.name),i.enable(),g!==h.name&&i.fire(o("procedure_rename",{block:l,old_value:g||"",new_value:h.name,name:a.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME})),u.update_callers_disabled(t,h.def_id)}l.get_descendants(!1,!0).forEach((function(t){if(t.type===a.PROCEDURE_BLOCK_TYPES.CALL_RETURN||t.type===a.PROCEDURE_BLOCK_TYPES.CALL_NORETURN){var e=u.load_caller_from_block(t);(0,s.assert)(e);var i=u.get_procedure_by_caller_id(t.id);(0,s.assert)(i);var o=t.get_field(a.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME);(0,s.assert)(o),o.set_value(i.name),t.set_disabled(i.disabled||t.type===a.PROCEDURE_BLOCK_TYPES.CALL_RETURN&&0===i.return_count)}})),i.set_record_undo(d)}}};t.add_change_listener((function(o){var n=i.is_record_undo();switch(i.set_record_undo(!1),o.type){case r.BlockEventType.CREATE:i.is_undoing()||"flyout:drag"!==o.source?u(o):d(u.bind(o,o));break;case r.BlockEventType.DELETE:!function(i){var o=(0,_.is_func)(e)?e():e;if(i.old_xml.getAttribute("type")===a.PROCEDURE_BLOCK_TYPES.DEF){var n=o.delete_procedure_def(i.get_block_id());if(!n)return;o.update_callers_disabled(t,n.def_id)}var r=function(t){if("block"===t.tagName.toLowerCase()){var e=t.getAttribute("type"),i=t.getAttribute("id");(0,s.assert)(e),(0,s.assert)(i),e!==a.PROCEDURE_BLOCK_TYPES.CALL_RETURN&&e!==a.PROCEDURE_BLOCK_TYPES.CALL_NORETURN||o.delete_caller(i)}};r(i.old_xml),Array.from(i.old_xml.querySelectorAll("block")).forEach(r)}(o);break;case r.BlockEventType.MOVE:!function(o){var n=o.get_old_loc(),r=o.get_new_loc();if(n.input_name||n.parent_id||r.input_name||r.parent_id){var c=[],l=t.get_block_by_id(o.get_block_id());if(l){var u=(0,_.is_func)(e)?e():e,h=l.get_descendants(!1,!0).filter((function(t){return t.type===a.PROCEDURE_BLOCK_TYPES.RETURN&&t.get_input("VALUE")})).length;if(!(h<1)){var p=function(e){var i=e&&t.get_block_by_id(e),o=i&&i.get_top_parent();if(o&&(0,_.is_block_svg)(o)&&o.type===a.PROCEDURE_BLOCK_TYPES.DEF)return o.id},g=p(o.get_old_loc().parent_id);g&&c.push((function(){var e=u.get_procedure_by_def(g);(0,s.assert)(e),u.change_return_count(e.name,-1*h),0===e.return_count&&u.update_callers_disabled(t,e.def_id)}));var f=p(o.get_new_loc().parent_id);f&&c.push((function(){var e=u.get_procedure_by_def(f);if(e){var i=e.return_count;u.change_return_count(e.name,h),0===i&&e.return_count>0&&u.update_callers_disabled(t,e.def_id)}}));var v=function(){var t=i.is_record_undo();i.set_record_undo(!1),c.forEach((function(t){return t()})),i.set_record_undo(t)};!i.is_undoing()&&t.is_dragging()?d(v):v()}}}}(o);break;case r.BlockEventType.CHANGE:!function(i){var o=t.get_block_by_id(i.get_block_id()||"");if(i.type===r.BlockEventType.CHANGE&&o){var n=(0,_.is_func)(e)?e():e;if(o.type===a.PROCEDURE_BLOCK_TYPES.RETURN){var c=o.get_top_parent();if(c&&(0,_.is_block_svg)(c)&&c.type!==a.PROCEDURE_BLOCK_TYPES.DEF)return;var l=n.get_procedure_by_def(c.id);(0,s.assert)(l),"mutation"===i.element&&(void 0!==i.get_new_value()?(n.change_return_count(l.name,1),l.return_count>0&&n.update_callers_disabled(t,l.def_id)):void 0!==i.get_old_value()&&(n.change_return_count(l.name,-1),0===l.return_count&&n.update_callers_disabled(t,l.def_id)))}if(o.type===a.PROCEDURE_BLOCK_TYPES.DEF){if("change_procedure_param"===i.element){var d=i.get_old_value(),u=i.get_new_value();if(l=n.get_procedure_by_def(i.get_block_id()),(0,s.assert)(l,"Trying to edit param on in-existing procedure"),"object"===typeof u&&"undefined"===typeof d){var h=u;n.add_param(l.name,h.param_name,h.default_value),n.update_params(t,l.name,"increase",h)}else"object"===typeof d&&"undefined"===typeof u&&(h=d,n.delete_param(l.name,h.param_name),n.update_params(t,l.name,"decrease",h));return}"procedure_rename"===i.element&&(d=i.get_old_value(),u=i.get_new_value(),(0,s.assert)("string"===typeof d),(0,s.assert)("string"===typeof u),n.update_procedure_name(t,d,u))}}}(o)}i.set_record_undo(n)})),t.set_pre_paste((function(t,i,o,n){var r=(0,_.is_func)(e)?e():e;return n||(t=(0,l.load_from_xml)(r,t,!0)),{xml_block:t,mouse_position:i,is_move_to_default:o}})),t.set_pre_paste_extend((function(t,i,o){var n=(0,_.is_func)(e)?e():e,r=document.createElement("xml");return t.forEach((function(t){return r.appendChild(t)})),{xml_blocks:t=Array.from((0,l.load_from_xml)(n,r,!0).children),mouse_position:i,is_move_to_default:o}}))}},2706:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.register_procedure_generator=void 0;var o=i(56905),n=i(4124);e.register_procedure_generator=function(t){t.register(n.PROCEDURE_BLOCK_TYPES.DEF,(function(e){var i=e.get_field_value("NAME");(0,o.assert)(i);var r=e.inputList.filter((function(t){return t.name.startsWith(n.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX)})).map((function(i){return t.value_to_code(e,i.name,t.ORDER_ATOMIC)})),s=t.statement_to_code(e,"STACK");return"function ".concat(i,"(").concat(r.join(", "),") {\n").concat(s,"}")})),t.register(n.PROCEDURE_BLOCK_TYPES.RETURN,(function(e){return e.get_input("VALUE")?"return ".concat(t.value_to_code(e,"VALUE",t.ORDER_NONE),";\n"):"return;\n"}));var e=function(e){var i=e.get_field_value("NAME");(0,o.assert)(i);var n=e.inputList.filter((function(t){return t.name.startsWith("ARG")})).map((function(i){return t.value_to_code(e,i.name,t.ORDER_NONE)}));return"".concat(i,"(").concat(n.join(", "),")")};t.register(n.PROCEDURE_BLOCK_TYPES.CALL_NORETURN,(function(t){return"".concat(e(t),";\n")})),t.register(n.PROCEDURE_BLOCK_TYPES.CALL_RETURN,(function(i){return[e(i),t.ORDER_FUNCTION_CALL]}));var i=function(e){var i=e.get_field_value("param_name");return(0,o.assert)(i),[i,t.ORDER_ATOMIC]};t.register(n.PROCEDURE_BLOCK_TYPES.PARAM,i),t.register(n.PROCEDURE_BLOCK_TYPES.PARAM_ON_BLOCK,i)}},21410:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.register_procedure_json_generator=void 0;var o=i(4124);e.register_procedure_json_generator=function(t){t.register(o.PROCEDURE_BLOCK_TYPES.DEF,(function(e,i){var n=e.blocks[i],r=t.get_field_value(n,"NAME"),s=Object.keys(n.shadows).filter((function(t){return t.startsWith(o.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX)})).map((function(o){return t.value_to_code(e,i,o,t.ORDER_ATOMIC)})),_=t.statement_to_code(e,i,"STACK");return"function ".concat(r,"(").concat(s.join(", "),") {\n").concat(_,"}")})),t.register(o.PROCEDURE_BLOCK_TYPES.RETURN,(function(e,i){var o=e.blocks[i];return Object.keys(o.shadows).length>2?"return ".concat(t.value_to_code(e,i,"VALUE",t.ORDER_NONE),";\n"):"return;\n"}));var e=function(e,i){var o=e.blocks[i],n=t.get_field_value(o,"NAME"),r=Object.keys(o.shadows).filter((function(t){return t.startsWith("ARG")})).map((function(o){return t.value_to_code(e,i,o,t.ORDER_NONE)}));return"".concat(n,"(").concat(r.join(", "),")")};t.register(o.PROCEDURE_BLOCK_TYPES.CALL_NORETURN,(function(t,i){return"".concat(e(t,i),";\n")})),t.register(o.PROCEDURE_BLOCK_TYPES.CALL_RETURN,(function(i,o){return[e(i,o),t.ORDER_FUNCTION_CALL]}));var i=function(e,i){var o=e.blocks[i];return[t.get_field_value(o,"param_name"),t.ORDER_ATOMIC]};t.register(o.PROCEDURE_BLOCK_TYPES.PARAM,i),t.register(o.PROCEDURE_BLOCK_TYPES.PARAM_ON_BLOCK,i)}},14375:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.ProcedureManager=e.register_procedure_json_generator=e.register_procedure_generator=e.PROCEDURE_BLOCK_FIELD_NAMES=e.PROCEDURE_BLOCK_INPUT_NAMES=e.PROCEDURE_BLOCK_TYPES=void 0;var o=i(98734),n=i(98030),r=i(56905),s=i(6517),_=i(4124),a=i(66132),c=i(50618),l=i(95306),d=i(27929);o.__exportStar(i(29535),e);var u=i(4124);Object.defineProperty(e,"PROCEDURE_BLOCK_TYPES",{enumerable:!0,get:function(){return u.PROCEDURE_BLOCK_TYPES}}),Object.defineProperty(e,"PROCEDURE_BLOCK_INPUT_NAMES",{enumerable:!0,get:function(){return u.PROCEDURE_BLOCK_INPUT_NAMES}}),Object.defineProperty(e,"PROCEDURE_BLOCK_FIELD_NAMES",{enumerable:!0,get:function(){return u.PROCEDURE_BLOCK_FIELD_NAMES}});var h=i(2706);Object.defineProperty(e,"register_procedure_generator",{enumerable:!0,get:function(){return h.register_procedure_generator}});var p=i(21410);Object.defineProperty(e,"register_procedure_json_generator",{enumerable:!0,get:function(){return p.register_procedure_json_generator}});var g=function(){function t(t,e,i){var o=this;this.caller_disable_callback=t,this.param_update_callback=e,this.rename_procedure_callback=i,this.procedures={},this.callers={},this.get_all_procedures_xml=function(){var t=[],e=document.createElement("block");e.setAttribute("type",_.PROCEDURE_BLOCK_TYPES.DEF),t.push(e);var i=document.createElement("block");i.setAttribute("type",_.PROCEDURE_BLOCK_TYPES.RETURN),t.push(i);var n=document.createElement("sep");return n.setAttribute("gap","30"),t.push(n),Object.keys(o.procedures).filter((function(t){return!o.procedures[t].disabled})).sort((function(t,e){return o.procedures[t].created_timestamp-o.procedures[e].created_timestamp})).forEach((function(e){var i=o.procedures[e];if(!i.disabled){var n=i.name,r=i.params,s=document.createElement("block");s.setAttribute("type",_.PROCEDURE_BLOCK_TYPES.CALL_NORETURN);var a=document.createElement("mutation");a.setAttribute("name",n),s.appendChild(a);var c=document.createElement("field");if(c.setAttribute("name","NAME"),c.textContent=n,s.appendChild(c),r.forEach((function(t){var e=document.createElement("procedures_2_parameter_shadow");e.setAttribute("name",t.param_name),void 0!==t.default_value?e.setAttribute("value",t.default_value):e.setAttribute("value","0"),a.appendChild(e)})),t.push(s),i.return_count>0){var l=s.cloneNode(!0);l.setAttribute("type",_.PROCEDURE_BLOCK_TYPES.CALL_RETURN),t.push(l)}}})),t}}return t.prototype.register_procedure_blocks=function(t,e,i){(0,s.register_procedure_blocks)(t,this,e,i)},t.prototype.register_default_procedure_events=function(t){(0,a.register_default_procedure_events)(t,this)},t.prototype.load_from_xml=function(t,e){return(0,c.load_from_xml)(this,t,e)},t.prototype.delete_from_xml=function(t){return(0,c.delete_from_xml)(this,t)},t.prototype.load_from_json=function(t,e){return(0,l.load_from_json)(this,t,e)},t.prototype.delete_from_json=function(t){return(0,l.delete_from_json)(this,t)},t.prototype.update_callers_disabled=function(t,e){var i=this,o=(0,n.get_instance)().get(n.BINDING.events),s=o.get_group();o.set_group(!1),o.disable();var _=this.get_procedure_by_def(e);(0,r.assert)(_);var a=_.disabled,c=_.disabled||0===_.return_count;_.callers_id.forEach((function(e){var o=i.callers[e];(0,r.assert)(o);var n=t.get_block_by_id(e);n&&n.set_disabled("call_return"===o.call_type?c:a)})),this.caller_disable_callback&&this.caller_disable_callback(_.name,a,c),o.enable(),o.set_group(s)},t.prototype.update_params=function(t,e,i,o){var s=(0,n.get_instance)().get(n.BINDING.events),_=s.get_group();s.set_group(!1),s.disable();var a=this.procedures[e];(0,r.assert)(a,"Trying to update param on inexistent procedure"),a.callers_id.forEach((function(e){var n,r,s=t.get_block_by_id(e);s&&("increase"===i?null===(n=s.addMutation)||void 0===n||n.call(s,o.default_value):"decrease"===i&&(null===(r=s.removeMutation)||void 0===r||r.call(s)))})),this.param_update_callback&&this.param_update_callback(i,e,o),s.enable(),s.set_group(_)},t.prototype.update_procedure_name=function(t,e,i){var o=(0,n.get_instance)().get(n.BINDING.events),s=o.get_group();o.set_group(!1);var _=o.is_record_undo(),a=this.procedures[i];(0,r.assert)(a,"Rename render should be called after rename data");var c=[];a.callers_id.forEach((function(e){var n=t.get_block_by_id(e);if(n){var s=n.get_field("NAME");(0,r.assert)(s),o.set_record_undo(!1),s.set_value(i);var a=n.get_collapsed_surround_parent();if(a){if(n.update_collapsed(!0),a===n||c.includes(a.id))return;c.push(a.id),a.update_collapsed(!0)}o.set_record_undo(_)}})),this.rename_procedure_callback&&this.rename_procedure_callback(e,i),o.set_group(s)},t.prototype.add_procedure=function(t){(0,r.assert)(void 0==this.procedures[t],"Duplicated procedure name");var e={def_id:"",disabled:!0,name:t,params:[],callers_id:[],return_count:0,valid:!1,base_name:t,created_timestamp:Date.now()};return this.procedures[t]=e,e},t.prototype.add_procedure_def=function(t,e){var i=this.procedures[t];if(i&&i.def_id&&i.def_id!==e){var o=t;t=(0,d.get_legal_procedure_name)("".concat(t,"%1"),this.get_occupied_procedure_names()),console.warn("Procedure ".concat(o," def exists. Renaming block [").concat(e,"] to ").concat(t)),i=this.add_procedure(t)}return i||(i=this.add_procedure(t)),i.def_id=e,i.disabled=!1,i.valid||this.soft_recover(i),i},t.prototype.add_caller=function(t,e,i){var o=this.get_procedure_by_name(t)||this.get_procedure_by_def(t);if(o||(o=this.add_procedure(t)),o.valid||this.soft_recover(o),this.callers[e])return this.callers[e].disabled=!1,this.callers[e];var n={id:e,proc_name:o.name,call_type:i,disabled:!1};return this.callers[e]=n,o.callers_id.push(e),n},t.prototype.add_param=function(t,e,i){var o=this.procedures[t];o||(o=this.add_procedure(t));var n=o.params.find((function(t){return t.param_name===e}));return(0,r.assert)(!n,"Param existed"),o.params.push({param_name:e,default_value:i}),e},t.prototype.load_from_workspace=function(t){var e=this;t.blockDB_.forEach((function(t){t.is_insertion_marker()||t.is_in_flyout||(t.type!==_.PROCEDURE_BLOCK_TYPES.DEF?t.type!==_.PROCEDURE_BLOCK_TYPES.CALL_NORETURN&&t.type!==_.PROCEDURE_BLOCK_TYPES.CALL_RETURN||e.load_caller_from_block(t):e.load_def_from_block(t))}))},t.prototype.load_def_from_block=function(t){if(t.type===_.PROCEDURE_BLOCK_TYPES.DEF){var e=t.get_field_value("NAME");(0,r.assert)(e);var i=this.add_procedure_def(e,t.id);return i.params=t.inputList.filter((function(t){return t.name.startsWith(_.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX)})).map((function(t){var e=t.connection&&t.connection.targetBlock();return{param_name:(null===e||void 0===e?void 0:e.get_field_value(_.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_NAME))||"",default_value:(null===e||void 0===e?void 0:e.get_field_value(_.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_DEFAULT_VALUE))||void 0}})),i.return_count=t.get_descendants().filter((function(t){return t.type===_.PROCEDURE_BLOCK_TYPES.RETURN})).length,i}},t.prototype.load_caller_from_block=function(t){if(t.type===_.PROCEDURE_BLOCK_TYPES.CALL_RETURN||t.type===_.PROCEDURE_BLOCK_TYPES.CALL_NORETURN){var e=t.get_field_value("NAME");return(0,r.assert)(e),this.add_caller(e,t.id,t.type===_.PROCEDURE_BLOCK_TYPES.CALL_RETURN?"call_return":"call")}},t.prototype.delete_procedure_def=function(t){var e=this,i=this.get_procedure_by_def(t);if(i)return i.disabled=!0,i.callers_id.every((function(t){return e.callers[t].disabled}))&&this.soft_delete(i),i},t.prototype.soft_delete=function(t){var e=t.name;this.rename_procedure(e,t.def_id),t.valid=!1,t.base_name=e},t.prototype.soft_recover=function(t){t.base_name!==t.name&&this.rename_procedure(t.name,(0,d.get_legal_procedure_name)(t.base_name,this.get_occupied_procedure_names())),t.valid=!0,t.base_name=t.name},t.prototype.delete_param=function(t,e){var i=this.procedures[t];(0,r.assert)(i,"Target procedure does not exist. ");var o=i.params.findIndex((function(t){return t.param_name===e}));return(0,r.assert)(o>-1,"Target procedure does not contain param ".concat(e,". ")),i.params.splice(o,1)[0].param_name},t.prototype.delete_caller=function(t){var e=this,i=this.callers[t];if(i){var o=this.procedures[i.proc_name];return(0,r.assert)(o),i.disabled=!0,o.disabled&&o.callers_id.every((function(t){return e.callers[t].disabled}))&&this.soft_delete(o),i}},t.prototype.clear=function(){this.procedures={},this.callers={}},t.prototype.rename_procedure=function(t,e){var i=this,o=this.procedures[t];return(0,r.assert)(o),o.name=e,o.base_name=e,this.procedures[e]=o,delete this.procedures[t],o.callers_id.forEach((function(t){i.callers[t].proc_name=e})),e},t.prototype.change_return_count=function(t,e){var i=this.procedures[t];(0,r.assert)(i),i.return_count+=e},t.prototype.set_param_default_value=function(t,e,i){var o=this.procedures[t].params.find((function(t){return t.param_name===e}));(0,r.assert)(o),o.default_value=i},t.prototype.get_procedures=function(){return this.procedures},t.prototype.get_procedure_by_name=function(t){return this.procedures[t]},t.prototype.get_procedure_by_def=function(t){for(var e=this.get_all_procedure_names(),i=e.length,o=0;o<i;o++){var n=this.procedures[e[o]];if(n.def_id===t)return n}},t.prototype.get_procedure_name_by_def=function(t){var e=this.get_procedure_by_def(t);return(0,r.assert)(e),e.name},t.prototype.get_procedure_param_names=function(t){var e=this.procedures[t];return(0,r.assert)(e),e.params.map((function(t){return t.param_name}))},t.prototype.get_all_procedure_names=function(){return Object.keys(this.procedures)},t.prototype.get_occupied_procedure_names=function(){var t=this;return Object.keys(this.procedures).filter((function(e){return t.procedures[e].valid}))},t.prototype.get_procedure_by_caller_id=function(t){var e=this.callers[t];if(e)return this.procedures[e.proc_name]},t.prototype.get_callers=function(){return this.callers},t}();e.ProcedureManager=g},29535:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},95306:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.rename_procedures_in_json=e.delete_from_json=e.load_from_json=void 0;var o=i(56905),n=i(4124),r=i(27929);function s(t,e){return t.fields[e]}function _(t,e,i){var o=[];return i&&!i(t.blocks[e])||o.push(t.blocks[e]),t.connections[e]&&Object.keys(t.connections[e]).forEach((function(e){o.push.apply(o,_(t,e,i))})),o}function a(t){var e=t.procedure_manager,i=t.workspace_json,r=t.should_rename,a=t.block_id,c=t.procedure_to_add,l=i.blocks[a];if(l.type===n.PROCEDURE_BLOCK_TYPES.DEF){var d=s(l,n.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME);(0,o.assert)(d);var u=i.connections[a],h=[];u&&(h=Object.keys(u).filter((function(t){var e=u[t];return"input"===e.type&&e.input_name.startsWith(n.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX)})).sort((function(t,e){var i=u[t],r=u[e];return(0,o.assert)("input"===i.type&&"input"===r.type),Number(i.input_name.slice(n.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX.length))-Number(r.input_name.slice(n.PROCEDURE_BLOCK_INPUT_NAMES.PARAM_PREFIX.length))})));var p=h.map((function(t){var e=i.blocks[t];(0,o.assert)(e&&e.type===n.PROCEDURE_BLOCK_TYPES.PARAM_ON_BLOCK);var r=s(e,n.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_NAME);return(0,o.assert)(r),{param_name:r,default_value:s(e,n.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_DEFAULT_VALUE)}})),g=_(i,a,(function(t){return t.type===n.PROCEDURE_BLOCK_TYPES.RETURN&&Object.keys(t.shadows).some((function(t){return"VALUE"===t}))})).length;if(!r){var f=e.add_procedure_def(d,a);return f.params=p,void(f.return_count=g)}var v=c[d];v||(v={def_id:a,disabled:!0,name:d,base_name:d,params:[],callers_id:[],return_count:0,valid:!0,created_timestamp:Date.now()},c[d]=v),v.def_id=a,v.disabled=!1,v.params=p,v.return_count=g}}function c(t,e){var i=[n.PROCEDURE_BLOCK_TYPES.DEF,n.PROCEDURE_BLOCK_TYPES.CALL_RETURN,n.PROCEDURE_BLOCK_TYPES.CALL_NORETURN];return Object.keys(t.blocks).forEach((function(o){var r=t.blocks[o];if(!(i.indexOf(r.type)<0)){var s=r.fields[n.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME];s&&e[s]&&(r.fields[n.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME]=e[s])}})),t}e.load_from_json=function(t,e,i){var _={},l={};if(Object.keys(e.blocks).forEach((function(r){a({procedure_manager:t,procedure_to_add:_,workspace_json:e,block_id:r,should_rename:i}),function(t){var e=t.procedure_manager,i=t.workspace_json,r=t.should_rename,_=t.block_id,a=t.procedure_to_add,c=t.callers_to_add,l=i.blocks[_];if(l.type===n.PROCEDURE_BLOCK_TYPES.CALL_NORETURN||l.type===n.PROCEDURE_BLOCK_TYPES.CALL_RETURN){var d=s(l,n.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME);(0,o.assert)(d);var u=l.mutation.match(/<procedures_2_parameter_shadow[^>]+><\/procedures_2_parameter_shadow>/g),h=[];if(u&&(h=Array.from(u).map((function(t){var e=t.match(/ name="([^"]+)"/);return(0,o.assert)(e&&2===e.length,"Trying to extract param name from invalid procedures_2_parameter_shadow: ".concat(t)),{param_name:e[1]}}))),r){var p=a[d];if(!p){var g=l.mutation.match(/def_id="([^"]+)"/);p={def_id:g&&g[1]||"",disabled:!0,name:d,base_name:d,params:h,callers_id:[],return_count:0,valid:!0,created_timestamp:Date.now()},a[d]=p}c[_]={id:_,proc_name:d,call_type:l.type===n.PROCEDURE_BLOCK_TYPES.CALL_RETURN?"call_return":"call",disabled:!1},p.callers_id.push(_)}else{if(!e.get_procedure_by_name(d)){var f=e.add_procedure_def(d,"");f.params=h,f.disabled=!0}e.add_caller(d,_,l.type===n.PROCEDURE_BLOCK_TYPES.CALL_RETURN?"call_return":"call")}}}({procedure_manager:t,procedure_to_add:_,workspace_json:e,block_id:r,should_rename:i,callers_to_add:l})})),!i)return e;var d=(0,r.add_procedure_and_generate_rename_map)({procedure_manager:t,procedure_to_add:_,callers_to_add:l});return c(e,d)},e.delete_from_json=function(t,e){var i=[];return Object.keys(e.blocks).forEach((function(o){!function(e){var o=e.type;if(o!==n.PROCEDURE_BLOCK_TYPES.DEF)o!==n.PROCEDURE_BLOCK_TYPES.CALL_NORETURN&&o!==n.PROCEDURE_BLOCK_TYPES.CALL_RETURN||(r=e.id,t.delete_caller(r));else{var r=e.id,s=t.delete_procedure_def(r);s&&i.push(s.def_id)}}(e.blocks[o])})),i},e.rename_procedures_in_json=c},27929:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.find_caller_blocks=e.add_procedure_and_generate_rename_map=e.get_legal_procedure_name=void 0;var o=i(4124);function n(t){if(t.length>15){var e=parseInt(t.substring(0,15),10),i=parseInt(t.substring(15,t.length),10)+1,o=i.toString();return i>Math.pow(t.length-15,10)-1&&(e+=1,o=o.substring(1,o.length)),e+o}return parseInt(t,10)+1}function r(t,e){for(;e.includes(t);){var i=t.match(/^(.*?)(\d+)$/);i?t=i[1]+n(i[2]):t+="1"}return t}e.get_legal_procedure_name=r,e.add_procedure_and_generate_rename_map=function(t){var e=t.procedure_manager,i=t.procedure_to_add,o=t.callers_to_add,n={};return Object.keys(i).forEach((function(t){var s=e.get_procedures(),_=e.get_callers(),a=e.get_procedure_by_def(i[t].def_id);if(a)i[t].callers_id.forEach((function(t){e.add_caller(a.name,t,o[t].call_type)}));else if(i[t].def_id){if(!s[t])return s[t]=i[t],void s[t].callers_id.forEach((function(t){_[t]=o[t]}));var c=r(t,e.get_occupied_procedure_names());n[t]=c;var l=i[t];l.name=c,l.base_name=c,l.callers_id.forEach((function(t){var e=o[t];e.proc_name=c,_[t]=e})),s[c]=l}else i[t].callers_id.forEach((function(i){e.add_caller(t,i,o[i].call_type)}))})),n},e.find_caller_blocks=function(t,e){var i=Object.keys(t.blocks),n=[];return i.forEach((function(i){var r=t.blocks[i];r.type!==o.PROCEDURE_BLOCK_TYPES.CALL_RETURN&&r.type!==o.PROCEDURE_BLOCK_TYPES.CALL_NORETURN||r.fields[o.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME]!==e||n.push(t.blocks[i])})),n}},50618:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.delete_from_xml=e.rename_procedures_in_xml=e.load_from_xml=void 0;var o=i(56905),n=i(4124),r=i(27929);function s(t,e){var i=function(t){if("block"===t.tagName.toLowerCase()){var i=t.getAttribute("type");if(i!==n.PROCEDURE_BLOCK_TYPES.DEF){if(i===n.PROCEDURE_BLOCK_TYPES.CALL_NORETURN||i===n.PROCEDURE_BLOCK_TYPES.CALL_RETURN){s=(r=t.querySelector('field[name="NAME"]'))&&r.textContent;if(r&&s&&e[s]){r.textContent=e[s];var o=t.querySelector("mutation");o&&o.setAttribute("name",e[s])}}}else{var r,s=(r=t.querySelector('field[name="NAME"]'))&&r.textContent;r&&s&&e[s]&&(r.textContent=e[s])}}};return i(t),Array.from(t.querySelectorAll("block")).forEach(i),t}e.load_from_xml=function(t,e,i){var _=Array.from(e.querySelectorAll("block"));"block"===e.tagName.toLowerCase()&&_.unshift(e);var a={},c={};if(_.forEach((function(e){var r=e.getAttribute("type");if(r===n.PROCEDURE_BLOCK_TYPES.DEF){var s=e.getAttribute("id");(0,o.assert)(s);var _=(p=e.querySelector('field[name="'.concat(n.PROCEDURE_BLOCK_FIELD_NAMES.PROCEDURE_NAME,'"]')))&&p.textContent;(0,o.assert)(_);var l=Array.from(e.querySelectorAll('block[type="'.concat(n.PROCEDURE_BLOCK_TYPES.PARAM_ON_BLOCK,'"]'))).map((function(t){var e=t.querySelector('field[name="'.concat(n.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_NAME,'"]'));(0,o.assert)(e&&e.textContent,"No name field or name on block parameter. ");var i=t.querySelector('field[name="'.concat(n.PROCEDURE_BLOCK_FIELD_NAMES.PARAM_DEFAULT_VALUE,'"]'));return{param_name:e.textContent,default_value:(null===i||void 0===i?void 0:i.textContent)||void 0}})),d=e.querySelector('statement[name="'.concat(n.PROCEDURE_BLOCK_INPUT_NAMES.DEF_STATEMENT,'"]')),u=d&&d.querySelectorAll('block[type="'.concat(n.PROCEDURE_BLOCK_TYPES.RETURN,'"]>mutation[items="1"]')).length||0;if(!i){var h=t.add_procedure_def(_,s);return h.params=l,h.return_count=u,void(p&&h.name!==_&&(p.textContent=h.name))}return(g=a[_])||(g={def_id:s,disabled:!0,name:_,base_name:_,params:[],callers_id:[],return_count:0,valid:!0,created_timestamp:Date.now()},a[_]=g),g.def_id=s,g.disabled=!1,g.params=l,void(g.return_count=u)}if(r===n.PROCEDURE_BLOCK_TYPES.CALL_NORETURN||r===n.PROCEDURE_BLOCK_TYPES.CALL_RETURN){s=e.getAttribute("id");(0,o.assert)(s);var p;_=(p=e.querySelector('field[name="NAME"]'))&&p.textContent;(0,o.assert)(_);var g;l=Array.from(e.querySelectorAll("mutation>procedures_2_parameter_shadow")).map((function(t){return{param_name:t.getAttribute("name")||""}}));if(!i){if(!t.get_procedure_by_name(_)){var f=t.add_procedure_def(_,"");f.params=l,f.disabled=!0}return void t.add_caller(_,s,r===n.PROCEDURE_BLOCK_TYPES.CALL_RETURN?"call_return":"call")}if(!(g=a[_])){var v=e.querySelector("mutation");g={def_id:v&&v.getAttribute("def_id")||"",disabled:!0,name:_,base_name:_,params:l,callers_id:[],return_count:0,valid:!0,created_timestamp:Date.now()},a[_]=g}return c[s]={id:s,proc_name:_,call_type:r===n.PROCEDURE_BLOCK_TYPES.CALL_RETURN?"call_return":"call",disabled:!1},void g.callers_id.push(s)}})),!i)return e;var l=(0,r.add_procedure_and_generate_rename_map)({procedure_manager:t,procedure_to_add:a,callers_to_add:c});return 0===Object.keys(l).length?e:s(e,l)},e.rename_procedures_in_xml=s,e.delete_from_xml=function(t,e){var i=[],r=function(e){var r=e.getAttribute("type");if(r!==n.PROCEDURE_BLOCK_TYPES.DEF){if(r===n.PROCEDURE_BLOCK_TYPES.CALL_NORETURN||r===n.PROCEDURE_BLOCK_TYPES.CALL_RETURN){s=e.getAttribute("id");(0,o.assert)(s),t.delete_caller(s)}}else{var s=e.getAttribute("id");(0,o.assert)(s);var _=t.delete_procedure_def(s);_&&i.push(_.def_id)}};return r(e),Array.from(e.querySelectorAll("block")).forEach(r),i}},26965:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.tagProperty=e.tagParameter=e.decorate=void 0;var o=i(73020),n=i(76899);function r(t,e,i,n,r){var s={},_="number"===typeof r,a=void 0!==r&&_?r.toString():i;if(_&&void 0!==i)throw new Error(o.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(s=Reflect.getMetadata(t,e));var c=s[a];if(Array.isArray(c))for(var l=0,d=c;l<d.length;l++){var u=d[l];if(u.key===n.key)throw new Error(o.DUPLICATED_METADATA+" "+u.key.toString())}else c=[];c.push(n),s[a]=c,Reflect.defineMetadata(t,s,e)}function s(t,e){Reflect.decorate(t,e)}function _(t,e){return function(i,o){e(i,o,t)}}e.tagParameter=function(t,e,i,o){r(n.TAGGED,t,e,o,i)},e.tagProperty=function(t,e,i){r(n.TAGGED_PROP,t.constructor,e,i)},e.decorate=function(t,e,i){"number"===typeof i?s([_(i,t)],e):"string"===typeof i?Reflect.decorate([t],e,i):s([t],e)}},51e3:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.inject=e.LazyServiceIdentifer=void 0;var o=i(73020),n=i(76899),r=i(40491),s=i(26965),_=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();e.LazyServiceIdentifer=_,e.inject=function(t){return function(e,i,_){if(void 0===t)throw new Error(o.UNDEFINED_INJECT_ANNOTATION(e.name));var a=new r.Metadata(n.INJECT_TAG,t);"number"===typeof _?s.tagParameter(e,i,_,a):s.tagProperty(e,i,a)}}},94538:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.injectable=void 0;var o=i(73020),n=i(76899);e.injectable=function(){return function(t){if(Reflect.hasOwnMetadata(n.PARAM_TYPES,t))throw new Error(o.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(n.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(n.PARAM_TYPES,e,t),t}}},41678:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.multiInject=void 0;var o=i(76899),n=i(40491),r=i(26965);e.multiInject=function(t){return function(e,i,s){var _=new n.Metadata(o.MULTI_INJECT_TAG,t);"number"===typeof s?r.tagParameter(e,i,s,_):r.tagProperty(e,i,_)}}},1037:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.named=void 0;var o=i(76899),n=i(40491),r=i(26965);e.named=function(t){return function(e,i,s){var _=new n.Metadata(o.NAMED_TAG,t);"number"===typeof s?r.tagParameter(e,i,s,_):r.tagProperty(e,i,_)}}},83035:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.optional=void 0;var o=i(76899),n=i(40491),r=i(26965);e.optional=function(){return function(t,e,i){var s=new n.Metadata(o.OPTIONAL_TAG,!0);"number"===typeof i?r.tagParameter(t,e,i,s):r.tagProperty(t,e,s)}}},63329:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.postConstruct=void 0;var o=i(73020),n=i(76899),r=i(40491);e.postConstruct=function(){return function(t,e,i){var s=new r.Metadata(n.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(n.POST_CONSTRUCT,t.constructor))throw new Error(o.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(n.POST_CONSTRUCT,s,t.constructor)}}},54651:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.tagged=void 0;var o=i(40491),n=i(26965);e.tagged=function(t,e){return function(i,r,s){var _=new o.Metadata(t,e);"number"===typeof s?n.tagParameter(i,r,s,_):n.tagProperty(i,r,_)}}},73233:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.targetName=void 0;var o=i(76899),n=i(40491),r=i(26965);e.targetName=function(t){return function(e,i,s){var _=new n.Metadata(o.NAME_TAG,t);r.tagParameter(e,i,s,_)}}},84893:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.unmanaged=void 0;var o=i(76899),n=i(40491),r=i(26965);e.unmanaged=function(){return function(t,e,i){var s=new n.Metadata(o.UNMANAGED_TAG,!0);r.tagParameter(t,e,i,s)}}},54977:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Binding=void 0;var o=i(41682),n=i(4442),r=function(){function t(t,e){this.id=n.id(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=o.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=e.scope===o.BindingScopeEnum.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();e.Binding=r},57103:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.BindingCount=void 0;e.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},73020:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.STACK_OVERFLOW=e.CIRCULAR_DEPENDENCY_IN_FACTORY=e.POST_CONSTRUCT_ERROR=e.MULTIPLE_POST_CONSTRUCT_METHODS=e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=e.ARGUMENTS_LENGTH_MISMATCH=e.INVALID_DECORATOR_OPERATION=e.INVALID_TO_SELF_VALUE=e.INVALID_FUNCTION_BINDING=e.INVALID_MIDDLEWARE_RETURN=e.NO_MORE_SNAPSHOTS_AVAILABLE=e.INVALID_BINDING_TYPE=e.NOT_IMPLEMENTED=e.CIRCULAR_DEPENDENCY=e.UNDEFINED_INJECT_ANNOTATION=e.MISSING_INJECT_ANNOTATION=e.MISSING_INJECTABLE_ANNOTATION=e.NOT_REGISTERED=e.CANNOT_UNBIND=e.AMBIGUOUS_MATCH=e.KEY_NOT_FOUND=e.NULL_ARGUMENT=e.DUPLICATED_METADATA=e.DUPLICATED_INJECTABLE_DECORATOR=void 0,e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",e.NULL_ARGUMENT="NULL argument",e.KEY_NOT_FOUND="Key Not Found",e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";e.UNDEFINED_INJECT_ANNOTATION=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},e.CIRCULAR_DEPENDENCY="Circular dependency found:",e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",e.INVALID_BINDING_TYPE="Invalid binding type:",e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";e.ARGUMENTS_LENGTH_MISMATCH=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";e.POST_CONSTRUCT_ERROR=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]};e.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."},e.STACK_OVERFLOW="Maximum call stack size exceeded"},41682:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TargetTypeEnum=e.BindingTypeEnum=e.BindingScopeEnum=void 0;e.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};e.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};e.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},76899:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.NON_CUSTOM_TAG_KEYS=e.POST_CONSTRUCT=e.DESIGN_PARAM_TYPES=e.PARAM_TYPES=e.TAGGED_PROP=e.TAGGED=e.MULTI_INJECT_TAG=e.INJECT_TAG=e.OPTIONAL_TAG=e.UNMANAGED_TAG=e.NAME_TAG=e.NAMED_TAG=void 0,e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct",e.NON_CUSTOM_TAG_KEYS=[e.INJECT_TAG,e.MULTI_INJECT_TAG,e.NAME_TAG,e.UNMANAGED_TAG,e.NAMED_TAG,e.OPTIONAL_TAG]},5093:function(t,e,i){var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{a(o.next(t))}catch(e){r(e)}}function _(t){try{a(o.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,_)}a((o=o.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:_(0),throw:_(1),return:_(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function _(r){return function(_){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(_){r=[6,_],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,_])}}},r=this&&this.__spreadArray||function(t,e){for(var i=0,o=e.length,n=t.length;i<o;i++,n++)t[n]=e[i];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var s=i(54977),_=i(73020),a=i(41682),c=i(76899),l=i(31734),d=i(13970),u=i(74565),h=i(74087),p=i(4442),g=i(48749),f=i(88047),v=i(70270),m=function(){function t(t){this._appliedMiddleware=[];var e=t||{};if("object"!==typeof e)throw new Error(""+_.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=a.BindingScopeEnum.Transient;else if(e.defaultScope!==a.BindingScopeEnum.Singleton&&e.defaultScope!==a.BindingScopeEnum.Transient&&e.defaultScope!==a.BindingScopeEnum.Request)throw new Error(""+_.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!==typeof e.autoBindInjectable)throw new Error(""+_.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!==typeof e.skipBaseClassChecks)throw new Error(""+_.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.id=p.id(),this._bindingDictionary=new v.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new l.MetadataReader}return t.merge=function(e,i){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];var s=new t,_=r([e,i],o).map((function(t){return d.getBindingDictionary(t)})),a=d.getBindingDictionary(s);return _.forEach((function(t){var e;e=a,t.traverse((function(t,i){i.forEach((function(t){e.add(t.serviceIdentifier,t.clone())}))}))})),s},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this._getContainerModuleHelpersFactory(),o=0,n=t;o<n.length;o++){var r=n[o],s=i(r.id);r.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return o(this,void 0,void 0,(function(){var e,i,o,r,s;return n(this,(function(n){switch(n.label){case 0:e=this._getContainerModuleHelpersFactory(),i=0,o=t,n.label=1;case 1:return i<o.length?(r=o[i],s=e(r.id),[4,r.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)]):[3,4];case 2:n.sent(),n.label=3;case 3:return i++,[3,1];case 4:return[2]}}))}))},t.prototype.unload=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.forEach((function(e){var i,o=(i=e.id,function(t){return t.moduleId===i});t._bindingDictionary.removeByCondition(o)}))},t.prototype.bind=function(t){var e=this.options.defaultScope||a.BindingScopeEnum.Transient,i=new s.Binding(t,e);return this._bindingDictionary.add(t,i),new h.BindingToSyntax(i)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(_.CANNOT_UNBIND+" "+g.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new v.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,c.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,i){var o=!1;if(this._bindingDictionary.hasKey(t)){var n=this._bindingDictionary.get(t),r=d.createMockRequest(this,t,e,i);o=n.some((function(t){return t.constraint(r)}))}return!o&&this.parent&&(o=this.parent.isBoundTagged(t,e,i)),o},t.prototype.snapshot=function(){this._snapshots.push(f.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw new Error(_.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var i=new t(e||this.options);return i.parent=this,i},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._appliedMiddleware=this._appliedMiddleware.concat(t);var i=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce((function(t,e){return e(t)}),i)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,a.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,i){return this._get(!1,!1,a.TargetTypeEnum.Variable,t,e,i)},t.prototype.getNamed=function(t,e){return this.getTagged(t,c.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,a.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,i){return this._get(!1,!0,a.TargetTypeEnum.Variable,t,e,i)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,c.NAMED_TAG,e)},t.prototype.resolve=function(t){var e=this.createChild();return e.bind(t).toSelf(),this._appliedMiddleware.forEach((function(t){e.applyMiddleware(t)})),e.get(t)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e},i=function(i){return function(o){var n=t.rebind.bind(t)(o);return e(n,i),n}};return function(o){return{bindFunction:(n=o,function(i){var o=t.bind.bind(t)(i);return e(o,n),o}),isboundFunction:function(e){return t.isBound.bind(t)(e)},rebindFunction:i(o),unbindFunction:function(e){t.unbind.bind(t)(e)}};var n}},t.prototype._get=function(t,e,i,o,n,r){var s=null,a={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:n,serviceIdentifier:o,targetType:i,value:r};if(this._middleware){if(void 0===(s=this._middleware(a))||null===s)throw new Error(_.INVALID_MIDDLEWARE_RETURN)}else s=this._planAndResolve()(a);return s},t.prototype._planAndResolve=function(){var t=this;return function(e){var i=d.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return i=e.contextInterceptor(i),u.resolve(i)}},t}();e.Container=m},47372:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncContainerModule=e.ContainerModule=void 0;var o=i(4442),n=function(t){this.id=o.id(),this.registry=t};e.ContainerModule=n;var r=function(t){this.id=o.id(),this.registry=t};e.AsyncContainerModule=r},88047:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerSnapshot=void 0;var i=function(){function t(){}return t.of=function(e,i){var o=new t;return o.bindings=e,o.middleware=i,o},t}();e.ContainerSnapshot=i},70270:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Lookup=void 0;var o=i(73020),n=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null===t||void 0===t)throw new Error(o.NULL_ARGUMENT);if(null===e||void 0===e)throw new Error(o.NULL_ARGUMENT);var i=this._map.get(t);void 0!==i?(i.push(e),this._map.set(t,i)):this._map.set(t,[e])},t.prototype.get=function(t){if(null===t||void 0===t)throw new Error(o.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw new Error(o.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null===t||void 0===t)throw new Error(o.NULL_ARGUMENT);if(!this._map.delete(t))throw new Error(o.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach((function(i,o){var n=i.filter((function(e){return!t(e)}));n.length>0?e._map.set(o,n):e._map.delete(o)}))},t.prototype.hasKey=function(t){if(null===t||void 0===t)throw new Error(o.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach((function(t,i){t.forEach((function(t){return e.add(i,t.clone())}))})),e},t.prototype.traverse=function(t){this._map.forEach((function(e,i){t(i,e)}))},t}();e.Lookup=n},61455:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=e.getServiceIdentifierAsString=e.typeConstraint=e.namedConstraint=e.taggedConstraint=e.traverseAncerstors=e.decorate=e.id=e.MetadataReader=e.postConstruct=e.targetName=e.multiInject=e.unmanaged=e.optional=e.LazyServiceIdentifer=e.inject=e.named=e.tagged=e.injectable=e.ContainerModule=e.AsyncContainerModule=e.TargetTypeEnum=e.BindingTypeEnum=e.BindingScopeEnum=e.Container=e.METADATA_KEY=void 0;var o=i(76899);e.METADATA_KEY=o;var n=i(5093);Object.defineProperty(e,"Container",{enumerable:!0,get:function(){return n.Container}});var r=i(41682);Object.defineProperty(e,"BindingScopeEnum",{enumerable:!0,get:function(){return r.BindingScopeEnum}}),Object.defineProperty(e,"BindingTypeEnum",{enumerable:!0,get:function(){return r.BindingTypeEnum}}),Object.defineProperty(e,"TargetTypeEnum",{enumerable:!0,get:function(){return r.TargetTypeEnum}});var s=i(47372);Object.defineProperty(e,"AsyncContainerModule",{enumerable:!0,get:function(){return s.AsyncContainerModule}}),Object.defineProperty(e,"ContainerModule",{enumerable:!0,get:function(){return s.ContainerModule}});var _=i(94538);Object.defineProperty(e,"injectable",{enumerable:!0,get:function(){return _.injectable}});var a=i(54651);Object.defineProperty(e,"tagged",{enumerable:!0,get:function(){return a.tagged}});var c=i(1037);Object.defineProperty(e,"named",{enumerable:!0,get:function(){return c.named}});var l=i(51e3);Object.defineProperty(e,"inject",{enumerable:!0,get:function(){return l.inject}}),Object.defineProperty(e,"LazyServiceIdentifer",{enumerable:!0,get:function(){return l.LazyServiceIdentifer}});var d=i(83035);Object.defineProperty(e,"optional",{enumerable:!0,get:function(){return d.optional}});var u=i(84893);Object.defineProperty(e,"unmanaged",{enumerable:!0,get:function(){return u.unmanaged}});var h=i(41678);Object.defineProperty(e,"multiInject",{enumerable:!0,get:function(){return h.multiInject}});var p=i(73233);Object.defineProperty(e,"targetName",{enumerable:!0,get:function(){return p.targetName}});var g=i(63329);Object.defineProperty(e,"postConstruct",{enumerable:!0,get:function(){return g.postConstruct}});var f=i(31734);Object.defineProperty(e,"MetadataReader",{enumerable:!0,get:function(){return f.MetadataReader}});var v=i(4442);Object.defineProperty(e,"id",{enumerable:!0,get:function(){return v.id}});var m=i(26965);Object.defineProperty(e,"decorate",{enumerable:!0,get:function(){return m.decorate}});var b=i(1744);Object.defineProperty(e,"traverseAncerstors",{enumerable:!0,get:function(){return b.traverseAncerstors}}),Object.defineProperty(e,"taggedConstraint",{enumerable:!0,get:function(){return b.taggedConstraint}}),Object.defineProperty(e,"namedConstraint",{enumerable:!0,get:function(){return b.namedConstraint}}),Object.defineProperty(e,"typeConstraint",{enumerable:!0,get:function(){return b.typeConstraint}});var y=i(48749);Object.defineProperty(e,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return y.getServiceIdentifierAsString}});var E=i(7344);Object.defineProperty(e,"multiBindToService",{enumerable:!0,get:function(){return E.multiBindToService}})},89113:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0;var o=i(4442),n=function(){function t(t){this.id=o.id(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();e.Context=n},40491:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var o=i(76899),n=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===o.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();e.Metadata=n},31734:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataReader=void 0;var o=i(76899),n=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{compilerGeneratedMetadata:Reflect.getMetadata(o.PARAM_TYPES,t),userGeneratedMetadata:Reflect.getMetadata(o.TAGGED,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Reflect.getMetadata(o.TAGGED_PROP,t)||[]},t}();e.MetadataReader=n},76293:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Plan=void 0;var i=function(t,e){this.parentContext=t,this.rootRequest=e};e.Plan=i},13970:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.getBindingDictionary=e.createMockRequest=e.plan=void 0;var o=i(57103),n=i(73020),r=i(41682),s=i(76899),_=i(76254),a=i(48749),c=i(89113),l=i(40491),d=i(76293),u=i(81592),h=i(31119),p=i(45748);function g(t){return t._bindingDictionary}function f(t,e,i,r,s){var _=m(i.container,s.serviceIdentifier),c=[];return _.length===o.BindingCount.NoBindingsAvailable&&i.container.options.autoBindInjectable&&"function"===typeof s.serviceIdentifier&&t.getConstructorMetadata(s.serviceIdentifier).compilerGeneratedMetadata&&(i.container.bind(s.serviceIdentifier).toSelf(),_=m(i.container,s.serviceIdentifier)),c=e?_:_.filter((function(t){var e=new h.Request(t.serviceIdentifier,i,r,t,s);return t.constraint(e)})),function(t,e,i,r){switch(e.length){case o.BindingCount.NoBindingsAvailable:if(i.isOptional())return e;var s=a.getServiceIdentifierAsString(t),_=n.NOT_REGISTERED;throw _+=a.listMetadataForTarget(s,i),_+=a.listRegisteredBindingsForServiceIdentifier(r,s,m),new Error(_);case o.BindingCount.OnlyOneBindingAvailable:if(!i.isArray())return e;case o.BindingCount.MultipleBindingsAvailable:default:if(i.isArray())return e;s=a.getServiceIdentifierAsString(t),_=n.AMBIGUOUS_MATCH+" "+s;throw _+=a.listRegisteredBindingsForServiceIdentifier(r,s,m),new Error(_)}}(s.serviceIdentifier,c,s,i.container),c}function v(t,e,i,o,s,_){var a,c;if(null===s){a=f(t,e,o,null,_),c=new h.Request(i,o,null,a,_);var l=new d.Plan(o,c);o.addPlan(l)}else a=f(t,e,o,s,_),c=s.addChildRequest(_.serviceIdentifier,a,_);a.forEach((function(e){var i=null;if(_.isArray())i=c.addChildRequest(e.serviceIdentifier,e,_);else{if(e.cache)return;i=c}if(e.type===r.BindingTypeEnum.Instance&&null!==e.implementationType){var s=u.getDependencies(t,e.implementationType);if(!o.container.options.skipBaseClassChecks){var a=u.getBaseClassDependencyCount(t,e.implementationType);if(s.length<a){var l=n.ARGUMENTS_LENGTH_MISMATCH(u.getFunctionName(e.implementationType));throw new Error(l)}}s.forEach((function(e){v(t,!1,e.serviceIdentifier,o,i,e)}))}}))}function m(t,e){var i=[],o=g(t);return o.hasKey(e)?i=o.get(e):null!==t.parent&&(i=m(t.parent,e)),i}e.getBindingDictionary=g,e.plan=function(t,e,i,o,n,r,d,u){void 0===u&&(u=!1);var h=new c.Context(e),g=function(t,e,i,o,n,r){var _=t?s.MULTI_INJECT_TAG:s.INJECT_TAG,a=new l.Metadata(_,i),c=new p.Target(e,o,i,a);if(void 0!==n){var d=new l.Metadata(n,r);c.metadata.push(d)}return c}(i,o,n,"",r,d);try{return v(t,u,n,h,null,g),h}catch(f){throw _.isStackOverflowExeption(f)&&h.plan&&a.circularDependencyToException(h.plan.rootRequest),f}},e.createMockRequest=function(t,e,i,o){var n=new p.Target(r.TargetTypeEnum.Variable,"",e,new l.Metadata(i,o)),s=new c.Context(t);return new h.Request(e,s,null,[],n)}},55127:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.QueryableString=void 0;var i=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e,i=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},i)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();e.QueryableString=i},81592:function(t,e,i){var o=this&&this.__spreadArray||function(t,e){for(var i=0,o=e.length,n=t.length;i<o;i++,n++)t[n]=e[i];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctionName=e.getBaseClassDependencyCount=e.getDependencies=void 0;var n=i(51e3),r=i(73020),s=i(41682),_=i(76899),a=i(48749);Object.defineProperty(e,"getFunctionName",{enumerable:!0,get:function(){return a.getFunctionName}});var c=i(45748);function l(t,e,i,n){var s=t.getConstructorMetadata(i),_=s.compilerGeneratedMetadata;if(void 0===_){var a=r.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(a)}var c=s.userGeneratedMetadata,l=Object.keys(c),h=0===i.length&&l.length>0,p=l.length>i.length,g=function(t,e,i,o,n){for(var r=[],s=0;s<n;s++){var _=d(s,t,e,i,o);null!==_&&r.push(_)}return r}(n,e,_,c,h||p?l.length:i.length),f=u(t,i);return o(o([],g),f)}function d(t,e,i,o,_){var a=_[t.toString()]||[],l=h(a),d=!0!==l.unmanaged,u=o[t],p=l.inject||l.multiInject;if((u=p||u)instanceof n.LazyServiceIdentifer&&(u=u.unwrap()),d){if(!e&&(u===Object||u===Function||void 0===u)){var g=r.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+i+".";throw new Error(g)}var f=new c.Target(s.TargetTypeEnum.ConstructorArgument,l.targetName,u);return f.metadata=a,f}return null}function u(t,e){for(var i=t.getPropertiesMetadata(e),n=[],r=0,_=Object.keys(i);r<_.length;r++){var a=_[r],l=i[a],d=h(i[a]),p=d.targetName||a,g=d.inject||d.multiInject,f=new c.Target(s.TargetTypeEnum.ClassProperty,p,g);f.metadata=l,n.push(f)}var v=Object.getPrototypeOf(e.prototype).constructor;if(v!==Object){var m=u(t,v);n=o(o([],n),m)}return n}function h(t){var e={};return t.forEach((function(t){e[t.key.toString()]=t.value})),{inject:e[_.INJECT_TAG],multiInject:e[_.MULTI_INJECT_TAG],targetName:e[_.NAME_TAG],unmanaged:e[_.UNMANAGED_TAG]}}e.getDependencies=function(t,e){return l(t,a.getFunctionName(e),e,!1)},e.getBaseClassDependencyCount=function t(e,i){var o=Object.getPrototypeOf(i.prototype).constructor;if(o!==Object){var n=l(e,a.getFunctionName(o),o,!0),r=n.map((function(t){return t.metadata.filter((function(t){return t.key===_.UNMANAGED_TAG}))})),s=[].concat.apply([],r).length,c=n.length-s;return c>0?c:t(e,o)}return 0}},31119:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Request=void 0;var o=i(4442),n=function(){function t(t,e,i,n,r){this.id=o.id(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=i,this.target=r,this.childRequests=[],this.bindings=Array.isArray(n)?n:[n],this.requestScope=null===i?new Map:null}return t.prototype.addChildRequest=function(e,i,o){var n=new t(e,this.parentContext,this,i,o);return this.childRequests.push(n),n},t}();e.Request=n},45748:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Target=void 0;var o=i(76899),n=i(4442),r=i(40491),s=i(55127),_=function(){function t(t,e,i,_){this.id=n.id(),this.type=t,this.serviceIdentifier=i,this.name=new s.QueryableString(e||""),this.metadata=new Array;var a=null;"string"===typeof _?a=new r.Metadata(o.NAMED_TAG,_):_ instanceof r.Metadata&&(a=_),null!==a&&this.metadata.push(a)}return t.prototype.hasTag=function(t){for(var e=0,i=this.metadata;e<i.length;e++){if(i[e].key===t)return!0}return!1},t.prototype.isArray=function(){return this.hasTag(o.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(o.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(o.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some((function(t){return o.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))}))},t.prototype.isOptional=function(){return this.matchesTag(o.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(t){return t.key===o.NAMED_TAG}))[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(t){return o.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))})):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(o.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(i){for(var o=0,n=e.metadata;o<n.length;o++){var r=n[o];if(r.key===t&&r.value===i)return!0}return!1}},t}();e.Target=_},24877:function(t,e,i){var o=this&&this.__spreadArray||function(t,e){for(var i=0,o=e.length,n=t.length;i<o;i++,n++)t[n]=e[i];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.resolveInstance=void 0;var n=i(73020),r=i(41682),s=i(76899);e.resolveInstance=function(t,e,i){var _,a,c=null;if(e.length>0){var l=e.filter((function(t){return null!==t.target&&t.target.type===r.TargetTypeEnum.ConstructorArgument})).map(i);a=l,c=function(t,e,i){var o=e.filter((function(t){return null!==t.target&&t.target.type===r.TargetTypeEnum.ClassProperty})),n=o.map(i);return o.forEach((function(e,i){var o;o=e.target.name.value();var r=n[i];t[o]=r})),t}(c=new((_=t).bind.apply(_,o([void 0],a))),e,i)}else c=new t;return function(t,e){if(Reflect.hasMetadata(s.POST_CONSTRUCT,t)){var i=Reflect.getMetadata(s.POST_CONSTRUCT,t);try{e[i.value]()}catch(o){throw new Error(n.POST_CONSTRUCT_ERROR(t.name,o.message))}}}(t,c),c}},74565:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.resolve=void 0;var o=i(73020),n=i(41682),r=i(76254),s=i(48749),_=i(24877),a=function(t,e,i){try{return i()}catch(n){throw r.isStackOverflowExeption(n)?new Error(o.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString())):n}},c=function t(e){return function(i){i.parentContext.setCurrentRequest(i);var r=i.bindings,c=i.childRequests,l=i.target&&i.target.isArray(),d=!i.parentRequest||!i.parentRequest.target||!i.target||!i.parentRequest.target.matchesArray(i.target.serviceIdentifier);if(l&&d)return c.map((function(i){return t(e)(i)}));var u=null;if(!i.target.isOptional()||0!==r.length){var h=r[0],p=h.scope===n.BindingScopeEnum.Singleton,g=h.scope===n.BindingScopeEnum.Request;if(p&&h.activated)return h.cache;if(g&&null!==e&&e.has(h.id))return e.get(h.id);if(h.type===n.BindingTypeEnum.ConstantValue)u=h.cache,h.activated=!0;else if(h.type===n.BindingTypeEnum.Function)u=h.cache,h.activated=!0;else if(h.type===n.BindingTypeEnum.Constructor)u=h.implementationType;else if(h.type===n.BindingTypeEnum.DynamicValue&&null!==h.dynamicValue)u=a("toDynamicValue",h.serviceIdentifier,(function(){return h.dynamicValue(i.parentContext)}));else if(h.type===n.BindingTypeEnum.Factory&&null!==h.factory)u=a("toFactory",h.serviceIdentifier,(function(){return h.factory(i.parentContext)}));else if(h.type===n.BindingTypeEnum.Provider&&null!==h.provider)u=a("toProvider",h.serviceIdentifier,(function(){return h.provider(i.parentContext)}));else{if(h.type!==n.BindingTypeEnum.Instance||null===h.implementationType){var f=s.getServiceIdentifierAsString(i.serviceIdentifier);throw new Error(o.INVALID_BINDING_TYPE+" "+f)}u=_.resolveInstance(h.implementationType,c,t(e))}return"function"===typeof h.onActivation&&(u=h.onActivation(i.parentContext,u)),p&&(h.cache=u,h.activated=!0),g&&null!==e&&!e.has(h.id)&&e.set(h.id,u),u}}};e.resolve=function(t){return c(t.plan.rootRequest.requestScope)(t.plan.rootRequest)}},62228:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInSyntax=void 0;var o=i(41682),n=i(51850),r=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=o.BindingScopeEnum.Request,new n.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=o.BindingScopeEnum.Singleton,new n.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=o.BindingScopeEnum.Transient,new n.BindingWhenOnSyntax(this._binding)},t}();e.BindingInSyntax=r},12152:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInWhenOnSyntax=void 0;var o=i(62228),n=i(19042),r=i(19586),s=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new r.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new n.BindingOnSyntax(this._binding),this._bindingInSyntax=new o.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingInWhenOnSyntax=s},19042:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BindingOnSyntax=void 0;var o=i(19586),n=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new o.BindingWhenSyntax(this._binding)},t}();e.BindingOnSyntax=n},74087:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BindingToSyntax=void 0;var o=i(73020),n=i(41682),r=i(12152),s=i(51850),_=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=n.BindingTypeEnum.Instance,this._binding.implementationType=t,new r.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!==typeof this._binding.serviceIdentifier)throw new Error(""+o.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=n.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=n.BindingScopeEnum.Singleton,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=n.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new r.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=n.BindingTypeEnum.Constructor,this._binding.implementationType=t,this._binding.scope=n.BindingScopeEnum.Singleton,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=n.BindingTypeEnum.Factory,this._binding.factory=t,this._binding.scope=n.BindingScopeEnum.Singleton,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!==typeof t)throw new Error(o.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=n.BindingTypeEnum.Function,this._binding.scope=n.BindingScopeEnum.Singleton,e},t.prototype.toAutoFactory=function(t){return this._binding.type=n.BindingTypeEnum.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},this._binding.scope=n.BindingScopeEnum.Singleton,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=n.BindingTypeEnum.Provider,this._binding.provider=t,this._binding.scope=n.BindingScopeEnum.Singleton,new s.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue((function(e){return e.container.get(t)}))},t}();e.BindingToSyntax=_},51850:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenOnSyntax=void 0;var o=i(19042),n=i(19586),r=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new n.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new o.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingWhenOnSyntax=r},19586:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenSyntax=void 0;var o=i(19042),n=i(1744),r=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new o.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=n.namedConstraint(t),new o.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new o.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=n.taggedConstraint(t)(e),new o.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return n.typeConstraint(t)(e.parentRequest)},new o.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return n.namedConstraint(t)(e.parentRequest)},new o.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(i){return n.taggedConstraint(t)(e)(i.parentRequest)},new o.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return n.traverseAncerstors(e,n.typeConstraint(t))},new o.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!n.traverseAncerstors(e,n.typeConstraint(t))},new o.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return n.traverseAncerstors(e,n.namedConstraint(t))},new o.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!n.traverseAncerstors(e,n.namedConstraint(t))},new o.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(i){return n.traverseAncerstors(i,n.taggedConstraint(t)(e))},new o.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(i){return!n.traverseAncerstors(i,n.taggedConstraint(t)(e))},new o.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return n.traverseAncerstors(e,t)},new o.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!n.traverseAncerstors(e,t)},new o.BindingOnSyntax(this._binding)},t}();e.BindingWhenSyntax=r},1744:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.typeConstraint=e.namedConstraint=e.taggedConstraint=e.traverseAncerstors=void 0;var o=i(76899),n=i(40491);e.traverseAncerstors=function t(e,i){var o=e.parentRequest;return null!==o&&(!!i(o)||t(o,i))};var r=function(t){return function(e){var i=function(i){return null!==i&&null!==i.target&&i.target.matchesTag(t)(e)};return i.metaData=new n.Metadata(t,e),i}};e.taggedConstraint=r;var s=r(o.NAMED_TAG);e.namedConstraint=s;e.typeConstraint=function(t){return function(e){var i=null;if(null!==e){if(i=e.bindings[0],"string"===typeof t)return i.serviceIdentifier===t;var o=e.bindings[0].implementationType;return t===o}return!1}}},7344:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=void 0;e.multiBindToService=function(t){return function(e){return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return i.forEach((function(i){return t.bind(i).toService(e)}))}}}},76254:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.isStackOverflowExeption=void 0;var o=i(73020);e.isStackOverflowExeption=function(t){return t instanceof RangeError||t.message===o.STACK_OVERFLOW}},4442:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.id=void 0;var i=0;e.id=function(){return i++}},48749:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.circularDependencyToException=e.listMetadataForTarget=e.listRegisteredBindingsForServiceIdentifier=e.getServiceIdentifierAsString=e.getFunctionName=void 0;var o=i(73020);function n(t){return"function"===typeof t?t.name:"symbol"===typeof t?t.toString():t}function r(t,e){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===e||r(t.parentRequest,e))}function s(t){if(t.name)return t.name;var e=t.toString(),i=e.match(/^function\s*([^\s(]+)/);return i?i[1]:"Anonymous function: "+e}e.getServiceIdentifierAsString=n,e.listRegisteredBindingsForServiceIdentifier=function(t,e,i){var o="",n=i(t,e);return 0!==n.length&&(o="\nRegistered bindings:",n.forEach((function(t){var e="Object";null!==t.implementationType&&(e=s(t.implementationType)),o=o+"\n "+e,t.constraint.metaData&&(o=o+" - "+t.constraint.metaData)}))),o},e.circularDependencyToException=function t(e){e.childRequests.forEach((function(e){if(r(e,e.serviceIdentifier)){var i=function(t){var e=function t(e,i){void 0===i&&(i=[]);var o=n(e.serviceIdentifier);return i.push(o),null!==e.parentRequest?t(e.parentRequest,i):i}(t);return e.reverse().join(" --\x3e ")}(e);throw new Error(o.CIRCULAR_DEPENDENCY+" "+i)}t(e)}))},e.listMetadataForTarget=function(t,e){if(e.isTagged()||e.isNamed()){var i="",o=e.getNamedTag(),n=e.getCustomTags();return null!==o&&(i+=o.toString()+"\n"),null!==n&&n.forEach((function(t){i+=t.toString()+"\n"}))," "+t+"\n "+t+" - "+i}return" "+t},e.getFunctionName=s},98734:function(t,e,i){i.r(e),i.d(e,{__assign:function(){return r},__asyncDelegator:function(){return E},__asyncGenerator:function(){return y},__asyncValues:function(){return k},__await:function(){return b},__awaiter:function(){return l},__classPrivateFieldGet:function(){return I},__classPrivateFieldSet:function(){return A},__createBinding:function(){return u},__decorate:function(){return _},__exportStar:function(){return h},__extends:function(){return n},__generator:function(){return d},__importDefault:function(){return N},__importStar:function(){return O},__makeTemplateObject:function(){return T},__metadata:function(){return c},__param:function(){return a},__read:function(){return g},__rest:function(){return s},__spread:function(){return f},__spreadArray:function(){return m},__spreadArrays:function(){return v},__values:function(){return p}});var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},o(t,e)};function n(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var r=function(){return r=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},r.apply(this,arguments)};function s(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i}function _(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var _=t.length-1;_>=0;_--)(n=t[_])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s}function a(t,e){return function(i,o){e(i,o,t)}}function c(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)}function l(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{a(o.next(t))}catch(e){r(e)}}function _(t){try{a(o.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,_)}a((o=o.apply(t,e||[])).next())}))}function d(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:_(0),throw:_(1),return:_(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function _(r){return function(_){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(_){r=[6,_],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,_])}}}var u=Object.create?function(t,e,i,o){void 0===o&&(o=i),Object.defineProperty(t,o,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,o){void 0===o&&(o=i),t[o]=e[i]};function h(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||u(e,t,i)}function p(t){var e="function"===typeof Symbol&&Symbol.iterator,i=e&&t[e],o=0;if(i)return i.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(t,e){var i="function"===typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,n,r=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(_){n={error:_}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return s}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(g(arguments[e]));return t}function v(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var o=Array(t),n=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,_=r.length;s<_;s++,n++)o[n]=r[s];return o}function m(t,e,i){if(i||2===arguments.length)for(var o,n=0,r=e.length;n<r;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}function b(t){return this instanceof b?(this.v=t,this):new b(t)}function y(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,n=i.apply(t,e||[]),r=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(t){n[t]&&(o[t]=function(e){return new Promise((function(i,o){r.push([t,e,i,o])>1||_(t,e)}))})}function _(t,e){try{(i=n[t](e)).value instanceof b?Promise.resolve(i.value.v).then(a,c):l(r[0][2],i)}catch(o){l(r[0][3],o)}var i}function a(t){_("next",t)}function c(t){_("throw",t)}function l(t,e){t(e),r.shift(),r.length&&_(r[0][0],r[0][1])}}function E(t){var e,i;return e={},o("next"),o("throw",(function(t){throw t})),o("return"),e[Symbol.iterator]=function(){return this},e;function o(o,n){e[o]=t[o]?function(e){return(i=!i)?{value:b(t[o](e)),done:"return"===o}:n?n(e):e}:n}}function k(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=p(t),e={},o("next"),o("throw"),o("return"),e[Symbol.asyncIterator]=function(){return this},e);function o(i){e[i]=t[i]&&function(e){return new Promise((function(o,n){(function(t,e,i,o){Promise.resolve(o).then((function(e){t({value:e,done:i})}),e)})(o,n,(e=t[i](e)).done,e.value)}))}}}function T(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var w=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e};function O(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&u(e,t,i);return w(e,t),e}function N(t){return t&&t.__esModule?t:{default:t}}function I(t,e,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(t):o?o.value:e.get(t)}function A(t,e,i,o,n){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?n.call(t,i):n?n.value=i:e.set(t,i),i}},47188:function(t){t.exports={i8:"0.29.0-47"}}}]);
//# sourceMappingURL=blink.20f34231.js.map